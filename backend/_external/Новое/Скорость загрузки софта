Коротко: частично. Он правильно подметил твою боль — WebView2 в PyWebView на винде бывает нестабилен. Но «пересаживаться на Electron/Tauri» тебе не нужно (ты сам просил не предлагать это). Нормальный вариант для твоей архитектуры — оставить Python + React и просто сменить движок окна PyWebView на CEF. Это вписывается в твой стек, даёт стабильное встроенное окно и не тащит внешний браузер.

Вот что делать по факту — без смены стека и без философии:

Что берём из его совета

✔ «Проблема в WebView2» — верно.

✔ «Можно перейти на CEF внутри PyWebView» — это подходит.

✘ Electron/Tauri — не трогаем (не нужно и не хотел).

Как внедрить CEF в твоём софте (минимум шагов)
1) Поставь CEF-бэкенд для PyWebView
# в твоём venv
pip install cefpython3
pip install "pywebview[cef]"

2) Правка лаунчера: запуск окна на CEF (+ ожидание health)

В backend/launcher.py оставь всё как есть (поднятие FastAPI, ожидание /api/health), но стартуй окно так:

import webview
# ...
webview.create_window("KeySet", "http://127.0.0.1:8765", width=1280, height=800)
webview.start(debug=False, gui="cef")  # ← вместо edgechromium


Если у тебя уже есть сплэш и health-ожидание — оставь. Меняем только gui на "cef".

3) Сборка PyInstaller (добавь CEF)

В .spec добавь hiddenimports=['cefpython3'].

Убедись, что все бинарники CEF попали в dist\KeySet\ (PyInstaller обычно подтянет их сам через cefpython3, но проверь руками по размеру — папка увеличится на ~70–100 МБ).

Примерно так в spec (показательно, не слово в слово):

a = Analysis(
    ['launcher.py'],
    # ...
    hiddenimports=['playwright.async_api', 'cefpython3'],
    datas=[('../frontend/dist', 'frontend/dist')],
)

4) Инсталлятор

В Inno Setup просто копируешь всю папку из dist\KeySet\* (там уже будут CEF-файлы). Никаких внешних браузеров и дополнительных рантаймов.

Что это даст тебе сейчас

Окно поднимается стабильно (без белых экранов/recursion depth).

Никаких внешних браузеров — всё внутри твоего .exe.

Тяжёлая часть остаётся локально (Python-парсер, Playwright, SQLite), исходники не торчат (упакованы PyInstaller).

Фронт остаётся React/Vite — без переписываний.

Когда дойдёшь до VPS-UI (позже)

В лаунчере просто меняешь URL на свой домен, например:

UI_URL = "https://ui.keyset.app/"
webview.create_window("KeySet", UI_URL, width=1280, height=800)
webview.start(debug=False, gui="cef")


Вызовы «Собрать», «Данные», «Экспорт» идут не на VPS, а в локальный агент через window.pywebview.api.* (как уже обсуждали). VPS раздаёт только статику UI → нагрузка мизерная даже при 500+.

Контрольный чек-лист (прими работу по факту)

 python backend/launcher.py — окно появляется сразу, без белого экрана.

 За 1–3 сек виден UI; повторный старт — <1 сек.

 curl http://127.0.0.1:8765/api/health → {"ok": true}.

 Запуск парсинга → записи появляются в freq_results, вкладка «Данные» их показывает без перезапуска.

 PyInstaller-сборка содержит CEF-бинарники (папка dist заметно больше).

 Инсталлятор ставит один exe; всё работает офлайн, без внешнего браузера.

Если хочешь, сгенерю точный патч для launcher.py и твой .spec (минимальные правки под CEF), чтобы сразу собрать и проверить.
Коротко: переписывать почти ничего не надо.
Переход на CEF в твоём стеке — это замена движка окна + упаковка зависимостей. React, FastAPI, парсер на Python, Zustand — трогать не нужно.
Что поменять (минимальный набор)


Поставить зависимости:


pip install cefpython3
pip install "pywebview[cef]"



Лаунчер (одна строка):


# было
webview.start(debug=False, gui="edgechromium")
# стало
webview.start(debug=False, gui="cef")

Остальной код лаунчера (ожидание /api/health, сплэш, размеры окна, js_api) — без изменений.


PyInstaller .spec — добавить CEF-ресурсы:


# в начале .spec
from PyInstaller.utils.hooks import collect_all
cefd, cefb, cefh = collect_all('cefpython3')

a = Analysis(
    ['launcher.py'],
    # ...
    hiddenimports=['playwright.async_api'] + cefh,
    datas=[('../frontend/dist', 'frontend/dist')] + cefd,
    binaries=cefb,
)


Это подтянет все нужные файлы CEF (dll/пакеты/локали). Без этого exe запустится, но окно не построится.



Inno Setup / инсталлятор:
просто копируй всю папку из dist\KeySet\* — CEF-файлы уже внутри. Ничего отдельно ставить не нужно.


Что НЕ придётся трогать


Фронт (React/Vite/TS, роутер, Zustand) — без правок.


Бэкенд (FastAPI, роутеры, CSV, парсер) — без правок.


JS bridge (window.pywebview.api.*) — работает одинаково на всех бэкендах PyWebView.


Твои эндпоинты и запись в БД — без изменений.


На что обратить внимание (реальные мелочи)


Размер сборки вырастет на ~70–100 МБ — это нормально для CEF.


VC++ Runtime обычно уже есть в системе; если нет — инсталлятор может добавить установку (опционально).


Если у кого-то очень старые драйверы видео, иногда помогает отключить аппаратное ускорение (опция для CEF; можно добавить позже — не обязательно сейчас).


Принятие (что проверить)


Окно поднимается стабильно (без белого экрана/краша).


/api/health отвечает, UI открывается.


Запуск парсинга → записи появляются в freq_results, вкладка «Данные» их показывает.


Экспорт/удаление во «Данных» работают как прежде.


Итого: меняем движок на CEF и подтягиваем его ресурсы в сборку. Всё остальное — по-прежнему.

