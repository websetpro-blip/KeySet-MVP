# ПОЛНЫЙ ФУНКЦИОНАЛЬНЫЙ АНАЛИЗ AdsCreator v4.14.xlsb

## Дата анализа: 2025-11-16

---

## 1. АРХИТЕКТУРА И ЛИСТЫ EXCEL

### Основные листы файла:
1. **AdsCreator** - Главный лист с интерфейсом
2. **Параметры** - Настройки (заголовки, тексты, добавки к H2)
3. **Яндекс Директ** - Выходная таблица (финальные объявления)
4. **Google Adwords** - Аналогично для Google (опциональный экспорт)

### Скрытые компоненты:
- VBA-макросы (в модулях: обработка логики, навигация, экспорт)
- Именованные диапазоны (для формул подстановки)
- Таблицы (ListObjects: Таблица10, Таблица7, и т.д.)

---

## 2. ПОЛЬЗОВАТЕЛЬСКИЙ ПОТОК (7 ШАГОВ)

### ШАГ 1: Ввод ключевых фраз
**Элемент:** Текстовое поле (textarea) в левой панели листа AdsCreator
```
Максимум: 1000 ключей
Максимум символов: 8192
Формат: одна фраза на строку
Поддержка: минус-слова (например: "купить -дешево -цена")
```
**Что происходит:**
- Пользователь вводит или вставляет ключи
- Система подсчитывает количество уникальных фраз
- Проверяет общую длину (максимум 8192 символов)
- Выводит предупреждение при превышении

**Соседние поля:**
- ID группы (опциональное, для редактирования старых объявлений)
- Домен/лендинг (например: nordkor.ru или https://nordkor.ru)
- UTM-шаблон (опциональный, по умолчанию заполнен)

---

### ШАГ 2: Добавки к заголовку №2 (H2 Suffix)
**Элемент:** Таблица на листе Параметры, левая часть
```
Название таблицы: Таблица10
Максимум строк: 20
Максимум символов на строку: 30
```
**Что это делает:**
- Хранит варианты "добавок" или "суффиксов" для H2 заголовка
- Если ключ целиком помещается в H1 (≤56 символов), H2 заполняется одной из этих добавок
- Добавки отсортированы от длинных к коротким (критично!)
- Система подбирает максимально длинную добавку, которая поместится по лимиту H1+H2

**Примеры добавок:**
- "система под ключ за 70 190р!" (27 символов)
- "обезжелезиватели от 16 90р!" (26 символов)
- "за 16 90р!" (9 символов)

**Алгоритм выбора:**
1. Проверяем доступное место: `доступно = 65 - длина_H1 - 3` (где 3 это " — ")
2. Ищем первую добавку в списке, которая поместится
3. Формируем: `H2 = остаток_ключа - добавка`

---

### ШАГ 3: Варианты текста объявления
**Элемент:** Textarea на листе Параметры, центральная часть
```
Максимум вариантов: неограниченный (но рационально 3-5)
Лимит каждого: 81 символ (для Яндекс.Директ)
```
**Что это делает:**
- Каждый вариант на новой строке
- При генерации подставляются циклически: объявление №1 → вариант №1, объявление №2 → вариант №2, и т.д.
- Если вариантов меньше, чем объявлений, циклически повторяются (остаток % количество_вариантов)

**Пример:**
```
Ответьте на 5 вопросов и узнайте стоимость системы очистки воды в 3-х вариантах!
Системы очистки воды для загородного дома. Рассчитайте стоимость на сайте!
Подберите систему очистки воды, которая подойдет именно Вам!
```

---

### ШАГ 4: Редактирование заголовков (H1 и H2)
**Интерфейс:** 3 колонки на листе параметры
```
ЛЕВАЯ: список всех ключей (каждый как H1)
ЦЕНТР: правила подмены и редактирование H2
СПРАВА: предпросмотр результата в виде, как в Яндексе
```

**Функции в этом шаге:**

#### 4.1 Правила подмены (Substitution Rules)
**Задача:** Автоматически преобразовать текст по правилам

**Два набора правил:**
1. **Глобальные замены** (применяются ко всем полям)
2. **ГЕО/морфология** (специфические правила по полям)

**Структура каждого правила:**
```javascript
{
  type: "plain" | "regex",      // тип замены
  find: "искомый текст",         // что ищем
  replace: "на что заменить",    // на что меняем
  scope: ["key", "h1", "h2", ...] или ["*"]  // какие поля затрагивать
}
```

**Примеры правил:**
```javascript
// Замена стрелки на дефис
{ type: "plain", find: "→", replace: " - ", scope: ["h1", "h2", "txt"] }

// Замена плейсхолдера города
{ type: "regex", find: "\\{city\\}", replace: "Москва", scope: ["h1", "h2", "path"] }

// Удаление спецсимволов
{ type: "regex", find: "[^а-яa-z0-9\\s-]", replace: "", scope: ["*"] }

// Замена в слове "система"
{ type: "regex", find: "система", replace: "комплекс", scope: ["h1"] }
```

**Порядок применения:**
- Сверху вниз по списку
- Каждое правило применяется ко всему набору объявлений
- Результат одного правила становится входом для следующего

**Область видимости (scope):**
- `["*"]` - применить ко всем текстовым полям
- `["key", "h1", "h2", "txt"]` - только к этим полям
- Поля: key, h1, h2, txt, url, path, clar, sl1_text, sl1_desc, sl2_text, sl2_desc, и т.д.

#### 4.2 Кнопка "Обработать"
**Функция:** Применить все правила подмены к текущему набору объявлений
- Активирует все правила из обоих наборов
- Применяет их последовательно к каждому объявлению
- Обновляет h1 и h2 для всех строк
- Показывает результат в предпросмотре

#### 4.3 Ручное редактирование H1/H2
- Каждый заголовок редактируется в таблице
- Валидация длины в реальном времени
- Подсвечивание ошибок (если превышен лимит)

---

### ШАГ 5: Предпросмотр "как в Яндексе" (САМЫЙ ВАЖНЫЙ)

**Визуальное представление:** Полная имитация выдачи Яндекса
```
┌─────────────────────────────────────────────────────────┐
│ [Яндекс лого] система очистки воды из скважины [Найти]   │
│ ПОИСК | КАРТИНКИ | ВИДЕО | КАРТЫ | МАРКЕТ | НОВОСТИ     │
├─────────────────────────────────────────────────────────┤
│                                                         │
│ ≫ Система очистки воды из скважины! — Для частного!    │
│   (синий 18px жирный)                                  │
│                                                         │
│ [Распродажа] nordkor.ru/ скидка 30% до 15.05           │
│ | Видео отзывы | Заказать                              │
│   (зелёная отобр. ссылка 13px)                          │
│                                                         │
│ система очистки воды                                    │
│ Ответьте на 5 вопросов и узнайте стоимость системы     │
│   (чёрный текст 14px)                                  │
│                                                         │
│ [Быстрая доставка] [Гарантия] [Отзывы] [Без предоплат] │
│   (серые чипы)                                          │
│                                                         │
│ Контактная информация · +7 (800) 0000-000 · пн-пт ...  │
│   (серый текст 12px)                                   │
│                                                         │
│ ┌─────────┬─────────┬─────────┬─────────┐               │
│ │nordkor. │nordkor. │nordkor. │nordkor. │               │
│ │#1       │#2       │#3       │#4       │               │
│ │Бесплат. │Подбор   │Монтаж   │15 лет   │               │
│ │консул.  │on-line  │за 1 день│рынке    │               │
│ └─────────┴─────────┴─────────┴─────────┘               │
│                                                         │
│ Отображаемая ссылка динамическая? Да                   │
└─────────────────────────────────────────────────────────┘
```

**Элементы и их свойства:**

1. **Заголовок:**
   - Формат: `≫ {H1} — {H2}`
   - Цвет: #0066FF (синий)
   - Размер: 18px
   - Вес: bold
   - Символ "≫" ОБЯЗАТЕЛЕН

2. **Отображаемая ссылка:**
   - Формат: `[Префикс] домен/путь | постфиксы`
   - Цвет: #06884A (зелёный)
   - Размер: 13px
   - Префикс: в зелёной рамке
   - **КРИТИЧНО:** БЕЗ UTM параметров!

3. **Текст объявления:**
   - Цвет: #000 (чёрный)
   - Размер: 14px
   - Line-height: 1.4

4. **Уточнения (Clarifications):**
   - До 4 штук, каждое в отдельном "чипе"
   - Background: #F0F0F0
   - Border: 1px solid #DDD
   - Border-radius: 12px
   - Padding: 4px 10px
   - Размер: 12px

5. **Быстрые ссылки (Sitelinks):**
   - 4 колонки в таблице
   - Каждая содержит: название, якорь (#1, #2, #3, #4), описание
   - Цвет домена: #06884A (зелёный)
   - Цвет номера якоря: серый

---

### ШАГ 6: Финальная таблица (Выгрузка)

**Элемент:** Очень широкая таблица на листе "Яндекс Директ"
**Таблица:** Таблица10 на листе AdsCreator (источник) → копируется на "Яндекс Директ"

**Колонки в таблице (примерно 30+):**
```
1. Техподдержка (dropdown)
2. Название кампании
3. Добавить в существующую группу
4. ID Кампании
5. Название группы
6. Номер группы
7. Статус "Мало показов"
8. ID фразы
9. Ключевик словами
10. Фраза (с минус-словами)
11. ID Объявления
12. Заголовок 1
13. Заголовок 2
14. Текст объявления
15. Ссылка (с UTM)
16. Отображаемая ссылка
17. Регион
18. Ставка на Поиск
19. Статус объявления
20. Статус фразы
... и много других метаполей для Direct Commander
```

**Структура данных:**
- Каждая строка = одно объявление (ключ + заголовки + текст + ссылки)
- Первая строка: "ПОИСК:" (тип кампании)
- ID колонки (для кампании, группы, фразы, объявления) - пусты (заполнятся при загрузке через API)

---

## 3. ПОЛНЫЙ АЛГОРИТМ ГЕНЕРАЦИИ ОБЪЯВЛЕНИЙ

### 3.1 Вход
```javascript
const INPUT = {
  keys: ["ключ1", "ключ2", ..., "ключ1000"],      // массив ключевых фраз
  domain: "nordkor.ru",                            // базовый домен
  utm: "utm_source=yandex&utm_medium=cpc&utm_campaign={group}&utm_term={key}",
  h2Additions: ["добавка1", "добавка2", ...],      // список суффиксов для H2
  textVariants: ["текст1", "текст2", ...],         // варианты текста объявления
  rules: [                                          // правила подмены
    { type: "plain|regex", find: "X", replace: "Y", scope: ["*"|["h1","h2",...]] }
  ],
  clarifications: ["быстрая доставка", ..., ...],  // до 4 уточнений
  sitelinks: [                                      // быстрые ссылки
    { text: "Каталог", url: "/katalog", anchor: "catalog", desc: "Все товары" },
    ...
  ]
}
```

### 3.2 Обработка каждого ключа
```
ДЛЯ КАЖДОГО ключа:

1. РАЗБИЕНИЕ H1/H2:
   └─ Собрать H1 по словам, пока <= 56 символов
   └─ Остаток слов → в H2 (хвост)
   └─ Если хвоста нет → H2 из суффиксов (выбрать максимально длинный, что поместится)
   └─ Добавить "!" в конец H1 и H2

2. ПРИМЕНЕНИЕ ПРАВИЛ ПОДМЕНЫ:
   └─ Для каждого правила:
      └─ Если type=="plain": заменить все вхождения в указанные поля
      └─ Если type=="regex": применить регулярное выражение
      └─ scope: либо ["*"] (все поля), либо массив конкретных полей

3. ГЕНЕРАЦИЯ ТЕКСТА:
   └─ text = textVariants[индекс % количество_вариантов]
   └─ Обрезать до 81 символа

4. ГЕНЕРАЦИЯ URL:
   └─ base_url = "https://" + domain (нормализовать: удалить протокол, слеши в конце)
   └─ Подставить макросы в UTM:
      ├─ {key} → ключевая фраза (URL-encoded)
      ├─ {group} → первые 40 символов ключа
      ├─ {campaign} → имя кампании
   └─ final_url = base_url + "?" + utm

5. ОТОБРАЖАЕМАЯ ССЫЛКА (Path):
   └─ Взять base_url (домен)
   └─ Прибавить path (если задан)
   └─ Результат: домен/путь БЕЗ UTM

6. УТОЧНЕНИЯ:
   └─ Взять из единых настроек (до 4 штук)
   └─ Каждое максимум 66 символов

7. БЫСТРЫЕ ССЫЛКИ (SL1-SL4):
   └─ Для каждой из 4 ссылок:
      ├─ text (максимум 30 символов)
      ├─ url (полный URL)
      ├─ anchor (якорь, например: "catalog")
      ├─ desc (описание, максимум 60 символов)

8. РЕЗУЛЬТАТ:
   └─ Одна строка AdRow:
      {
        key: "ключ1",
        h1: "Заголовок 1!",
        h2: "Заголовок 2!",
        txt: "Текст объявления...",
        url: "https://nordkor.ru?utm_source=...",
        path: "katalog/filtry",
        clar: "Быстрая доставка\nГарантия\nОтзывы\nБез предоплат",
        sl1_text: "Каталог", sl1_url: "https://nordkor.ru/katalog", sl1_anchor: "catalog", sl1_desc: "Все товары",
        sl2_text: "Цены",   sl2_url: "https://nordkor.ru/price",   sl2_anchor: "price",   sl2_desc: "Акции и скидки",
        sl3_text: "Доставка", sl3_url: "https://nordkor.ru/delivery", sl3_anchor: "delivery", sl3_desc: "За 1 день",
        sl4_text: "Контакты", sl4_url: "https://nordkor.ru/contacts", sl4_anchor: "contacts", sl4_desc: "Звонок бесплатно"
      }
```

---

## 4. ЛИМИТЫ И ВАЛИДАЦИЯ

```javascript
const LIMITS = {
  H1: 56,                    // Заголовок 1
  H2: 56,                    // Заголовок 2
  H1_H2_SUM: 65,             // H1 + " — " + H2 (для проверки формата отображения)
  TEXT: 81,                  // Текст объявления
  PATH: 20,                  // Отображаемый путь
  CLARIFICATION: 66,         // Одно уточнение
  CLARIFICATION_COUNT: 4,    // Максимум уточнений
  SITELINK_TEXT: 30,         // Текст быстрой ссылки
  SITELINK_DESC: 60,         // Описание быстрой ссылки
  SITELINK_COUNT: 4,         // Максимум быстрых ссылок
  KEYS_TOTAL_CHARS: 8192,    // Максимум символов в поле ключей
  KEYS_COUNT: 1000,          // Максимум ключевых фраз
  H2_ADDITIONS: 20           // Максимум вариантов добавления к H2
};
```

### Валидация:
1. **H1 > 56** → Подсвечивание красным + подсказка
2. **H2 > 56** → Подсвечивание красным + подсказка
3. **Text > 81** → Подсвечивание красным + подсказка
4. **Пустые обязательные поля (ключ, H1, URL)** → Предупреждение
5. **Дубликаты ключей** → Объединение или помечение
6. **Превышение общей длины ключей** → Ошибка ввода

### Кнопка "Подрезать по лимитам":
- H1: обрезать до 56, добавить "…" если обрезано
- H2: обрезать до 56, добавить "…" если обрезано
- Text: обрезать до 81, добавить "…" если обрезано

---

## 5. ЭКСПОРТ В CSV (Direct Commander)

### Формат:
```
Кодировка: UTF-8 с BOM (\ufeff)
Разделитель: ;
Первая строка: Заголовки
```

### Заголовки (точный порядок):
```
Кампания;Группа;Ключевая фраза;Заголовок 1;Заголовок 2;Текст;Ссылка;Отображаемая ссылка;Уточнения;SL1;SL1 URL;SL1 Anchor;SL1 Desc;SL2;SL2 URL;SL2 Anchor;SL2 Desc;SL3;SL3 URL;SL3 Anchor;SL3 Desc;SL4;SL4 URL;SL4 Anchor;SL4 Desc
```

### Данные в каждой строке:
```
Кампания: "AUTO-2025-11-16" (дата генерации)
Группа: первые 80 символов ключа
Ключевая фраза: полный ключ (с минус-словами, если были)
Заголовок 1: H1
Заголовок 2: H2
Текст: текст объявления
Ссылка: полная URL с UTM
Отображаемая ссылка: домен/путь БЕЗ UTM
Уточнения: "уточнение1 | уточнение2 | уточнение3 | уточнение4"
SL1: текст первой быстрой ссылки
SL1 URL: URL первой быстрой ссылки
SL1 Anchor: якорь (#1, #2, и т.д.)
SL1 Desc: описание первой быстрой ссылки
... (аналогично для SL2, SL3, SL4)
```

### Пример строки CSV:
```csv
AUTO-2025-11-16;система очистки воды из скважины для частного;система очистки воды из скважины для частного;Система очистки воды из скважины!;Для частного!;Ответьте на 5 вопросов и узнайте стоимость системы очистки воды в 3-х вариантах!;https://nordkor.ru?utm_source=yandex&utm_medium=cpc&utm_campaign=sistema_ochistki_vody&utm_term=sistema%20ochistki%20vody%20iz%20skvazhiny;nordkor.ru/sistema-ochistki;Быстрая доставка | Гарантия | Отзывы клиентов | Без предоплат;Каталог;https://nordkor.ru/katalog;catalog;Все модели;Цены;https://nordkor.ru/price;price;Акции и скидки;Доставка;https://nordkor.ru/delivery;delivery;За 1 день;Контакты;https://nordkor.ru/contacts;contacts;Звонок бесплатно
```

### Обработка специальных символов:
- Если в поле содержится `;` или `"` или `\n` → обернуть в двойные кавычки
- `"` внутри заменять на `""`

---

## 6. ИНТЕГРАЦИЯ С GOOGLE ADWORDS (ОПЦИОНАЛЬНО)

Аналогично Яндекс.Директ, но:
- Лимит текста: 80 символов (вместо 81)
- Структура CSV немного отличается
- Таблица экспортируется на отдельный лист "Google Adwords"

---

## 7. КНОПКА "СГЕНЕРИРОВАТЬ С ИИ" (Gemini API)

### Когда нажимаем эту кнопку:

**Запрос на бэкенд:**
```javascript
POST /api/ai/ads/generate

{
  "keys": ["ключ1", "ключ2", ...],
  "domain": "nordkor.ru",
  "utm": "utm_source=yandex&utm_medium=cpc&utm_campaign={group}&utm_term={key}",
  "locale": "ru",
  "mode": "serp",                    // анализ SERP (выдача поисковых систем)
  "limits": {
    "h1": 56,
    "h2": 56,
    "body": 81
  }
}
```

### Что делает ИИ на бэкенде:

1. **Анализ SERP (Search Engine Result Page):**
   - Получает топ-10 результатов поиска по каждому ключу
   - Анализирует заголовки и описания конкурентов
   - Ищет общие паттерны и УТП (уникальные торговые предложения)

2. **Анализ объявлений конкурентов:**
   - Смотрит, как конкуренты формируют заголовки (H1/H2)
   - Какие слова они используют
   - Структуру текста

3. **Генерация объявлений:**
   - Создаёт H1: включает ключевое слово, указывает основной УТП
   - Создаёт H2: дополнительное преимущество или УТП
   - Генерирует текст: выгода, логика, CTA (Call to Action)
   - Подбирает уточнения: 3-5 ключевых преимуществ
   - Генерирует быстрые ссылки: Каталог, Цены, Доставка, Контакты

4. **Гарантии качества:**
   - Все поля заполнены полностью
   - Соблюдены лимиты (H1≤56, H2≤56, Text≤81)
   - Ключевое слово обязательно в H1 или H2
   - Текст логичен и привлекательный
   - Релевантность: 10/10
   - CTR (вероятность клика): 10/10

### Ответ от ИИ:
```javascript
{
  "rows": [
    {
      "key": "ключ1",
      "h1": "Сгенерированный H1...",
      "h2": "Сгенерированный H2...",
      "txt": "Сгенерированный текст...",
      "url": "https://domain.ru?utm_...",
      "path": "path-to-page",
      "clar": "Преимущество 1\nПреимущество 2\nПреимущество 3\nПреимущество 4",
      "sl1_text": "Каталог", "sl1_url": "...", "sl1_anchor": "catalog", "sl1_desc": "...",
      "sl2_text": "Цены", "sl2_url": "...", "sl2_anchor": "price", "sl2_desc": "...",
      "sl3_text": "Доставка", "sl3_url": "...", "sl3_anchor": "delivery", "sl3_desc": "...",
      "sl4_text": "Контакты", "sl4_url": "...", "sl4_anchor": "contacts", "sl4_desc": "..."
    },
    ...
  ]
}
```

---

## 8. VBA МАКРОСЫ (основные)

### Основные макросы:

1. **NextButton_Click** - Кнопка "Далее"
   - Проверяет заполненность полей
   - Переходит на следующий шаг (лист)
   - Сохраняет данные в именованные диапазоны

2. **BackButton_Click** - Кнопка "Назад"
   - Возвращается на предыдущий шаг
   - Восстанавливает сохранённые данные

3. **ApplyRules_Click** - Кнопка "Обработать" (применить правила)
   - Читает правила подмены из настроек
   - Применяет их к текущему набору объявлений
   - Обновляет H1/H2 для всех строк

4. **ExportCSV** - Экспорт в CSV
   - Формирует таблицу с правильной структурой
   - Добавляет BOM для кириллицы
   - Сохраняет файл с датой-временем

5. **GenerateAds** - Генерация объявлений
   - Разбивает ключи на H1/H2
   - Применяет текстовые варианты
   - Генерирует URL с UTM
   - Заполняет все поля объявления

---

## 9. РЕЖИМ КОПИРОВАНИЯ И ИМПОРТ

### Режим копирования (Copy Mode):

**Что это:**
- Переключение таблицы в plain text вид
- Можно выделить мышью любой прямоугольник (как в Excel)
- Скопировать и вставить куда угодно

**Три способа копирования:**

1. **Копировать как TSV (Tab-Separated Values)**
   - Таблица преобразуется в текст с табуляциями
   - Можно вставить в Excel, Word, Google Docs
   - Все поля сохраняются

2. **Копировать только ключи**
   - Вывести одну колонку с ключами
   - Удобно для вставки в Yandex Wordstat
   - Для проверки частотности

3. **Копировать весь CSV**
   - Экспорт в полный формат Direct Commander
   - Файл готов для загрузки в Яндекс

---

## 10. ЛОКАЛЬНОЕ СОХРАНЕНИЕ (LocalStorage)

**Что сохраняется:**
```javascript
{
  keys: string,           // введённые ключи
  domain: string,         // домен
  utm: string,            // UTM-шаблон
  h2Suffix: string,       // суффиксы H2
  textVariants: string,   // текстовые варианты
  rules: [                // правила подмены
    { type, find, replace, scope }
  ],
  clarifications: [...]   // уточнения
  sitelinks: [...]        // быстрые ссылки
}
```

**Когда сохраняется:**
- Автоматически при каждом изменении поля
- В браузерном хранилище (не на сервере)

**Восстановление:**
- При открытии страницы снова
- Если данные потеряны (очистка кэша) → восстановить нельзя

---

## 11. ДОПОЛНИТЕЛЬНЫЕ ФУНКЦИИ

### 11.1 Быстрое добавление быстрых ссылок
**Кнопка:** "+ Быстрые ссылки (4)"
```
Заполняет стандартный набор:
- Каталог → /katalog → catalog → "Все модели"
- Цены → /price → price → "Акции и скидки"
- Доставка → /delivery → delivery → "За 1 день"
- Контакты → /contacts → contacts → "Звонок бесплатно"
```

### 11.2 Подсчёт символов в реальном времени
- H1: показывает текущую длину и максимум (56)
- H2: показывает текущую длину и максимум (56)
- Text: показывает текущую длину и максимум (81)

### 11.3 Синхронизация настроек
**Кнопка:** "Применить настройки ко всем"
- Берёт единые настройки (быстрые ссылки, уточнения, путь)
- Применяет их ко ВСЕМ объявлениям одновременно
- Экономит время при массовом редактировании

---

## 12. ИНТЕГРАЦИЯ С ЯНДЕКС.ДИРЕКТ (API v5)

### Загрузка в Яндекс через API:

**Кнопка:** "Загрузить в Яндекс Директ" (опциональная)

**Требуемые данные:**
```javascript
{
  auth: {
    token: "Ваш токен API",
    login: "Ваш логин Яндекса"
    sandbox: true/false           // true = тестовая загрузка
  },
  campaign: {
    name: "Название кампании"
  },
  groups: [
    {
      name: "Название группы",
      keywords: ["ключ1", "ключ2", ...],
      ads: [
        {
          title1: "Заголовок 1",
          title2: "Заголовок 2",
          text: "Текст",
          url: "https://..."
        }
      ]
    }
  ]
}
```

**Что происходит на сервере:**
1. Создаётся кампания (если её нет)
2. Для каждой группы: создаётся AdGroup
3. В каждой группе: создаются TextAds (объявления)
4. Для каждого объявления: добавляются Keywords (ключевые фразы)
5. Возвращаются IDs созданных объектов

**Ответ:**
```javascript
{
  "request_id": "12345",
  "campaign_id": 67890,
  "groups": [
    {
      "adgroup_id": 11111,
      "ads_ids": [111, 222, 333],
      "keyword_ids": [1001, 1002, 1003]
    }
  ]
}
```

---

## 13. ТИПИЧНЫЕ ОШИБКИ И РЕШЕНИЯ

### Ошибка 1: "Run-time error '9': Subscript out of range"
**Причина:** Макрос ищет таблицу Таблица7, которой нет
**Решение:** 
- Переименовать таблицы согласно коду VBA
- Или исправить VBA на правильные имена

### Ошибка 2: "Превышение лимита H1/H2"
**Решение:**
- Нажать "Подрезать по лимитам"
- Или вручную отредактировать

### Ошибка 3: "Пустые уточнения"
**Решение:**
- Нажать "+ Быстрые ссылки" для автозаполнения
- Или заполнить вручную в единых настройках

### Ошибка 4: "CSV не открывается в Excel"
**Причина:** Нет BOM, неправильный разделитель
**Решение:**
- Убедиться, что используется ;
- Убедиться, что UTF-8 с BOM (\ufeff)

---

## 14. ПРОИЗВОДИТЕЛЬНОСТЬ И ОГРАНИЧЕНИЯ

**Что может обработать:**
- До 1000 ключевых фраз одновременно
- До 20 вариантов добавок к H2
- До 20 правил подмены
- До 10 текстовых вариантов
- Генерация всех 1000 объявлений: <5 сек (на современном ПК)

**Память:**
- Каждое объявление занимает ~1-2 KB
- 1000 объявлений = 1-2 MB в памяти браузера

**Пропускная способность:**
- Экспорт 1000 объявлений в CSV: <1 сек
- Копирование в буфер обмена: <1 сек

---

## 15. ЧЕКЛИСТ ДЛЯ ВОСПРОИЗВЕДЕНИЯ В ВЕБ-ВЕРСИИ

### P0 - Критично:
- [ ] Двухколоночный интерфейс (левая панель 280px, правая широкая)
- [ ] Ввод ключей (textarea, 8192 символов, до 1000 фраз)
- [ ] Excel-like таблица (все колонки, inline редактирование)
- [ ] Предпросмотр "как в Яндексе" (sticky, компактный, без белой плашки)
- [ ] Правила подмены (2 RuleSet, plain|regex, scope)
- [ ] Экспорт CSV (UTF-8 BOM, ;, точная шапка для Commander)
- [ ] Лимиты и валидация (H1 56, H2 56, Text 81)

### P1 - Важно:
- [ ] Кнопка "Сгенерировать с ИИ" (POST /api/ai/ads/generate)
- [ ] Режим копирования (plain text таблица)
- [ ] Копировать как TSV и копировать только ключи
- [ ] Быстрые ссылки (SL1-SL4 с текстом, URL, anchor, desc)
- [ ] Единые настройки в левой панели
- [ ] Сохранение в LocalStorage (черновик)

### P2 - Улучшения:
- [ ] Resizable columns
- [ ] Sticky headers в таблице
- [ ] Валидация и подсветка ошибок
- [ ] Загрузка в API v5 (опционально)
- [ ] Предпросмотр правил подмены

---

## ИТОГОВОЕ РЕЗЮМЕ

**AdsCreator v4.14.xlsb** - это профессиональный инструмент для создания рекламных кампаний Яндекс.Директ за несколько кликов.

**На вход:** до 1000 ключевых фраз
**На выход:** полностью заполненные объявления (H1/H2/текст/URL/уточнения/быстрые ссылки)

**Основные возможности:**
1. Интеллектуальное разбиение заголовков (H1/H2) с учётом лимитов
2. Правила подмены (regex и plain text)
3. Циклическое распределение текстовых вариантов
4. Предпросмотр как в реальной выдаче Яндекса
5. Экспорт в Direct Commander (CSV)
6. Интеграция с ИИ (Gemini) для умной генерации
7. Быстрое копирование (TSV, только ключи)
8. Загрузка в Яндекс.Директ API v5 (опционально)

**Все лимиты:** H1≤56, H2≤56, Text≤81, Clarification≤66, SiteLink Text≤30, SiteLink Desc≤60

