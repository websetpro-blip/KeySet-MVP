<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>–ì–µ–Ω–µ—Ä–∞—Ç–æ—Ä –æ–±—ä—è–≤–ª–µ–Ω–∏–π –Ø–Ω–¥–µ–∫—Å.–î–∏—Ä–µ–∫—Ç - AdsCreator v4.14</title>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            background: #f5f5f5;
            overflow: hidden;
        }

        .ads-app {
            display: flex;
            flex-direction: column;
            height: 100vh;
        }

        /* HEADER */
        .ads-header {
            padding: 20px 30px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
        }

        .ads-header h1 {
            margin: 0;
            font-size: 24px;
            font-weight: 600;
        }

        .ads-subtitle {
            margin: 5px 0 0 0;
            opacity: 0.9;
            font-size: 14px;
        }

        /* CONTENT */
        .ads-content {
            display: flex;
            flex: 1;
            overflow: hidden;
        }

        /* –õ–ï–í–ê–Ø –ü–ê–ù–ï–õ–¨ */
        .ads-sidebar {
            width: 350px;
            background: #fafafa;
            border-right: 1px solid #e0e0e0;
            overflow-y: auto;
            padding: 20px;
            display: flex;
            flex-direction: column;
            gap: 15px;
        }

        .ads-section {
            background: white;
            border-radius: 8px;
            padding: 15px;
            box-shadow: 0 1px 3px rgba(0, 0, 0, 0.1);
        }

        .ads-section h2 {
            margin: 0 0 15px 0;
            font-size: 16px;
            font-weight: 600;
            color: #333;
        }

        .ads-section label {
            display: block;
            font-size: 12px;
            font-weight: 600;
            color: #666;
            margin-bottom: 4px;
        }

        .ads-input,
        .ads-textarea {
            width: 100%;
            padding: 10px;
            border: 1px solid #ddd;
            border-radius: 6px;
            font-size: 14px;
            font-family: inherit;
            background-color: white;
            margin-bottom: 10px;
        }

        .ads-textarea {
            resize: vertical;
            min-height: 80px;
        }

        .ads-hint {
            font-size: 11px;
            color: #999;
            margin-top: -5px;
            margin-bottom: 10px;
        }

        .btn-generate {
            width: 100%;
            padding: 14px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border: none;
            border-radius: 6px;
            font-size: 15px;
            font-weight: 600;
            cursor: pointer;
            transition: transform 0.2s, box-shadow 0.2s;
            box-shadow: 0 4px 12px rgba(102, 126, 234, 0.3);
            margin-bottom: 10px;
        }

        .btn-generate:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 16px rgba(102, 126, 234, 0.4);
        }

        .btn-export {
            width: 100%;
            padding: 10px;
            background: white;
            color: #667eea;
            border: 2px solid #667eea;
            border-radius: 6px;
            font-size: 13px;
            font-weight: 600;
            cursor: pointer;
            margin-bottom: 5px;
        }

        .btn-export:hover {
            background: #f0f0ff;
        }

        /* –¶–ï–ù–¢–†–ê–õ–¨–ù–ê–Ø –ß–ê–°–¢–¨ */
        .ads-main {
            flex: 1;
            overflow-y: auto;
            padding: 20px;
            display: flex;
            flex-direction: column;
            gap: 20px;
        }

        /* –Ø–ù–î–ï–ö–° –ü–†–ï–í–¨–Æ */
        .yandex-preview {
            background: #ffffff;
            border: 1px solid #d4d4d4;
            border-radius: 8px;
            padding: 10px 18px 25px;
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
        }

        .top-row {
            display: flex;
            align-items: center;
            margin-bottom: 10px;
        }

        .logo {
            margin-right: 20px;
            text-align: center;
            line-height: 1.1;
        }

        .logo-main {
            font-size: 24px;
            font-weight: bold;
            color: #000;
        }

        .logo-main span {
            color: #d41313;
        }

        .logo-sub {
            font-size: 11px;
            color: #666;
        }

        .search-area {
            flex: 1;
        }

        .search-top {
            display: flex;
            align-items: center;
            margin-bottom: 4px;
        }

        .search-input {
            flex: 1;
            padding: 5px 7px;
            border: 1px solid #b7b7b7;
            font-size: 13px;
        }

        .search-controls {
            display: flex;
            align-items: center;
            gap: 10px;
            margin-left: 8px;
        }

        .icon-btn {
            width: 18px;
            height: 18px;
            border-radius: 50%;
            border: 1px solid #c0c0c0;
            background: #fafafa;
            font-size: 11px;
            text-align: center;
            line-height: 16px;
            cursor: pointer;
        }

        .search-button {
            padding: 7px 18px;
            background: #ffcc00;
            border: 1px solid #ddb100;
            border-radius: 2px;
            font-weight: bold;
            cursor: pointer;
        }

        .search-nav {
            margin-top: 2px;
            font-size: 12px;
            text-transform: uppercase;
        }

        .search-nav a {
            margin-right: 14px;
            text-decoration: none;
            color: #000;
        }

        .search-nav a.active {
            font-weight: bold;
        }

        .search-nav a.active span {
            border-bottom: 2px solid #000;
            padding-bottom: 1px;
        }

        .main {
            margin-top: 14px;
        }

        .ad {
            border-top: 1px solid #d9d9d9;
            padding-top: 8px;
        }

        .ad-title {
            font-size: 22px;
            color: #0033cc;
            font-weight: bold;
            margin-bottom: 6px;
            display: flex;
            align-items: center;
            position: relative;
            padding-left: 0;
        }

        .ad-title::before {
            content: "¬ª¬ª¬ª";
            position: absolute;
            left: -50px;
            top: 50%;
            transform: translateY(-50%);
            font-size: 24px;
            color: #d41313;
        }

        .ad-title a {
            color: inherit;
            text-decoration: none;
        }

        .ad-row {
            display: flex;
            align-items: center;
            margin-top: 4px;
        }

        .ad-row-main {
            flex: 1;
        }

        .ad-label {
            width: 210px;
            font-size: 12px;
            line-height: 1.3;
            color: #333333;
            padding-right: 10px;
            box-sizing: border-box;
        }

        .side-arrow {
            color: #cc0000;
            font-weight: bold;
            font-size: 14px;
        }

        .ad-quick-links {
            display: grid;
            grid-template-columns: repeat(4, 1fr);
            border-collapse: collapse;
            margin-bottom: 4px;
            margin-top: 0;
            font-size: 12px;
        }

        .ad-quick-links div {
            border: 1px solid #e0e0e0;
            padding: 4px 6px;
            text-align: center;
            white-space: nowrap;
            cursor: text;
            outline: none;
        }

        .ad-quick-links a {
            text-decoration: none;
            color: #0033cc;
        }

        .ad-quick-links .active {
            border: 2px solid #0a8a00;
        }

        .ad-url-row {
            display: grid;
            grid-template-columns: 1.3fr 2.7fr;
            border: 1px solid #e0e0e0;
            border-top: none;
            margin-bottom: 4px;
            font-size: 12px;
        }

        .ad-url-domain {
            padding: 4px 6px;
            font-weight: bold;
            color: #0a8a00;
            text-align: center;
        }

        .ad-url-text {
            padding: 4px 6px;
        }

        .ad-text {
            font-size: 12px;
            white-space: nowrap;
            display: inline-block;
        }

        .sitelinks {
            margin-top: 0;
            border-collapse: collapse;
            width: 100%;
            font-size: 12px;
            table-layout: fixed;
        }

        .sitelinks th,
        .sitelinks td {
            border: 1px solid #e0e0e0;
            padding: 2px 4px;
            text-align: center;
            white-space: nowrap;
            cursor: text;
            outline: none;
        }

        .sitelinks th {
            font-weight: normal;
        }

        .sitelinks a {
            text-decoration: none;
            color: #0033cc;
        }

        .ad-label-sitelinks div {
            height: 18px;
            display: flex;
            align-items: center;
        }

        .dynamic-flag {
            margin-top: 6px;
            font-size: 14px;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .dynamic-flag-label {
            white-space: nowrap;
        }

        .toggle-switch {
            display: inline-flex;
            align-items: center;
            gap: 6px;
            font-size: 12px;
            cursor: pointer;
        }

        .toggle-option {
            text-transform: lowercase;
            color: #666;
        }

        .toggle-option.active {
            font-weight: bold;
            color: #0a8a00;
        }

        .toggle-track {
            width: 34px;
            height: 16px;
            border-radius: 999px;
            border: 1px solid #c2c2c2;
            background: linear-gradient(135deg, #ffffff, #f4f4f4);
            padding: 1px;
            box-sizing: border-box;
            display: flex;
            align-items: center;
            justify-content: flex-start;
            box-shadow: 0 1px 2px rgba(0, 0, 0, 0.15) inset;
            transition: justify-content 0.15s ease, border-color 0.15s ease, background 0.15s ease;
        }

        .toggle-knob {
            width: 14px;
            height: 14px;
            border-radius: 50%;
            background: #ffffff;
            box-shadow: 0 1px 2px rgba(0, 0, 0, 0.25);
        }

        .toggle-switch.toggle-on .toggle-track {
            justify-content: flex-end;
            border-color: #0a8a00;
            background: linear-gradient(135deg, #ffffff, #e9ffe9);
        }

        /* –¢–ê–ë–õ–ò–¶–ê */
        .table-section {
            background: white;
            border-radius: 8px;
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
            overflow: hidden;
        }

        .table-header {
            padding: 15px 20px;
            background: #f8f8f8;
            border-bottom: 1px solid #e0e0e0;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .table-header h2 {
            font-size: 18px;
            font-weight: 600;
            color: #333;
        }

        .table-wrapper {
            overflow-x: auto;
            max-height: 400px;
            overflow-y: auto;
        }

        table {
            width: 100%;
            border-collapse: collapse;
            font-size: 11px;
        }

        th, td {
            padding: 6px;
            border: 1px solid #e0e0e0;
            text-align: left;
        }

        th {
            background: #f5f5f5;
            font-weight: 600;
            position: sticky;
            top: 0;
            z-index: 10;
            font-size: 10px;
        }

        td input {
            width: 100%;
            padding: 3px;
            border: 1px solid transparent;
            font-size: 11px;
        }

        td input:focus {
            border-color: #667eea;
            outline: none;
        }

        .limits-error {
            color: #dc2626;
            background: #fee2e2;
        }

        .counter {
            font-size: 10px;
            color: #666;
            margin-top: 2px;
        }

        /* Scrollbar */
        .ads-sidebar::-webkit-scrollbar,
        .ads-main::-webkit-scrollbar,
        .table-wrapper::-webkit-scrollbar {
            width: 8px;
            height: 8px;
        }

        .ads-sidebar::-webkit-scrollbar-track,
        .ads-main::-webkit-scrollbar-track,
        .table-wrapper::-webkit-scrollbar-track {
            background: #f1f1f1;
            border-radius: 4px;
        }

        .ads-sidebar::-webkit-scrollbar-thumb,
        .ads-main::-webkit-scrollbar-thumb,
        .table-wrapper::-webkit-scrollbar-thumb {
            background: #888;
            border-radius: 4px;
        }

        .ads-sidebar::-webkit-scrollbar-thumb:hover,
        .ads-main::-webkit-scrollbar-thumb:hover,
        .table-wrapper::-webkit-scrollbar-thumb:hover {
            background: #555;
        }

        .empty-state {
            padding: 60px 20px;
            text-align: center;
            color: #999;
        }

        .empty-state p {
            margin: 10px 0;
            font-size: 14px;
        }
    </style>
</head>
<body>
    <div class="ads-app">
        <!-- HEADER -->
        <div class="ads-header">
            <h1>üì¢ –ì–µ–Ω–µ—Ä–∞—Ç–æ—Ä –æ–±—ä—è–≤–ª–µ–Ω–∏–π –Ø–Ω–¥–µ–∫—Å.–î–∏—Ä–µ–∫—Ç - AdsCreator v4.14</h1>
            <div class="ads-subtitle">–ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ —Å–æ–∑–¥–∞–Ω–∏–µ –æ–±—ä—è–≤–ª–µ–Ω–∏–π –∏–∑ –∫–ª—é—á–µ–≤—ã—Ö —Ñ—Ä–∞–∑</div>
        </div>

        <!-- CONTENT -->
        <div class="ads-content">
            <!-- –õ–ï–í–ê–Ø –ü–ê–ù–ï–õ–¨ -->
            <div class="ads-sidebar">
                <!-- –ù–∞—Å—Ç—Ä–æ–π–∫–∏ URL -->
                <div class="ads-section">
                    <h2>–ù–∞—Å—Ç—Ä–æ–π–∫–∏ URL</h2>
                    <label>–î–æ–º–µ–Ω</label>
                    <input class="ads-input" id="domain" placeholder="example.ru" value="nordkor.ru">
                    <div class="ads-hint">–ë–µ–∑ http:// –∏ www</div>

                    <label>UTM-—à–∞–±–ª–æ–Ω</label>
                    <input class="ads-input" id="utm" value="utm_source=yandex&utm_medium=cpc&utm_campaign={group}&utm_term={key}" placeholder="utm_source=yandex&utm_term={key}">
                    <div class="ads-hint">–ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ {key} –∏ {group} –¥–ª—è –ø–æ–¥—Å—Ç–∞–Ω–æ–≤–∫–∏</div>
                </div>

                <!-- –ü—Ä–∏–±–∞–≤–∫–∏ –∫ H2 -->
                <div class="ads-section">
                    <h2>–ü—Ä–∏–±–∞–≤–∫–∏ –∫ –∑–∞–≥–æ–ª–æ–≤–∫—É ‚Ññ2</h2>
                    <textarea class="ads-textarea" id="h2_additions" placeholder="—Å–∏—Å—Ç–µ–º–∞ –ø–æ–¥ –∫–ª—é—á –∑–∞ 70 190—Ä!&#10;–æ–±–µ–∑–∂–µ–ª–µ–∑–∏–≤–∞—Ç–µ–ª–∏ –æ—Ç 16 990—Ä!">–°–∫–∏–¥–∫–∞ 30% –¥–æ 15.05
–ë–µ—Å–ø–ª–∞—Ç–Ω–∞—è –∫–æ–Ω—Å—É–ª—å—Ç–∞—Ü–∏—è
–í –Ω–∞–ª–∏—á–∏–∏
–°–µ—Ä—Ç–∏—Ñ–∏—Ü–∏—Ä–æ–≤–∞–Ω–æ</textarea>
                    <div class="ads-hint">–ï—Å–ª–∏ –∫–ª—é—á —Ü–µ–ª–∏–∫–æ–º –≤–ª–µ–∑ –≤ H1 ‚Üí –±–µ—Ä–µ—Ç—Å—è –ø—Ä–∏–±–∞–≤–∫–∞. –ï—Å–ª–∏ –Ω–µ –≤–ª–µ–∑ ‚Üí –æ—Å—Ç–∞—Ç–æ–∫ –∫–ª—é—á–∞ –∏–¥–µ—Ç –≤ H2</div>
                </div>

                <!-- –¢–µ–∫—Å—Ç—ã –æ–±—ä—è–≤–ª–µ–Ω–∏–π -->
                <div class="ads-section">
                    <h2>–¢–µ–∫—Å—Ç—ã –æ–±—ä—è–≤–ª–µ–Ω–∏–π</h2>
                    <textarea class="ads-textarea" id="texts" placeholder="–û—Ñ–∏—Ü–∏–∞–ª—å–Ω–æ. –ë—ã—Å—Ç—Ä–∞—è –¥–æ—Å—Ç–∞–≤–∫–∞. –ì–∞—Ä–∞–Ω—Ç–∏—è 2 –≥–æ–¥–∞.">–û—Ç–≤–µ—Ç—å—Ç–µ –Ω–∞ 5 –≤–æ–ø—Ä–æ—Å–æ–≤ –∏ —É–∑–Ω–∞–π—Ç–µ —Å—Ç–æ–∏–º–æ—Å—Ç—å —Å–∏—Å—Ç–µ–º—ã –æ—á–∏—Å—Ç–∫–∏ –≤–æ–¥—ã –≤ 3-—Ö –≤–∞—Ä–∏–∞–Ω—Ç–∞—Ö!
–û—Ñ–∏—Ü–∏–∞–ª—å–Ω–æ. –ë—ã—Å—Ç—Ä–∞—è –¥–æ—Å—Ç–∞–≤–∫–∞. –ì–∞—Ä–∞–Ω—Ç–∏—è 2 –≥–æ–¥–∞.
–°–µ—Ä—Ç–∏—Ñ–∏—Ü–∏—Ä–æ–≤–∞–Ω–æ. –ú–æ–Ω—Ç–∞–∂ –ø–æ–¥ –∫–ª—é—á. –ï—Å—Ç—å —Ä–∞—Å—Å—Ä–æ—á–∫–∞.</textarea>
                    <div class="ads-hint">–í—ã–±–∏—Ä–∞–µ—Ç—Å—è —Å–∞–º—ã–π –¥–ª–∏–Ω–Ω—ã–π —Ç–µ–∫—Å—Ç –∏–∑ –≤–∞—Ä–∏–∞–Ω—Ç–æ–≤, –∫–æ—Ç–æ—Ä—ã–π –≤–ª–µ–∑–∞–µ—Ç –≤ 81 —Å–∏–º–≤–æ–ª</div>
                </div>

                <!-- –ë—ã—Å—Ç—Ä—ã–µ —Å—Å—ã–ª–∫–∏ -->
                <div class="ads-section">
                    <h2>–ë—ã—Å—Ç—Ä—ã–µ —Å—Å—ã–ª–∫–∏</h2>
                    <label>–¢–µ–∫—Å—Ç—ã (–º–∞–∫—Å 30 —Å–∏–º–≤–æ–ª–æ–≤)</label>
                    <input class="ads-input" id="sl1_text" placeholder="SL1" maxlength="30" value="–†–∞—Å–ø—Ä–æ–¥–∞–∂–∞">
                    <input class="ads-input" id="sl2_text" placeholder="SL2" maxlength="30" value="—Å–∫–∏–¥–∫–∞ 30% –¥–æ 15.05">
                    <input class="ads-input" id="sl3_text" placeholder="SL3" maxlength="30" value="–í–∏–¥–µ–æ –æ—Ç–∑—ã–≤—ã">
                    <input class="ads-input" id="sl4_text" placeholder="SL4" maxlength="30" value="–ó–∞–∫–∞–∑–∞—Ç—å">

                    <label>–û–ø–∏—Å–∞–Ω–∏—è (–º–∞–∫—Å 60 —Å–∏–º–≤–æ–ª–æ–≤)</label>
                    <input class="ads-input" id="sl1_desc" placeholder="SL1 –û–ø–∏—Å–∞–Ω–∏–µ" maxlength="60" value="–ë–µ—Å–ø–ª–∞—Ç–Ω–∞—è –∫–æ–Ω—Å—É–ª—å—Ç–∞—Ü">
                    <input class="ads-input" id="sl2_desc" placeholder="SL2 –û–ø–∏—Å–∞–Ω–∏–µ" maxlength="60" value="–ü–æ–¥–±–æ—Ä on-line">
                    <input class="ads-input" id="sl3_desc" placeholder="SL3 –û–ø–∏—Å–∞–Ω–∏–µ" maxlength="60" value="–ú–æ–Ω—Ç–∞–∂ –∑–∞ 1 –¥–µ–Ω—å">
                    <input class="ads-input" id="sl4_desc" placeholder="SL4 –û–ø–∏—Å–∞–Ω–∏–µ" maxlength="60" value="15 –ª–µ—Ç –Ω–∞ —Ä—ã–Ω–∫–µ">
                </div>

                <!-- –£—Ç–æ—á–Ω–µ–Ω–∏—è -->
                <div class="ads-section">
                    <h2>–£—Ç–æ—á–Ω–µ–Ω–∏—è</h2>
                    <textarea class="ads-textarea" id="clarifications" rows="3" placeholder="–ë—ã—Å—Ç—Ä–∞—è –¥–æ—Å—Ç–∞–≤–∫–∞&#10;–ì–∞—Ä–∞–Ω—Ç–∏—è">–ë—ã—Å—Ç—Ä–∞—è –¥–æ—Å—Ç–∞–≤–∫–∞
–ì–∞—Ä–∞–Ω—Ç–∏—è
–û—Ç–∑—ã–≤—ã –∫–ª–∏–µ–Ω—Ç–æ–≤
–ë–µ–∑ –ø—Ä–µ–¥–æ–ø–ª–∞—Ç</textarea>
                    <div class="ads-hint">–î–æ 4 —É—Ç–æ—á–Ω–µ–Ω–∏–π, –±—É–¥—É—Ç —Å–∫–ª–µ–µ–Ω—ã —á–µ—Ä–µ–∑ " | " –≤ —ç–∫—Å–ø–æ—Ä—Ç–µ</div>
                </div>

                <!-- –ö–ª—é—á–µ–≤—ã–µ —Ñ—Ä–∞–∑—ã -->
                <div class="ads-section">
                    <h2>–ö–ª—é—á–µ–≤—ã–µ —Ñ—Ä–∞–∑—ã</h2>
                    <textarea class="ads-textarea" style="min-height: 120px;" id="keys" placeholder="—Å–∏—Å—Ç–µ–º–∞ –æ—á–∏—Å—Ç–∫–∏ –≤–æ–¥—ã&#10;—Ñ–∏–ª—å—Ç—Ä –¥–ª—è –≤–æ–¥—ã –æ—Ç –∂–µ–ª–µ–∑–∞&#10;–æ–±–µ–∑–∂–µ–ª–µ–∑–∏–≤–∞—Ç–µ–ª—å –≤–æ–¥—ã">—Å–∏—Å—Ç–µ–º–∞ –æ—á–∏—Å—Ç–∫–∏ –≤–æ–¥—ã –∏–∑ —Å–∫–≤–∞–∂–∏–Ω—ã –¥–ª—è —á–∞—Å—Ç–Ω–æ–≥–æ
—Ñ–∏–ª—å—Ç—Ä –¥–ª—è –≤–æ–¥—ã –∫—É–ø–∏—Ç—å
–æ–±–µ–∑–∂–µ–ª–µ–∑–∏–≤–∞—Ç–µ–ª—å –≤–æ–¥—ã</textarea>
                    <div class="ads-hint" id="keys_counter">–§—Ä–∞–∑: 0 / 1000 ‚Ä¢ –°–∏–º–≤–æ–ª–æ–≤: 0 / 8192</div>
                </div>

                <!-- –ö–Ω–æ–ø–∫–∏ -->
                <button class="btn-generate" onclick="generateAds()">üöÄ –°–≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞—Ç—å –æ–±—ä—è–≤–ª–µ–Ω–∏—è</button>
                <button class="btn-export" onclick="copyTSV()">üìã –ö–æ–ø–∏—Ä–æ–≤–∞—Ç—å TSV</button>
                <button class="btn-export" onclick="exportCSV()">üíæ –≠–∫—Å–ø–æ—Ä—Ç CSV –¥–ª—è Direct Commander</button>
            </div>

            <!-- –¶–ï–ù–¢–†–ê–õ–¨–ù–ê–Ø –ß–ê–°–¢–¨ -->
            <div class="ads-main">
                <!-- –Ø–ù–î–ï–ö–° –ü–†–ï–í–¨–Æ -->
                <div class="yandex-preview">
                    <div class="top-row">
                        <div class="logo">
                            <div class="logo-main"><span>–Ø</span>–Ω–¥–µ–∫—Å</div>
                            <div class="logo-sub">–ü–æ–∏—Å–∫ ‚Ññ1 –≤ –†–æ—Å—Å–∏–∏*</div>
                        </div>
                        <div class="search-area">
                            <div class="search-top">
                                <input class="search-input" id="preview_search" type="text" value="—Å–∏—Å—Ç–µ–º–∞ –æ—á–∏—Å—Ç–∫–∏ –≤–æ–¥—ã –∏–∑ —Å–∫–≤–∞–∂–∏–Ω—ã –¥–ª—è —á–∞—Å—Ç–Ω–æ–≥–æ">
                                <div class="search-controls">
                                    <div class="icon-btn">üîç</div>
                                    <div class="icon-btn">‚òÖ</div>
                                    <div class="icon-btn">‚öô</div>
                                    <button class="search-button">–ù–∞–π—Ç–∏</button>
                                </div>
                            </div>
                            <div class="search-nav">
                                <a href="#" class="active"><span>–ø–æ–∏—Å–∫</span></a>
                                <a href="#">–∫–∞—Ä—Ç–∏–Ω–∫–∏</a>
                                <a href="#">–≤–∏–¥–µ–æ</a>
                                <a href="#">–∫–∞—Ä—Ç—ã</a>
                                <a href="#">–º–∞—Ä–∫–µ—Ç</a>
                                <a href="#">–Ω–æ–≤–æ—Å—Ç–∏</a>
                                <a href="#">–ø–µ—Ä–µ–≤–æ–¥—á–∏–∫</a>
                                <a href="#">–µ—â—ë</a>
                            </div>
                        </div>
                    </div>

                    <div class="main">
                        <div id="preview_content" class="content">
                            <div class="empty-state">
                                <p>üìù –°–≥–µ–Ω–µ—Ä–∏—Ä—É–π—Ç–µ –æ–±—ä—è–≤–ª–µ–Ω–∏—è</p>
                                <p>–ó–∞–ø–æ–ª–Ω–∏—Ç–µ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ —Å–ª–µ–≤–∞ –∏ –Ω–∞–∂–º–∏—Ç–µ –∫–Ω–æ–ø–∫—É –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏</p>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- –¢–ê–ë–õ–ò–¶–ê -->
                <div class="table-section">
                    <div class="table-header">
                        <h2>–°–≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ –æ–±—ä—è–≤–ª–µ–Ω–∏—è (<span id="ads_count">0</span>)</h2>
                    </div>
                    <div class="table-wrapper">
                        <table>
                            <thead>
                                <tr>
                                    <th>‚Ññ</th>
                                    <th>–ö–ª—é—á</th>
                                    <th>H1<br>(‚â§56)</th>
                                    <th>H2<br>(‚â§56)</th>
                                    <th>–¢–µ–∫—Å—Ç<br>(‚â§81)</th>
                                    <th>URL</th>
                                    <th>–û—Ç–æ–±—Ä. —Å—Å—ã–ª–∫–∞</th>
                                    <th>–£—Ç–æ—á–Ω–µ–Ω–∏—è</th>
                                    <th>SL1</th>
                                    <th>SL1 Desc</th>
                                    <th>SL2</th>
                                    <th>SL2 Desc</th>
                                    <th>SL3</th>
                                    <th>SL3 Desc</th>
                                    <th>SL4</th>
                                    <th>SL4 Desc</th>
                                </tr>
                            </thead>
                            <tbody id="table_body">
                                <tr>
                                    <td colspan="16" style="text-align: center; padding: 40px; color: #999;">
                                        –í–≤–µ–¥–∏—Ç–µ –¥–∞–Ω–Ω—ã–µ –∏ –Ω–∞–∂–º–∏—Ç–µ "–û–±—Ä–∞–±–æ—Ç–∞—Ç—å"
                                    </td>
                                </tr>
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script>
        // ===========================================
        // –ö–û–ù–°–¢–ê–ù–¢–´
        // ===========================================
        const LIMITS = {
            h1: 56,
            h2: 56,
            body: 81,
            path: 20,
            maxKeys: 1000,
            maxChars: 8192
        };

        const SUBSTITUTION_RULES = [
            { find: /\b–º—Å–∫\b/gi, replace: '–ú–°–ö' },
            { find: /\b—Å–ø–±\b/gi, replace: '–°–ü–±' },
            { find: /\b–º–æ—Å–∫–≤—ã\b/gi, replace: '–ú–æ—Å–∫–≤—ã' },
            { find: /\b–º–æ—Å–∫–≤–µ\b/gi, replace: '–ú–æ—Å–∫–≤–µ' },
            { find: /\b–ø–∏—Ç–µ—Ä\b/gi, replace: '–°–ü–±' },
            { find: /\b–ø–µ—Ç–µ—Ä–±—É—Ä–≥\b/gi, replace: '–°–ü–±' },
            { find: /\b—Å–∞–Ω–∫—Ç\b/gi, replace: '–°–∞–Ω–∫—Ç-' },
            { find: /\b—Ä—Ñ\b/gi, replace: '–†–§' },
            { find: /\b–∂–∫—Ö\b/gi, replace: '–ñ–ö–•' },
            { find: /\s+/g, replace: ' ' },
            { find: /\s+([,.!?])/g, replace: '$1' }
        ];

        let adsData = [];
        let currentPreviewIndex = 0;

        // ===========================================
        // –£–¢–ò–õ–ò–¢–´
        // ===========================================
        function clip(text, maxLen) {
            if (!text || text.length <= maxLen) return text || '';
            return text.substring(0, maxLen);
        }

        function applySubstitutions(text) {
            let result = text;
            SUBSTITUTION_RULES.forEach(rule => {
                result = result.replace(rule.find, rule.replace);
            });
            return result.trim();
        }

        function capitalize(text) {
            if (!text) return '';
            return text.charAt(0).toUpperCase() + text.slice(1);
        }

        // ===========================================
        // CORE –õ–û–ì–ò–ö–ê –ò–ó CHATGPT
        // ===========================================
        function splitKeyToBaseH1H2(key) {
            const words = (key || '').trim().split(/\s+/).filter(Boolean);
            let h1 = '';
            let idx = 0;

            for (; idx < words.length; idx++) {
                const candidate = h1 ? `${h1} ${words[idx]}` : words[idx];
                if (candidate.length <= LIMITS.h1) {
                    h1 = candidate;
                } else {
                    break;
                }
            }

            const rest = words.slice(idx).join(' ');
            return {
                h1Base: clip(h1 || key, LIMITS.h1),
                h2Base: rest
            };
        }

        function chooseAddonForH2(h2Base, addons) {
            const base = (h2Base || '').trim();
            const list = (addons || []).map(s => s.trim()).filter(Boolean);

            if (!list.length && base) return clip(base, LIMITS.h2);
            if (!list.length) return '';

            if (base) return clip(base, LIMITS.h2);

            const candidate = list.find(a => a.length <= LIMITS.h2) || list[0];
            return clip(candidate, LIMITS.h2);
        }

        function makeTitles(key, additions) {
            const normalized = applySubstitutions(key);
            const { h1Base, h2Base } = splitKeyToBaseH1H2(normalized);
            const h2 = chooseAddonForH2(h2Base, additions);

            return {
                h1: capitalize(h1Base),
                h2: capitalize(h2)
            };
        }

        function chooseBodyText(variants) {
            const list = (variants || []).map(s => s.trim()).filter(Boolean);
            if (!list.length) return '';

            let best = '';
            list.forEach(t => {
                if (t.length <= LIMITS.body && t.length > best.length) {
                    best = t;
                }
            });

            if (best) return best;
            return clip(list[0], LIMITS.body);
        }

        function transliterate(text) {
            const map = {
                '–∞': 'a', '–±': 'b', '–≤': 'v', '–≥': 'g', '–¥': 'd', '–µ': 'e', '—ë': 'e',
                '–∂': 'zh', '–∑': 'z', '–∏': 'i', '–π': 'y', '–∫': 'k', '–ª': 'l', '–º': 'm',
                '–Ω': 'n', '–æ': 'o', '–ø': 'p', '—Ä': 'r', '—Å': 's', '—Ç': 't', '—É': 'u',
                '—Ñ': 'f', '—Ö': 'h', '—Ü': 'ts', '—á': 'ch', '—à': 'sh', '—â': 'sch',
                '—ä': '', '—ã': 'y', '—å': '', '—ç': 'e', '—é': 'yu', '—è': 'ya'
            };

            return text.toLowerCase()
                .split('')
                .map(char => map[char] || char)
                .join('')
                .replace(/[^a-z0-9\s-]/g, '')
                .replace(/\s+/g, '-')
                .replace(/-+/g, '-')
                .substring(0, LIMITS.path);
        }

        function buildUrl(domain, utm, key) {
            const base = domain.replace(/^https?:\/\//, '').replace(/^www\./, '').replace(/\/$/, '');
            let url = `https://${base}`;

            if (utm && utm.trim()) {
                const utmParams = utm
                    .replace(/{key}/g, encodeURIComponent(key))
                    .replace(/{group}/g, encodeURIComponent(key.substring(0, 40)));
                url += '?' + utmParams;
            }

            return url;
        }

        function displayUrl(url, path) {
            const domain = url.split('?')[0].replace(/^https?:\/\//, '');
            return path ? `${domain}/${path}` : domain;
        }

        // ===========================================
        // –ü–û–õ–£–ß–ï–ù–ò–ï –î–ê–ù–ù–´–•
        // ===========================================
        function getKeys() {
            const text = document.getElementById('keys').value;
            if (text.length > LIMITS.maxChars) {
                alert(`–ü—Ä–µ–≤—ã—à–µ–Ω –ª–∏–º–∏—Ç —Å–∏–º–≤–æ–ª–æ–≤! –ú–∞–∫—Å–∏–º—É–º ${LIMITS.maxChars}, —É –≤–∞—Å ${text.length}`);
                return [];
            }
            const keys = text.split('\n').map(k => k.trim()).filter(k => k.length > 0);
            return [...new Set(keys)].slice(0, LIMITS.maxKeys);
        }

        function getAdditions() {
            return document.getElementById('h2_additions').value
                .split('\n')
                .map(a => a.trim())
                .filter(a => a.length > 0)
                .sort((a, b) => b.length - a.length);
        }

        function getTexts() {
            return document.getElementById('texts').value
                .split('\n')
                .map(t => t.trim())
                .filter(t => t.length > 0);
        }

        function getUnifiedSettings() {
            return {
                sl1_text: document.getElementById('sl1_text').value,
                sl1_desc: document.getElementById('sl1_desc').value,
                sl2_text: document.getElementById('sl2_text').value,
                sl2_desc: document.getElementById('sl2_desc').value,
                sl3_text: document.getElementById('sl3_text').value,
                sl3_desc: document.getElementById('sl3_desc').value,
                sl4_text: document.getElementById('sl4_text').value,
                sl4_desc: document.getElementById('sl4_desc').value,
                clarifications: document.getElementById('clarifications').value
            };
        }

        // ===========================================
        // –ì–ï–ù–ï–†–ê–¶–ò–Ø –û–ë–™–Ø–í–õ–ï–ù–ò–ô
        // ===========================================
        function generateAds() {
            const keys = getKeys();
            if (keys.length === 0) {
                alert('–í–≤–µ–¥–∏—Ç–µ –∫–ª—é—á–µ–≤—ã–µ —Ñ—Ä–∞–∑—ã!');
                return;
            }

            const domain = document.getElementById('domain').value.trim();
            if (!domain) {
                alert('–£–∫–∞–∂–∏—Ç–µ –¥–æ–º–µ–Ω!');
                return;
            }

            const utm = document.getElementById('utm').value.trim();
            const additions = getAdditions();
            const texts = getTexts();

            if (additions.length === 0) {
                alert('–î–æ–±–∞–≤—å—Ç–µ —Ö–æ—Ç—è –±—ã –æ–¥–Ω—É –ø—Ä–∏–±–∞–≤–∫—É –∫ –∑–∞–≥–æ–ª–æ–≤–∫—É ‚Ññ2!');
                return;
            }

            if (texts.length === 0) {
                alert('–î–æ–±–∞–≤—å—Ç–µ —Ö–æ—Ç—è –±—ã –æ–¥–∏–Ω –≤–∞—Ä–∏–∞–Ω—Ç —Ç–µ–∫—Å—Ç–∞!');
                return;
            }

            const unified = getUnifiedSettings();

            adsData = keys.map((key) => {
                const { h1, h2 } = makeTitles(key, additions);
                const text = chooseBodyText(texts);
                const url = buildUrl(domain, utm, key);
                const path = transliterate(key);

                return {
                    key,
                    h1,
                    h2,
                    text,
                    url,
                    displayUrl: displayUrl(url, path),
                    path,
                    clarifications: unified.clarifications,
                    sl1_text: unified.sl1_text,
                    sl1_desc: unified.sl1_desc,
                    sl2_text: unified.sl2_text,
                    sl2_desc: unified.sl2_desc,
                    sl3_text: unified.sl3_text,
                    sl3_desc: unified.sl3_desc,
                    sl4_text: unified.sl4_text,
                    sl4_desc: unified.sl4_desc
                };
            });

            currentPreviewIndex = 0;
            renderPreview();
            renderTable();
            document.getElementById('ads_count').textContent = adsData.length;
            alert(`‚úÖ –°–≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞–Ω–æ ${adsData.length} –æ–±—ä—è–≤–ª–µ–Ω–∏–π!`);
        }

        // ===========================================
        // –†–ï–ù–î–ï–† –ü–†–ï–í–¨–Æ
        // ===========================================
        function renderPreview() {
            const container = document.getElementById('preview_content');

            if (adsData.length === 0) {
                container.innerHTML = `
                    <div class="empty-state">
                        <p>üìù –°–≥–µ–Ω–µ—Ä–∏—Ä—É–π—Ç–µ –æ–±—ä—è–≤–ª–µ–Ω–∏—è</p>
                        <p>–ó–∞–ø–æ–ª–Ω–∏—Ç–µ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ —Å–ª–µ–≤–∞ –∏ –Ω–∞–∂–º–∏—Ç–µ –∫–Ω–æ–ø–∫—É –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏</p>
                    </div>`;
                return;
            }

            const ad = adsData[currentPreviewIndex];
            const domain = document.getElementById('domain').value.trim();
            const clars = (ad.clarifications || '').split('\n').map(c => c.trim()).filter(Boolean);

            // –û–±–Ω–æ–≤–ª—è–µ–º –ø–æ–∏—Å–∫–æ–≤—É—é —Å—Ç—Ä–æ–∫—É
            document.getElementById('preview_search').value = ad.key;

            container.innerHTML = `
                <div class="ad">
                    <div class="ad-row">
                        <div class="ad-label"></div>
                        <div class="ad-row-main">
                            <div class="ad-title">
                                <a href="#">${esc(ad.h1)}${ad.h2 ? ' ‚Äî ' + esc(ad.h2) : ''}</a>
                            </div>
                        </div>
                    </div>

                    <div class="ad-row">
                        <div class="ad-label">–ë—ã—Å—Ç—Ä—ã–µ —Å—Å—ã–ª–∫–∏ <span class="side-arrow">&gt;</span></div>
                        <div class="ad-row-main">
                            <div class="ad-quick-links">
                                <div class="active"><a href="#">${esc(ad.sl1_text)}</a></div>
                                <div><a href="#">${esc(ad.sl2_text)}</a></div>
                                <div><a href="#">${esc(ad.sl3_text)}</a></div>
                                <div><a href="#">${esc(ad.sl4_text)}</a></div>
                            </div>
                        </div>
                    </div>

                    <div class="ad-row">
                        <div class="ad-label">–û—Ç–æ–±—Ä–∞–∂–∞–µ–º–∞—è —Å—Å—ã–ª–∫–∞ <span class="side-arrow">&gt;</span></div>
                        <div class="ad-row-main">
                            <div class="ad-url-row">
                                <div class="ad-url-domain">${esc(domain)}/</div>
                                <div class="ad-url-text">${esc(ad.key)}</div>
                            </div>
                        </div>
                    </div>

                    <div class="ad-row">
                        <div class="ad-label">–¢–µ–∫—Å—Ç <span class="side-arrow">&gt;</span></div>
                        <div class="ad-row-main">
                            <span class="ad-text">${esc(ad.text)}</span>
                        </div>
                    </div>

                    <div class="ad-row">
                        <div class="ad-label">–£—Ç–æ—á–Ω–µ–Ω–∏—è <span class="side-arrow">&gt;</span></div>
                        <div class="ad-row-main">
                            <table class="sitelinks">
                                <tr>
                                    <td>${esc(clars[0] || '')}</td>
                                    <td>${esc(clars[1] || '')}</td>
                                    <td>${esc(clars[2] || '')}</td>
                                    <td>${esc(clars[3] || '')}</td>
                                </tr>
                            </table>
                        </div>
                    </div>

                    <div class="ad-row">
                        <div class="ad-label ad-label-sitelinks">
                            <div>–ê–¥—Ä–µ—Å–∞ –±—ã—Å—Ç—Ä—ã—Ö —Å—Å—ã–ª–æ–∫ <span class="side-arrow">&gt;</span></div>
                            <div>–Ø–∫–æ—Ä—è –±—ã—Å—Ç—Ä—ã—Ö —Å—Å—ã–ª–æ–∫ <span class="side-arrow">&gt;</span></div>
                            <div>–û–ø–∏—Å–∞–Ω–∏—è –±—ã—Å—Ç—Ä—ã—Ö —Å—Å—ã–ª–æ–∫ <span class="side-arrow">&gt;</span></div>
                        </div>
                        <div class="ad-row-main">
                            <table class="sitelinks">
                                <tr>
                                    <th><a href="#">${esc(domain)}</a></th>
                                    <th><a href="#">${esc(domain)}</a></th>
                                    <th><a href="#">${esc(domain)}</a></th>
                                    <th><a href="#">${esc(domain)}</a></th>
                                </tr>
                                <tr>
                                    <td>#1</td>
                                    <td>#2</td>
                                    <td>#3</td>
                                    <td>#4</td>
                                </tr>
                                <tr>
                                    <td>${esc(ad.sl1_desc)}</td>
                                    <td>${esc(ad.sl2_desc)}</td>
                                    <td>${esc(ad.sl3_desc)}</td>
                                    <td>${esc(ad.sl4_desc)}</td>
                                </tr>
                            </table>
                        </div>
                    </div>

                    <div class="dynamic-flag">
                        <span class="dynamic-flag-label">–û—Ç–æ–±—Ä–∞–∂–∞–µ–º–∞—è —Å—Å—ã–ª–∫–∞ –¥–∏–Ω–∞–º–∏—á–µ—Å–∫–∞—è</span>
                        <div class="toggle-switch toggle-on">
                            <span class="toggle-option">–Ω–µ—Ç</span>
                            <div class="toggle-track">
                                <div class="toggle-knob"></div>
                            </div>
                            <span class="toggle-option active">–¥–∞</span>
                        </div>
                    </div>
                </div>
            `;

            // –ê–∫—Ç–∏–≤–∏—Ä—É–µ–º —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –∏ –∫–ª–∏–∫–∏
            initPreviewInteractivity();
        }

        function initPreviewInteractivity() {
            // –†–µ–¥–∞–∫—Ç–∏—Ä—É–µ–º—ã–µ —è—á–µ–π–∫–∏
            const editableCells = document.querySelectorAll('.ad-quick-links div, .sitelinks th, .sitelinks td, .ad-url-text');
            editableCells.forEach(cell => {
                cell.setAttribute('contenteditable', 'true');
            });

            // –ë—ã—Å—Ç—Ä—ã–µ —Å—Å—ã–ª–∫–∏ - –ø–æ–¥—Å–≤–µ—Ç–∫–∞ –∞–∫—Ç–∏–≤–Ω–æ–π
            const quickCells = document.querySelectorAll('.ad-quick-links div');
            quickCells.forEach(cell => {
                cell.addEventListener('click', () => {
                    quickCells.forEach(c => c.classList.remove('active'));
                    cell.classList.add('active');
                });
            });

            // –¢—É–º–±–ª–µ—Ä –¥–∏–Ω–∞–º–∏—á–µ—Å–∫–æ–π —Å—Å—ã–ª–∫–∏
            const toggle = document.querySelector('.toggle-switch');
            if (toggle) {
                toggle.addEventListener('click', (e) => {
                    e.preventDefault();
                    const isOn = !toggle.classList.contains('toggle-on');
                    const options = toggle.querySelectorAll('.toggle-option');

                    if (isOn) {
                        toggle.classList.add('toggle-on');
                        if (options[0]) options[0].classList.remove('active');
                        if (options[1]) options[1].classList.add('active');
                    } else {
                        toggle.classList.remove('toggle-on');
                        if (options[0]) options[0].classList.add('active');
                        if (options[1]) options[1].classList.remove('active');
                    }
                });
            }
        }

        // ===========================================
        // –†–ï–ù–î–ï–† –¢–ê–ë–õ–ò–¶–´
        // ===========================================
        function renderTable() {
            const tbody = document.getElementById('table_body');

            if (adsData.length === 0) {
                tbody.innerHTML = '<tr><td colspan="16" style="text-align: center; padding: 40px; color: #999;">–í–≤–µ–¥–∏—Ç–µ –¥–∞–Ω–Ω—ã–µ –∏ –Ω–∞–∂–º–∏—Ç–µ "–û–±—Ä–∞–±–æ—Ç–∞—Ç—å"</td></tr>';
                return;
            }

            let html = '';
            adsData.forEach((ad, i) => {
                const h1Class = ad.h1.length > LIMITS.h1 ? 'limits-error' : '';
                const h2Class = ad.h2.length > LIMITS.h2 ? 'limits-error' : '';
                const textClass = ad.text.length > LIMITS.body ? 'limits-error' : '';

                html += `<tr onclick="selectPreview(${i})" style="cursor: pointer;">
                    <td>${i + 1}</td>
                    <td><input type="text" value="${esc(ad.key)}" onchange="updateAd(${i}, 'key', this.value)" onclick="event.stopPropagation()"></td>
                    <td class="${h1Class}"><input type="text" value="${esc(ad.h1)}" onchange="updateAd(${i}, 'h1', this.value)" onclick="event.stopPropagation()"><div class="counter">${ad.h1.length}/56</div></td>
                    <td class="${h2Class}"><input type="text" value="${esc(ad.h2)}" onchange="updateAd(${i}, 'h2', this.value)" onclick="event.stopPropagation()"><div class="counter">${ad.h2.length}/56</div></td>
                    <td class="${textClass}"><input type="text" value="${esc(ad.text)}" onchange="updateAd(${i}, 'text', this.value)" onclick="event.stopPropagation()"><div class="counter">${ad.text.length}/81</div></td>
                    <td><input type="text" value="${esc(ad.url)}" onchange="updateAd(${i}, 'url', this.value)" onclick="event.stopPropagation()"></td>
                    <td><input type="text" value="${esc(ad.displayUrl)}" onchange="updateAd(${i}, 'displayUrl', this.value)" onclick="event.stopPropagation()"></td>
                    <td><input type="text" value="${esc(ad.clarifications)}" onchange="updateAd(${i}, 'clarifications', this.value)" onclick="event.stopPropagation()"></td>
                    <td><input type="text" value="${esc(ad.sl1_text)}" onchange="updateAd(${i}, 'sl1_text', this.value)" onclick="event.stopPropagation()"></td>
                    <td><input type="text" value="${esc(ad.sl1_desc)}" onchange="updateAd(${i}, 'sl1_desc', this.value)" onclick="event.stopPropagation()"></td>
                    <td><input type="text" value="${esc(ad.sl2_text)}" onchange="updateAd(${i}, 'sl2_text', this.value)" onclick="event.stopPropagation()"></td>
                    <td><input type="text" value="${esc(ad.sl2_desc)}" onchange="updateAd(${i}, 'sl2_desc', this.value)" onclick="event.stopPropagation()"></td>
                    <td><input type="text" value="${esc(ad.sl3_text)}" onchange="updateAd(${i}, 'sl3_text', this.value)" onclick="event.stopPropagation()"></td>
                    <td><input type="text" value="${esc(ad.sl3_desc)}" onchange="updateAd(${i}, 'sl3_desc', this.value)" onclick="event.stopPropagation()"></td>
                    <td><input type="text" value="${esc(ad.sl4_text)}" onchange="updateAd(${i}, 'sl4_text', this.value)" onclick="event.stopPropagation()"></td>
                    <td><input type="text" value="${esc(ad.sl4_desc)}" onchange="updateAd(${i}, 'sl4_desc', this.value)" onclick="event.stopPropagation()"></td>
                </tr>`;
            });

            tbody.innerHTML = html;
        }

        function selectPreview(index) {
            currentPreviewIndex = index;
            renderPreview();
        }

        function updateAd(index, field, value) {
            adsData[index][field] = value;
            if (index === currentPreviewIndex) {
                renderPreview();
            }
        }

        function esc(str) {
            return (str || '').replace(/"/g, '&quot;').replace(/</g, '&lt;').replace(/>/g, '&gt;');
        }

        // ===========================================
        // –≠–ö–°–ü–û–†–¢
        // ===========================================
        function copyTSV() {
            if (adsData.length === 0) {
                alert('–ù–µ—Ç –¥–∞–Ω–Ω—ã—Ö –¥–ª—è –∫–æ–ø–∏—Ä–æ–≤–∞–Ω–∏—è!');
                return;
            }

            const headers = ['–ö–∞–º–ø–∞–Ω–∏—è', '–ì—Ä—É–ø–ø–∞', '–ö–ª—é—á–µ–≤–∞—è —Ñ—Ä–∞–∑–∞', '–ó–∞–≥–æ–ª–æ–≤–æ–∫ 1', '–ó–∞–≥–æ–ª–æ–≤–æ–∫ 2', '–¢–µ–∫—Å—Ç', '–°—Å—ã–ª–∫–∞', '–û—Ç–æ–±—Ä–∞–∂–∞–µ–º–∞—è —Å—Å—ã–ª–∫–∞', '–£—Ç–æ—á–Ω–µ–Ω–∏—è', 'SL1', 'SL1 Desc', 'SL2', 'SL2 Desc', 'SL3', 'SL3 Desc', 'SL4', 'SL4 Desc'];
            const campaign = 'AUTO-' + new Date().toISOString().slice(0, 10);

            let tsv = headers.join('\t') + '\n';

            adsData.forEach(ad => {
                const clars = (ad.clarifications || '').replace(/\r?\n/g, ' | ');
                const row = [
                    campaign,
                    ad.key.substring(0, 80),
                    ad.key,
                    ad.h1,
                    ad.h2,
                    ad.text,
                    ad.url,
                    ad.displayUrl,
                    clars,
                    ad.sl1_text, ad.sl1_desc,
                    ad.sl2_text, ad.sl2_desc,
                    ad.sl3_text, ad.sl3_desc,
                    ad.sl4_text, ad.sl4_desc
                ];
                tsv += row.join('\t') + '\n';
            });

            navigator.clipboard.writeText(tsv).then(() => {
                alert('‚úÖ –î–∞–Ω–Ω—ã–µ —Å–∫–æ–ø–∏—Ä–æ–≤–∞–Ω—ã –≤ –±—É—Ñ–µ—Ä –æ–±–º–µ–Ω–∞ (TSV —Ñ–æ—Ä–º–∞—Ç)');
            }).catch(() => {
                alert('‚ùå –û—à–∏–±–∫–∞ –∫–æ–ø–∏—Ä–æ–≤–∞–Ω–∏—è. –°–∫–æ–ø–∏—Ä—É–π—Ç–µ —Ç–∞–±–ª–∏—Ü—É –≤—Ä—É—á–Ω—É—é.');
            });
        }

        function exportCSV() {
            if (adsData.length === 0) {
                alert('–ù–µ—Ç –¥–∞–Ω–Ω—ã—Ö –¥–ª—è —ç–∫—Å–ø–æ—Ä—Ç–∞!');
                return;
            }

            const headers = ['–ö–∞–º–ø–∞–Ω–∏—è', '–ì—Ä—É–ø–ø–∞', '–ö–ª—é—á–µ–≤–∞—è —Ñ—Ä–∞–∑–∞', '–ó–∞–≥–æ–ª–æ–≤–æ–∫ 1', '–ó–∞–≥–æ–ª–æ–≤–æ–∫ 2', '–¢–µ–∫—Å—Ç', '–°—Å—ã–ª–∫–∞', '–û—Ç–æ–±—Ä–∞–∂–∞–µ–º–∞—è —Å—Å—ã–ª–∫–∞', '–£—Ç–æ—á–Ω–µ–Ω–∏—è', 'SL1', 'SL1 Desc', 'SL2', 'SL2 Desc', 'SL3', 'SL3 Desc', 'SL4', 'SL4 Desc'];
            const campaign = 'AUTO-' + new Date().toISOString().slice(0, 10);

            let csv = '\ufeff';
            csv += headers.join(';') + '\n';

            adsData.forEach(ad => {
                const clars = (ad.clarifications || '').replace(/\r?\n/g, ' | ');
                const row = [
                    campaign,
                    ad.key.substring(0, 80),
                    ad.key,
                    ad.h1,
                    ad.h2,
                    ad.text,
                    ad.url,
                    ad.displayUrl,
                    clars,
                    ad.sl1_text, ad.sl1_desc,
                    ad.sl2_text, ad.sl2_desc,
                    ad.sl3_text, ad.sl3_desc,
                    ad.sl4_text, ad.sl4_desc
                ];
                csv += row.map(escCsv).join(';') + '\n';
            });

            const blob = new Blob([csv], { type: 'text/csv;charset=utf-8;' });
            const link = document.createElement('a');
            link.href = URL.createObjectURL(blob);
            link.download = `yandex_ads_${new Date().toISOString().slice(0, 10)}.csv`;
            link.click();

            alert('‚úÖ CSV —Ñ–∞–π–ª –∑–∞–≥—Ä—É–∂–µ–Ω –¥–ª—è Direct Commander!');
        }

        function escCsv(str) {
            str = (str || '').toString();
            if (str.includes(';') || str.includes('"') || str.includes('\n')) {
                return '"' + str.replace(/"/g, '""') + '"';
            }
            return str;
        }

        // ===========================================
        // –ò–ù–ò–¶–ò–ê–õ–ò–ó–ê–¶–ò–Ø
        // ===========================================
        document.getElementById('keys').addEventListener('input', function() {
            const keys = getKeys();
            const chars = this.value.length;
            const counter = document.getElementById('keys_counter');
            counter.textContent = `–§—Ä–∞–∑: ${keys.length} / ${LIMITS.maxKeys} ‚Ä¢ –°–∏–º–≤–æ–ª–æ–≤: ${chars} / ${LIMITS.maxChars}`;
            if (keys.length > LIMITS.maxKeys || chars > LIMITS.maxChars) {
                counter.style.color = '#dc2626';
            } else {
                counter.style.color = '#666';
            }
        });
    </script>
</body>
</html>
