# АНАЛИЗ УПУЩЕННЫХ ФУНКЦИЙ

## Дата анализа
2025-11-16

## Источники
- Скриншоты 1.png - 6.png
- AdsCreator v4.14.xlsb
- Чат РАБОЧИЙ КОД.txt
- AitiCreator PRO.txt
- Создание объявлений.txt

---

## ❌ КРИТИЧЕСКИЕ УПУЩЕНИЯ В ТЕКУЩЕЙ HTML ВЕРСИИ

### 1. ИНТЕРФЕЙС И LAYOUT

#### Проблема: Нет правильного двухколоночного интерфейса
**Что должно быть:**
- Левая панель (узкая, 280-320px) - настройки и управление
- Правая панель (широкая) - таблица Excel + предпросмотр как в Яндексе

**Сейчас:**
- Единые настройки вверху в желтом блоке - НЕПРАВИЛЬНО
- Не компактно, занимает много места

#### Проблема: Отсутствует визуальный предпросмотр "как в Яндексе"
**Что должно быть (из скриншота 5.png):**
```
┌─────────────────────────────────────────────────┐
│ [Логотип Яндекс] [поисковая строка] [Найти]    │
│ ПОИСК | КАРТИНКИ | ВИДЕО | КАРТЫ | МАРКЕТ...  │
├─────────────────────────────────────────────────┤
│                                                 │
│ ≫ Система очистки воды из скважины! — Для частного! │
│   (синий, кликабельный заголовок)              │
│                                                 │
│ [Распродажа] nordkor.ru/ скидка 30% до 15.05 | Видео отзывы | Заказать │
│   (зеленая отображаемая ссылка)                │
│                                                 │
│ система очистки воды                            │
│ Ответьте на 5 вопросов и узнайте стоимость системы очистки воды в 3-х вариантах! │
│   (черный текст объявления)                     │
│                                                 │
│ [Быстрая доставка] [Гарантия] [Отзывы клиентов] [Без предоплат] │
│   (серые чипы уточнений)                        │
│                                                 │
│ Контактная информация · +7 (800) 0000-000 · пн-пт 9:00-18:00, сб 9:30-17:00 │
│ м. Невский Проспект · Санкт-Петербург         │
│                                                 │
│ ┌──────────────┬──────────────┬──────────────┬──────────────┐ │
│ │ nordkor.ru   │ nordkor.ru   │ nordkor.ru   │ nordkor.ru   │ │
│ │ #1           │ #2           │ #3           │ #4           │ │
│ │ Бесплатная   │ Подбор       │ Монтаж за    │ 15 лет на    │ │
│ │ консультация │ on-line      │ 1 день       │ рынке        │ │
│ └──────────────┴──────────────┴──────────────┴──────────────┘ │
│                                                 │
│ Отображаемая ссылка динамическая (да/нет)? да  │
└─────────────────────────────────────────────────┘
```

**Сейчас:**
- НЕТ такого предпросмотра вообще

---

### 2. ФУНКЦИОНАЛЬНОСТЬ

#### Проблема: Нет правил подмены (Substitution Rules)
**Что должно быть:**
- 2 набора правил (RuleSet):
  1. Глобальные замены
  2. ГЕО/морфология
- Каждое правило:
  - type: plain или regex
  - find: что искать
  - replace: на что заменять
  - scope: массив полей ["key", "h1", "h2", "txt", "url", "path", "clar", "sl1_text", "sl2_text", ...] или ["*"]
- Применяются последовательно сверху вниз
- Предпросмотр правил перед применением

**Примеры правил:**
```javascript
{
  "type": "plain",
  "find": "→",
  "replace": " - ",
  "scope": ["h1", "h2", "txt"]
}

{
  "type": "regex",
  "find": "\\{city\\}",
  "replace": "Москва",
  "scope": ["h1", "h2", "path"]
}
```

**Сейчас:**
- НЕТ вообще

#### Проблема: Нет интеграции с ИИ для генерации
**Что должно быть:**
- Кнопка "Сгенерировать с ИИ"
- Запрос: `POST /api/ai/ads/generate`
- Payload:
  ```json
  {
    "keys": ["ключ1", "ключ2", ...],
    "domain": "nordkor.ru",
    "utm": "utm_source=yandex&utm_medium=cpc&utm_campaign={group}&utm_term={key}",
    "locale": "ru",
    "mode": "serp",
    "limits": {"h1": 56, "h2": 56, "body": 81}
  }
  ```
- Ответ: `{ "rows": [{AdRow}, {AdRow}, ...] }`
- ИИ анализирует:
  - SERP по ключу
  - Объявления конкурентов
  - Сниппеты сайта
  - Генерирует заголовки/тексты/уточнения/быстрые ссылки
- Качество: релевантность 10/10, CTR 10/10, логика 10/10

**Сейчас:**
- НЕТ вообще

#### Проблема: Нет режима копирования
**Что должно быть:**
- Кнопка "Режим копирования" - переключает таблицу в plain text формат
- Можно выделить мышью любой прямоугольник и скопировать
- Кнопка "Копировать как TSV" - копирует всю таблицу с заголовками
- Кнопка "Скопировать только ключи" - копирует колонку ключей

**Сейчас:**
- Частично есть (только inline редактирование)

---

### 3. ТАБЛИЦА EXCEL

#### Проблема: Неправильная структура колонок
**Что должно быть (по порядку):**
1. ☑ (checkbox)
2. Ключ
3. H1 (Заголовок 1)
4. H2 (Заголовок 2)
5. Текст
6. URL (полный с UTM)
7. Отобр. путь (Path без UTM)
8. Уточнения (multiline, до 4 строк)
9. SL1 (текст)
10. SL1 URL
11. SL1 Anchor
12. SL1 Desc
13. SL2 (текст)
14. SL2 URL
15. SL2 Anchor
16. SL2 Desc
17. SL3 (текст)
18. SL3 URL
19. SL3 Anchor
20. SL3 Desc
21. SL4 (текст)
22. SL4 URL
23. SL4 Anchor
24. SL4 Desc

**Сейчас:**
- Есть, но без Anchor и Desc для быстрых ссылок

#### Проблема: Нет изменяемой ширины столбцов
**Что должно быть:**
- Каждый столбец имеет resizer на правой границе
- Можно тянуть мышью, изменяя ширину
- Минимальная ширина: 40-50px

**Сейчас:**
- Есть resizer, но работает не идеально

---

### 4. ЕДИНЫЕ НАСТРОЙКИ

#### Проблема: Настройки не в левой панели
**Что должно быть:**
Левая панель с секциями:

**Секция 1: Ключевые фразы**
- Textarea для ввода ключей (по одному в строке)
- Счетчик: "Фраз: N / 1000"
- Hint: "Максимум 8192 символов"

**Секция 2: Основные настройки**
- Домен (input)
- UTM-шаблон (input, опционально)

**Секция 3: Заголовки**
- Шаблон H1 (input, default: `{key}`)
- Шаблон H2 (input, default: "— Для частного!")

**Секция 4: Текст объявления**
- Textarea (multiline для вариантов)
- Hint: "Максимум 81 символ"

**Секция 5: Единые настройки (для всех объявлений)**
- Раскрывающийся блок "Быстрые ссылки"
  - 4 группы полей: SL1, SL2, SL3, SL4
  - Каждая: название, URL, якорь, описание
- Раскрывающийся блок "Уточнения"
  - 4 поля для уточнений (max 66 символов каждое)
- Раскрывающийся блок "Отображаемая ссылка"
  - Префикс (например: "Распродажа")
  - Постфикс (например: "Видео отзывы | Заказать")
- Раскрывающийся блок "Контакты"
  - Контактная информация
  - Адрес (город, метро)

**Кнопки:**
- 🚀 Сгенерировать
- 🤖 Сгенерировать с ИИ
- 🔄 Применить настройки ко всем
- 💾 Экспорт CSV

**Сейчас:**
- Единые настройки в желтом блоке по центру вверху - НЕПРАВИЛЬНО

---

### 5. ЛИМИТЫ И ВАЛИДАЦИЯ

#### Что должно быть:
**Лимиты Яндекс.Директ:**
- H1 ≤ 56 символов
- H2 ≤ 56 символов
- Текст ≤ 81 символ
- Отобр. путь ≤ 20 символов
- Уточнение ≤ 66 символов
- Быстрая ссылка (текст) ≤ 30 символов
- Быстрая ссылка (описание) ≤ 60 символов

**Автоматическая обрезка:**
- При превышении лимита - подсветка красным
- Кнопка "Подрезать по лимитам" - обрезает все поля до лимитов с многоточием

**Разбиение H1/H2:**
- Если ключ не помещается в H1 (56), разбиваем по словам
- Хвост переносим в H2
- Если хвоста нет - H2 берем из шаблона H2

**Сейчас:**
- Есть базовая логика, но не всё

---

### 6. ЭКСПОРТ

#### Проблема: Неполный формат CSV
**Что должно быть (Direct Commander):**

**Формат:**
- Кодировка: UTF-8 с BOM
- Разделитель: `;`
- Первая строка: заголовки

**Заголовки (точный порядок):**
```
Кампания;Группа;Ключевая фраза;Заголовок 1;Заголовок 2;Текст;Ссылка;Отображаемая ссылка;Уточнения;SL1;SL1 URL;SL1 Anchor;SL1 Desc;SL2;SL2 URL;SL2 Anchor;SL2 Desc;SL3;SL3 URL;SL3 Anchor;SL3 Desc;SL4;SL4 URL;SL4 Anchor;SL4 Desc
```

**Данные:**
- Кампания: `AUTO-2025-11-16`
- Группа: первые 80 символов ключа
- Ключевая фраза: полный ключ
- Отображаемая ссылка: только домен/путь БЕЗ UTM
- Уточнения: склеить через ` | `

**Сейчас:**
- Не хватает Anchor и Desc для быстрых ссылок

---

## 📋 ПРИОРИТЕТ ИСПРАВЛЕНИЙ

### P0 - Критично (блокирует использование)
1. ✅ Левая панель с настройками
2. ✅ Excel-like таблица справа с правильными колонками (включая Anchor/Desc)
3. ✅ Предпросмотр "как в Яндексе" (справа внизу или отдельная вкладка)
4. ✅ Единые настройки в левой панели (применяются ко всем 1000 объявлениям)

### P1 - Важно (нужно для полного функционала)
5. ✅ Правила подмены (2 RuleSet)
6. ✅ Кнопка "Сгенерировать с ИИ"
7. ✅ Режим копирования (plain text таблица)
8. ✅ Кнопки "Копировать TSV" и "Скопировать ключи"

### P2 - Улучшения (качество жизни)
9. ✅ Resizable columns (изменяемая ширина столбцов)
10. ✅ Sticky заголовки таблицы при прокрутке
11. ✅ Сохранение черновика в LocalStorage
12. ✅ Валидация и подсветка ошибок (превышение лимитов)

---

## 🎯 ИТОГОВЫЕ ТРЕБОВАНИЯ К ИНТЕРФЕЙСУ

### Layout:
```
┌──────────────┬─────────────────────────────────────────────────┐
│              │  Toolbar: Объявлений: 0 | Выбрано: 0           │
│              │  [Выбрать все] [Снять] [Удалить]               │
│  Левая       ├─────────────────────────────────────────────────┤
│  панель      │                                                 │
│  (280px)     │           EXCEL ТАБЛИЦА                         │
│              │  (все колонки с inline редактированием)         │
│  Настройки:  │                                                 │
│  - Ключи     │                                                 │
│  - Домен     │                                                 │
│  - UTM       │                                                 │
│  - H1/H2     │                                                 │
│  - Текст     │                                                 │
│  - БС (4)    ├─────────────────────────────────────────────────┤
│  - Уточнения │                                                 │
│  - Отобр.    │    ПРЕДПРОСМОТР "КАК В ЯНДЕКСЕ"                │
│    ссылка    │    (sticky, компактная карточка)                │
│  - Контакты  │                                                 │
│              │  [←] [→] переключение объявлений               │
│  [Кнопки]    │                                                 │
└──────────────┴─────────────────────────────────────────────────┘
```

### Компактность:
- Шрифты: 10-12px
- Padding: 4-8px
- Без белых плашек на весь экран
- Все управление в одном месте

---

## 📝 СЛЕДУЮЩИЙ ШАГ

Создать документ "Полное описание последовательности работы AdsCreator.md" с детальным разбором Excel файла:
- Размеры окон
- Последовательность действий
- Внешний вид каждого элемента
- Как повторить 1 в 1 в веб интерфейсе
