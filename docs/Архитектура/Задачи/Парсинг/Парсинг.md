# üìê –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞ KeySet: –°–≤—è–∑–∫–∞ React UI ‚Üî Python Backend

## üéØ –û–±—â–∞—è —Å—Ö–µ–º–∞

```
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ                        KeySet Desktop App                        ‚îÇ
‚îÇ                                                                   ‚îÇ
‚îÇ  ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê         ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê  ‚îÇ
‚îÇ  ‚îÇ   Python Backend ‚îÇ ‚óÑ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚ñ∫ ‚îÇ      React Frontend          ‚îÇ  ‚îÇ
‚îÇ  ‚îÇ   (PySide6/Qt)   ‚îÇ  QWeb   ‚îÇ  (TypeScript + Vite)         ‚îÇ  ‚îÇ
‚îÇ  ‚îÇ                  ‚îÇ Channel ‚îÇ                              ‚îÇ  ‚îÇ
‚îÇ  ‚îÇ  - TurboParser   ‚îÇ         ‚îÇ  - 23 –º–æ–¥–∞–ª–∞                 ‚îÇ  ‚îÇ
‚îÇ  ‚îÇ  - Multiparser   ‚îÇ         ‚îÇ  - PhrasesTable              ‚îÇ  ‚îÇ
‚îÇ  ‚îÇ  - Morphology    ‚îÇ         ‚îÇ  - GroupsPanel               ‚îÇ  ‚îÇ
‚îÇ  ‚îÇ  - SQLite        ‚îÇ         ‚îÇ  - Toolbar + Modals          ‚îÇ  ‚îÇ
‚îÇ  ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò         ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò  ‚îÇ
‚îÇ           ‚ñ≤                              ‚îÇ                       ‚îÇ
‚îÇ           ‚îÇ                              ‚ñº                       ‚îÇ
‚îÇ           ‚îÇ                    QWebEngineView                    ‚îÇ
‚îÇ           ‚îÇ                    (–≤—Å—Ç—Ä–æ–µ–Ω–Ω—ã–π Chromium)             ‚îÇ
‚îÇ           ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
‚îÇ                                                                   ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
```

---

## üìÇ –°—Ç—Ä—É–∫—Ç—É—Ä–∞ –ø—Ä–æ–µ–∫—Ç–∞

```
C:\AI\yandex\keyset\
‚îú‚îÄ‚îÄ app\
‚îÇ   ‚îú‚îÄ‚îÄ main.py                      # –ì–ª–∞–≤–Ω–æ–µ –æ–∫–Ω–æ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è
‚îÇ   ‚îú‚îÄ‚îÄ tabs\
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ parsing_tab.py           # –û—Ä–∏–≥–∏–Ω–∞–ª—å–Ω—ã–π –ø–∞—Ä—Å–µ—Ä (PySide6)
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ parsing_tab_v5.py        # React UI + QWebChannel Bridge
‚îÇ   ‚îú‚îÄ‚îÄ dialogs\
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ parsing_dialogs.py       # –î–∏–∞–ª–æ–≥–∏ –¥–ª—è —Å—Ç–æ–ø-—Å–ª–æ–≤/—Ñ–∏–ª—å—Ç—Ä–æ–≤/–¥—É–±–ª–µ–π
‚îÇ   ‚îî‚îÄ‚îÄ widgets\
‚îÇ       ‚îî‚îÄ‚îÄ activity_log.py          # –ñ—É—Ä–Ω–∞–ª –∞–∫—Ç–∏–≤–Ω–æ—Å—Ç–∏
‚îÇ
‚îú‚îÄ‚îÄ services\
‚îÇ   ‚îú‚îÄ‚îÄ accounts.py                  # –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –∞–∫–∫–∞—É–Ω—Ç–∞–º–∏ –Ø–Ω–¥–µ–∫—Å–∞ (SQLite)
‚îÇ   ‚îú‚îÄ‚îÄ morphology.py                # –ú–æ—Ä—Ñ–æ–ª–æ–≥–∏—á–µ—Å–∫–∏–π –∞–Ω–∞–ª–∏–∑ (pymorphy3)
‚îÇ   ‚îî‚îÄ‚îÄ multiparser_manager.py       # –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –ø–∞—Ä—Å–µ—Ä–∞–º–∏
‚îÇ
‚îú‚îÄ‚îÄ turbo_parser_improved.py        # TurboParser (Playwright, 10 –≤–∫–ª–∞–¥–æ–∫)
‚îÇ
‚îî‚îÄ‚îÄ ui\                              # ‚Üê React UI (—Å–æ–±—Ä–∞–Ω–Ω—ã–π dist)
    ‚îú‚îÄ‚îÄ index.html                   # –ì–ª–∞–≤–Ω—ã–π HTML
    ‚îú‚îÄ‚îÄ qwebchannel.js               # QWebChannel –∫–ª–∏–µ–Ω—Ç
    ‚îî‚îÄ‚îÄ assets\
        ‚îú‚îÄ‚îÄ index-*.js               # React bundle (1.3MB)
        ‚îî‚îÄ‚îÄ index-*.css              # –°—Ç–∏–ª–∏

configs\
‚îî‚îÄ‚îÄ accounts.json                    # –ê–∫–∫–∞—É–Ω—Ç—ã –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
```

---

## üîå –°–≤—è–∑—å React ‚Üî Python —á–µ—Ä–µ–∑ QWebChannel

### 1. Python Bridge (Backend)

**–§–∞–π–ª:** `keyset/app/tabs/parsing_tab_v5.py`

```python
from PySide6.QtCore import QObject, Slot
from PySide6.QtWebChannel import QWebChannel
from PySide6.QtWebEngineWidgets import QWebEngineView
import json

class PythonBridge(QObject):
    """–ú–æ—Å—Ç –¥–ª—è –≤—ã–∑–æ–≤–∞ Python –∏–∑ JavaScript"""

    def __init__(self, parsing_tab):
        super().__init__()
        self.parsing_tab = parsing_tab
        self.keys_panel = parsing_tab.keys_panel
        self.activity_log = parsing_tab.activity_log

    @Slot(str, result=str)
    def call_python(self, data_json: str) -> str:
        """
        –ï–¥–∏–Ω–∞—è —Ç–æ—á–∫–∞ –≤—Ö–æ–¥–∞ –¥–ª—è –≤—Å–µ—Ö –∫–æ–º–∞–Ω–¥ –∏–∑ React

        –§–æ—Ä–º–∞—Ç –∑–∞–ø—Ä–æ—Å–∞ (JSON):
        {
            "action": "start_parsing",
            "phrases": ["–∫–ª—é—á 1", "–∫–ª—é—á 2"],
            "settings": { "modes": ["ws"], "regions": [225] }
        }

        –§–æ—Ä–º–∞—Ç –æ—Ç–≤–µ—Ç–∞ (JSON):
        {
            "status": "ok" | "error",
            "data": {...},
            "message": "—Ç–µ–∫—Å—Ç –æ—à–∏–±–∫–∏"
        }
        """
        try:
            data = json.loads(data_json)
            action = data.get('action')

            # –†–æ—É—Ç–∏–Ω–≥ –∫–æ–º–∞–Ω–¥
            if action == 'start_parsing':
                return self._start_wordstat_parsing(
                    data.get('phrases', []),
                    data.get('settings', {})
                )
            elif action == 'start_batch':
                return self._start_batch_parsing(data.get('phrases', []))
            elif action == 'get_accounts':
                return self._get_accounts()
            else:
                return json.dumps({
                    'status': 'error',
                    'message': f'Unknown action: {action}'
                })

        except Exception as e:
            return json.dumps({'status': 'error', 'message': str(e)})

    def _start_wordstat_parsing(self, phrases, settings):
        """–ó–∞–ø—É—Å–∫ –ø–∞—Ä—Å–∏–Ω–≥–∞ Wordstat"""
        try:
            # –°–æ–∑–¥–∞–µ–º –∏–ª–∏ –∏—Å–ø–æ–ª—å–∑—É–µ–º —Å—É—â–µ—Å—Ç–≤—É—é—â–∏–π —ç–∫–∑–µ–º–ø–ª—è—Ä ParsingTab
            if not hasattr(self.parsing_tab, '_parser_instance'):
                from .parsing_tab import ParsingTab as OriginalParsingTab
                self.parsing_tab._parser_instance = OriginalParsingTab(
                    parent=self.parsing_tab,
                    keys_panel=self.keys_panel,
                    activity_log=self.activity_log
                )

            parser = self.parsing_tab._parser_instance

            # –ü—Ä–µ–æ–±—Ä–∞–∑—É–µ–º –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ –∏–∑ React —Ñ–æ—Ä–º–∞—Ç–∞ –≤ Python
            selected_profiles = settings.get('profiles', [])
            normalized_settings = {
                'modes': settings.get('modes', ['ws']),
                'regions': settings.get('regions', [225]),
                'regions_map': settings.get('regions_map', {}),
                'ws': 'ws' in settings.get('modes', []),
                'qws': 'qws' in settings.get('modes', []),
                'bws': 'bws' in settings.get('modes', []),
            }

            # –ó–∞–ø—É—Å–∫–∞–µ–º –ø–∞—Ä—Å–∏–Ω–≥ (–∞—Å–∏–Ω—Ö—Ä–æ–Ω–Ω—ã–π)
            if hasattr(parser, '_run_parsing_with_settings'):
                parser._run_parsing_with_settings(
                    phrases,
                    selected_profiles,
                    normalized_settings
                )

            if self.activity_log:
                self.activity_log.append_line(
                    f"INFO: –ó–∞–ø—É—â–µ–Ω –ø–∞—Ä—Å–∏–Ω–≥ {len(phrases)} —Ñ—Ä–∞–∑"
                )

            return json.dumps({
                'status': 'started',
                'phrases_count': len(phrases),
                'message': '–ü–∞—Ä—Å–∏–Ω–≥ –∑–∞–ø—É—â–µ–Ω —É—Å–ø–µ—à–Ω–æ'
            })

        except Exception as e:
            if self.activity_log:
                self.activity_log.append_line(f"ERROR: {str(e)}")
            return json.dumps({'status': 'error', 'message': str(e)})

    def _get_accounts(self):
        """–ü–æ–ª—É—á–∏—Ç—å –∞–∫–∫–∞—É–Ω—Ç—ã –Ø–Ω–¥–µ–∫—Å–∞ –∏–∑ –ë–î"""
        try:
            from ...services.accounts import list_accounts
            accounts = list_accounts()

            # –ü—Ä–µ–æ–±—Ä–∞–∑—É–µ–º –≤ JSON-—Å–µ—Ä–∏–∞–ª–∏–∑—É–µ–º—ã–π —Ñ–æ—Ä–º–∞—Ç
            accounts_data = [
                {
                    'id': acc.id,
                    'name': acc.name,
                    'email': acc.email,
                    'profile_path': acc.profile_path,
                    'proxy': acc.proxy
                }
                for acc in accounts
            ]

            return json.dumps({
                'status': 'ok',
                'accounts': accounts_data
            })
        except Exception as e:
            return json.dumps({'status': 'error', 'message': str(e)})


class ParsingTabV5(QWidget):
    """–í–∫–ª–∞–¥–∫–∞ –ø–∞—Ä—Å–∏–Ω–≥–∞ —Å React UI"""

    def __init__(self, parent=None, keys_panel=None, activity_log=None):
        super().__init__(parent)
        self.keys_panel = keys_panel
        self.activity_log = activity_log
        self._setup_ui()

    def _setup_ui(self):
        layout = QVBoxLayout(self)
        layout.setContentsMargins(0, 0, 0, 0)

        # QWebEngineView –¥–ª—è –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏—è React UI
        self.webview = QWebEngineView()

        # –ù–∞—Å—Ç—Ä–æ–π–∫–∞ QWebChannel –¥–ª—è —Å–≤—è–∑–∏ Python ‚Üî JavaScript
        self.channel = QWebChannel()
        self.bridge = PythonBridge(self)
        self.channel.registerObject('pythonBridge', self.bridge)
        self.webview.page().setWebChannel(self.channel)

        # –ó–∞–≥—Ä—É–∂–∞–µ–º —Å–æ–±—Ä–∞–Ω–Ω—ã–π HTML –∏–∑ keyset/ui/
        module_dir = Path(__file__).resolve().parent.parent.parent
        ui_path = module_dir / 'ui' / 'index.html'

        if ui_path.exists():
            ui_dir = ui_path.parent
            base_url = QUrl.fromLocalFile(str(ui_dir.absolute()) + '/')

            html_content = ui_path.read_text(encoding='utf-8')
            self.webview.setHtml(html_content, base_url)

            if self.activity_log:
                self.activity_log.append_line(f"INFO: –ó–∞–≥—Ä—É–∂–µ–Ω React UI –∏–∑ {ui_path}")
        else:
            # –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –æ—à–∏–±–∫—É –µ—Å–ª–∏ UI –Ω–µ –Ω–∞–π–¥–µ–Ω
            error_msg = '''<html>...</html>'''
            self.webview.setHtml(error_msg)

        layout.addWidget(self.webview)
```

---

### 2. JavaScript Bridge (Frontend)

**–§–∞–π–ª:** `keyset-web/src/bridge/pythonBridge.ts`

```typescript
/**
 * Python Bridge –¥–ª—è —Å–≤—è–∑–∏ React ‚Üî Python —á–µ—Ä–µ–∑ QWebChannel
 */

declare global {
  interface Window {
    qt?: {
      webChannelTransport?: any;
    };
    QWebChannel?: any;
    pythonBridge?: {
      call_python: (dataJson: string) => string;
    };
  }
}

class PythonBridge {
  private bridge: any = null;
  private connected = false;

  async init(): Promise<void> {
    return new Promise((resolve, reject) => {
      // –ü—Ä–æ–≤–µ—Ä—è–µ–º –Ω–∞–ª–∏—á–∏–µ QWebChannel (–∑–∞–≥—Ä—É–∂–∞–µ—Ç—Å—è —á–µ—Ä–µ–∑ <script> –≤ HTML)
      if (typeof window.QWebChannel === 'undefined') {
        console.warn('QWebChannel –Ω–µ –Ω–∞–π–¥–µ–Ω - —Ä–∞–±–æ—Ç–∞–µ–º –≤ dev —Ä–µ–∂–∏–º–µ');
        this.connected = false;
        resolve();
        return;
      }

      // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä—É–µ–º –∫–∞–Ω–∞–ª —Å–≤—è–∑–∏
      if (window.qt?.webChannelTransport) {
        new window.QWebChannel(window.qt.webChannelTransport, (channel: any) => {
          this.bridge = channel.objects.pythonBridge;
          this.connected = true;
          console.log('‚úÖ Python Bridge –ø–æ–¥–∫–ª—é—á–µ–Ω');
          resolve();
        });
      } else {
        console.warn('webChannelTransport –Ω–µ –Ω–∞–π–¥–µ–Ω');
        this.connected = false;
        resolve();
      }
    });
  }

  isConnected(): boolean {
    return this.connected;
  }

  /**
   * –£–Ω–∏–≤–µ—Ä—Å–∞–ª—å–Ω—ã–π –º–µ—Ç–æ–¥ –≤—ã–∑–æ–≤–∞ Python —Ñ—É–Ω–∫—Ü–∏–∏
   */
  async call(action: string, params: any = {}): Promise<any> {
    if (!this.connected || !this.bridge) {
      console.warn(`[DEV MODE] Python call: ${action}`, params);
      return { status: 'dev_mode', message: 'Running in development mode' };
    }

    try {
      const request = JSON.stringify({ action, ...params });
      const responseStr = this.bridge.call_python(request);
      return JSON.parse(responseStr);
    } catch (error) {
      console.error('Python Bridge error:', error);
      return { status: 'error', message: String(error) };
    }
  }

  /**
   * –ó–∞–ø—É—Å—Ç–∏—Ç—å –ø–∞—Ä—Å–∏–Ω–≥ Wordstat
   */
  async startParsing(phrases: string[], settings: any): Promise<any> {
    return this.call('start_parsing', { phrases, settings });
  }

  /**
   * –ó–∞–ø—É—Å—Ç–∏—Ç—å –ø–∞–∫–µ—Ç–Ω—ã–π —Å–±–æ—Ä
   */
  async startBatch(phrases: string[]): Promise<any> {
    return this.call('start_batch', { phrases });
  }

  /**
   * –ü–æ–ª—É—á–∏—Ç—å —Å–ø–∏—Å–æ–∫ –∞–∫–∫–∞—É–Ω—Ç–æ–≤
   */
  async getAccounts(): Promise<any> {
    return this.call('get_accounts');
  }
}

export const pythonBridge = new PythonBridge();

// –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ
if (typeof window !== 'undefined') {
  pythonBridge.init().catch(console.error);
}
```

---

### 3. –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ –≤ React –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–∞—Ö

**–ü—Ä–∏–º–µ—Ä:** –ö–Ω–æ–ø–∫–∞ "–ß–∞—Å—Ç–æ—Ç–∫–∞" –≤ Toolbar

```tsx
import { pythonBridge } from '@/bridge/pythonBridge';
import { useStore } from '@/store/useStore';

function Toolbar() {
  const { phrases, addLog } = useStore();

  const handleParsingClick = async () => {
    // –°–æ–±–∏—Ä–∞–µ–º –≤—ã–±—Ä–∞–Ω–Ω—ã–µ —Ñ—Ä–∞–∑—ã
    const selectedPhrases = phrases
      .filter(p => p.selected)
      .map(p => p.text);

    if (selectedPhrases.length === 0) {
      addLog('warning', '–í—ã–±–µ—Ä–∏—Ç–µ —Ñ—Ä–∞–∑—ã –¥–ª—è –ø–∞—Ä—Å–∏–Ω–≥–∞');
      return;
    }

    // –ù–∞—Å—Ç—Ä–æ–π–∫–∏ –ø–∞—Ä—Å–∏–Ω–≥–∞
    const settings = {
      modes: ['ws', 'qws'],
      regions: [225], // –†–æ—Å—Å–∏—è
      profiles: [] // –í—Å–µ –∞–∫–∫–∞—É–Ω—Ç—ã
    };

    // –í—ã–∑—ã–≤–∞–µ–º Python backend
    const result = await pythonBridge.startParsing(selectedPhrases, settings);

    if (result.status === 'started') {
      addLog('success', `–ü–∞—Ä—Å–∏–Ω–≥ –∑–∞–ø—É—â–µ–Ω: ${result.phrases_count} —Ñ—Ä–∞–∑`);
    } else {
      addLog('error', `–û—à–∏–±–∫–∞: ${result.message}`);
    }
  };

  return (
    <button onClick={handleParsingClick}>
      üîç –ß–∞—Å—Ç–æ—Ç–∫–∞
    </button>
  );
}
```

---

## üîÑ Workflow –ø–∞—Ä—Å–∏–Ω–≥–∞ (–ø–æ–ª–Ω–∞—è —Ü–µ–ø–æ—á–∫–∞)

### –®–∞–≥ 1: –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –Ω–∞–∂–∏–º–∞–µ—Ç "–ß–∞—Å—Ç–æ—Ç–∫–∞" –≤ React UI

```
React Toolbar ‚Üí onClick ‚Üí handleParsingClick()
```

### –®–∞–≥ 2: React –≤—ã–∑—ã–≤–∞–µ—Ç pythonBridge

```typescript
const result = await pythonBridge.startParsing(phrases, settings);
```

### –®–∞–≥ 3: JavaScript ‚Üí QWebChannel ‚Üí Python

```
pythonBridge.call('start_parsing', { phrases, settings })
  ‚Üì
window.pythonBridge.call_python(JSON.stringify(...))
  ‚Üì QWebChannel (IPC —á–µ—Ä–µ–∑ shared memory)
PythonBridge.call_python(data_json)
```

### –®–∞–≥ 4: Python –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç –∑–∞–ø—Ä–æ—Å

```python
# parsing_tab_v5.py
def call_python(self, data_json: str) -> str:
    data = json.loads(data_json)
    action = data['action']  # "start_parsing"

    if action == 'start_parsing':
        return self._start_wordstat_parsing(
            data['phrases'],
            data['settings']
        )
```

### –®–∞–≥ 5: –°–æ–∑–¥–∞–µ—Ç—Å—è —ç–∫–∑–µ–º–ø–ª—è—Ä ParsingTab –∏ –∑–∞–ø—É—Å–∫–∞–µ—Ç—Å—è –ø–∞—Ä—Å–∏–Ω–≥

```python
def _start_wordstat_parsing(self, phrases, settings):
    # –ü–æ–ª—É—á–∞–µ–º –æ—Ä–∏–≥–∏–Ω–∞–ª—å–Ω—ã–π –ø–∞—Ä—Å–µ—Ä
    parser = self.parsing_tab._parser_instance

    # –í—ã–∑—ã–≤–∞–µ–º –º–µ—Ç–æ–¥ –ø–∞—Ä—Å–∏–Ω–≥–∞
    parser._run_parsing_with_settings(
        phrases,
        selected_profiles,
        normalized_settings
    )
```

### –®–∞–≥ 6: MultiParsingWorker –∑–∞–ø—É—Å–∫–∞–µ—Ç—Å—è –≤ –æ—Ç–¥–µ–ª—å–Ω–æ–º –ø–æ—Ç–æ–∫–µ

```python
# parsing_tab.py
def _run_parsing_with_settings(self, phrases, profiles, settings):
    # –°–æ–∑–¥–∞–µ–º worker –≤ –æ—Ç–¥–µ–ª—å–Ω–æ–º QThread
    self._worker = MultiParsingWorker(
        phrases=phrases,
        profiles=profiles,
        settings=settings
    )

    # –ü–æ–¥–∫–ª—é—á–∞–µ–º —Å–∏–≥–Ω–∞–ª—ã –¥–ª—è –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è UI
    self._worker.log_signal.connect(self._append_log)
    self._worker.progress_signal.connect(self._update_progress)
    self._worker.finished.connect(self._on_parsing_finished)

    # –ó–∞–ø—É—Å–∫–∞–µ–º –∞—Å–∏–Ω—Ö—Ä–æ–Ω–Ω–æ
    self._worker.start()
```

### –®–∞–≥ 7: MultiParsingWorker ‚Üí SingleParsingTask ‚Üí TurboParser

```python
# parsing_tab.py (–≤–Ω—É—Ç—Ä–∏ MultiParsingWorker)
async def _run_all_parsers(self):
    tasks = []
    for profile in self.profiles:
        task = SingleParsingTask(
            phrases=batch_phrases,
            profile=profile,
            settings=self.settings
        )
        tasks.append(task.run())

    # –ó–∞–ø—É—Å–∫–∞–µ–º –ø–∞—Ä–∞–ª–ª–µ–ª—å–Ω–æ
    results = await asyncio.gather(*tasks)
```

### –®–∞–≥ 8: TurboParser –∑–∞–ø—É—Å–∫–∞–µ—Ç Playwright —Å 10 –≤–∫–ª–∞–¥–∫–∞–º–∏

```python
# turbo_parser_improved.py
class TurboParser:
    async def run(self):
        # –ó–∞–ø—É—Å–∫–∞–µ–º –±—Ä–∞—É–∑–µ—Ä —Å –ø—Ä–æ—Ñ–∏–ª–µ–º Chrome
        context = await chromium.launch_persistent_context(
            profile_path,
            proxy=proxy_config,
            headless=False
        )

        # –°–æ–∑–¥–∞–µ–º 10 –≤–∫–ª–∞–¥–æ–∫
        pages = [await context.new_page() for _ in range(10)]

        # –†–∞—Å–ø—Ä–µ–¥–µ–ª—è–µ–º —Ñ—Ä–∞–∑—ã –ø–æ –≤–∫–ª–∞–¥–∫–∞–º
        for tab_idx, page in enumerate(pages):
            phrases_for_tab = self.phrases[tab_idx::10]
            await self._parse_tab(page, phrases_for_tab)

        return self.results
```

### –®–∞–≥ 9: –ü–µ—Ä–µ—Ö–≤–∞—Ç XHR –∑–∞–ø—Ä–æ—Å–æ–≤ –∫ Wordstat API

```python
# turbo_parser_improved.py
async def _parse_tab(self, page, phrases):
    # –ü–æ–¥–ø–∏—Å—ã–≤–∞–µ–º—Å—è –Ω–∞ response –æ—Ç /wordstat/api
    page.on('response', self._handle_response)

    for phrase in phrases:
        # –ü–µ—Ä–µ—Ö–æ–¥–∏–º –Ω–∞ —Å—Ç—Ä–∞–Ω–∏—Ü—É Wordstat
        url = f'https://wordstat.yandex.ru/?words={phrase}&region={region}'
        await page.goto(url)

        # –ñ–¥–µ–º –æ—Ç–≤–µ—Ç–∞ API (–ø–µ—Ä–µ—Ö–≤–∞—Ç–∏—Ç—Å—è –≤ _handle_response)
        await page.wait_for_timeout(2000)

def _handle_response(self, response):
    if '/wordstat/api' in response.url:
        data = response.json()
        frequency = data.get('shows', 0)
        self.results[phrase] = frequency
```

### –®–∞–≥ 10: –†–µ–∑—É–ª—å—Ç–∞—Ç—ã –≤–æ–∑–≤—Ä–∞—â–∞—é—Ç—Å—è –≤ UI

```python
# parsing_tab.py
def _on_parsing_finished(self, results):
    # –û–±–Ω–æ–≤–ª—è–µ–º —Ç–∞–±–ª–∏—Ü—É —Å —Ä–µ–∑—É–ª—å—Ç–∞—Ç–∞–º–∏
    for phrase, frequency in results.items():
        self._update_table_row(phrase, frequency)

    # –õ–æ–≥–∏—Ä—É–µ–º –≤ Activity Log
    self._append_log(f"‚úÖ –ü–∞—Ä—Å–∏–Ω–≥ –∑–∞–≤–µ—Ä—à–µ–Ω: {len(results)} —Ñ—Ä–∞–∑")
```

### –®–∞–≥ 11: Activity Log –æ—Ç–æ–±—Ä–∞–∂–∞–µ—Ç—Å—è –≤ React UI

```
Python ActivityLog.append_line()
  ‚Üì (—Å–∏–≥–Ω–∞–ª Qt)
QTextEdit –æ–±–Ω–æ–≤–ª—è–µ—Ç—Å—è
  ‚Üì (–µ—Å–ª–∏ –Ω—É–∂–Ω–æ –ø–µ—Ä–µ–¥–∞—Ç—å –≤ React)
pythonBridge emit signal ‚Üí React useEffect
```

---

## üóÇÔ∏è –ú–æ—Ä—Ñ–æ–ª–æ–≥–∏—è (pymorphy3)

**–§–∞–π–ª:** `keyset/services/morphology.py`

```python
import pymorphy3

morph = pymorphy3.MorphAnalyzer()

def lemmatize_word(word: str) -> str:
    """–ü–æ–ª—É—á–∏—Ç—å –ª–µ–º–º—É (–Ω–∞—á–∞–ª—å–Ω—É—é —Ñ–æ—Ä–º—É) —Å–ª–æ–≤–∞"""
    parsed = morph.parse(word.lower())[0]
    return parsed.normal_form

def match_stopword(phrase: str, stopword: str, mode: str) -> bool:
    """
    –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —Å–æ–≤–ø–∞–¥–µ–Ω–∏–µ —Å—Ç–æ–ø-—Å–ª–æ–≤–∞ —Å —Ñ—Ä–∞–∑–æ–π

    –†–µ–∂–∏–º—ã:
    - exact: —Ç–æ—á–Ω–æ–µ —Å–æ–≤–ø–∞–¥–µ–Ω–∏–µ
    - partial: —á–∞—Å—Ç–∏—á–Ω–æ–µ –≤—Ö–æ–∂–¥–µ–Ω–∏–µ
    - independent: —Ü–µ–ª–æ–µ —Å–ª–æ–≤–æ
    - morphological: –ø–æ –ª–µ–º–º–∞–º (–∫—É–ø–∏—Ç—å = –ø–æ–∫—É–ø–∫–∞)
    """
    if mode == 'morphological':
        phrase_lemmas = set(lemmatize_word(w) for w in phrase.split())
        stopword_lemma = lemmatize_word(stopword)
        return stopword_lemma in phrase_lemmas

    # ... –æ—Å—Ç–∞–ª—å–Ω—ã–µ —Ä–µ–∂–∏–º—ã
```

**–ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ –≤ –º–∏–Ω—É—Å–∞—Ü–∏–∏:**

```python
# parsing_tab.py
def _on_stopwords_clicked(self):
    from ...services.morphology import match_stopword

    config = dialog.get_stopwords()
    stopwords = config['words']
    mode = config['mode']  # 'morphological'

    for row in range(self.keys_table.rowCount()):
        phrase = self.keys_table.item(row, 0).text()

        for stopword in stopwords:
            if match_stopword(phrase, stopword, mode):
                rows_to_remove.append(row)
                break
```

---

## üì¶ –£–ø–∞–∫–æ–≤–∫–∞ –≤ .exe

### PyInstaller –∫–æ–º–∞–Ω–¥–∞

```bash
pyinstaller \
  --onefile \
  --windowed \
  --name KeySet \
  --icon keyset/keyset_icon.ico \
  --add-data "keyset/ui;keyset/ui" \
  --hidden-import PySide6.QtWebEngineWidgets \
  --hidden-import PySide6.QtWebChannel \
  --hidden-import pymorphy3 \
  keyset/app/main.py
```

### –ß—Ç–æ –≤–∫–ª—é—á–∞–µ—Ç—Å—è –≤ .exe

- Python runtime + –≤—Å–µ –±–∏–±–ª–∏–æ—Ç–µ–∫–∏
- PySide6 + –≤—Å—Ç—Ä–æ–µ–Ω–Ω—ã–π Chromium (QWebEngine)
- React UI –∏–∑ `keyset/ui/` (index.html + assets)
- –í—Å–µ –º–æ–¥—É–ª–∏ Python (–ø–∞—Ä—Å–µ—Ä, –º–æ—Ä—Ñ–æ–ª–æ–≥–∏—è, –ë–î)

### –†–µ–∑—É–ª—å—Ç–∞—Ç

```
dist/
‚îî‚îÄ‚îÄ KeySet.exe  (~150-200 MB)
```

---

## üîç –û—Ç–ª–∞–¥–∫–∞

### –ö–æ–Ω—Å–æ–ª—å –±—Ä–∞—É–∑–µ—Ä–∞ –≤ QWebEngineView

–î–æ–±–∞–≤–∏—Ç—å DevTools:

```python
# parsing_tab_v5.py
from PySide6.QtWebEngineCore import QWebEngineSettings

settings = self.webview.settings()
settings.setAttribute(QWebEngineSettings.JavascriptEnabled, True)
settings.setAttribute(QWebEngineSettings.LocalContentCanAccessRemoteUrls, True)

# –í–∫–ª—é—á–∏—Ç—å DevTools (—Ç–æ–ª—å–∫–æ –¥–ª—è —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∏)
self.webview.page().setDevToolsPage(QWebEnginePage())
```

### –õ–æ–≥–∏ Python

```python
if self.activity_log:
    self.activity_log.append_line(f"DEBUG: {message}")
```

### –õ–æ–≥–∏ JavaScript

```typescript
console.log('[React] Parsing started:', phrases);
```

---

## ‚úÖ –ß–µ–∫–ª–∏—Å—Ç –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–∏

- [x] React UI —Å–æ–±—Ä–∞–Ω –≤ `keyset/ui/`
- [x] QWebEngineView –∑–∞–≥—Ä—É–∂–∞–µ—Ç `ui/index.html`
- [x] QWebChannel –∑–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä–æ–≤–∞–Ω —Å `pythonBridge`
- [x] `pythonBridge.ts` –ø–æ–¥–∫–ª—é—á–∞–µ—Ç—Å—è –≤ React
- [x] –ú–æ—Ä—Ñ–æ–ª–æ–≥–∏—è (pymorphy3) —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∞
- [x] –ü–∞—Ä—Å–∏–Ω–≥ –≤—ã–∑—ã–≤–∞–µ—Ç—Å—è —á–µ—Ä–µ–∑ `startParsing()`
- [x] Activity Log —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∏—Ä—É–µ—Ç—Å—è
- [x] –û—Ç–Ω–æ—Å–∏—Ç–µ–ª—å–Ω—ã–µ –ø—É—Ç–∏ (`./assets/`) –¥–ª—è —É–ø–∞–∫–æ–≤–∫–∏
- [ ] –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –≤—Å–µ—Ö 23 –º–æ–¥–∞–ª–æ–≤
- [ ] –§–∏–Ω–∞–ª—å–Ω–∞—è —É–ø–∞–∫–æ–≤–∫–∞ PyInstaller

---

## üéâ –ò—Ç–æ–≥

**KeySet Production v1.0** –ø–æ–ª–Ω–æ—Å—Ç—å—é –≥–æ—Ç–æ–≤ –∫ —É–ø–∞–∫–æ–≤–∫–µ –≤ .exe:

1. **React UI** (premium –¥–∏–∑–∞–π–Ω) –≤—Å—Ç—Ä–æ–µ–Ω –≤ QWebEngineView
2. **QWebChannel** —Å–≤—è–∑—ã–≤–∞–µ—Ç JavaScript ‚Üî Python
3. **TurboParser** (Playwright, 10 –≤–∫–ª–∞–¥–æ–∫) —Ä–∞–±–æ—Ç–∞–µ—Ç —á–µ—Ä–µ–∑ bridge
4. **–ú–æ—Ä—Ñ–æ–ª–æ–≥–∏—è** (pymorphy3) –æ–±–µ—Å–ø–µ—á–∏–≤–∞–µ—Ç –ø—Ä–∞–≤–∏–ª—å–Ω—É—é –º–∏–Ω—É—Å–∞—Ü–∏—é
5. **–í—Å–µ —Ñ–∞–π–ª—ã** –Ω–∞—Ö–æ–¥—è—Ç—Å—è –≤ `keyset/` –¥–ª—è —É–ø–∞–∫–æ–≤–∫–∏

**–°–ª–µ–¥—É—é—â–∏–π —à–∞–≥:** —É–ø–∞–∫–æ–≤–∞—Ç—å –∫–æ–º–∞–Ω–¥–æ–π PyInstaller –∏ –ø–æ–ª—É—á–∏—Ç—å –≥–æ—Ç–æ–≤—ã–π `KeySet.exe` –¥–ª—è –ø—Ä–æ–¥–∞–∂–∏!
