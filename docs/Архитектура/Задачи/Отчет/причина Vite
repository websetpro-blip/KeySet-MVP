# РџСЂРѕР±Р»РµРјР°: KeySet-MVP РЅРµ Р·Р°РїСѓСЃРєР°Р»СЃСЏ - Р±РµР»С‹Р№ СЌРєСЂР°РЅ Рё РѕС€РёР±РєРё PyWebView

## РЎРёРјРїС‚РѕРјС‹:
1. PyWebView РѕРєРЅРѕ РѕС‚РєСЂС‹РІР°Р»РѕСЃСЊ, РЅРѕ РїР°РґР°Р»Рѕ СЃ РѕС€РёР±РєРѕР№ `webview.errors.WebViewException: Main window failed to start`
2. РћС€РёР±РєР° РІРѕР·РЅРёРєР°Р»Р° РІ С„Р°Р№Р»Рµ `webview/dom/element.py` РїСЂРё РїРѕРїС‹С‚РєРµ РґРѕСЃС‚СѓРїР° Рє DOM.body
3. Р’СЃРµ assets Р·Р°РіСЂСѓР¶Р°Р»РёСЃСЊ СѓСЃРїРµС€РЅРѕ (CSS, JS bundle, vite.svg), РЅРѕ React РЅРµ РёРЅРёС†РёР°Р»РёР·РёСЂРѕРІР°Р»СЃСЏ
4. РџРѕСЃР»Рµ Р·Р°РіСЂСѓР·РєРё vite.svg РЅРёРєР°РєРёС… РґРѕРїРѕР»РЅРёС‚РµР»СЊРЅС‹С… Р·Р°РїСЂРѕСЃРѕРІ РЅРµ Р±С‹Р»Рѕ - РїСЂРёР»РѕР¶РµРЅРёРµ Р·Р°РІРёСЃР°Р»Рѕ

## РљРѕСЂРЅРµРІР°СЏ РїСЂРёС‡РёРЅР°:
**Vite code-splitting СЃРѕР·РґР°РІР°Р» РјРЅРѕР¶РµСЃС‚РІРѕ РјРµР»РєРёС… chunks, РєРѕС‚РѕСЂС‹Рµ Р»РѕРјР°Р»Рё РёРЅРёС†РёР°Р»РёР·Р°С†РёСЋ js_api bridge РІ PyWebView**

РљРѕРіРґР° Vite СЃРѕР±РёСЂР°Р» С„СЂРѕРЅС‚РµРЅРґ СЃ РІРєР»СЋС‡РµРЅРЅС‹Рј code-splitting (РЅР°СЃС‚СЂРѕР№РєР° РїРѕ СѓРјРѕР»С‡Р°РЅРёСЋ), РѕРЅ СЃРѕР·РґР°РІР°Р» С‚Р°РєРёРµ С„Р°Р№Р»С‹:
- vendor-BD-WZS7N.js
- vendor-react-BeNjHMlV.js
- tab-data-DC4rwfnn.js
- index-eQ5cn-KO.js (РѕСЃРЅРѕРІРЅРѕР№ bundle)

PyWebView РїС‹С‚Р°Р»СЃСЏ РёРЅР¶РµРєС‚РёС‚СЊ js_api bridge (WindowAPI СЃ РјРµС‚РѕРґР°РјРё DevToolsBridge) **РґРѕ С‚РѕРіРѕ, РєР°Рє СЃС‚СЂР°РЅРёС†Р° РїРѕР»РЅРѕСЃС‚СЊСЋ Р·Р°РіСЂСѓР·РёР»Р°СЃСЊ**. РџСЂРё РЅР°Р»РёС‡РёРё РјРЅРѕР¶РµСЃС‚РІР° chunks СЌС‚Рѕ РїСЂРёРІРѕРґРёР»Рѕ Рє race condition:
- PyWebView РІС‹Р·С‹РІР°Р» `window.evaluate_js()` РґР»СЏ РїРѕР»СѓС‡РµРЅРёСЏ СЃРїРёСЃРєР° DOM events
- DOM.body РµС‰Рµ РЅРµ Р±С‹Р» РіРѕС‚РѕРІ РёР·-Р·Р° Р°СЃРёРЅС…СЂРѕРЅРЅРѕР№ Р·Р°РіСЂСѓР·РєРё chunks
- РРЅР¶РµРєС†РёСЏ РїР°РґР°Р»Р° СЃ РёСЃРєР»СЋС‡РµРЅРёРµРј

## Р РµС€РµРЅРёРµ:

### 1. РЎРєРѕРїРёСЂРѕРІР°Р» СЂР°Р±РѕС‡РёРµ РєРѕРјРїРѕРЅРµРЅС‚С‹ РёР· KeySet-MVP-claude
```bash
# Venv СЃ Python 3.11.8 Рё СЃРѕРІРјРµСЃС‚РёРјС‹РјРё РІРµСЂСЃРёСЏРјРё РїР°РєРµС‚РѕРІ
rm -rf .venv
cp -r ../KeySet-MVP-claude/.venv .venv

# Р Р°Р±РѕС‡РёР№ launcher.py (РёРґРµРЅС‚РёС‡РµРЅ, РЅРѕ СЂР°Р±РѕС‚Р°Р» СЃ РїСЂР°РІРёР»СЊРЅС‹Рј dist)
cp ../KeySet-MVP-claude/launcher.py launcher.py

# Р Р°Р±РѕС‡РёР№ backend/main.py (РёРґРµРЅС‚РёС‡РµРЅ)
cp ../KeySet-MVP-claude/backend/main.py backend/main.py
```

### 2. **РљР»СЋС‡РµРІРѕРµ СЂРµС€РµРЅРёРµ: РЎРєРѕРїРёСЂРѕРІР°Р» frontend/dist Р±РµР· code-splitting**
```bash
rm -rf frontend/dist
cp -r ../KeySet-MVP-claude/frontend/dist frontend/dist
```

KeySet-MVP-claude РёСЃРїРѕР»СЊР·СѓРµС‚ **РѕРґРёРЅ Р±РѕР»СЊС€РѕР№ bundle** РІРјРµСЃС‚Рѕ РјРЅРѕР¶РµСЃС‚РІР° chunks:
- `index-CV_t14DI.js` - 1.3 MB (РІСЃРµ РІ РѕРґРЅРѕРј С„Р°Р№Р»Рµ)
- `index-C-WZsHsY.css` - CSS
- РЁСЂРёС„С‚С‹ FontAwesome

Р­С‚Рѕ СЂРµС€Р°РµС‚ РїСЂРѕР±Р»РµРјСѓ РїРѕС‚РѕРјСѓ С‡С‚Рѕ:
1. Р’РµСЃСЊ JavaScript Р·Р°РіСЂСѓР¶Р°РµС‚СЃСЏ **РѕРґРЅРёРј СЃРёРЅС…СЂРѕРЅРЅС‹Рј Р·Р°РїСЂРѕСЃРѕРј**
2. PyWebView РјРѕР¶РµС‚ Р±РµР·РѕРїР°СЃРЅРѕ РёРЅР¶РµРєС‚РёС‚СЊ js_api bridge РїРѕСЃР»Рµ С‚РѕРіРѕ, РєР°Рє РµРґРёРЅСЃС‚РІРµРЅРЅС‹Р№ bundle Р·Р°РіСЂСѓР·РёР»СЃСЏ
3. РќРµС‚ race conditions РјРµР¶РґСѓ Р·Р°РіСЂСѓР·РєРѕР№ chunks Рё РёРЅРёС†РёР°Р»РёР·Р°С†РёРµР№ PyWebView DOM API

## Р РµР·СѓР»СЊС‚Р°С‚:
РџРѕСЃР»Рµ Р·Р°РјРµРЅС‹ dist РЅР° РІРµСЂСЃРёСЋ Р±РµР· code-splitting, Р·Р°РїСѓСЃРє РїСЂРѕС€РµР» СѓСЃРїРµС€РЅРѕ:
```
INFO: 127.0.0.1:65089 - "GET / HTTP/1.1" 200 OK
INFO: 127.0.0.1:50486 - "GET /assets/index-C-WZsHsY.css HTTP/1.1" 200 OK
INFO: 127.0.0.1:65089 - "GET /assets/index-CV_t14DI.js HTTP/1.1" 200 OK
INFO: 127.0.0.1:65089 - "GET /assets/fa-solid-900-8GirhLYJ.woff2 HTTP/1.1" 200 OK
INFO: 127.0.0.1:65089 - "GET /vite.svg HTTP/1.1" 200 OK
INFO: 127.0.0.1:65089 - "GET /api/accounts HTTP/1.1" 200 OK  в†ђ React РёРЅРёС†РёР°Р»РёР·РёСЂРѕРІР°Р»СЃСЏ!
```

## Р§С‚Рѕ РќР• СЃСЂР°Р±РѕС‚Р°Р»Рѕ (РїРѕРїС‹С‚РєРё РґРѕ СЂРµС€РµРЅРёСЏ):
1. вќЊ РЎРјРµРЅР° РІРµСЂСЃРёР№ Python (РїСЂРѕР±РѕРІР°Р» 3.10, 3.12, 3.13) - РЅРµ РїРѕРјРѕРіР»Рѕ
2. вќЊ РћР±РЅРѕРІР»РµРЅРёРµ pythonnet СЃ 3.0.3 РґРѕ 3.0.5 - РЅРµ РїРѕРјРѕРіР»Рѕ
3. вќЊ РџРµСЂРµСѓСЃС‚Р°РЅРѕРІРєР° FastAPI/uvicorn - РЅРµ РїРѕРјРѕРіР»Рѕ
4. вќЊ РџРµСЂРµСЃР±РѕСЂРєР° frontend С‡РµСЂРµР· `npm run build` - С‚РѕР»СЊРєРѕ СѓС…СѓРґС€РёР»Рѕ (СЃРѕР·РґР°Р» РµС‰Рµ Р±РѕР»СЊС€Рµ chunks)
5. вќЊ РџРѕРїС‹С‚РєР° РёСЃРїРѕР»СЊР·РѕРІР°С‚СЊ `gui="mshtml"` РІРјРµСЃС‚Рѕ `edgechromium` - РЅРµ РїРѕРјРѕРіР»Рѕ

## Р”РѕР»РіРѕСЃСЂРѕС‡РЅРѕРµ СЂРµС€РµРЅРёРµ:
Р§С‚РѕР±С‹ РёР·Р±РµР¶Р°С‚СЊ СЌС‚РѕР№ РїСЂРѕР±Р»РµРјС‹ РІ Р±СѓРґСѓС‰РµРј, РЅСѓР¶РЅРѕ РЅР°СЃС‚СЂРѕРёС‚СЊ Vite РґР»СЏ СЃР±РѕСЂРєРё **РµРґРёРЅРѕРіРѕ bundle Р±РµР· code-splitting** РІ KeySet-MVP/frontend/vite.config.ts:

```typescript
export default defineConfig({
  plugins: [react()],
  build: {
    rollupOptions: {
      output: {
        manualChunks: undefined, // РћС‚РєР»СЋС‡РёС‚СЊ Р°РІС‚РѕРјР°С‚РёС‡РµСЃРєРёР№ code-splitting
      },
    },
  },
});
```

РџРѕСЃР»Рµ СЌС‚РѕРіРѕ `npm run build` Р±СѓРґРµС‚ СЃРѕР·РґР°РІР°С‚СЊ РѕРґРёРЅ Р±РѕР»СЊС€РѕР№ bundle, СЃРѕРІРјРµСЃС‚РёРјС‹Р№ СЃ PyWebView js_api РёРЅР¶РµРєС†РёРµР№.

## РљРѕРјР°РЅРґР° РґР»СЏ Р·Р°РїСѓСЃРєР°:
```bash
cd C:\AI\yandex\KeySet-MVP
.venv\Scripts\python.exe launcher.py
```
