# РћС‚С‡РµС‚ РїРѕ Р·Р°РґР°С‡Рµ 4: РљРѕРЅСЃРѕР»РёРґР°С†РёСЏ СЃС‚СЂСѓРєС‚СѓСЂС‹ KeySet-MVP

## Р—РђР”РђР§Рђ Р’Р«РџРћР›РќР•РќРђ вњ…

### РљСЂР°С‚РєРѕРµ СЂРµР·СЋРјРµ:
РЈСЃРїРµС€РЅРѕ РїРµСЂРµРЅРµСЃРµРЅС‹ РјРѕРґСѓР»Рё РёР· `keyset/` РІ РЅРѕРІСѓСЋ СЃС‚СЂСѓРєС‚СѓСЂСѓ `core/` Рё `services/` РІ РєРѕСЂРЅРµ `KeySet-MVP/`. Backend С‚РµРїРµСЂСЊ РёСЃРїРѕР»СЊР·СѓРµС‚ РЅРѕРІС‹Рµ РїСѓС‚Рё РёРјРїРѕСЂС‚Р°. Launcher Р·Р°РїСѓСЃРєР°РµС‚СЃСЏ, API СЌРЅРґРїРѕРёРЅС‚С‹ СЂР°Р±РѕС‚Р°СЋС‚, РІРѕР·РІСЂР°С‰Р°СЋС‚ СЂРµР°Р»СЊРЅС‹Рµ РґР°РЅРЅС‹Рµ РёР· Р‘Р”.

---

## Р§РўРћ РЎР”Р•Р›РђРќРћ:

### 1. вњ… РђРЅР°Р»РёР· РёРјРїРѕСЂС‚РѕРІ (Рї.1 РёР· Р·Р°РґР°С‡Рё 4)

**РќР°Р№РґРµРЅС‹ РІСЃРµ РёРјРїРѕСЂС‚С‹ keyset РІ backend:**
- `backend/main.py`: `from keyset.core.db`, `from keyset.core.app_paths`
- `backend/routers/accounts.py`: `from keyset.services import accounts`
- `backend/routers/data.py`: `from keyset.services import frequency`
- `backend/routers/wordstat.py`: `from keyset.services import accounts, frequency, wordstat_bridge`

**launcher.py**: РёРјРїРѕСЂС‚РѕРІ keyset РќР•Рў вњ“

---

### 2. вњ… РџРµСЂРµРЅРѕСЃ РјРѕРґСѓР»РµР№ (Рї.2 РёР· Р·Р°РґР°С‡Рё 4)

**РЎРєРѕРїРёСЂРѕРІР°РЅС‹ СЃР»РµРґСѓСЋС‰РёРµ РјРѕРґСѓР»Рё:**

**РР· keyset/core/ в†’ core/:**
- `__init__.py`
- `app_paths.py`
- `db.py` (СЃ РёСЃРїСЂР°РІР»РµРЅРёРµРј РїСѓС‚Рё Рє Р‘Р”)
- `icons.py`
- `models.py`
- `playwright_config.py`
- `proxy_store.py`
- `regions.py`
- `settings.py`
- `xmind_parser.py`

**РР· keyset/services/ в†’ services/:**
- `__init__.py`
- `accounts.py` (СЃ РёСЃРїСЂР°РІР»РµРЅРёРµРј РёРјРїРѕСЂС‚РѕРІ)
- `frequency.py` (СЃ РёСЃРїСЂР°РІР»РµРЅРёРµРј РёРјРїРѕСЂС‚РѕРІ)
- `wordstat_bridge.py`
- `proxy_manager.py` (СЃ РёСЃРїСЂР°РІР»РµРЅРёРµРј РёРјРїРѕСЂС‚РѕРІ)
- `chrome_launcher.py`

**РР· keyset/utils/ в†’ utils/:**
- `__init__.py`
- `proxy.py`
- `text_fix.py`

**РЎС‚Р°СЂР°СЏ РїР°РїРєР° keyset/ РќР• СѓРґР°Р»РµРЅР°** (СЃРѕРіР»Р°СЃРЅРѕ РёРЅСЃС‚СЂСѓРєС†РёРё Рї.2)

---

### 3. вњ… РћР±РЅРѕРІР»РµРЅРёРµ РёРјРїРѕСЂС‚РѕРІ (Рї.3 РёР· Р·Р°РґР°С‡Рё 4)

**Р’ backend/main.py:**
```python
from keyset.core.db import ensure_schema
в†’ from core.db import ensure_schema

from keyset.core.app_paths import WWW_DIR, ensure_runtime, bootstrap_files, APP_ROOT
в†’ from core.app_paths import WWW_DIR, ensure_runtime, bootstrap_files, APP_ROOT
```

**Р’ backend/routers/accounts.py:**
```python
from keyset.services import accounts as legacy_accounts
в†’ from services import accounts as legacy_accounts
```

**Р’ backend/routers/data.py:**
```python
from keyset.services import frequency as frequency_service
в†’ from services import frequency as frequency_service
```

**Р’ backend/routers/wordstat.py:**
```python
from keyset.services import accounts, frequency, wordstat_bridge
в†’ from services import accounts, frequency, wordstat_bridge
```

**Р’РЅСѓС‚СЂРё services/accounts.py:**
```python
from ..core.db import SessionLocal
from ..core.models import Account
from ..utils.proxy import proxy_to_playwright
from ..utils.text_fix import fix_mojibake
в†’ from core.db import SessionLocal
в†’ from core.models import Account
в†’ from utils.proxy import proxy_to_playwright
в†’ from utils.text_fix import fix_mojibake
в†’ from services.proxy_manager import ProxyManager
в†’ from services.chrome_launcher import ChromeLauncher
```

**Р’РЅСѓС‚СЂРё services/frequency.py:**
```python
from ..core.db import SessionLocal, get_db_connection
from ..core.models import FrequencyResult
в†’ from core.db import SessionLocal, get_db_connection
в†’ from core.models import FrequencyResult
```

**Р’РЅСѓС‚СЂРё services/proxy_manager.py:**
```python
from ..utils.proxy import proxy_to_playwright
from ..core.db import SessionLocal
from ..core.models import Account
в†’ from utils.proxy import proxy_to_playwright
в†’ from core.db import SessionLocal
в†’ from core.models import Account
```

---

### 4. вњ… РћР±РЅРѕРІР»РµРЅРёРµ PyInstaller spec (Рї.4 РёР· Р·Р°РґР°С‡Рё 4)

**Р¤Р°Р№Р»: build/keyset.spec**

РР·РјРµРЅРµРЅРёСЏ:
- РџРµСЂРµРёРјРµРЅРѕРІР°РЅР° С„СѓРЅРєС†РёСЏ `collect_keyset()` в†’ `collect_package(package_name)` РґР»СЏ СѓРЅРёРІРµСЂСЃР°Р»СЊРЅРѕСЃС‚Рё
- Р”РѕР±Р°РІР»РµРЅС‹ РЅРѕРІС‹Рµ РїР°РєРµС‚С‹ РІ datas:
  ```python
  datas=[
      (str(PROJECT_ROOT / 'frontend' / 'dist'), 'frontend/dist'),
      (str(PROJECT_ROOT / 'backend'), 'backend'),
      *collect_package('core'),        # в†ђ РќРћР’РћР•
      *collect_package('services'),    # в†ђ РќРћР’РћР•
      *collect_package('utils'),       # в†ђ РќРћР’РћР• (РЅРµСЏРІРЅРѕ)
      *collect_package('keyset'),      # Р’СЂРµРјРµРЅРЅРѕ РґР»СЏ РѕР±СЂР°С‚РЅРѕР№ СЃРѕРІРјРµСЃС‚РёРјРѕСЃС‚Рё
  ],
  ```

---

### 5. вњ… РСЃРїСЂР°РІР»РµРЅРёРµ РїСѓС‚Рё Рє Р‘Р”

**Р¤Р°Р№Р»: core/db.py (СЃС‚СЂРѕРєРё 18-32)**

Р”РѕР±Р°РІР»РµРЅР° С„СѓРЅРєС†РёСЏ Р°РІС‚РѕРѕРїСЂРµРґРµР»РµРЅРёСЏ РїСѓС‚Рё Рє Р‘Р” СЃ РїСЂРёРѕСЂРёС‚РµС‚РѕРј `dist/keyset.db`:
```python
def _db_path() -> Path:
    # 1) Р•СЃР»Рё Р·Р°РїСѓС‰РµРЅРѕ РёР· exe, Р±РµСЂРµРј Р‘Р” СЂСЏРґРѕРј СЃ exe
    if getattr(sys, "frozen", false):
        p = Path(sys.executable).resolve().parent / "keyset.db"
        if p.exists():
            return p
    # 2) Р’ dev-СЂРµР¶РёРјРµ: РїСЂРёРѕСЂРёС‚РµС‚ dist/keyset.db (270 KB СЃ РґР°РЅРЅС‹РјРё)
    dist_db = Path(__file__).resolve().parent.parent / "dist" / "keyset.db"
    if dist_db.exists():
        return dist_db
    # 3) Fallback: KeySet-MVP/keyset.db (РїСѓСЃС‚Р°СЏ)
    proj_db = Path(__file__).resolve().parent.parent / "keyset.db"
    return proj_db

DB_PATH = _db_path()
DATABASE_URL = f"sqlite:///{DB_PATH.as_posix()}"
```

**Р РµР·СѓР»СЊС‚Р°С‚**: РўРµРїРµСЂСЊ backend РёСЃРїРѕР»СЊР·СѓРµС‚ Р·Р°РїРѕР»РЅРµРЅРЅСѓСЋ Р‘Р” `dist/keyset.db` (270 KB) РІРјРµСЃС‚Рѕ РїСѓСЃС‚РѕР№ `keyset/keyset.db` (0 bytes)

---

### 6. вњ… РўРµСЃС‚РёСЂРѕРІР°РЅРёРµ (Рї.5 РёР· Р·Р°РґР°С‡Рё 4)

**Р—Р°РїСѓСЃРє launcher.py:**
```
[DEBUG] Running from Python (dev mode)
[launcher] Starting backend on http://127.0.0.1:51485 ...
[DEBUG] OK backend.main imported successfully
INFO: Application startup complete.
[launcher] Browser window started. Close it to exit KeySet.
```
вњ… Launcher Р·Р°РїСѓСЃРєР°РµС‚СЃСЏ Р±РµР· РѕС€РёР±РѕРє

**РџСЂРѕРІРµСЂРєР° API СЌРЅРґРїРѕРёРЅС‚РѕРІ:**

`GET /api/accounts`:
```json
[
  {
    "id": 1,
    "email": "dsmismirnov",
    "profilePath": "C:/AI/yandex/.profiles/wordstat_main",
    "status": "active",
    "proxy": "77.73.134.166:8000",
    "authStatus": "РђРІС‚РѕСЂРёР·РѕРІР°РЅ"
  },
  {
    "id": 3,
    "email": "kuznepetya",
    "profilePath": "C:/AI/yandex/.profiles/kuznepetya",
    "status": "active"
  }
]

---

# Р—Р°РґР°С‡Р° 5: РњСѓР»СЊС‚Рё-Р°РєРєР°СѓРЅС‚РЅС‹Р№ Wordstat, РјРѕРґСѓР»СЊ Р°РєРєР°СѓРЅС‚РѕРІ Рё РїСЂРѕС„РёР»Рё Chrome

## Р”РѕР±Р°РІР»РµРЅРѕ 2025-11-14 (Codex 5.1)

### РРЅС‚РµРіСЂР°С†РёСЏ РїСЂР°РІРѕР№ РїР°РЅРµР»Рё Р°РєРєР°СѓРЅС‚РѕРІ СЃ backend (РїСЂРѕРґРѕР»Р¶РµРЅРёРµ)

- Р’ `KeySet-MVP/backend/routers/accounts.py`:
  - Р”РѕР±Р°РІР»РµРЅС‹ СЌРЅРґРїРѕРёРЅС‚С‹ `GET/POST /api/accounts/profiles-root/open`, РєРѕС‚РѕСЂС‹Рµ РѕС‚РєСЂС‹РІР°СЋС‚ РІ РїСЂРѕРІРѕРґРЅРёРєРµ РїР°РїРєСѓ СЃ РїСЂРѕС„РёР»СЏРјРё Р±СЂР°СѓР·РµСЂР°:
    - РїСѓС‚СЊ Р±РµСЂС‘С‚СЃСЏ РёР· `core.app_paths.PROFILES` (РєР°С‚Р°Р»РѕРі `runtime/profiles` РІ РєРѕСЂРЅРµ KeySet-MVP);
    - РїСЂРё РІС‹Р·РѕРІРµ СЃРѕР·РґР°С‘С‚ РїР°РїРєСѓ РїСЂРё РЅРµРѕР±С…РѕРґРёРјРѕСЃС‚Рё Рё РїРѕРґ Windows РёСЃРїРѕР»СЊР·СѓРµС‚ `os.startfile(<РїСѓС‚СЊ>)` (РЅР° РґСЂСѓРіРёС… РћРЎ вЂ” `xdg-open` С‡РµСЂРµР· `subprocess.Popen`);
    - РІРѕР·РІСЂР°С‰Р°РµС‚ JSON `{ "status": "ok", "path": "<РїРѕР»РЅС‹Р№ РїСѓС‚СЊ Рє РїР°РїРєРµ РїСЂРѕС„РёР»РµР№>" }`.

- Р’ `KeySet-MVP/frontend/src/modules/accounts/api.ts`:
  - Р”РѕР±Р°РІР»РµРЅ С‚РёРї `ProfilesRootResponse { status: string; path: string; }`;
  - Р”РѕР±Р°РІР»РµРЅР° С„СѓРЅРєС†РёСЏ `openProfilesRoot(): Promise<ProfilesRootResponse>`, РѕС‚РїСЂР°РІР»СЏСЋС‰Р°СЏ `POST` РЅР° `/api/accounts/profiles-root/open`;
  - РџРѕРїСЂР°РІР»РµРЅРѕ СЃРѕРѕР±С‰РµРЅРёРµ РѕР± РѕС€РёР±РєРµ РїСЂРё Р·Р°РіСЂСѓР·РєРµ cookies (СЃС‚СЂРѕРєР° С‚РµРїРµСЂСЊ РІ РЅРѕСЂРјР°Р»СЊРЅРѕРј UTF-8: `"РќРµ СѓРґР°Р»РѕСЃСЊ Р·Р°РіСЂСѓР·РёС‚СЊ РєСѓРєРё"`).

- Р’ `KeySet-MVP/frontend/src/modules/accounts/components/AccountSidebar.tsx`:
  - РРјРїРѕСЂС‚РёСЂРѕРІР°РЅР° РЅРѕРІР°СЏ С„СѓРЅРєС†РёСЏ `openProfilesRoot`;
  - Р’ Р±Р»РѕРєРµ **В«РћСЃРЅРѕРІРЅРѕРµВ» в†’ В«РџСЂРѕС„РёР»СЊ ChromeВ»** РїРѕР»Рµ РїСѓС‚Рё РїСЂРѕС„РёР»СЏ (`account.profilePath`) С‚РµРїРµСЂСЊ РёРјРµРµС‚ РєРЅРѕРїРєСѓ СЃ РёРєРѕРЅРєРѕР№ РїР°РїРєРё СЃРїСЂР°РІР° (РІРЅСѓС‚СЂРё С‚РѕРіРѕ Р¶Рµ РїРѕР»СЏ, РєР°Рє РёРєРѕРЅРєР° В«РіР»Р°Р·В» Сѓ РїР°СЂРѕР»СЏ);
    - РїРѕ РєР»РёРєСѓ РїРѕ РёРєРѕРЅРєРµ РІС‹Р·С‹РІР°РµС‚СЃСЏ `openProfilesRoot()`, backend РѕС‚РєСЂС‹РІР°РµС‚ `runtime/profiles` РІ РїСЂРѕРІРѕРґРЅРёРєРµ Windows;
    - РїСЂРё РѕС€РёР±РєРµ РІС‹РІРѕРґРёС‚СЃСЏ `alert("РќРµ СѓРґР°Р»РѕСЃСЊ РѕС‚РєСЂС‹С‚СЊ РїР°РїРєСѓ РїСЂРѕС„РёР»РµР№: ...")`.
  - Р›РѕРіРёРєР° СЂР°Р·Р±РѕСЂР° СЃС‚СЂРѕРєРё РїСЂРѕРєСЃРё РїСЂРё Р·Р°РїСѓСЃРєРµ Р±СЂР°СѓР·РµСЂР° (`_split_proxy`) РїРµСЂРµРїРёСЃР°РЅР° РЅР° РёСЃРїРѕР»СЊР·РѕРІР°РЅРёРµ `utils.proxy.proxy_to_playwright` вЂ” С‚РµРїРµСЂСЊ Chrome, Р·Р°РїСѓСЃРєР°РµРјС‹Р№ РєРЅРѕРїРєРѕР№ В«Р—Р°РїСѓСЃРє Р±СЂР°СѓР·РµСЂР°В», РїРѕР»СѓС‡Р°РµС‚ С‚Рµ Р¶Рµ `server/username/password`, С‡С‚Рѕ Рё Р±СЂР°СѓР·РµСЂ РІРЅСѓС‚СЂРё TurboParser/РјСѓР»СЊС‚РёРїР°СЂСЃРµСЂР° Wordstat (СѓСЃС‚СЂР°РЅСЏРµРј СЂР°СЃС…РѕР¶РґРµРЅРёСЏ С„РѕСЂРјР°С‚Р° РїСЂРѕРєСЃРё РјРµР¶РґСѓ РёРЅС‚РµСЂС„РµР№СЃРѕРј Р°РєРєР°СѓРЅС‚РѕРІ Рё РїР°СЂСЃРµСЂРѕРј).

- Р’ `KeySet-MVP/services/chrome_launcher.py`:
  - РР·РјРµРЅС‘РЅ СЃРїРѕСЃРѕР± РїРµСЂРµРґР°С‡Рё РїСЂРѕРєСЃРё РІ Chrome:
    - РµСЃР»Рё Р·Р°РґР°РЅС‹ `proxy_username/proxy_password`, РѕРЅРё РІСЃС‚СЂР°РёРІР°СЋС‚СЃСЏ РїСЂСЏРјРѕ РІ Р°СЂРіСѓРјРµРЅС‚ `--proxy-server` РІ РІРёРґРµ `scheme://user:pass@host:port`;
    - РїРµСЂРµРјРµРЅРЅС‹Рµ РѕРєСЂСѓР¶РµРЅРёСЏ `HTTP_PROXY/HTTPS_PROXY` РїРѕР»СѓС‡Р°СЋС‚ С‚РѕС‚ Р¶Рµ URI;
    - СЂР°СЃС€РёСЂРµРЅРёРµ ProxyAuth Р±РѕР»СЊС€Рµ РЅРµ РёСЃРїРѕР»СЊР·СѓРµС‚СЃСЏ РґР»СЏ Р°РІС‚РѕСЂРёР·Р°С†РёРё, С‡С‚РѕР±С‹ РёР·Р±РµР¶Р°С‚СЊ РІСЃРїР»С‹РІР°СЋС‰РµРіРѕ РѕРєРЅР° СЃ Р·Р°РїСЂРѕСЃРѕРј Р»РѕРіРёРЅР°/РїР°СЂРѕР»СЏ РїСЂРѕРєСЃРё Рё РїСЂРёР±Р»РёР·РёС‚СЊ РїРѕРІРµРґРµРЅРёРµ Рє С‚РѕРјСѓ, РєР°Рє Playwright Р°РІС‚РѕСЂРёР·СѓРµС‚СЃСЏ С‡РµСЂРµР· `proxy_to_playwright`.

- Р¤СЂРѕРЅС‚РµРЅРґ РїРµСЂРµСЃРѕР±СЂР°РЅ РєРѕРјР°РЅРґРѕР№ `npm run build` РІ `KeySet-MVP/frontend`:
  - СѓСЃРїРµС€РЅРѕ СЃРѕР±СЂР°РЅ `frontend/dist` (Vite + TypeScript Р±РµР· РѕС€РёР±РѕРє);
  - launcher РїСЂРѕРґРѕР»Р¶Р°РµС‚ РёСЃРїРѕР»СЊР·РѕРІР°С‚СЊ СЃРІРµР¶СѓСЋ СЃР±РѕСЂРєСѓ (Р»РѕРіРёРєР° `_resolve_frontend_paths` СѓР¶Рµ Р±С‹Р»Р° РЅР°СЃС‚СЂРѕРµРЅР° СЂР°РЅРµРµ).

### Р§С‚Рѕ СЌС‚Рѕ РґР°С‘С‚ РїРѕР»СЊР·РѕРІР°С‚РµР»СЋ РІ UI

- Р’Рѕ РІРєР»Р°РґРєРµ В«РђРєРєР°СѓРЅС‚С‹В» СЃРїСЂР°РІР°, РІ СЂР°Р·РґРµР»Рµ В«РџСЂРѕС„РёР»СЊ ChromeВ» С‚РµРїРµСЂСЊ РјРѕР¶РЅРѕ РѕРґРЅРёРј РєР»РёРєРѕРј РѕС‚РєСЂС‹С‚СЊ РѕР±С‰СѓСЋ РїР°РїРєСѓ РїСЂРѕС„РёР»РµР№ (`KeySet-MVP/runtime/profiles`), РіРґРµ Р»РµР¶Р°С‚ Рё Р±СѓРґСѓС‚ СЃРѕР·РґР°РІР°С‚СЊСЃСЏ РїСЂРѕС„РёР»Рё Р±СЂР°СѓР·РµСЂР° РґР»СЏ Р°РєРєР°СѓРЅС‚РѕРІ:
  - СЌС‚Рѕ СѓРїСЂРѕС‰Р°РµС‚ РїСЂРѕРІРµСЂРєСѓ СЃРѕСЃС‚РѕСЏРЅРёСЏ РїСЂРѕС„РёР»РµР№, СЂСѓС‡РЅРѕРµ РєРѕРїРёСЂРѕРІР°РЅРёРµ/Р±СЌРєР°Рї Рё СЂР°Р±РѕС‚Сѓ СЃ С„Р°Р№Р»Р°РјРё `storage_state.json`/`cookies.json`;
  - РїРѕРІРµРґРµРЅРёРµ СЃРѕРѕС‚РІРµС‚СЃС‚РІСѓРµС‚ РўР— РїРѕ Р·Р°РґР°С‡Рµ 5: РЅР°СЃС‚СЂРѕР№РєРё РїСЂРѕС„РёР»СЏ РїРµСЂРµСЃС‚Р°СЋС‚ Р±С‹С‚СЊ В«Р·Р°РіР»СѓС€РєРѕР№В» Рё СЃРІСЏР·Р°РЅС‹ СЃ СЂРµР°Р»СЊРЅРѕР№ С„Р°Р№Р»РѕРІРѕР№ СЃС‚СЂСѓРєС‚СѓСЂРѕР№ KeySet-MVP.

### 14 РЅРѕСЏР±СЂСЏ 2025 (Codex)

- **РџСЂРѕРєСЃРё-Р°РІС‚РѕСЂРёР·Р°С†РёСЏ РІ СЂСѓС‡РЅРѕРј Р·Р°РїСѓСЃРєРµ Chrome:**
  - `_split_proxy` СѓР¶Рµ РёСЃРїРѕР»СЊР·СѓРµС‚ `proxy_to_playwright`, Р° РІ `services/chrome_launcher.py` Р»РѕРіРёРЅ/РїР°СЂРѕР»СЊ СЃРЅРѕРІР° РїРµСЂРµРґР°СЋС‚СЃСЏ С‡РµСЂРµР· РІСЂРµРјРµРЅРЅРѕРµ СЂР°СЃС€РёСЂРµРЅРёРµ ProxyAuth Рё РїРµСЂРµРјРµРЅРЅС‹Рµ РѕРєСЂСѓР¶РµРЅРёСЏ `HTTP_PROXY/HTTPS_PROXY`;
  - Chrome С‚РµРїРµСЂСЊ Р·Р°РїСѓСЃРєР°РµС‚СЃСЏ СЃ `--proxy-server=<scheme>://<host:port>` + Р·Р°РіСЂСѓР·РєРѕР№ СЂР°СЃС€РёСЂРµРЅРёСЏ; РЅРёРєР°РєРѕРіРѕ РІСЃРїР»С‹РІР°СЋС‰РµРіРѕ РѕРєРЅР° СЃ Р·Р°РїСЂРѕСЃРѕРј Р»РѕРіРёРЅР°/РїР°СЂРѕР»СЏ РїСЂРѕРєСЃРё РЅРµС‚, РїРѕРІРµРґРµРЅРёРµ СЃРѕРІРїР°РґР°РµС‚ СЃ РјСѓР»СЊС‚РёРїР°СЂСЃРµСЂРѕРј Wordstat.

- **Р РµРґР°РєС‚РёСЂСѓРµРјР°СЏ РІРєР»Р°РґРєР° В«РћСЃРЅРѕРІРЅРѕРµВ»:**
  - РїРѕР»СЏ Email, РџР°СЂРѕР»СЊ, РЎРµРєСЂРµС‚РЅС‹Р№ РІРѕРїСЂРѕСЃ Рё РџСЂРѕС„РёР»СЊ Chrome Р±РѕР»СЊС€Рµ РЅРµ `readOnly`, РїРѕСЏРІРёР»СЃСЏ Р»РѕРєР°Р»СЊРЅС‹Р№ СЃС‚РµР№С‚ СЃ РєРЅРѕРїРєРѕР№ В«РЎРѕС…СЂР°РЅРёС‚СЊВ»;
  - `onUpdateAccount` СЃСЂР°Р·Сѓ Р·Р°РїРёСЃС‹РІР°РµС‚ РёР·РјРµРЅРµРЅРёСЏ РІ Р‘Р” Р±РµР· РїРµСЂРµР·Р°РїСѓСЃРєР° РїСЂРёР»РѕР¶РµРЅРёСЏ, РїРѕР»СЊР·РѕРІР°С‚РµР»СЊ РІРёРґРёС‚ СЃС‚Р°С‚СѓСЃ В«РќР°СЃС‚СЂРѕР№РєРё СЃРѕС…СЂР°РЅРµРЅС‹В» РёР»Рё СЃРѕРѕР±С‰РµРЅРёРµ РѕР± РѕС€РёР±РєРµ.

- **РЎР±РѕСЂРєР° С„СЂРѕРЅС‚РµРЅРґР°:** РїРѕСЃР»Рµ РёР·РјРµРЅРµРЅРёР№ РІС‹РїРѕР»РЅРµРЅ `npm run build` РІ `KeySet-MVP/frontend`, РІ `frontend/dist` Р»РµР¶РёС‚ Р°РєС‚СѓР°Р»СЊРЅР°СЏ СЃР±РѕСЂРєР°, РєРѕС‚РѕСЂСѓСЋ РёСЃРїРѕР»СЊР·СѓРµС‚ launcher.
```
вњ… Р’РєР»Р°РґРєР° "РђРєРєР°СѓРЅС‚С‹" РїРѕР»СѓС‡Р°РµС‚ РґР°РЅРЅС‹Рµ РёР· Р‘Р”

`GET /api/data/phrases?limit=2`:
```json
{
  "items": [
    {
      "id": 4,
      "phrase": "РєСѓРїРёС‚СЊ РѕРєРЅР°",
      "ws": 0,
      "freq": 0,
      "status": "error",
      "region": 225
    },
    {
      "id": 3,
      "phrase": "С‚РµСЃС‚РѕРІР°СЏ С„СЂР°Р·Р°",
      "ws": 123,
      "freq": 123,
      "status": "ok",
      "region": 225
    }
  ],
  "nextCursor": 3
}
```
вњ… Р’РєР»Р°РґРєР° "Р”Р°РЅРЅС‹Рµ" РїРѕР»СѓС‡Р°РµС‚ С„СЂР°Р·С‹ РёР· Р‘Р”

---

## РЎРўР РЈРљРўРЈР Рђ РџР РћР•РљРўРђ (РїРѕСЃР»Рµ РїРµСЂРµРЅРѕСЃР°):

```
KeySet-MVP/
в”њв”Ђв”Ђ core/                       в†ђ РќРћР’РћР• (СЃРєРѕРїРёСЂРѕРІР°РЅРѕ РёР· keyset/core/)
в”‚   в”њв”Ђв”Ђ __init__.py
в”‚   в”њв”Ђв”Ђ app_paths.py
в”‚   в”њв”Ђв”Ђ db.py                  (РёСЃРїСЂР°РІР»РµРЅ РїСѓС‚СЊ Рє Р‘Р”)
в”‚   в”њв”Ђв”Ђ models.py
в”‚   в””в”Ђв”Ђ ... (РµС‰Рµ 8 С„Р°Р№Р»РѕРІ)
в”‚
в”њв”Ђв”Ђ services/                   в†ђ РќРћР’РћР• (СЃРєРѕРїРёСЂРѕРІР°РЅРѕ РёР· keyset/services/)
в”‚   в”њв”Ђв”Ђ __init__.py
в”‚   в”њв”Ђв”Ђ accounts.py            (РёСЃРїСЂР°РІР»РµРЅС‹ РёРјРїРѕСЂС‚С‹)
в”‚   в”њв”Ђв”Ђ frequency.py           (РёСЃРїСЂР°РІР»РµРЅС‹ РёРјРїРѕСЂС‚С‹)
в”‚   в”њв”Ђв”Ђ proxy_manager.py       (РёСЃРїСЂР°РІР»РµРЅС‹ РёРјРїРѕСЂС‚С‹)
в”‚   в”њв”Ђв”Ђ wordstat_bridge.py
в”‚   в””в”Ђв”Ђ chrome_launcher.py
в”‚
в”њв”Ђв”Ђ utils/                      в†ђ РќРћР’РћР• (СЃРєРѕРїРёСЂРѕРІР°РЅРѕ РёР· keyset/utils/)
в”‚   в”њв”Ђв”Ђ __init__.py
в”‚   в”њв”Ђв”Ђ proxy.py
в”‚   в””в”Ђв”Ђ text_fix.py
в”‚
в”њв”Ђв”Ђ backend/
в”‚   в”њв”Ђв”Ђ main.py                (РёРјРїРѕСЂС‚С‹ РѕР±РЅРѕРІР»РµРЅС‹: core.db, core.app_paths)
в”‚   в””в”Ђв”Ђ routers/
в”‚       в”њв”Ђв”Ђ accounts.py        (РёРјРїРѕСЂС‚С‹ РѕР±РЅРѕРІР»РµРЅС‹: services.accounts)
в”‚       в”њв”Ђв”Ђ data.py            (РёРјРїРѕСЂС‚С‹ РѕР±РЅРѕРІР»РµРЅС‹: services.frequency)
в”‚       в””в”Ђв”Ђ wordstat.py        (РёРјРїРѕСЂС‚С‹ РѕР±РЅРѕРІР»РµРЅС‹: services.*)
в”‚
в”њв”Ђв”Ђ frontend/
в”‚   в””в”Ђв”Ђ dist/                  (React UI)
в”‚
в”њв”Ђв”Ђ build/
в”‚   в””в”Ђв”Ђ keyset.spec            (РѕР±РЅРѕРІР»РµРЅ: РґРѕР±Р°РІР»РµРЅС‹ core, services, utils)
в”‚
в”њв”Ђв”Ђ dist/
в”‚   в”њв”Ђв”Ђ KeySet.exe             (98.5 MB)
в”‚   в””в”Ђв”Ђ keyset.db              (270 KB - Р·Р°РїРѕР»РЅРµРЅРЅР°СЏ Р‘Р”)
в”‚
в”њв”Ђв”Ђ keyset/                     в†ђ РЎРўРђР РћР• (РќР• СѓРґР°Р»РµРЅРѕ, РёСЃРїРѕР»СЊР·СѓРµС‚СЃСЏ РґРѕ С„РёРЅР°Р»Р°)
в”‚   в”њв”Ђв”Ђ core/
в”‚   в”њв”Ђв”Ђ services/
в”‚   в””в”Ђв”Ђ data/
в”‚       в”њв”Ђв”Ђ keyset.db          (0 bytes - РїСѓСЃС‚Р°СЏ)
в”‚       в””в”Ђв”Ђ regions_tree_full.json
в”‚
в””в”Ђв”Ђ launcher.py                 (Р±РµР· РёР·РјРµРЅРµРЅРёР№)
```

---

## РЎР›Р•Р”РЈР®Р©РР• РЁРђР“Р:

**Рї.6 РёР· Р·Р°РґР°С‡Рё 4 - Р¤РёРЅР°Р»СЊРЅР°СЏ СЃР±РѕСЂРєР°:**
1. Р—Р°РїСѓСЃС‚РёС‚СЊ `npm run build` РІ frontend (РµСЃР»Рё UI РёР·РјРµРЅРёР»СЃСЏ)
2. Р—Р°РїСѓСЃС‚РёС‚СЊ `build.ps1` РґР»СЏ СЃРѕР·РґР°РЅРёСЏ exe
3. РџСЂРѕРІРµСЂРёС‚СЊ, С‡С‚Рѕ `dist/KeySet.exe` СЃС‚Р°СЂС‚СѓРµС‚ Рё СЂР°Р±РѕС‚Р°РµС‚ РїРѕР»РЅРѕСЃС‚СЊСЋ
4. РџРћРЎР›Р• СѓСЃРїРµС€РЅРѕР№ РїСЂРѕРІРµСЂРєРё - СѓРґР°Р»РёС‚СЊ СЃС‚Р°СЂСѓСЋ РїР°РїРєСѓ `keyset/`

**Р’РђР–РќРћ:** РџР°РїРєР° `keyset/` РїРѕРєР° РќР• СѓРґР°Р»РµРЅР° СЃРѕРіР»Р°СЃРЅРѕ Рї.2 Р·Р°РґР°С‡Рё 4 ("РќР• СѓРґР°Р»СЏР№ РїРѕРєР° СЃС‚Р°СЂСѓСЋ РїР°РїРєСѓ keyset").

---

## РўР•РҐРќРР§Р•РЎРљРР• Р”Р•РўРђР›Р:

**Р‘Р”:**
- РџСѓС‚СЊ: `C:\AI\yandex\KeySet-MVP\dist\keyset.db`
- Р Р°Р·РјРµСЂ: 270 336 bytes (270 KB)
- РЎРѕРґРµСЂР¶РёС‚: С‚Р°Р±Р»РёС†С‹ accounts, freq_results, frequencies, groups, proxies, tasks

**РўРµСЃС‚РёСЂРѕРІР°РЅРёРµ:**
- вњ… Backend РёРјРїРѕСЂС‚РёСЂСѓРµС‚ РјРѕРґСѓР»Рё РёР· core/, services/, utils/ Р±РµР· РѕС€РёР±РѕРє
- вњ… API /api/accounts РІРѕР·РІСЂР°С‰Р°РµС‚ 2+ Р°РєРєР°СѓРЅС‚Р° РёР· Р‘Р”
- вњ… API /api/data/phrases РІРѕР·РІСЂР°С‰Р°РµС‚ С„СЂР°Р·С‹ СЃ С‡Р°СЃС‚РѕС‚РЅРѕСЃС‚СЊСЋ
- вњ… UI Р·Р°РіСЂСѓР¶Р°РµС‚СЃСЏ С‡РµСЂРµР· Edge --app mode
- вњ… Р’СЃРµ СЃС‚Р°С‚РёС‡РµСЃРєРёРµ С„Р°Р№Р»С‹ (JS/CSS) РѕС‚РґР°СЋС‚СЃСЏ РєРѕСЂСЂРµРєС‚РЅРѕ

**РџСЂРѕР±Р»РµРјС‹ СЂРµС€РµРЅС‹:**
1. вќЊ "no such table: accounts" в†’ вњ… РСЃРїСЂР°РІР»РµРЅ РїСѓС‚СЊ Рє Р‘Р” РІ core/db.py
2. вќЊ РћС‚РЅРѕСЃРёС‚РµР»СЊРЅС‹Рµ РёРјРїРѕСЂС‚С‹ `from ..core` в†’ вњ… Р—Р°РјРµРЅРµРЅС‹ РЅР° `from core`
3. вќЊ PyInstaller spec РЅРµ РІРєР»СЋС‡Р°Р» РЅРѕРІС‹Рµ РїР°РєРµС‚С‹ в†’ вњ… Р”РѕР±Р°РІР»РµРЅС‹ core/, services/

---

## Р’Р«Р’РћР”:

РљРѕРЅСЃРѕР»РёРґР°С†РёСЏ СЃС‚СЂСѓРєС‚СѓСЂС‹ **Р—РђР’Р•Р РЁР•РќРђ**. Backend СѓСЃРїРµС€РЅРѕ СЂР°Р±РѕС‚Р°РµС‚ СЃ РјРѕРґСѓР»СЏРјРё РІ РЅРѕРІРѕР№ СЃС‚СЂСѓРєС‚СѓСЂРµ (`core/`, `services/`, `utils/`). Р’РєР»Р°РґРєРё "РђРєРєР°СѓРЅС‚С‹" Рё "Р”Р°РЅРЅС‹Рµ" РїРѕР»СѓС‡Р°СЋС‚ СЂРµР°Р»СЊРЅС‹Рµ РґР°РЅРЅС‹Рµ РёР· Р‘Р”. Р“РѕС‚РѕРІРѕ Рє С„РёРЅР°Р»СЊРЅРѕР№ СЃР±РѕСЂРєРµ exe.

---

## 12.11.2025 вЂ” Р”РёР°РіРЅРѕСЃС‚РёРєР° РІРєР»Р°РґРѕРє В«РђРєРєР°СѓРЅС‚С‹В» Рё В«Р”Р°РЅРЅС‹РµВ»
- рџ”Ќ Р’С‹СЏСЃРЅРµРЅРѕ, С‡С‚Рѕ ReactвЂ‘РєР»РёРµРЅС‚ РїСЂРѕРґРѕР»Р¶Р°Р» РѕР±СЂР°С‰Р°С‚СЊСЃСЏ Рє Р¶С‘СЃС‚РєРѕ Р·Р°С€РёС‚РѕРјСѓ `http://127.0.0.1:8765` (С„Р°Р№Р» `frontend/src/lib/apiClient.ts:1-16`), С‚РѕРіРґР° РєР°Рє launcher РІС‹Р±РёСЂР°РµС‚ СЃРІРѕР±РѕРґРЅС‹Р№ РїРѕСЂС‚ (РїСЂРёРјРµСЂ: 58067). РР·-Р·Р° СЌС‚РѕРіРѕ РІСЃРµ Р·Р°РїСЂРѕСЃС‹ /api/accounts Рё /api/data/phrases СѓС…РѕРґРёР»Рё РЅР° РЅРµСЃСѓС‰РµСЃС‚РІСѓСЋС‰РёР№ РїРѕСЂС‚ Рё UI РѕСЃС‚Р°РІР°Р»СЃСЏ РїСѓСЃС‚С‹Рј.
- вњЏпёЏ РћР±РЅРѕРІРёР» `apiClient`: С‚РµРїРµСЂСЊ РїСЂРё РѕС‚СЃСѓС‚СЃС‚РІРёРё `VITE_API_BASE_URL` РёСЃРїРѕР»СЊР·СѓРµС‚СЃСЏ С‚РµРєСѓС‰РёР№ `window.location.origin`, Р° РїСЂРё СЃР±РѕСЂРєРµ РІ .exe Р·Р°РїСЂРѕСЃС‹ РѕС‚РїСЂР°РІР»СЏСЋС‚СЃСЏ РЅР° С‚РѕС‚ Р¶Рµ origin, С‡С‚Рѕ Рё СЃС‚Р°С‚РёРєР°. Р”Р»СЏ dev-СЃС†РµРЅР°СЂРёСЏ РјРѕР¶РЅРѕ РїРѕ-РїСЂРµР¶РЅРµРјСѓ Р·Р°РґР°С‚СЊ VITE РїРµСЂРµРјРµРЅРЅСѓСЋ.
- вњ… РџРѕСЃР»Рµ РїРµСЂРµСЃР±РѕСЂРєРё С„СЂРѕРЅС‚Р° РІРєР»Р°РґРєРё РїРѕР»СѓС‡Р°СЋС‚ РґР°РЅРЅС‹Рµ СЃ С‚РѕРіРѕ Р¶Рµ РїРѕСЂС‚Р°, С‡С‚Рѕ Рё backend, Р±РµР· РґРѕРїРѕР»РЅРёС‚РµР»СЊРЅС‹С… РїСЂР°РІРѕРє PyInstaller/launcher.

## 12.11.2025 вЂ” РЎР±РѕСЂРєР° Рё smoke-С‚РµСЃС‚ РїРѕ Р·Р°РґР°С‡Рµ 4
- `npm run build` (РІ `frontend/`) СЃРѕР±СЂР°Р» СЃРІРµР¶РёР№ `frontend/dist` СѓР¶Рµ СЃ РёСЃРїСЂР°РІР»РµРЅРЅС‹Рј `apiClient`. РџСЂРµРґСѓРїСЂРµР¶РґРµРЅРёСЏ Vite Рѕ СЂР°Р·РјРµСЂРµ Р±Р°РЅРґР»Р° РѕСЃС‚Р°Р»РёСЃСЊ С‚РѕР»СЊРєРѕ РёРЅС„РѕСЂРјР°С‚РёРІРЅС‹РјРё.
- `.\build.ps1` РїРµСЂРµСЃРѕР±СЂР°Р» PyInstaller onefile: `dist/KeySet.exe` ~48вЂЇMB, datas/hiddenimports РїСЂРµР¶РЅРёРµ. Р›РѕРіРё build.ps1 СЃРѕС…СЂР°РЅРµРЅС‹ РІ РєРѕРЅСЃРѕР»Рё.
- Р‘С‹СЃС‚СЂС‹Р№ С‚РµСЃС‚ С‡РµСЂРµР· `fastapi.testclient.TestClient`: `/api/health`, `/api/accounts`, `/api/data/phrases` РІРѕР·РІСЂР°С‰Р°СЋС‚ РґР°РЅРЅС‹Рµ РёР· SQLite (СЃРј. РІС‹РІРѕРґ РєРѕРјР°РЅРґС‹ `python -c ...`). Р­С‚Рѕ РїРѕРґС‚РІРµСЂР¶РґР°РµС‚, С‡С‚Рѕ backend Рё React-SPA СЂР°Р±РѕС‚Р°СЋС‚ СЃ РѕРґРЅРѕР№ Р‘Р” Рё РѕРґРЅРёРј origin вЂ” РјРѕР¶РЅРѕ РїРµСЂРµС…РѕРґРёС‚СЊ Рє РѕСЃС‚Р°РІС€РёРјСЃСЏ С€Р°РіР°Рј Р·Р°РґР°С‡Рё 4 (РґР°Р»СЊРЅРµР№С€Р°СЏ РєРѕРЅСЃРѕР»РёРґР°С†РёСЏ app_core РїРѕ РёРЅСЃС‚СЂСѓРєС†РёРё В«Р·Р°РґР°РЅРёРµ 3В»).

## 13.11.2025 вЂ” РСЃРїСЂР°РІР»РµРЅРёРµ React error #185 РЅР° РІРєР»Р°РґРєРµ В«Р”Р°РЅРЅС‹РµВ»
- РЎРёРјРїС‚РѕРј: Р·Р°РїСѓСЃРєР°РµРјС‹Р№ С‡РµСЂРµР· launcher С„СЂРѕРЅС‚ РїСЂРѕРґРѕР»Р¶Р°Р» РіСЂСѓР·РёС‚СЊСЃСЏ РёР· `www/assets/index-B34d8OBy.js` + `vendor-*.js`, РёР·-Р·Р° СЃС‚Р°СЂС‹С… С‡Р°РЅРєРѕРІ PyWebView РІС‹РґР°РІР°Р» `Minified React error #185`.
- РџСЂРёС‡РёРЅР°: `backend/main.py::_resolve_frontend_paths()` РІСЃРµРіРґР° РѕС‚РґР°РІР°Р» `WWW_DIR`, РґР°Р¶Рµ РІ dev-СЂРµР¶РёРјРµ. РџР°РїРєР° `www/` СЃРѕРґРµСЂР¶Р°Р»Р° СЃС‚Р°СЂС‹Р№ build СЃ РІРєР»СЋС‡С‘РЅРЅС‹Рј code-splitting, РїРѕСЌС‚РѕРјСѓ Р°РєС‚СѓР°Р»СЊРЅС‹Р№ `frontend/dist` (РѕРґРёРЅ bundle) РІРѕРѕР±С‰Рµ РЅРµ РёСЃРїРѕР»СЊР·РѕРІР°Р»СЃСЏ.
- Р РµС€РµРЅРёРµ: С„СѓРЅРєС†РёСЏ С‚РµРїРµСЂСЊ СЂР°Р·Р»РёС‡Р°РµС‚ СЂРµР¶РёРјС‹ вЂ” РІ dev РІСЃРµРіРґР° Р±РµСЂС‘Рј `frontend/dist`, РІ frozen СЂРµР¶РёРјРµ РїСЂРёРѕСЂРёС‚РµС‚ Сѓ `_MEIPASS/frontend/dist` (РµСЃР»Рё РІРґСЂСѓРі РЅРµС‚, РјРѕР¶РЅРѕ РїРѕР»РѕР¶РёС‚СЊ СЃР±РѕСЂРєСѓ РІ `www/`). РџРѕСЃР»Рµ РїСЂР°РІРєРё РґРµРІ-СЃРµСЂРІРµСЂ СЃСЂР°Р·Сѓ РѕР±СЃР»СѓР¶РёРІР°РµС‚ СЃРІРµР¶РёР№ Р±Р°РЅРґР»; С‡С‚РѕР±С‹ СѓРІРёРґРµС‚СЊ РёР·РјРµРЅРµРЅРёСЏ РІ РїСЂРёР»РѕР¶РµРЅРёРё, РґРѕСЃС‚Р°С‚РѕС‡РЅРѕ РїРµСЂРµР·Р°РїСѓСЃС‚РёС‚СЊ `python launcher.py` (РїРµСЂРµСЃР±РѕСЂРєР° .exe РЅРµ С‚СЂРµР±СѓРµС‚СЃСЏ).


## 12.11.2025 вЂ” РСЃРїСЂР°РІР»РµРЅРёРµ РєСЂР°РєРѕР·СЏР±СЂ (UTF-8 encoding) РІ API responses

- рџ”Ќ Р’С‹СЏРІР»РµРЅР° РїСЂРѕР±Р»РµРјР°: `/api/accounts` РІРѕР·РІСЂР°С‰Р°Р» РєСЂР°РєРѕР·СЏР±СЂС‹ РІРјРµСЃС‚Рѕ СЂСѓСЃСЃРєРѕРіРѕ С‚РµРєСЃС‚Р° (В«РђРІС‚РѕСЂРёР·РѕРІР°РЅВ» РѕС‚РѕР±СЂР°Р¶Р°Р»СЃСЏ РєР°Рє В«ГђГђВІГ‘ГђВѕГ‘ГђВёГђВ·ГђВѕГђВІГђВ°ГђВЅВ»).
- рџ“Ќ РљРѕСЂРµРЅСЊ РїСЂРѕР±Р»РµРјС‹: Р’ С„Р°Р№Р»Рµ `backend/routers/accounts.py` СЃС‚СЂРѕРєРѕРІС‹Рµ Р»РёС‚РµСЂР°Р»С‹ СЃ СЂСѓСЃСЃРєРёРј С‚РµРєСЃС‚РѕРј (lines 75-84 РІ С„СѓРЅРєС†РёРё `_map_status`) Р±С‹Р»Рё РЅРµРїСЂР°РІРёР»СЊРЅРѕ Р·Р°РєРѕРґРёСЂРѕРІР°РЅС‹.
- вњЏпёЏ Р РµС€РµРЅРёРµ:
  1. РЎРѕР·РґР°РЅ СЃРєСЂРёРїС‚ `fix_encoding.py` РґР»СЏ Р°РІС‚РѕРјР°С‚РёС‡РµСЃРєРѕР№ РїРµСЂРµРєРѕРґРёСЂРѕРІРєРё С„Р°Р№Р»Р°.
  2. РЎРєСЂРёРїС‚ С‡РёС‚Р°РµС‚ С„Р°Р№Р» РєР°Рє UTF-8 bytes Рё РїСЂР°РІРёР»СЊРЅРѕ СЃРѕС…СЂР°РЅСЏРµС‚ РѕР±СЂР°С‚РЅРѕ СЃ РєРѕСЂСЂРµРєС‚РЅС‹РјРё СЂСѓСЃСЃРєРёРјРё СЃС‚СЂРѕРєР°РјРё.
  3. РСЃРїСЂР°РІР»РµРЅС‹ РІСЃРµ СЃС‚Р°С‚СѓСЃС‹: В«РђРІС‚РѕСЂРёР·РѕРІР°РЅВ», В«Р’ СЂР°Р±РѕС‚РµВ», В«РўСЂРµР±СѓРµС‚СЃСЏ РєР°РїС‡Р°В», В«Р—Р°Р±Р»РѕРєРёСЂРѕРІР°РЅВ», В«РћС€РёР±РєР°В», В«РќРµРёР·РІРµСЃС‚РЅРѕВ».
- вњ… Р РµР·СѓР»СЊС‚Р°С‚:
  - API response `/api/accounts` С‚РµРїРµСЂСЊ РІРѕР·РІСЂР°С‰Р°РµС‚ РєРѕСЂСЂРµРєС‚РЅС‹Р№ UTF-8: `authStatus: 'РђРІС‚РѕСЂРёР·РѕРІР°РЅ'`.
  - Р‘Р°Р№С‚С‹ UTF-8: `b'\xd0\x90\xd0\xb2\xd1\x82\xd0\xbe\xd1\x80\xd0\xb8\xd0\xb7\xd0\xbe\xd0\xb2\xd0\xb0\xd0\xbd'`.
  - Р‘СЂР°СѓР·РµСЂ РєРѕСЂСЂРµРєС‚РЅРѕ РѕС‚РѕР±СЂР°Р¶Р°РµС‚ СЂСѓСЃСЃРєРёР№ С‚РµРєСЃС‚ РІ UI.
  - РљРѕРЅСЃРѕР»СЊ Windows РїРѕРєР°Р·С‹РІР°РµС‚ mojibake РёР·-Р·Р° cp1251, РЅРѕ СЌС‚Рѕ РЅРµ РІР»РёСЏРµС‚ РЅР° СЂР°Р±РѕС‚Сѓ РїСЂРёР»РѕР¶РµРЅРёСЏ.

**Р¤Р°Р№Р»С‹ РёР·РјРµРЅРµРЅС‹:**
- `backend/routers/accounts.py` (lines 75-84): РёСЃРїСЂР°РІР»РµРЅС‹ СЃС‚СЂРѕРєРѕРІС‹Рµ Р»РёС‚РµСЂР°Р»С‹ СЃ СЂСѓСЃСЃРєРёРј С‚РµРєСЃС‚РѕРј
- `fix_encoding.py`: СЃРѕР·РґР°РЅ РІСЂРµРјРµРЅРЅС‹Р№ СЃРєСЂРёРїС‚ РґР»СЏ Р°РІС‚РѕРјР°С‚РёС‡РµСЃРєРѕР№ РїРµСЂРµРєРѕРґРёСЂРѕРІРєРё

**РўРµСЃС‚РёСЂРѕРІР°РЅРёРµ:**
```python
resp = requests.get('http://127.0.0.1:57143/api/accounts')
data[0]['authStatus']  # Returns correct UTF-8: 'РђРІС‚РѕСЂРёР·РѕРІР°РЅ'
```
\n### 2025-11-12\n- РџРµСЂРµРЅС‘СЃ geo-РґР°РЅРЅС‹Рµ Wordstat РІ core/data Рё РїРѕРґРєР»СЋС‡РёР» Рє backend С‡РµСЂРµР· core.geo.regions, С‚РµРїРµСЂСЊ /api/regions Рё /api/wordstat/regions РїРѕРґС‚СЏРіРёРІР°СЋС‚ РїРѕР»РЅС‹Р№ СЂРµРµСЃС‚СЂ Р Р¤ Р±РµР· Р·Р°РІРёСЃРёРјРѕСЃС‚Рё РѕС‚ keyset/.\n- РћР±РЅРѕРІРёР» WordstatModal РІ React: Р°РєРєР°СѓРЅС‚ РІС‹Р±РёСЂР°РµС‚СЃСЏ Р°РІС‚РѕРјР°С‚РёС‡РµСЃРєРё (Р±РµСЂС‘С‚СЃСЏ РїРµСЂРІС‹Р№ РёР· legacy Р±Р°Р·С‹), СѓР±СЂР°РЅ СЂСѓС‡РЅРѕР№ СЃРµР»РµРєС‚, РґРѕР±Р°РІР»РµРЅС‹ РїРѕРґСЃРєР°Р·РєРё Рё РїСЂРѕРІРµСЂРєРё.\n- РџСЂРѕРіРЅР°Р» python TestClient РґР»СЏ /api/regions Рё /api/wordstat/regions + npm run build, СѓР±РµРґРёР»СЃСЏ С‡С‚Рѕ С„СЂРѕРЅС‚ СЃРѕР±РёСЂР°РµС‚СЃСЏ РЅР° РЅРѕРІРѕРј API.
## 13. Р–СѓСЂРЅР°Р» СЂР°Р±РѕС‚ (12.11.2025 вЂ” runtime Р‘Р” Рё РїСЂРѕС„РёР»Рё)
### Р§С‚Рѕ СЃРґРµР»Р°РЅРѕ
- core/app_paths.py С‚РµРїРµСЂСЊ РІ РїРµСЂРІСѓСЋ РѕС‡РµСЂРµРґСЊ РёС‰РµС‚ СЂРµСЃСѓСЂСЃС‹ РІ untime/{db|geo|config}, Р° Р·Р°С‚РµРј РІ core/data, legacy keyset/data Рё bundled-РїР°РїРєР°С…. Р”Р»СЏ keyset.db РґРѕР±Р°РІР»РµРЅ fallback РЅР° dist/ Рё РєРѕСЂРµРЅСЊ РїСЂРѕРµРєС‚Р°, РїРѕСЌС‚РѕРјСѓ Р¶РёРІР°СЏ Р‘Р” Р°РІС‚РѕРјР°С‚РёС‡РµСЃРєРё РєРѕРїРёСЂСѓРµС‚СЃСЏ РІ untime/db.
- core/db.py Р¶С‘СЃС‚РєРѕ РїСЂРёРІСЏР·Р°РЅ Рє untime/db/keyset.db: РјРѕРґСѓР»СЊ СЃР°Рј РІС‹Р·С‹РІР°РµС‚ ensure_runtime() Рё ootstrap_files(), Р±РµСЂС‘С‚ URL С‡РµСЂРµР· sqlite_url() Рё Р±РѕР»СЊС€Рµ РЅРµ Р·Р°РІРёСЃРёС‚ РѕС‚ dist/*.db.
- services/chrome_launcher.py РёСЃРїРѕР»СЊР·СѓРµС‚ РїСѓС‚Рё РёР· core.app_paths: APP_ROOT РІРјРµСЃС‚Рѕ Р¶С‘СЃС‚РєРѕРіРѕ C:/AI/yandex, СЂР°СЃС€РёСЂРµРЅРёСЏ Р»РµР¶Р°С‚ РІ untime/proxy_extensions, Р° РїСЂРѕС„РёР»Рё вЂ” РІ untime/profiles СЃ РїСЂРµРѕР±СЂР°Р·РѕРІР°РЅРёРµРј СЃС‚Р°СЂС‹С… РїСѓС‚РµР№ .profiles/<account>.

### РџСЂРѕРІРµСЂРєРё
- python -c "from core.db import SessionLocal, DB_PATH; print(DB_PATH)" в†’ C:\AI\yandex\KeySet-MVP\runtime\db\keyset.db (С„Р°Р№Р» СЃСѓС‰РµСЃС‚РІСѓРµС‚).
- python -c "from fastapi.testclient import TestClient; from backend.main import app; c=TestClient(app); print(len(c.get('/api/regions').json()), len(c.get('/api/wordstat/regions').json()))" в†’ /api/regions РІРѕР·РІСЂР°С‰Р°РµС‚ 8 РєРѕСЂРЅРµРІС‹С… СѓР·Р»РѕРІ, /api/wordstat/regions вЂ” 1103 СЂРµРіРёРѕРЅР° РёР· untime/geo.
- python -c "from services.chrome_launcher import ChromeLauncher; print(ChromeLauncher._normalise_profile_path(None, 'demo'))" в†’ untime/profiles/demo, РєР°С‚Р°Р»РѕРі СЃРѕР·РґР°С‘С‚СЃСЏ Р°РІС‚РѕРјР°С‚РёС‡РµСЃРєРё.

### РС‚РѕРі
Р’СЃРµ РєР»СЋС‡РµРІС‹Рµ РґР°РЅРЅС‹Рµ (Р‘Р”, СЂРµРіРёРѕРЅС‹, РєРѕРЅС„РёРіРё, РїСЂРѕС„РёР»Рё) Р¶РёРІСѓС‚ РІ untime/ СЂСЏРґРѕРј СЃ KeySet.exe, С‡С‚Рѕ Р·Р°РєСЂС‹РІР°РµС‚ С‚СЂРµР±РѕРІР°РЅРёСЏ РёР· Р·Р°РіСЂСѓР·РєР° СЃРѕС„С‚Р°/ РїРѕ РїРѕСЂС‚Р°С‚РёРІРЅРѕСЃС‚Рё.
## 14. Р–СѓСЂРЅР°Р» СЂР°Р±РѕС‚ (12.11.2025 вЂ” Wordstat/UI)
- РћСЃС‚Р°РІРёР» РІ geo-РґРµСЂРµРІРµ С‚РѕР»СЊРєРѕ СЃС‚СЂР°РЅС‹ РЎРќР“: core/geo/regions.py С„РёР»СЊС‚СЂСѓРµС‚ JSON РїРѕ ID 225/159/149, Р° fallback DEFAULT_REGION_TREE РІ ackend/routers/wordstat.py СЃРёРЅС…СЂРѕРЅРёР·РёСЂРѕРІР°РЅ.
- Wordstat Modal: СѓР±СЂР°РЅ РІС‹Р±РѕСЂ Р°РєРєР°СѓРЅС‚Р°, РґРѕР±Р°РІР»РµРЅС‹ РєР°СЂС‚РѕС‡РєРё СЃ РєРѕР»РёС‡РµСЃС‚РІРѕРј С„СЂР°Р·/СЂРµРіРёРѕРЅРѕРІ/РЅРѕРІС‹С… РєР»СЋС‡РµР№, РїРѕСЏРІРёР»Р°СЃСЊ С‚РµРєСЃС‚РѕРІР°СЏ РѕР±Р»Р°СЃС‚СЊ РґР»СЏ Р·Р°РіСЂСѓР·РєРё РєР»СЋС‡РµР№ (POST /api/data/phrases/enqueue). РљРЅРѕРїРєР° В«Р—Р°РїСѓСЃС‚РёС‚СЊ РїР°СЂСЃРёРЅРіВ» Р±Р»РѕРєРёСЂСѓРµС‚СЃСЏ С‚РѕР»СЊРєРѕ РµСЃР»Рё РЅРµС‚ С„СЂР°Р· РёР»Рё РёРґС‘С‚ Р·Р°РіСЂСѓР·РєР°.
- Backend: keyset/services/wordstat_ws.collect_frequency СЂР°СЃРїСЂРµРґРµР»СЏРµС‚ Р·Р°РїСЂРѕСЃС‹ РјРµР¶РґСѓ РІСЃРµРјРё Р°РєРєР°СѓРЅС‚Р°РјРё Рё Р·Р°РїСѓСЃРєР°РµС‚ TurboWordstatParser РїР°СЂР°Р»Р»РµР»СЊРЅРѕ С‡РµСЂРµР· syncio.gather, РІРѕР·РІСЂР°С‰Р°СЏ СЂРµР·СѓР»СЊС‚Р°С‚С‹ РІ РїСЂРµР¶РЅРµРј С„РѕСЂРјР°С‚Рµ. API collectWordstat Р±РѕР»СЊС€Рµ РЅРµ С‚СЂРµР±СѓРµС‚ profile.
- Р‘С‹СЃС‚СЂС‹Рµ РєРЅРѕРїРєРё В«Р РѕСЃСЃРёСЏ / РљР°Р·Р°С…СЃС‚Р°РЅ / Р‘РµР»Р°СЂСѓСЃСЊ / РћС‡РёСЃС‚РёС‚СЊВ» РґРѕР±Р°РІР»РµРЅС‹ РІ GeoRegionPicker, С‡С‚РѕР±С‹ СѓСЃРєРѕСЂРёС‚СЊ РІС‹Р±РѕСЂ СЂРµРіРёРѕРЅР°.

РџСЂРѕРІРµСЂРєРё:
- python -c "from core.geo import load_region_tree; print([node['label'] for node in load_region_tree()])" в†’ С‚СЂРё СЃС‚СЂР°РЅС‹.
- python -c "from keyset.services import wordstat_ws; print(len(wordstat_ws.collect_frequency(['С‚РµСЃС‚'], modes={'ws': True, 'qws': False, 'bws': False}, regions=[225], profile=None)))" вЂ” РїР°СЂСЃРёРЅРі РІРѕР·РІСЂР°С‰Р°РµС‚ РѕС‚РІРµС‚, Р·Р°РїСѓСЃРє РёРґС‘С‚ Р±РµР· СѓРєР°Р·Р°РЅРёСЏ Р°РєРєР°СѓРЅС‚Р°.
- UI: РјРѕРґР°Р»РєР° Wordstat РѕС‚РѕР±СЂР°Р¶Р°РµС‚ Р±Р»РѕРє Р·Р°РіСЂСѓР·РєРё РєР»СЋС‡РµР№, РєРЅРѕРїРєРё СЃС‚СЂР°РЅ Рё СѓСЃРїРµС€РЅРѕ Р·Р°РїСѓСЃРєР°РµС‚ РїР°СЂСЃРёРЅРі РІСЃРµС… РґРѕР±Р°РІР»РµРЅРЅС‹С… С„СЂР°Р·.

## 15. Р–СѓСЂРЅР°Р» СЂР°Р±РѕС‚ (13.11.2025 вЂ” С‚СѓСЂР±Рѕ-РїР°СЂСЃРµСЂ РїРµСЂРµРЅРµСЃС‘РЅ РІ РєРѕСЂРµРЅСЊ KeySet-MVP)
### Р§С‚Рѕ СЃРґРµР»Р°РЅРѕ
- РЎРєРѕРїРёСЂРѕРІР°РЅС‹ Р±РѕРµРІС‹Рµ РјРѕРґСѓР»Рё Wordstat/TurboParser РёР· `keyset/` РІ РѕСЃРЅРѕРІРЅРѕР№ РїСЂРѕРµРєС‚: `services/wordstat_ws.py`, `services/direct_batch.py`, `services/multiparser_manager.py`, `workers/turbo_parser_integration.py`, `workers/visual_browser_manager.py`, `workers/auto_auth_handler.py`. Р’СЃРµ С„Р°Р№Р»С‹ РѕСЃС‚Р°РІР»РµРЅС‹ РІ UTF-8, Р° `workers/__init__.py` С‚РµРїРµСЂСЊ РѕРїРёСЃС‹РІР°РµС‚ Р»РѕРєР°Р»СЊРЅС‹Р№ РїР°РєРµС‚ РІРјРµСЃС‚Рѕ РїРµСЂРµР°РґСЂРµСЃР°С†РёРё РІ legacy.
- `backend/routers/wordstat.py` Рё `services/wordstat_bridge.py` РёР·Р±Р°РІР»РµРЅС‹ РѕС‚ `_import_module("keyset....")`: API `/api/wordstat/accounts|regions|collect|forecast` РЅР°РїСЂСЏРјСѓСЋ РёСЃРїРѕР»СЊР·СѓСЋС‚ РЅРѕРІС‹Рµ СЃРµСЂРІРёСЃС‹ (`services.accounts`, `services.frequency`, `services.wordstat_ws`, `services.direct_batch`).
- Р’ `workers/turbo_parser_integration.py` РґРѕР±Р°РІР»РµРЅС‹ РёРјРїРѕСЂС‚С‹ `core.app_paths.DB_DIR/CONFIG_DIR` вЂ” TurboWordstatParser РїРёС€РµС‚ СЂРµР·СѓР»СЊС‚Р°С‚С‹ РІ `runtime/db/keyset.db`, Р° credentials РёС‰СѓС‚СЃСЏ РІ `runtime/config/accounts.json` (СЃ fallback РЅР° СЃС‚Р°СЂС‹Рµ РїСѓС‚Рё). Р‘Р»Р°РіРѕРґР°СЂСЏ СЌС‚РѕРјСѓ С†РµРїРѕС‡РєР° РїР°СЂСЃРёРЅРіР° Р±РѕР»СЊС€Рµ РЅРµ Р·Р°РІРёСЃРёС‚ РѕС‚ `C:/AI/yandex/keyset`.
- РћР±РЅРѕРІР»РµРЅС‹ `services/__init__.py` (СЌРєСЃРїРѕСЂС‚ РЅРѕРІС‹С… РјРѕРґСѓР»РµР№) Рё `services/wordstat_bridge.py` (РѕР±С‘СЂС‚РєР° `_try_call` РІРјРµСЃС‚Рѕ РґРёРЅР°РјРёС‡РµСЃРєРѕРіРѕ РёРјРїРѕСЂС‚Р°, РїРѕР»РЅРѕС†РµРЅРЅС‹Р№ forecast С‡РµСЂРµР· `direct_batch`).

### РџСЂРѕРІРµСЂРєРё
- `python - <<script ...` (СЃРј. Р»РѕРі) вЂ” РёРјРїРѕСЂС‚РёСЂРѕРІР°РЅС‹ `services.wordstat_ws`, `services.wordstat_bridge`, `workers.turbo_parser_integration` Р±РµР· РѕС€РёР±РѕРє.
- `npm run build` (frontend) в†’ вњ… (Vite).
- `python launcher.py` в†’ вњ…: backend СЃС‚Р°СЂС‚СѓРµС‚, UI РѕС‚РєСЂС‹РІР°РµС‚СЃСЏ, `/api/wordstat/regions` РѕС‚РґР°С‘С‚ РґРµСЂРµРІРѕ, `/api/wordstat/collect` РІС‹РїРѕР»РЅСЏРµС‚ СЂРµР°Р»СЊРЅС‹Р№ Р·Р°РїСЂРѕСЃ (РІ Р»РѕРіРµ `[TURBO] Persistent ...`, HTTP 200 Рё РѕР±РЅРѕРІР»РµРЅРёРµ С‚Р°Р±Р»РёС†).

### РС‚РѕРі
TurboWordstatParser Рё СЃРІСЏР·Р°РЅРЅС‹Рµ СЃРµСЂРІРёСЃС‹ Р±РѕР»СЊС€Рµ РЅРµ Р·Р°РІРёСЃСЏС‚ РѕС‚ РєР°С‚Р°Р»РѕРіР° `keyset/` вЂ” РІСЃС‘ СЂР°Р±РѕС‚Р°РµС‚ РёР· РєРѕСЂРЅСЏ `KeySet-MVP`, С‡С‚Рѕ С‚СЂРµР±РѕРІР°Р»РѕСЃСЊ РґР»СЏ СѓРїР°РєРѕРІРєРё СЃРѕС„С‚Р° В«РїРѕРґ РєР»СЋС‡В».

## 14.11.2025 вЂ” Launcher, Р±РµР»С‹Р№ СЌРєСЂР°РЅ Рё РєСЌС€ С„СЂРѕРЅС‚Р°
### РЎРёРјРїС‚РѕРјС‹
- РџСЂРё Р·Р°РїСѓСЃРєРµ СЃРѕС„С‚Р° С‡РµСЂРµР· `KeySet-MVP/launcher.py` РѕРєРЅРѕ Edge РїРѕРєР°Р·С‹РІР°Р»Рѕ Р±РµР»С‹Р№ СЌРєСЂР°РЅ, РІ РєРѕРЅСЃРѕР»Рё Р±СЂР°СѓР·РµСЂР° С„РёРєСЃРёСЂРѕРІР°Р»РёСЃСЊ РѕС€РёР±РєРё:
  - `Failed to load resource: style-60IVmluU.css 404 (Not Found)`
  - `index-BV7OJ2FU.js:11 Uncaught TypeError: Cannot read properties of undefined (reading 'badgeClass')`.
- Р’ Р»РѕРіР°С… backend РїРѕСЏРІР»СЏР»РѕСЃСЊ: `ERROR: [Errno 10048] ... winerror 10048 ... РѕР±С‹С‡РЅРѕ СЂР°Р·СЂРµС€Р°РµС‚СЃСЏ С‚РѕР»СЊРєРѕ РѕРґРЅРѕ РёСЃРїРѕР»СЊР·РѕРІР°РЅРёРµ Р°РґСЂРµСЃР° СЃРѕРєРµС‚Р°`, С‡С‚Рѕ СѓРєР°Р·С‹РІР°Р»Рѕ РЅР° РїРѕРїС‹С‚РєСѓ РїРѕРґРЅСЏС‚СЊ РІС‚РѕСЂРѕР№ uvicorn РЅР° СѓР¶Рµ Р·Р°РЅСЏС‚РѕРј РїРѕСЂС‚Сѓ `127.0.0.1:8765`.

### РџСЂРёС‡РёРЅС‹
- Edge, Р·Р°РїСѓС‰РµРЅРЅС‹Р№ РІ СЂРµР¶РёРјРµ `--app`, РёСЃРїРѕР»СЊР·РѕРІР°Р» СЃС‚Р°СЂС‹Р№ Р·Р°РєСЌС€РёСЂРѕРІР°РЅРЅС‹Р№ `index.html`, РІ РєРѕС‚РѕСЂРѕРј Р±С‹Р»Рё СЃСЃС‹Р»РєРё РЅР° СѓСЃС‚Р°СЂРµРІС€РёРµ Р±Р°РЅРґР»С‹ `index-BV7OJ2FU.js` Рё `style-60IVmluU.css`. Р’ Р°РєС‚СѓР°Р»СЊРЅРѕРј `frontend/dist/index.html` СЌС‚РёС… С„Р°Р№Р»РѕРІ СѓР¶Рµ РЅРµС‚ вЂ” С‚Р°Рј `index-CLMQ6FdA.js` Рё `style-BvWPhXMZ.css`.
- `launcher.py` РІСЃРµРіРґР° РїС‹С‚Р°Р»СЃСЏ СЃС‚Р°СЂС‚РѕРІР°С‚СЊ backend, РґР°Р¶Рµ РµСЃР»Рё uvicorn СѓР¶Рµ РєСЂСѓС‚РёР»СЃСЏ РІ РґСЂСѓРіРѕРј РїСЂРѕС†РµСЃСЃРµ, С‡С‚Рѕ РІР»РµРєР»Рѕ WinError 10048 РїСЂРё РїРѕРІС‚РѕСЂРЅРѕРј Р·Р°РїСѓСЃРєРµ СЃРѕС„С‚Р°.
- РћС‚РґРµР»СЊРЅРѕ РІС‹СЏРІР»РµРЅРѕ, С‡С‚Рѕ `services/multiparser_manager.py` РЅР°РїСЂСЏРјСѓСЋ РёРјРїРѕСЂС‚РёСЂРѕРІР°Р» `win32crypt`, Рё РІ СЃР»СѓС‡Р°Рµ РѕС‚СЃСѓС‚СЃС‚РІРёСЏ `pywin32` backend РјРѕРі РїР°РґР°С‚СЊ РµС‰С‘ РЅР° СЌС‚Р°РїРµ РёРјРїРѕСЂС‚Р° РјРѕРґСѓР»СЏ.

### Р§С‚Рѕ СЃРґРµР»Р°РЅРѕ
- `services/multiparser_manager.py`:
  - РћР±РµСЂРЅСѓР» РёРјРїРѕСЂС‚ `win32crypt` РІ `try/except`. РџСЂРё РѕС‚СЃСѓС‚СЃС‚РІРёРё Р±РёР±Р»РёРѕС‚РµРєРё СѓСЃС‚Р°РЅР°РІР»РёРІР°РµС‚СЃСЏ С„Р»Р°Рі `WIN32CRYPT_AVAILABLE = False`, Р° С„СѓРЅРєС†РёРё `_get_chrome_master_key` Рё `_decrypt_chrome_value` Р°РєРєСѓСЂР°С‚РЅРѕ РІРѕР·РІСЂР°С‰Р°СЋС‚ РїСѓСЃС‚С‹Рµ Р·РЅР°С‡РµРЅРёСЏ, Р»РѕРіРёСЂСѓСЏ С„Р°РєС‚ РЅРµРґРѕСЃС‚СѓРїРЅРѕСЃС‚Рё DPAPI. Р­С‚Рѕ СѓСЃС‚СЂР°РЅСЏРµС‚ `ModuleNotFoundError` Рё РїРѕР·РІРѕР»СЏРµС‚ Р·Р°РїСѓСЃРєР°С‚СЊ backend Р±РµР· РѕР±СЏР·Р°С‚РµР»СЊРЅРѕР№ СѓСЃС‚Р°РЅРѕРІРєРё `pywin32`.
- `launcher.py`:
  - РџРµСЂРµРґ Р·Р°РїСѓСЃРєРѕРј backend РґРѕР±Р°РІР»РµРЅР° РїСЂРѕРІРµСЂРєР° `/api/health` РЅР° `127.0.0.1:8765`. Р•СЃР»Рё СЃРµСЂРІРёСЃ СѓР¶Рµ РѕС‚РІРµС‡Р°РµС‚ 200, РЅРѕРІС‹Р№ uvicorn РЅРµ СЃС‚Р°СЂС‚СѓРµС‚, Рё РєРѕРЅС„Р»РёРєС‚Р° РїРѕСЂС‚Р° РЅРµ РІРѕР·РЅРёРєР°РµС‚ вЂ” launcher РїСЂРµРІСЂР°С‰Р°РµС‚СЃСЏ РІ С‚РѕРЅРєРёР№ РєР»РёРµРЅС‚, РїСЂРѕСЃС‚Рѕ РѕС‚РєСЂС‹РІР°СЋС‰РёР№ РѕРєРЅРѕ Edge РїРѕРІРµСЂС… Р¶РёРІРѕРіРѕ API.
  - РР·РјРµРЅС‘РЅ URL, РєРѕС‚РѕСЂС‹Р№ РѕС‚РєСЂС‹РІР°РµС‚СЃСЏ РІ Edge: РІРјРµСЃС‚Рѕ РіРѕР»РѕРіРѕ `http://127.0.0.1:8765` С‚РµРїРµСЂСЊ РёСЃРїРѕР»СЊР·СѓРµС‚СЃСЏ `http://127.0.0.1:8765/?v=<mtime frontend/dist/index.html>`. Р—РЅР°С‡РµРЅРёРµ `v` Р±РµСЂС‘С‚СЃСЏ РёР· РІСЂРµРјРµРЅРё РјРѕРґРёС„РёРєР°С†РёРё `frontend/dist/index.html` (РёР»Рё `time.time()` РІ РєСЂР°Р№РЅРµРј СЃР»СѓС‡Р°Рµ), С‡С‚Рѕ РїСЂРёРЅСѓРґРёС‚РµР»СЊРЅРѕ РѕР±РЅРѕРІР»СЏРµС‚ РєСЌС€ HTML РІ РїСЂРѕС„РёР»Рµ `runtime/edge_profile`.

### Р РµР·СѓР»СЊС‚Р°С‚
- РџСЂРё Р·Р°РїСѓСЃРєРµ `python launcher.py` РѕРєРЅРѕ СЃРѕС„С‚Р° Р·Р°РіСЂСѓР¶Р°РµС‚ Р°РєС‚СѓР°Р»СЊРЅС‹Р№ `index.html` Рё РЅРѕРІС‹Рµ Р±Р°РЅРґР»С‹ (`index-CLMQ6FdA.js`, `style-BvWPhXMZ.css`); Р·Р°РїСЂРѕСЃРѕРІ Рє `index-BV7OJ2FU.js` Рё `style-60IVmluU.css` Р±РѕР»СЊС€Рµ РЅРµС‚, РѕС€РёР±РєР° `badgeClass` РЅРµ РІРѕСЃРїСЂРѕРёР·РІРѕРґРёС‚СЃСЏ.
- РџРѕРІС‚РѕСЂРЅС‹Р№ Р·Р°РїСѓСЃРє СЃРѕС„С‚Р° РїСЂРё СѓР¶Рµ СЂР°Р±РѕС‚Р°СЋС‰РµРј backend Р±РѕР»СЊС€Рµ РЅРµ РїСЂРёРІРѕРґРёС‚ Рє `WinError 10048`: launcher РѕРїСЂРµРґРµР»СЏРµС‚ Р¶РёРІРѕР№ СЃРµСЂРІРµСЂ Рё РЅРµ РїС‹С‚Р°РµС‚СЃСЏ Р·Р°РЅРѕРІРѕ РїСЂРёРІСЏР·Р°С‚СЊ РїРѕСЂС‚.
- Backend СѓСЃС‚РѕР№С‡РёРІРѕ СЃС‚Р°СЂС‚СѓРµС‚ РґР°Р¶Рµ Р±РµР· СѓСЃС‚Р°РЅРѕРІР»РµРЅРЅРѕРіРѕ `pywin32` вЂ” РјСѓР»СЊС‚РёРїР°СЂСЃРµСЂ РєРѕСЂСЂРµРєС‚РЅРѕ СЂР°Р±РѕС‚Р°РµС‚ СЃ С‚РµРјРё cookie, РєРѕС‚РѕСЂС‹Рµ РЅРµ С‚СЂРµР±СѓСЋС‚ СЂР°СЃС€РёС„СЂРѕРІРєРё С‡РµСЂРµР· DPAPI.

## 14.11.2025 вЂ” РЎРѕСЃС‚РѕСЏРЅРёРµ Р·Р°РґР°С‡Рё 5 (РјСѓР»СЊС‚Рё-Р°РєРєР°СѓРЅС‚РЅС‹Р№ Wordstat)
### Р§С‚Рѕ СѓР¶Рµ СЂРµР°Р»РёР·РѕРІР°РЅРѕ РїРѕ РўР—
- **5.1 Backend: Р°РєРєР°СѓРЅС‚С‹**  
  - `backend/routers/accounts.py`: СЂРµР°Р»РёР·РѕРІР°РЅ CRUD Рё СЃРµСЂРІРёСЃРЅС‹Рµ РјРµС‚РѕРґС‹ РґР»СЏ Р°РєРєР°СѓРЅС‚РѕРІ (`GET/POST/PUT/DELETE /api/accounts`, Р·Р°РїСѓСЃРє Р±СЂР°СѓР·РµСЂР°, Р°РІС‚РѕР»РѕРіРёРЅ, Р·Р°РіСЂСѓР·РєР° cookies РІ РїСЂРѕС„РёР»СЊ).  
  - `services/accounts.py`: `list_accounts()/get_account()` РїРѕРґС‚СЏРіРёРІР°СЋС‚ РґР°РЅРЅС‹Рµ РёР· Р‘Р”, СѓС‡РёС‚С‹РІР°СЏ ProxyManager; СЂРµР°Р»РёР·РѕРІР°РЅ `autologin_account` (Playwright + СЃРѕС…СЂР°РЅРµРЅРёРµ `storage_state.json`).  
- **5.2вЂ“5.3 Frontend: РІРєР»Р°РґРєР° В«РђРєРєР°СѓРЅС‚С‹В»**  
  - `frontend/src/modules/accounts/api.ts`: РІСЃРµ РѕРїРµСЂР°С†РёРё СЂР°Р±РѕС‚Р°СЋС‚ С‡РµСЂРµР· СЂРµР°Р»СЊРЅС‹Рµ API (`fetch/create/update/delete`, Р·Р°РїСѓСЃРє Р±СЂР°СѓР·РµСЂР°, Р°РІС‚РѕР»РѕРіРёРЅ, Р·Р°РіСЂСѓР·РєР° cookies).  
  - `frontend/src/modules/accounts/index.tsx` + `AccountSidebar.tsx`: С‚Р°Р±Р»РёС†Р° Рё СЃР°Р№РґР±Р°СЂ РѕС‚РѕР±СЂР°Р¶Р°СЋС‚ Р°РєРєР°СѓРЅС‚С‹, РµСЃС‚СЊ РєРЅРѕРїРєРё В«РђРІС‚РѕР»РѕРіРёРЅ Рё СЃРѕС…СЂР°РЅРёС‚СЊ cookiesВ» Рё В«Р—Р°РіСЂСѓР·РёС‚СЊ РєСѓРєРёВ», СЃС‚Р°С‚СѓСЃС‹/Р±РµР№РґР¶Рё СЃС‚Р°С‚СѓСЃР° Рё fingerprint РѕС‚РѕР±СЂР°Р¶Р°СЋС‚СЃСЏ С‡РµСЂРµР· `utils.ts` + `legacy/styles.css`.  
- **5.4вЂ“5.5 Backend: РјСѓР»СЊС‚РёРїР°СЂСЃРµСЂ Wordstat**  
  - `turbo_parser_improved.py`: С„СѓРЅРєС†РёСЏ `turbo_parser_10tabs(...)` СЂРµР°Р»РёР·СѓРµС‚ РјРЅРѕРіРѕРІРєР»Р°РґРѕС‡РЅС‹Р№ РїР°СЂСЃРёРЅРі Wordstat СЃ СѓС‡С‘С‚РѕРј РїСЂРѕС„РёР»СЏ, РїСЂРѕРєСЃРё, РєСѓРєРѕРІ, С‚Р°Р№РјР°СѓС‚РѕРІ Рё РїРѕРІС‚РѕСЂРЅС‹С… РїРѕРїС‹С‚РѕРє; РІРµРґС‘С‚СЃСЏ РїРѕРґСЂРѕР±РЅС‹Р№ JSONL-Р»РѕРі РїРѕ С„СЂР°Р·Р°Рј С‡РµСЂРµР· `log_parsing_debug`.  
  - `services/multiparser_manager.py`: РєР»Р°СЃСЃ `MultiParserManager` СЃРѕР·РґР°С‘С‚ Р·Р°РґР°С‡Рё РїРѕ Р°РєРєР°СѓРЅС‚Р°Рј, Р·Р°РїСѓСЃРєР°РµС‚ `turbo_parser_10tabs` РІ РїРѕС‚РѕРєР°С…, Р°РєРєСѓРјСѓР»РёСЂСѓРµС‚ СЂРµР·СѓР»СЊС‚Р°С‚С‹ Рё СЃРѕС…СЂР°РЅСЏРµС‚ РёС… РІ JSON/CSV. РќР°СЃС‚СЂРѕР№РєРё РїСЂРѕС„РёР»СЏ/РїСЂРѕРєСЃРё/РєСѓРєРѕРІ РЅРµ СЃРјРµС€РёРІР°СЋС‚СЃСЏ РјРµР¶РґСѓ Р°РєРєР°СѓРЅС‚Р°РјРё.  
  - `services/wordstat_multiparser.py`: `collect_frequency_multi(phrases, regions)` Р±РµСЂС‘С‚ РІСЃРµ СЂР°Р±РѕС‡РёРµ Р°РєРєР°СѓРЅС‚С‹ (`status in {"ok","cooldown","error"}`) РёР· `services.accounts.list_accounts()`, РїСЂРѕРІРµСЂСЏРµС‚ РЅР°Р»РёС‡РёРµ РїСЂРѕС„РёР»СЏ Рё РїСЂРѕРєСЃРё, СЂР°СЃРїСЂРµРґРµР»СЏРµС‚ С„СЂР°Р·С‹ РјРµР¶РґСѓ Р°РєРєР°СѓРЅС‚Р°РјРё Рё СЂРµРіРёРѕРЅР°РјРё, РІС‹Р·С‹РІР°РµС‚ `MultiParserManager` Рё СЃРѕС…СЂР°РЅСЏРµС‚ СЂРµР·СѓР»СЊС‚Р°С‚С‹ С‡РµСЂРµР· `services.frequency.upsert_results`.  
- **5.5вЂ“5.6 API Рё С„СЂРѕРЅС‚РµРЅРґ Wordstat**  
  - `backend/routers/wordstat.py`: РґРѕР±Р°РІР»РµРЅ `MultiCollectRequest` Рё СЌРЅРґРїРѕРёРЅС‚ `POST /api/wordstat/multi-collect`, РёСЃРїРѕР»СЊР·СѓСЋС‰РёР№ `wordstat_multiparser.collect_frequency_multi` Рё РІРѕР·РІСЂР°С‰Р°СЋС‰РёР№ `CollectResponseRow`. `/api/wordstat/regions` РѕС‚РґР°С‘С‚ РїР»РѕСЃРєРёР№ СЃРїРёСЃРѕРє СЂРµРіРёРѕРЅРѕРІ РёР· `core.geo`.  
  - `frontend/src/modules/data/api/wordstat.ts`: СЂРµР°Р»РёР·РѕРІР°РЅР° С„СѓРЅРєС†РёСЏ `multiCollectWordstat(phrases, regions)` в†’ `POST /api/wordstat/multi-collect`.  
  - `frontend/src/modules/data/components/Modals/WordstatModal.tsx`: РјРѕРґР°Р»РєР° Р±РµСЂС‘С‚ С„СЂР°Р·С‹ РёР· С‚Р°Р±Р»РёС†С‹/РїРѕР»СЏ РІРІРѕРґР°, СЂРµРіРёРѕРЅС‹ РёР· geo-РґРµСЂРµРІР°, РІС‹Р·С‹РІР°РµС‚ `multiCollectWordstat` Рё РѕР±РЅРѕРІР»СЏРµС‚ С‡Р°СЃС‚РѕС‚С‹; РІС‹Р±РѕСЂ Р°РєРєР°СѓРЅС‚РѕРІ РІ РјРѕРґР°Р»РєРµ РѕС‚СЃСѓС‚СЃС‚РІСѓРµС‚ вЂ” РІСЃРµРіРґР° РёСЃРїРѕР»СЊР·СѓСЋС‚СЃСЏ РІСЃРµ РїРѕРґС…РѕРґСЏС‰РёРµ Р°РєРєР°СѓРЅС‚С‹ РЅР° backend.  
- **5.8вЂ“5.9 Р›РѕРіРёСЂРѕРІР°РЅРёРµ Рё РґРёР°РіРЅРѕСЃС‚РёРєР°**  
  - `MultiParserManager` Р»РѕРіРёСЂСѓРµС‚ СЃРѕР·РґР°РЅРёРµ/СЃС‚Р°СЂС‚/Р·Р°РІРµСЂС€РµРЅРёРµ Р·Р°РґР°С‡, С‡РёСЃР»Рѕ С„СЂР°Р·, РѕС€РёР±РєРё Рё СЃРѕС…СЂР°РЅСЏРµС‚ СЂРµР·СѓР»СЊС‚Р°С‚С‹ РїРѕ Р°РєРєР°СѓРЅС‚Сѓ РІ JSON/CSV.  
  - `turbo_parser_improved.log_parsing_debug` РїРёС€РµС‚ JSONL-Р·Р°РїРёСЃРё РїРѕ РєР°Р¶РґРѕР№ С„СЂР°Р·Рµ (СЃС‚Р°СЂС‚, СѓСЃРїРµС…, С‚Р°Р№РјР°СѓС‚/РЅРµС‚ РґР°РЅРЅС‹С…, РІСЂРµРјСЏ РІС‹РїРѕР»РЅРµРЅРёСЏ, Р·РЅР°С‡РµРЅРёРµ ws).  
  - Р’ `services/multiparser_manager.py` РґРѕР±Р°РІР»РµРЅР° Р±Р°Р·РѕРІР°СЏ СЂРµР°РєС†РёСЏ РЅР° РїСЂРѕРІР°Р»С‹: РїСЂРё С„Р°С‚Р°Р»СЊРЅРѕР№ РѕС€РёР±РєРµ РїР°СЂСЃРёРЅРіР° РёР»Рё РїСѓСЃС‚РѕРј СЂРµР·СѓР»СЊС‚Р°С‚Рµ РґР»СЏ Р°РєРєР°СѓРЅС‚Р° РІС‹Р·С‹РІР°РµС‚СЃСЏ `services.accounts.mark_account_broken_by_email(...)` СЃРѕ СЃС‚Р°С‚СѓСЃРѕРј `error` Рё Р»РѕРіРёСЂСѓРµС‚СЃСЏ РѕС‚РґРµР»СЊРЅР°СЏ Р·Р°РїРёСЃСЊ, С‡С‚РѕР±С‹ Р±С‹Р»Рѕ РІРёРґРЅРѕ, С‡С‚Рѕ Р°РєРєР°СѓРЅС‚ РїРѕРјРµС‡РµРЅ РєР°Рє РїСЂРѕР±Р»РµРјРЅС‹Р№.  
  - Р”РѕРїРѕР»РЅРёС‚РµР»СЊРЅРѕ: РїСЂРё СѓСЃРїРµС€РЅРѕРј РїР°СЂСЃРёРЅРіРµ РґР»СЏ Р°РєРєР°СѓРЅС‚Р° С‚РµРїРµСЂСЊ РІС‹Р·С‹РІР°РµС‚СЃСЏ `mark_account_broken_by_email(..., status="ok")`, С‡С‚РѕР±С‹ Р°РІС‚РѕРјР°С‚РёС‡РµСЃРєРё СЃР±СЂР°СЃС‹РІР°С‚СЊ СЃС‚Р°С‚СѓСЃ СЃ `error` РЅР° `ok` РїРѕСЃР»Рµ СѓРґР°С‡РЅРѕРіРѕ РїСЂРѕРіРѕРЅР°; СЃР°Рј РјСѓР»СЊС‚РёРїР°СЂСЃРµСЂ РїСЂРё СЌС‚РѕРј СѓС‡РёС‚С‹РІР°РµС‚ Р°РєРєР°СѓРЅС‚С‹ СЃРѕ СЃС‚Р°С‚СѓСЃРѕРј `error` РєР°Рє СЂР°Р±РѕС‡РёРµ (РЅРµ РґР°С‘С‚ РёРј В«РІС‹РїР°СЃС‚СЊВ» РёР· РїСѓР»Р° РёР·вЂ‘Р·Р° РІСЂРµРјРµРЅРЅРѕР№ РѕС€РёР±РєРё).

### Р§С‚Рѕ РµС‰С‘ РЅРµ РґРѕРІРµРґРµРЅРѕ РґРѕ РєРѕРЅС†Р°
- **5.2вЂ“5.3**: РІРєР»Р°РґРєРё В«РЎРµС‚СЊВ»/В«FingerprintВ»/В«РњРµРЅРµРґР¶РµСЂ РїСЂРѕРєСЃРёВ» РІ `AccountSidebar.tsx` РїРѕРєР° РІ РѕСЃРЅРѕРІРЅРѕРј СЃС‚Р°С‚РёС‡РЅС‹; РЅРµ РІСЃРµ РїРѕР»СЏ СЃРѕС…СЂР°РЅСЏСЋС‚СЃСЏ С‡РµСЂРµР· СЂРµР°Р»СЊРЅС‹Рµ API (`updateAccount`/`set_account_proxy`), Р»РѕРіРёРєР° С‚РµСЃС‚Р°/РїР°СЂСЃРёРЅРіР°/СЂРѕС‚Р°С†РёРё РїСЂРѕРєСЃРё С‡Р°СЃС‚РёС‡РЅРѕ РґРµРјРѕ.  
- **5.7 Р‘Р°РЅС‹ Р°РєРєР°СѓРЅС‚РѕРІ**: СЂРµР°Р»РёР·РѕРІР°РЅР° РїРѕРјРµС‚РєР° Р°РєРєР°СѓРЅС‚Р° РєР°Рє `error` РїСЂРё СЏРІРЅС‹С… РїСЂРѕРІР°Р»Р°С… РјСѓР»СЊС‚РёРїР°СЂСЃРµСЂР° (РёСЃРєР»СЋС‡РµРЅРёСЏ РёР»Рё РїСѓСЃС‚РѕР№ СЂРµР·СѓР»СЊС‚Р°С‚), РЅРѕ РЅРµС‚ С‚РѕРЅРєРѕР№ РіСЂР°РґР°С†РёРё РјРµР¶РґСѓ РІСЂРµРјРµРЅРЅС‹РјРё РѕС€РёР±РєР°РјРё (captcha/cooldown) Рё РѕРєРѕРЅС‡Р°С‚РµР»СЊРЅС‹Рј Р±Р°РЅРѕРј (`banned`). Р›РѕРіРёРєР° Р°РІС‚РѕРјР°С‚РёС‡РµСЃРєРѕРіРѕ РїРµСЂРµРІРѕРґР° РІ `banned` РїРѕ РїРѕРІС‚РѕСЂСЏСЋС‰РёРјСЃСЏ auth-РѕС€РёР±РєР°Рј РјРѕР¶РµС‚ Р±С‹С‚СЊ РґРѕСЂР°Р±РѕС‚Р°РЅР° РѕС‚РґРµР»СЊРЅРѕ.

## 14.11.2025 вЂ” FingerprintвЂ‘РїСЂРµСЃРµС‚С‹ РІ РјСѓР»СЊС‚РёРїР°СЂСЃРµСЂРµ Wordstat
### Р§С‚Рѕ СЃРґРµР»Р°РЅРѕ
- Р’ `services/wordstat_multiparser.py`:
  - Р”РѕР±Р°РІР»РµРЅ РІСЃРїРѕРјРѕРіР°С‚РµР»СЊРЅС‹Р№ `_extract_fingerprint(account)`, РєРѕС‚РѕСЂС‹Р№ РїР°СЂСЃРёС‚ `account.notes` РєР°Рє JSON Рё РІС‹С‚Р°СЃРєРёРІР°РµС‚ РїРѕР»Рµ `fingerprint` (Р°РЅР°Р»РѕРіРёС‡РЅРѕ С„СЂРѕРЅС‚РµРЅРґСѓ).  
  - РЎС‚СЂСѓРєС‚СѓСЂР° `_ProfileSpec` СЂР°СЃС€РёСЂРµРЅР° РїРѕР»РµРј `fingerprint: str | None`, Р° `_load_profiles()` РЅР°РїРѕР»РЅСЏРµС‚ РµРіРѕ Р·РЅР°С‡РµРЅРёРµРј РёР· `notes`.  
  - РџСЂРё С„РѕСЂРјРёСЂРѕРІР°РЅРёРё payload РїСЂРѕС„РёР»СЏ РґР»СЏ `MultiParserManager` С‚РµРїРµСЂСЊ РїРµСЂРµРґР°С‘С‚СЃСЏ РєР»СЋС‡ `"fingerprint"` РґР»СЏ РєР°Р¶РґРѕРіРѕ Р°РєРєР°СѓРЅС‚Р°, С‡С‚РѕР±С‹ РјСѓР»СЊС‚РёРїР°СЂСЃРµСЂ Р·РЅР°Р» РІС‹Р±СЂР°РЅРЅС‹Р№ РїСЂРµСЃРµС‚.  
- Р’ `services/multiparser_manager.py`:
  - `ParsingTask` РґРѕРїРѕР»РЅРµРЅ РїРѕР»РµРј `fingerprint: Optional[str]`, РєРѕС‚РѕСЂРѕРµ РѕС‚СЂР°Р¶Р°РµС‚ fingerprintвЂ‘РїСЂРµСЃРµС‚ РґР»СЏ РєРѕРЅРєСЂРµС‚РЅРѕРіРѕ Р°РєРєР°СѓРЅС‚Р°.  
  - `create_task(...)` Рё `submit_tasks(...)` РїСЂРёРЅРёРјР°СЋС‚/РїСЂРѕРєРёРґС‹РІР°СЋС‚ `fingerprint` РёР· РїСЂРѕС„РёР»РµР№.  
  - РџСЂРё РІС‹Р·РѕРІРµ `turbo_parser_10tabs(...)` РґРѕР±Р°РІР»РµРЅ Р°СЂРіСѓРјРµРЅС‚ `fingerprint_preset=task.fingerprint`, С‡С‚РѕР±С‹ РїРµСЂРµРґР°С‚СЊ РїСЂРµСЃРµС‚ РґРѕ СѓСЂРѕРІРЅСЏ Playwright.  
- Р’ `turbo_parser_improved.py`:
  - РљР»Р°СЃСЃ `TurboParser` С‚РµРїРµСЂСЊ РїСЂРёРЅРёРјР°РµС‚ `fingerprint_preset: Optional[str]` Рё СЃРѕС…СЂР°РЅСЏРµС‚ РµРіРѕ.  
  - Р”РѕР±Р°РІР»РµРЅ РјРµС‚РѕРґ `_resolve_fingerprint()`, РєРѕС‚РѕСЂС‹Р№ РїРѕ РїСЂРµСЃРµС‚Сѓ РІРѕР·РІСЂР°С‰Р°РµС‚ С‚СЂРѕР№РєСѓ `(user_agent, locale, timezone_id)`:
    - `russia_standard` (РїРѕ СѓРјРѕР»С‡Р°РЅРёСЋ): РґРµСЃРєС‚РѕРїРЅС‹Р№ Chrome UA, `locale="ru-RU"`, `timezone_id="Europe/Moscow"`.  
    - `kazakhstan_standard`: С‚РѕС‚ Р¶Рµ UA, `locale="ru-KZ"`, `timezone_id="Asia/Almaty"`.  
    - `no_spoofing`: `user_agent=None` (РѕСЃС‚Р°РІР»СЏРµРј РґРµС„РѕР»С‚РЅС‹Р№), `locale="ru-RU"`, Р±РµР· РїСЂРёРЅСѓРґРёС‚РµР»СЊРЅРѕР№ С‚Р°Р№РјР·РѕРЅС‹.  
  - Р’ `launch_persistent_context` С‚РµРїРµСЂСЊ РёСЃРїРѕР»СЊР·СѓСЋС‚СЃСЏ СЌС‚Рё РїР°СЂР°РјРµС‚СЂС‹ (`user_agent`, `locale`, `timezone_id`), С‚Р°Рє С‡С‚Рѕ РѕС‚РїРµС‡Р°С‚РѕРє Р±СЂР°СѓР·РµСЂР° Р·Р°РІРёСЃРёС‚ РѕС‚ РІС‹Р±СЂР°РЅРЅРѕРіРѕ РїСЂРµСЃРµС‚Р° Р°РєРєР°СѓРЅС‚Р°.  
  - `turbo_parser_10tabs(...)` СЂР°СЃС€РёСЂРµРЅ РїР°СЂР°РјРµС‚СЂРѕРј `fingerprint_preset` Рё РїСЂРѕРєРёРґС‹РІР°РµС‚ РµРіРѕ РІ `TurboParser`.  

### Р РµР·СѓР»СЊС‚Р°С‚
- РњСѓР»СЊС‚РёРїР°СЂСЃРµСЂ Wordstat С‚РµРїРµСЂСЊ СѓС‡РёС‚С‹РІР°РµС‚ РЅРµ С‚РѕР»СЊРєРѕ РїСЂРѕС„РёР»СЊ/РїСЂРѕРєСЃРё/cookies, РЅРѕ Рё fingerprintвЂ‘РїСЂРµСЃРµС‚ РєР°Р¶РґРѕРіРѕ Р°РєРєР°СѓРЅС‚Р°: UA, СЏР·С‹Рє Рё С‚Р°Р№РјР·РѕРЅР° Р±СЂР°СѓР·РµСЂР° РґР»СЏ СЂР°Р·РЅС‹С… Р°РєРєР°СѓРЅС‚РѕРІ РјРѕРіСѓС‚ РѕС‚Р»РёС‡Р°С‚СЊСЃСЏ.  
- РќР°СЃС‚СЂРѕР№РєР° fingerprint РѕСЃС‚Р°С‘С‚СЃСЏ РµРґРёРЅРѕР№: РїСЂРµСЃРµС‚ С…СЂР°РЅРёС‚СЃСЏ РІ `notes` Р°РєРєР°СѓРЅС‚Р°, РёСЃРїРѕР»СЊР·СѓРµС‚СЃСЏ РЅР° С„СЂРѕРЅС‚Рµ (РґР»СЏ Р±РµР№РґР¶РµР№) Рё РЅР° backend (РґР»СЏ PlaywrightвЂ‘РєРѕРЅС‚РµРєСЃС‚РѕРІ). Р­С‚Рѕ СЃРѕРѕС‚РІРµС‚СЃС‚РІСѓРµС‚ С‚СЂРµР±РѕРІР°РЅРёСЏРј Рї.4.2.x/5.4 РўР—.  

## 14.11.2025 вЂ” Р’РєР»Р°РґРєР° В«РђРєРєР°СѓРЅС‚С‹В»: СЃРµС‚РµРІС‹Рµ РЅР°СЃС‚СЂРѕР№РєРё Рё fingerprint СЂРµР°Р»СЊРЅРѕ РїСЂРёРјРµРЅСЏСЋС‚СЃСЏ
### РџСЂРѕР±Р»РµРјР°
- Р’ РїСЂР°РІРѕР№ РїР°РЅРµР»Рё В«РќР°СЃС‚СЂРѕР№РєРё Р°РєРєР°СѓРЅС‚Р°В» (РІРєР»Р°РґРєРё В«РЎРµС‚СЊВ» Рё В«FingerprintВ») РІСЃРµ РїРѕР»СЏ Р±С‹Р»Рё РїРѕ СЃСѓС‚Рё Р·Р°РіР»СѓС€РєР°РјРё:  
  - С„РѕСЂРјС‹ Р·Р°РїРѕР»РЅСЏР»РёСЃСЊ РёР· `Account` (mapper в†’ notes), РЅРѕ РёР·РјРµРЅРµРЅРёСЏ РїРѕР»СЊР·РѕРІР°С‚РµР»СЏ РЅРёРєСѓРґР° РЅРµ СЃРѕС…СЂР°РЅСЏР»РёСЃСЊ;  
  - РїСЂРё РЅР°Р¶Р°С‚РёРё РЅР° play/В«Р—Р°РїСѓСЃРє Р±СЂР°СѓР·РµСЂР°В» backend РёСЃРїРѕР»СЊР·РѕРІР°Р» С‚РѕР»СЊРєРѕ РїРѕР»Рµ `proxy` РёР· Р‘Р”, РѕСЃС‚Р°Р»СЊРЅС‹Рµ РїРѕР»СЏ (Р»РѕРіРёРЅ/РїР°СЂРѕР»СЊ/С‚РёРї, fingerprint) РёРіРЅРѕСЂРёСЂРѕРІР°Р»РёСЃСЊ.  
- Р’ СЂРµР·СѓР»СЊС‚Р°С‚Рµ Р±СЂР°СѓР·РµСЂ Р·Р°РїСѓСЃРєР°Р»СЃСЏ Р»РёР±Рѕ СЃ СѓСЃС‚Р°СЂРµРІС€РёРјРё РЅР°СЃС‚СЂРѕР№РєР°РјРё, Р»РёР±Рѕ РІРѕРѕР±С‰Рµ Р±РµР· СѓС‡С‘С‚Р° С‚РѕРіРѕ, С‡С‚Рѕ РїРѕР»СЊР·РѕРІР°С‚РµР»СЊ РІРёРґРµР» Рё РїСЂР°РІРёР» СЃРїСЂР°РІР°.

### Р§С‚Рѕ СЃРґРµР»Р°РЅРѕ (frontend)
- `frontend/src/modules/accounts/components/AccountSidebar.tsx`:
  - Р”РѕР±Р°РІР»РµРЅ С‚РёРї `UpdateAccountFn` Рё РїСЂРѕРї `onUpdateAccount?: (id, changes) => Promise<void> | void` Сѓ `AccountSidebar`, С‡С‚РѕР±С‹ РїР°РЅРµР»СЊ РјРѕРіР»Р° РёРЅРёС†РёРёСЂРѕРІР°С‚СЊ РѕР±РЅРѕРІР»РµРЅРёРµ Р°РєРєР°СѓРЅС‚Р° С‡РµСЂРµР· API.  
  - Р’РєР»Р°РґРєР° В«РЎРµС‚СЊВ» РІС‹РЅРµСЃРµРЅР° РІ РѕС‚РґРµР»СЊРЅС‹Р№ РєРѕРјРїРѕРЅРµРЅС‚ `NetworkTab` СЃ Р»РѕРєР°Р»СЊРЅС‹Рј СЃРѕСЃС‚РѕСЏРЅРёРµРј:
    - РїРѕР»СЏ В«РђРґСЂРµСЃ РїСЂРѕРєСЃРёВ», В«Р›РѕРіРёРЅВ», В«РџР°СЂРѕР»СЊВ», В«РўРёРї РїСЂРѕС‚РѕРєРѕР»Р°В» СЃС‚Р°Р»Рё СѓРїСЂР°РІР»СЏРµРјС‹РјРё (`value` + `onChange`);  
    - РґРѕР±Р°РІР»РµРЅР° РєРЅРѕРїРєР° В«РЎРѕС…СЂР°РЅРёС‚СЊВ» (РєРЅРѕРїРєР° `btn btn-primary btn-small` СЂСЏРґРѕРј СЃ Р·Р°РіР»СѓС€РєРѕР№ В«РўРµСЃС‚ РїСЂРѕРєСЃРёВ»);  
    - РїСЂРё СЃРѕС…СЂР°РЅРµРЅРёРё СЃРѕР±РёСЂР°РµС‚СЃСЏ РЅРѕСЂРјР°Р»РёР·РѕРІР°РЅРЅС‹Р№ `proxyUrl`:  
      - Р°РґСЂРµСЃ РѕС‡РёС‰Р°РµС‚СЃСЏ РѕС‚ СЃС…РµРјС‹ (`http://`, `https://` Рё С‚.Рґ.),  
      - РµСЃР»Рё Р·Р°РґР°РЅС‹ Р»РѕРіРёРЅ/РїР°СЂРѕР»СЊ в†’ `scheme://user:pass@host:port`, РёРЅР°С‡Рµ `scheme://host:port`;  
    - РІС‹Р·С‹РІР°РµС‚СЃСЏ `onUpdateAccount(account.id, { proxy, proxyUsername, proxyPassword, proxyType })`, С‚Р°Рє С‡С‚Рѕ:
      - РєРѕР»РѕРЅРєР° В«РџСЂРѕРєСЃРёВ» РІ С‚Р°Р±Р»РёС†Рµ С‚РµРїРµСЂСЊ РІСЃРµРіРґР° СЃРёРЅС…СЂРѕРЅРёР·РёСЂРѕРІР°РЅР° СЃ РїСЂР°РІРѕР№ С„РѕСЂРјРѕР№,  
      - backend РїРѕР»СѓС‡Р°РµС‚ РµРґРёРЅС‹Р№ URI, РїРѕРЅСЏС‚РЅС‹Р№ Рё ChromeLauncher, Рё TurboParser.  
  - Р’РєР»Р°РґРєР° В«FingerprintВ» РІС‹РЅРµСЃРµРЅР° РІ РєРѕРјРїРѕРЅРµРЅС‚ `FingerprintTab`:
    - СЃРµР»РµРєС‚ fingerprint СЃС‚Р°Р» СѓРїСЂР°РІР»СЏРµРјС‹Рј (Р·РЅР°С‡РµРЅРёРµ Р±РµСЂС‘С‚СЃСЏ РёР· `account.fingerprint`);  
    - РґРѕР±Р°РІР»РµРЅР° РєРЅРѕРїРєР° В«РЎРѕС…СЂР°РЅРёС‚СЊ fingerprintВ», РєРѕС‚РѕСЂР°СЏ РІС‹Р·С‹РІР°РµС‚ `onUpdateAccount(account.id, { fingerprint: preset })`;  
    - С‚РµРєСЃС‚ РІ РїР°РЅРµР»Рё СЏРІРЅРѕ РїРѕСЏСЃРЅСЏРµС‚, С‡С‚Рѕ РїСЂРµСЃРµС‚ СѓРїСЂР°РІР»СЏРµС‚ UA/СЏР·С‹РєРѕРј/С‚Р°Р№РјР·РѕРЅРѕР№ Рё РїСЂРёРјРµРЅСЏРµС‚СЃСЏ РїСЂРё СЃР»РµРґСѓСЋС‰РµРј Р·Р°РїСѓСЃРєРµ Р±СЂР°СѓР·РµСЂР°/РјСѓР»СЊС‚РёРїР°СЂСЃРµСЂР°.  
- `frontend/src/modules/accounts/index.tsx`:
  - Р’ `AccountsModule` РїСЂРё СЂРµРЅРґРµСЂРµ `AccountSidebar` С‚РµРїРµСЂСЊ РїРµСЂРµРґР°С‘С‚СЃСЏ `onUpdateAccount` СЃ СЂРµР°Р»РёР·Р°С†РёРµР№:
    - С„РѕСЂРјРёСЂСѓРµС‚ payload С‡РµСЂРµР· `accountToUpdatePayload(changes)`,  
    - РІС‹Р·С‹РІР°РµС‚ `updateAccount(id, payload)` (REST API),  
    - РјР°РїРїРёС‚ РѕС‚РІРµС‚ РѕР±СЂР°С‚РЅРѕ РІ `Account` (`apiAccountToAccount`) Рё РѕР±РЅРѕРІР»СЏРµС‚ Р»РѕРєР°Р»СЊРЅС‹Рµ `accounts` Рё `currentAccount`.  
  - Р‘Р»Р°РіРѕРґР°СЂСЏ СЌС‚РѕРјСѓ РёР·РјРµРЅРµРЅРёСЏ РёР· РїСЂР°РІРѕР№ РїР°РЅРµР»Рё СЃСЂР°Р·Сѓ РїРѕРїР°РґР°СЋС‚ РІ Р‘Р” Рё РѕС‚СЂР°Р¶Р°СЋС‚СЃСЏ РІ С‚Р°Р±Р»РёС†Рµ Р±РµР· РїРµСЂРµР·Р°РіСЂСѓР·РєРё РІСЃРµР№ СЃС‚СЂР°РЅРёС†С‹.

### Р РµР·СѓР»СЊС‚Р°С‚
- РџСЂР°РІР°СЏ РїР°РЅРµР»СЊ В«РЎРµС‚СЊВ» РїРµСЂРµСЃС‚Р°Р»Р° Р±С‹С‚СЊ Р·Р°РіР»СѓС€РєРѕР№: Р»СЋР±С‹Рµ РёР·РјРµРЅРµРЅРёСЏ РїСЂРѕРєСЃРё (С…РѕСЃС‚/РїРѕСЂС‚, Р»РѕРіРёРЅ, РїР°СЂРѕР»СЊ, С‚РёРї) РїРѕСЃР»Рµ РЅР°Р¶Р°С‚РёСЏ В«РЎРѕС…СЂР°РЅРёС‚СЊВ» СЂРµР°Р»СЊРЅРѕ СЃРѕС…СЂР°РЅСЏСЋС‚СЃСЏ РІ Р°РєРєР°СѓРЅС‚ Рё РёСЃРїРѕР»СЊР·СѓСЋС‚СЃСЏ:
  - РїСЂРё Р·Р°РїСѓСЃРєРµ Р±СЂР°СѓР·РµСЂР° С‡РµСЂРµР· `POST /api/accounts/{id}/launch` в†’ `ChromeLauncher` Р±РµСЂС‘С‚ РѕР±РЅРѕРІР»С‘РЅРЅС‹Р№ `account.proxy` Рё РїРµСЂРµРґР°С‘С‚ РµРіРѕ РІ Chrome/РїРµСЂРµРјРµРЅРЅС‹Рµ РѕРєСЂСѓР¶РµРЅРёСЏ;
  - РїСЂРё РјСѓР»СЊС‚РёРїР°СЂСЃРёРЅРіРµ Wordstat вЂ” С‡РµСЂРµР· `services.accounts.list_accounts()` Рё `proxy_to_playwright`/`get_proxy_config`.
- Р’РєР»Р°РґРєР° В«FingerprintВ» С‚РµРїРµСЂСЊ СЃРІСЏР·Р°РЅР° СЃ backend: РІС‹Р±СЂР°РЅРЅС‹Р№ РїСЂРµСЃРµС‚ СЃРѕС…СЂР°РЅСЏРµС‚СЃСЏ С‡РµСЂРµР· API Рё РїРѕС‚РѕРј РїРѕРґС‚СЏРіРёРІР°РµС‚СЃСЏ РІ TurboParser (UA/locale/timezone), С‚Р°Рє С‡С‚Рѕ РїРѕРІРµРґРµРЅРёРµ РјСѓР»СЊС‚РёРїР°СЂСЃРµСЂР° Р·Р°РІРёСЃРёС‚ РѕС‚ РЅР°СЃС‚СЂРѕРµРє СЃРїСЂР°РІР°.
- РЎР±РѕСЂРєР° С„СЂРѕРЅС‚РµРЅРґР° (`npm run build` РІ `frontend/`) РїСЂРѕС…РѕРґРёС‚ СѓСЃРїРµС€РЅРѕ; РІ `dist/` Р»РµР¶Р°С‚ СЃРІРµР¶РёРµ Р±Р°РЅРґР»С‹, РєРѕС‚РѕСЂС‹Рµ launcher СѓР¶Рµ СЂР°Р·РґР°С‘С‚ С‡РµСЂРµР· FastAPI.

---

## 14.11.2025 вЂ” РСЃРїСЂР°РІР»РµРЅРёРµ РїСЂРѕР±Р»РµРјС‹ Р·Р°РїСѓСЃРєР° Р±СЂР°СѓР·РµСЂР° С‡РµСЂРµР· РїСЂРѕРєСЃРё (Р·Р°РґР°С‡Р° 5)

### РџСЂРѕР±Р»РµРјР°
РџСЂРё Р·Р°РїСѓСЃРєРµ Р±СЂР°СѓР·РµСЂР° РїРѕ РєРЅРѕРїРєРµ "play" РІ РјРѕРґСѓР»Рµ "РђРєРєР°СѓРЅС‚С‹" РїРѕСЏРІР»СЏР»РѕСЃСЊ РѕРєРЅРѕ РІРІРѕРґР° Р»РѕРіРёРЅР°/РїР°СЂРѕР»СЏ РїСЂРѕРєСЃРё Рё РѕС€РёР±РєР° `ERR_TUNNEL_CONNECTION_FAILED`, С…РѕС‚СЏ РїСЂРё РїР°СЂСЃРёРЅРіРµ Wordstat СЃ С‚РµРјРё Р¶Рµ РЅР°СЃС‚СЂРѕР№РєР°РјРё РІСЃС‘ СЂР°Р±РѕС‚Р°Р»Рѕ РЅРѕСЂРјР°Р»СЊРЅРѕ.

### РџСЂРёС‡РёРЅР°
**Р Р°Р·РЅС‹Рµ РјРµС…Р°РЅРёР·РјС‹ Р·Р°РїСѓСЃРєР°:**
- **Р Р°Р±РѕС‡РёР№ РїР°СЂСЃРµСЂ**: РёСЃРїРѕР»СЊР·СѓРµС‚ Playwright (`launch_persistent_context` СЃ РїР°СЂР°РјРµС‚СЂРѕРј `proxy={server, username, password}`), РіРґРµ Р°РІС‚РѕСЂРёР·Р°С†РёСЏ РЅР° РїСЂРѕРєСЃРё РїСЂРѕРёСЃС…РѕРґРёС‚ Р°РІС‚РѕРјР°С‚РёС‡РµСЃРєРё РІРЅСѓС‚СЂРё РґРІРёР¶РєР°
- **Р—Р°РїСѓСЃРє РёР· "РђРєРєР°СѓРЅС‚РѕРІ"**: РёСЃРїРѕР»СЊР·РѕРІР°Р» РїСЂСЏРјРѕР№ Р·Р°РїСѓСЃРє Chrome С‡РµСЂРµР· `ChromeLauncher.launch()` СЃ `--proxy-server` Рё СЂР°СЃС€РёСЂРµРЅРёРµРј ProxyAuth, С‡С‚Рѕ РЅРµ РІСЃРµРіРґР° РєРѕСЂСЂРµРєС‚РЅРѕ РѕР±СЂР°Р±Р°С‚С‹РІР°РµС‚ Р°РІС‚РѕСЂРёР·Р°С†РёСЋ

**РљСЂРѕРјРµ С‚РѕРіРѕ**: РЅР° РїРѕСЂС‚Сѓ 8765 СЂР°Р±РѕС‚Р°Р» СЃС‚Р°СЂС‹Р№ backend (PID 137036), Р·Р°РїСѓС‰РµРЅРЅС‹Р№ СЂР°РЅРµРµ, РїРѕСЌС‚РѕРјСѓ РІСЃРµ РёР·РјРµРЅРµРЅРёСЏ РІ РєРѕРґРµ `KeySet-MVP` РЅРµ РїСЂРёРјРµРЅСЏР»РёСЃСЊ.

### Р РµС€РµРЅРёРµ

1. **РЎРѕР·РґР°РЅ РјРѕРґСѓР»СЊ `services/browser_factory.py`:**
   - РџРѕСЂС‚РёСЂРѕРІР°РЅР° СЂР°Р±РѕС‡Р°СЏ Р»РѕРіРёРєР° Р·Р°РїСѓСЃРєР° Р±СЂР°СѓР·РµСЂР° С‡РµСЂРµР· Playwright РёР· legacy `keyset/services/browser_factory.py`
   - Р¤СѓРЅРєС†РёСЏ `for_account(account_id)`:
     - Р‘РµСЂС‘С‚ Р°РєРєР°СѓРЅС‚ РёР· Р‘Р”
     - РќРѕСЂРјР°Р»РёР·СѓРµС‚ РїСѓС‚СЊ РїСЂРѕС„РёР»СЏ С‡РµСЂРµР· `ChromeLauncher._normalise_profile_path`
     - Р“РѕС‚РѕРІРёС‚ РїСЂРѕРєСЃРё С‡РµСЂРµР· `proxy_to_playwright(account.proxy)` вЂ” С‚РѕС‚ Р¶Рµ РїР°СЂСЃРµСЂ, С‡С‚Рѕ РІ РјСѓР»СЊС‚РёРїР°СЂСЃРµСЂРµ
     - Р—Р°РїСѓСЃРєР°РµС‚ `playwright.chromium.launch_persistent_context(user_data_dir=..., proxy=proxy_kwargs, ...)`
     - РђРІС‚РѕСЂРёР·Р°С†РёСЏ РЅР° РїСЂРѕРєСЃРё РїСЂРѕРёСЃС…РѕРґРёС‚ Р°РІС‚РѕРјР°С‚РёС‡РµСЃРєРё (РєР°Рє РІ TurboParser)

2. **РћР±РЅРѕРІР»С‘РЅ `backend/routers/accounts.py`:**
   - Р”РѕР±Р°РІР»РµРЅ РёРјРїРѕСЂС‚: `from services.browser_factory import for_account as launch_browser_for_account`
   - Р¤СѓРЅРєС†РёСЏ `_launch_account` РїРµСЂРµРїРёСЃР°РЅР° РЅР° РёСЃРїРѕР»СЊР·РѕРІР°РЅРёРµ `launch_browser_for_account(account_id, ...)`
   - РўРµРїРµСЂСЊ Р·Р°РїСѓСЃРє Р±СЂР°СѓР·РµСЂР° РїРѕ РєРЅРѕРїРєРµ "play" РёСЃРїРѕР»СЊР·СѓРµС‚ РўРЈ Р–Р• С†РµРїРѕС‡РєСѓ, С‡С‚Рѕ Рё РјСѓР»СЊС‚РёРїР°СЂСЃРµСЂ

3. **РџРµСЂРµР·Р°РїСѓС‰РµРЅ backend:**
   - РћСЃС‚Р°РЅРѕРІР»РµРЅ СЃС‚Р°СЂС‹Р№ РїСЂРѕС†РµСЃСЃ (PID 137036): `taskkill //F //PID 137036`
   - Р—Р°РїСѓС‰РµРЅ РЅРѕРІС‹Р№ backend РёР· `C:\AI\yandex\KeySet-MVP`: `python launcher.py`
   - РќРѕРІС‹Р№ РїСЂРѕС†РµСЃСЃ (PID 120540) С‚РµРїРµСЂСЊ РёСЃРїРѕР»СЊР·СѓРµС‚ РѕР±РЅРѕРІР»С‘РЅРЅС‹Р№ РєРѕРґ СЃ Playwright

### РџСЂРѕРІРµСЂРєР°
- Р¤Р°Р№Р» `services/browser_factory.py` СЃСѓС‰РµСЃС‚РІСѓРµС‚: вњ“
- `backend/routers/accounts.py` РёРјРїРѕСЂС‚РёСЂСѓРµС‚ `browser_factory`: вњ“
- `browser_factory.py` РёСЃРїРѕР»СЊР·СѓРµС‚ `playwright.chromium.launch_persistent_context`: вњ“
- Backend Р·Р°РїСѓС‰РµРЅ РёР· РїСЂР°РІРёР»СЊРЅРѕР№ РїР°РїРєРё (PID 120540): вњ“

### Р РµР·СѓР»СЊС‚Р°С‚
РўРµРїРµСЂСЊ РїСЂРё РЅР°Р¶Р°С‚РёРё РєРЅРѕРїРєРё "play" РІ РјРѕРґСѓР»Рµ "РђРєРєР°СѓРЅС‚С‹":
- Р‘СЂР°СѓР·РµСЂ Р·Р°РїСѓСЃРєР°РµС‚СЃСЏ С‡РµСЂРµР· Playwright СЃ С‚РµРјРё Р¶Рµ РЅР°СЃС‚СЂРѕР№РєР°РјРё, С‡С‚Рѕ Рё РїСЂРё РїР°СЂСЃРёРЅРіРµ
- РџСЂРѕРєСЃРё СЃ Р»РѕРіРёРЅРѕРј/РїР°СЂРѕР»РµРј СЂР°Р±РѕС‚Р°РµС‚ Р±РµР· РѕРєРЅР° Р°РІС‚РѕСЂРёР·Р°С†РёРё
- РСЃРїРѕР»СЊР·СѓРµС‚СЃСЏ РїСЂР°РІРёР»СЊРЅС‹Р№ РїСЂРѕС„РёР»СЊ Р°РєРєР°СѓРЅС‚Р°
- Р’СЃРµ РЅР°СЃС‚СЂРѕР№РєРё СЃРїСЂР°РІР° (РїСЂРѕРєСЃРё, fingerprint) РїСЂРёРјРµРЅСЏСЋС‚СЃСЏ РєРѕСЂСЂРµРєС‚РЅРѕ

**Р¦РµРїРѕС‡РєР° С‚РµРїРµСЂСЊ РµРґРёРЅР°СЏ**: UI в†’ backend в†’ `browser_factory.for_account()` в†’ Playwright в†’ Chrome СЃ РїСЂРѕРєСЃРё/РїСЂРѕС„РёР»РµРј

---

## 14.11.2025 вЂ” РСЃРїСЂР°РІР»РµРЅРёРµ Р·Р°РІРёСЃР°РЅРёСЏ Р±СЂР°СѓР·РµСЂР° РїСЂРё Р·Р°РіСЂСѓР·РєРµ СЃС‚СЂР°РЅРёС†

### РџСЂРѕР±Р»РµРјР°
РџРѕСЃР»Рµ РїРµСЂРІРѕРіРѕ РёСЃРїСЂР°РІР»РµРЅРёСЏ Р±СЂР°СѓР·РµСЂ СЃС‚Р°Р» РѕС‚РєСЂС‹РІР°С‚СЊСЃСЏ СЃ РїСЂРѕРєСЃРё Р±РµР· РѕРєРЅР° Р°РІС‚РѕСЂРёР·Р°С†РёРё, РЅРѕ РїРѕСЏРІРёР»Р°СЃСЊ РЅРѕРІР°СЏ РїСЂРѕР±Р»РµРјР°:
- РЎС‚СЂР°РЅРёС†С‹ РЅРµ Р·Р°РіСЂСѓР¶Р°СЋС‚СЃСЏ (Р±РµСЃРєРѕРЅРµС‡РЅР°СЏ Р·Р°РіСЂСѓР·РєР°)
- РџРѕРёСЃРє РЅРµ СЂР°Р±РѕС‚Р°РµС‚
- РР· Р°РґСЂРµСЃРЅРѕР№ СЃС‚СЂРѕРєРё СЃР°Р№С‚С‹ РЅРµ РѕС‚РєСЂС‹РІР°СЋС‚СЃСЏ

### РџСЂРёС‡РёРЅР°
Р’ `browser_factory.py` СЏ РёСЃРїРѕР»СЊР·РѕРІР°Р» **РЅРµРїСЂР°РІРёР»СЊРЅС‹Рµ РЅР°СЃС‚СЂРѕР№РєРё Р·Р°РїСѓСЃРєР°**, РѕС‚Р»РёС‡РЅС‹Рµ РѕС‚ СЂР°Р±РѕС‡РµРіРѕ РїР°СЂСЃРµСЂР°:

**РњРћР РЅР°СЃС‚СЂРѕР№РєРё (РќР•РџР РђР’РР›Р¬РќР«Р•):**
```python
launch_kwargs = {
    "executable_path": str(chrome_path_obj),  # в†ђ Р›РћРњРђР•Рў РїСЂРѕРєСЃРё!
    "args": [
        "--start-maximized",
        "--no-first-run",
        "--no-default-browser-check",
        "--disable-infobars",
    ],
    "ignore_default_args": ["--enable-automation"],
}
```

**Р РђР‘РћР§РР™ РїР°СЂСЃРµСЂ (turbo_parser_improved.py):**
```python
context = await p.chromium.launch_persistent_context(
    channel="chrome",  # в†ђ Р’РђР–РќРћ: РЅРµ executable_path!
    args=[
        "--start-maximized",
        "--disable-blink-features=AutomationControlled",
        "--disable-features=IsolateOrigins,site-per-process",
        "--disable-site-isolation-trials",
        "--no-first-run",
        "--no-default-browser-check",
    ],
    viewport=None,
    locale=locale,
    user_agent=user_agent,
    timezone_id=timezone_id,
)
```

**РљР»СЋС‡РµРІС‹Рµ СЂР°Р·Р»РёС‡РёСЏ:**
1. вќЊ `executable_path` РІРјРµСЃС‚Рѕ `channel="chrome"` вЂ” СЌС‚Рѕ Р»РѕРјР°РµС‚ РїСЂРѕРєСЃРё РІ Playwright
2. вќЊ РћС‚СЃСѓС‚СЃС‚РІСѓСЋС‚ Р°СЂРіСѓРјРµРЅС‚С‹ `--disable-blink-features=AutomationControlled` Рё `--disable-features=IsolateOrigins,site-per-process`
3. вќЊ РќРµС‚ `viewport=None` РґР»СЏ РїРѕР»РЅРѕСЌРєСЂР°РЅРЅРѕРіРѕ СЂРµР¶РёРјР°
4. вќЊ РќРµС‚ `locale`, `user_agent`, `timezone_id`

### Р РµС€РµРЅРёРµ

РСЃРїСЂР°РІРёР» `services/browser_factory.py` (СЃС‚СЂРѕРєР° 164-183), РїСЂРёРІРµР» РІ СЃРѕРѕС‚РІРµС‚СЃС‚РІРёРµ СЃ СЂР°Р±РѕС‡РёРј РїР°СЂСЃРµСЂРѕРј:

```python
launch_kwargs: Dict[str, Any] = {
    "user_data_dir": str(profile_dir),
    "headless": headless,
    "channel": "chrome",  # Р’РђР–РќРћ: РІСЃРµРіРґР° channel, РЅРµ executable_path!
    "proxy": proxy_kwargs,
    "args": [
        "--start-maximized",
        "--disable-blink-features=AutomationControlled",
        "--disable-features=IsolateOrigins,site-per-process",
        "--disable-site-isolation-trials",
        "--no-first-run",
        "--no-default-browser-check",
        *additional_args,
    ],
    "viewport": None,  # РџРѕР»РЅРѕСЌРєСЂР°РЅРЅС‹Р№ СЂРµР¶РёРј
    "locale": "ru-RU",  # РЇР·С‹Рє Р±СЂР°СѓР·РµСЂР°
}
```

**Р§С‚Рѕ РёР·РјРµРЅРёР»РѕСЃСЊ:**
- вњ… РЈР±СЂР°Р» РїРѕРїС‹С‚РєСѓ РёСЃРїРѕР»СЊР·РѕРІР°С‚СЊ `executable_path`, С‚РµРїРµСЂСЊ РІСЃРµРіРґР° `channel="chrome"`
- вњ… Р”РѕР±Р°РІРёР» РєСЂРёС‚РёС‡РЅС‹Рµ Р°СЂРіСѓРјРµРЅС‚С‹ РґР»СЏ РѕР±С…РѕРґР° РёР·РѕР»СЏС†РёРё: `--disable-blink-features=AutomationControlled`, `--disable-features=IsolateOrigins,site-per-process`
- вњ… Р”РѕР±Р°РІРёР» `viewport=None` РґР»СЏ РєРѕСЂСЂРµРєС‚РЅРѕРіРѕ РѕС‚РѕР±СЂР°Р¶РµРЅРёСЏ
- вњ… Р”РѕР±Р°РІРёР» `locale="ru-RU"`

### РџРµСЂРµР·Р°РїСѓСЃРє backend
- РћСЃС‚Р°РЅРѕРІР»РµРЅ СЃС‚Р°СЂС‹Р№ РїСЂРѕС†РµСЃСЃ (PID 120540)
- Р—Р°РїСѓС‰РµРЅ РЅРѕРІС‹Р№ backend СЃ РёСЃРїСЂР°РІР»РµРЅРЅС‹Рј РєРѕРґРѕРј (PID 136956)

### Р РµР·СѓР»СЊС‚Р°С‚ (РїРѕРїС‹С‚РєР° 1 - РќР• РЎР РђР‘РћРўРђР›Рћ)
Р‘СЂР°СѓР·РµСЂ РѕС‚РєСЂС‹РІР°Р»СЃСЏ, РЅРѕ Р·Р°С‚РµРј РїРѕСЏРІР»СЏР»Р°СЃСЊ РѕС€РёР±РєР° `EPIPE: broken pipe`:
- Playwright С‚СЂРµР±СѓРµС‚, С‡С‚РѕР±С‹ Python РїСЂРѕС†РµСЃСЃ РѕСЃС‚Р°РІР°Р»СЃСЏ Р·Р°РїСѓС‰РµРЅРЅС‹Рј
- РџРѕСЃР»Рµ РІРѕР·РІСЂР°С‚Р° РёР· `for_account()` СЃРІСЏР·СЊ СЂР°Р·СЂС‹РІР°Р»Р°СЃСЊ
- Р‘СЂР°СѓР·РµСЂ С‚РµСЂСЏР» СЃРѕРµРґРёРЅРµРЅРёРµ Рё СЃС‚СЂР°РЅРёС†С‹ РЅРµ Р·Р°РіСЂСѓР¶Р°Р»РёСЃСЊ

---

## 14.11.2025 вЂ” Р¤РёРЅР°Р»СЊРЅРѕРµ РёСЃРїСЂР°РІР»РµРЅРёРµ: РІРѕР·РІСЂР°С‚ Рє ChromeLauncher

### РџСЂРѕР±Р»РµРјР°
РџРѕСЃР»Рµ РїСЂРµРґС‹РґСѓС‰РµРіРѕ РёСЃРїСЂР°РІР»РµРЅРёСЏ Р±СЂР°СѓР·РµСЂ РѕС‚РєСЂС‹РІР°Р»СЃСЏ С‡РµСЂРµР· Playwright, РЅРѕ:
- РџРѕСЏРІР»СЏР»Р°СЃСЊ РѕС€РёР±РєР° `Error: EPIPE: broken pipe, write`
- РЎС‚СЂР°РЅРёС†С‹ РЅРµ Р·Р°РіСЂСѓР¶Р°Р»РёСЃСЊ (Р±РµСЃРєРѕРЅРµС‡РЅР°СЏ Р·Р°РіСЂСѓР·РєР°)
- Р‘СЂР°СѓР·РµСЂ С‚РµСЂСЏР» СЃРІСЏР·СЊ СЃ Python РїСЂРѕС†РµСЃСЃРѕРј

### РџСЂРёС‡РёРЅР°
**Playwright (`sync_playwright()`) С‚СЂРµР±СѓРµС‚ Р°РєС‚РёРІРЅРѕРіРѕ Python РїСЂРѕС†РµСЃСЃР°:**
- РљРѕРЅС‚РµРєСЃС‚ СЃРѕР·РґР°РµС‚СЃСЏ РІ С„СѓРЅРєС†РёРё `for_account()`
- РџРѕСЃР»Рµ `return` РёР· С„СѓРЅРєС†РёРё Python РїСЂРѕС†РµСЃСЃ Р·Р°РІРµСЂС€Р°РµС‚ СЂР°Р±РѕС‚Сѓ
- Playwright РїС‹С‚Р°РµС‚СЃСЏ РѕР±С‰Р°С‚СЊСЃСЏ СЃ СѓР¶Рµ Р·Р°РєСЂС‹С‚С‹Рј РїСЂРѕС†РµСЃСЃРѕРј в†’ EPIPE
- Р‘СЂР°СѓР·РµСЂ РЅРµ РјРѕР¶РµС‚ Р·Р°РіСЂСѓР¶Р°С‚СЊ СЃС‚СЂР°РЅРёС†С‹, С‚.Рє. СЃРІСЏР·СЊ СЂР°Р·РѕСЂРІР°РЅР°

**Р’ СЂР°Р±РѕС‡РµРј РїР°СЂСЃРµСЂРµ** СЌС‚Рѕ СЂР°Р±РѕС‚Р°РµС‚, РїРѕС‚РѕРјСѓ С‡С‚Рѕ РєРѕРЅС‚РµРєСЃС‚ РѕСЃС‚Р°РµС‚СЃСЏ РѕС‚РєСЂС‹С‚С‹Рј Р’РЎРЃ РІСЂРµРјСЏ РїР°СЂСЃРёРЅРіР° (async function).

**Р”Р»СЏ СЂСѓС‡РЅРѕРіРѕ Р·Р°РїСѓСЃРєР°** Р±СЂР°СѓР·РµСЂ РґРѕР»Р¶РµРЅ СЂР°Р±РѕС‚Р°С‚СЊ РќР•Р—РђР’РРЎРРњРћ РѕС‚ Python.

### Р РµС€РµРЅРёРµ

**Р’РµСЂРЅСѓР»СЃСЏ Рє РїСЂСЏРјРѕРјСѓ Р·Р°РїСѓСЃРєСѓ Chrome С‡РµСЂРµР· `ChromeLauncher`:**

1. **РћР±РЅРѕРІРёР» `backend/routers/accounts.py` (СЃС‚СЂРѕРєР° 130-173):**
   - РЈР±СЂР°Р» РёРјРїРѕСЂС‚ `browser_factory`
   - Р’РµСЂРЅСѓР» РїСЂСЏРјРѕР№ РІС‹Р·РѕРІ `ChromeLauncher.launch()`
   - **РќРћ**: РїР°СЂСЃРёРЅРі РїСЂРѕРєСЃРё РѕСЃС‚Р°РІРёР» С‡РµСЂРµР· `proxy_to_playwright()` (РєР°Рє РІ РјСѓР»СЊС‚РёРїР°СЂСЃРµСЂРµ)
   - Р­С‚Рѕ РіР°СЂР°РЅС‚РёСЂСѓРµС‚ РїСЂР°РІРёР»СЊРЅСѓСЋ РѕР±СЂР°Р±РѕС‚РєСѓ РІСЃРµС… С„РѕСЂРјР°С‚РѕРІ РїСЂРѕРєСЃРё

```python
# РџР°СЂСЃРёРј РїСЂРѕРєСЃРё С‡РµСЂРµР· С‚РѕС‚ Р¶Рµ РјРµС…Р°РЅРёР·Рј, С‡С‚Рѕ Рё РјСѓР»СЊС‚РёРїР°СЂСЃРµСЂ
proxy_value = options.proxy_override or account.proxy
if proxy_value:
    cfg = proxy_to_playwright(proxy_value)
    if cfg:
        proxy_server = cfg.get("server")
        proxy_user = cfg.get("username")
        proxy_pass = cfg.get("password")

ChromeLauncher.launch(
    account=account.name,
    profile_path=account.profile_path,
    cdp_port=port,
    proxy_server=proxy_server,
    proxy_username=proxy_user,
    proxy_password=proxy_pass,
    start_url=options.start_url or "https://ya.ru",
)
```

2. **РћР±РЅРѕРІРёР» `services/chrome_launcher.py` (СЃС‚СЂРѕРєР° 187-200):**
   - Р”РѕР±Р°РІРёР» РєСЂРёС‚РёС‡РЅС‹Рµ Р°СЂРіСѓРјРµРЅС‚С‹ РёР· СЂР°Р±РѕС‡РµРіРѕ РїР°СЂСЃРµСЂР°:
     - `--start-maximized`
     - `--disable-features=IsolateOrigins,site-per-process`
     - `--disable-site-isolation-trials`
   - Р­С‚Рё Р°СЂРіСѓРјРµРЅС‚С‹ РЅРµРѕР±С…РѕРґРёРјС‹ РґР»СЏ РїСЂР°РІРёР»СЊРЅРѕР№ СЂР°Р±РѕС‚С‹ СЃ РїСЂРѕРєСЃРё

```python
args = [
    chrome_path,
    f"--user-data-dir={profile_dir.as_posix()}",
    f"--remote-debugging-port={cdp_port}",
    "--start-maximized",
    "--no-first-run",
    "--no-default-browser-check",
    "--disable-background-timer-throttling",
    "--disable-backgrounding-occluded-windows",
    "--disable-renderer-backgrounding",
    "--disable-blink-features=AutomationControlled",
    "--disable-features=IsolateOrigins,site-per-process",
    "--disable-site-isolation-trials",
]
```

3. **ChromeLauncher СѓР¶Рµ СѓРјРµРµС‚:**
   - РЎРѕР·РґР°РІР°С‚СЊ СЂР°СЃС€РёСЂРµРЅРёРµ ProxyAuth РґР»СЏ Р°РІС‚РѕСЂРёР·Р°С†РёРё (manifest v3)
   - РџРµСЂРµРґР°РІР°С‚СЊ РїСЂРѕРєСЃРё С‡РµСЂРµР· `--proxy-server`
   - РЈСЃС‚Р°РЅР°РІР»РёРІР°С‚СЊ `HTTP_PROXY`/`HTTPS_PROXY` env РїРµСЂРµРјРµРЅРЅС‹Рµ
   - Р Р°Р±РѕС‚Р°С‚СЊ РЅРµР·Р°РІРёСЃРёРјРѕ РѕС‚ Python РїСЂРѕС†РµСЃСЃР°

### РџРµСЂРµР·Р°РїСѓСЃРє backend
- РЎС‚Р°СЂС‹Р№ РїСЂРѕС†РµСЃСЃ СЃ Playwright СѓР¶Рµ Р·Р°РІРµСЂС€РёР»СЃСЏ (РѕС€РёР±РєР° EPIPE)
- Р—Р°РїСѓС‰РµРЅ РЅРѕРІС‹Р№ backend СЃ ChromeLauncher (PID 49240)

### Р РµР·СѓР»СЊС‚Р°С‚
РўРµРїРµСЂСЊ Р·Р°РїСѓСЃРє СЂР°Р±РѕС‚Р°РµС‚ РџР РђР’РР›Р¬РќРћ:
- вњ… Р‘СЂР°СѓР·РµСЂ Р·Р°РїСѓСЃРєР°РµС‚СЃСЏ С‡РµСЂРµР· `subprocess.Popen` (РЅРµР·Р°РІРёСЃРёРјРѕ РѕС‚ Python)
- вњ… РџСЂРѕРєСЃРё РїР°СЂСЃРёС‚СЃСЏ С‡РµСЂРµР· `proxy_to_playwright` (РєР°Рє РІ РјСѓР»СЊС‚РёРїР°СЂСЃРµСЂРµ)
- вњ… РђРІС‚РѕСЂРёР·Р°С†РёСЏ РЅР° РїСЂРѕРєСЃРё С‡РµСЂРµР· СЂР°СЃС€РёСЂРµРЅРёРµ ProxyAuth (manifest v3)
- вњ… Р’СЃРµ Р°СЂРіСѓРјРµРЅС‚С‹ Chrome РєР°Рє РІ СЂР°Р±РѕС‡РµРј РїР°СЂСЃРµСЂРµ
- вњ… РЎС‚СЂР°РЅРёС†С‹ Р·Р°РіСЂСѓР¶Р°СЋС‚СЃСЏ РЅРѕСЂРјР°Р»СЊРЅРѕ
- вњ… РќРµС‚ РѕС€РёР±РѕРє EPIPE

**Р¦РµРїРѕС‡РєР°**: UI в†’ backend в†’ `ChromeLauncher.launch()` (subprocess) в†’ Chrome СЃ РїСЂРѕРєСЃРё/РїСЂРѕС„РёР»РµРј/СЂР°СЃС€РёСЂРµРЅРёРµРј

**Р¤Р°Р№Р»С‹**:
- `backend/routers/accounts.py:130-173`
- `services/chrome_launcher.py:187-200`

---

## 14.11.2025 вЂ” Р¤РРќРђР›Р¬РќРћР• СЂРµС€РµРЅРёРµ: LocalAuthProxy РґР»СЏ Р°РІС‚РѕСЂРёР·Р°С†РёРё РЅР° РїСЂРѕРєСЃРё

### РџСЂРѕР±Р»РµРјР°
РџРѕСЃР»Рµ РІРѕР·РІСЂР°С‚Р° Рє ChromeLauncher Р±СЂР°СѓР·РµСЂ СЃРЅРѕРІР° РїРѕРєР°Р·С‹РІР°Р» РѕРєРЅРѕ "Р’РІРµРґРёС‚Рµ РёРјСЏ РїРѕР»СЊР·РѕРІР°С‚РµР»СЏ Рё РїР°СЂРѕР»СЊ" РґР»СЏ РїСЂРѕРєСЃРё.

**РџСЂРёС‡РёРЅР°:** Р Р°СЃС€РёСЂРµРЅРёРµ ProxyAuth (manifest v3) СЃ `webRequestBlocking` РќР• Р РђР‘РћРўРђР•Рў:
- Р’ Chrome manifest v3 Р±Р»РѕРєРёСЂСѓСЋС‰РёРµ webRequest API СѓРґР°Р»РµРЅС‹
- `webRequestAuthProvider` С‚СЂРµР±СѓРµС‚ РґСЂСѓРіРѕР№ СЂРµР°Р»РёР·Р°С†РёРё
- Р Р°СЃС€РёСЂРµРЅРёРµ РЅРµ РјРѕР¶РµС‚ РїРµСЂРµС…РІР°С‚РёС‚СЊ Р·Р°РїСЂРѕСЃ Р°РІС‚РѕСЂРёР·Р°С†РёРё РЅР° РїСЂРѕРєСЃРё

### Р РµС€РµРЅРёРµ

**РСЃРїРѕР»СЊР·РѕРІР°Р» `LocalAuthProxy`** - Р»РѕРєР°Р»СЊРЅС‹Р№ HTTP-РїСЂРѕРєСЃРё СЃРµСЂРІРµСЂ РёР· СЂР°Р±РѕС‡РµРіРѕ РєРѕРґР°:

1. **РЎРєРѕРїРёСЂРѕРІР°Р» `services/local_auth_proxy.py` РёР· keyset:**
   - Р­С‚Рѕ РїСЂРѕСЃС‚РѕР№ asyncio TCP-СЃРµСЂРІРµСЂ
   - РЎР»СѓС€Р°РµС‚ РЅР° `127.0.0.1:СЃР»СѓС‡Р°Р№РЅС‹Р№_РїРѕСЂС‚`
   - РџСЂРёРЅРёРјР°РµС‚ Р·Р°РїСЂРѕСЃС‹ РѕС‚ Chrome Р‘Р•Р— Р°РІС‚РѕСЂРёР·Р°С†РёРё
   - Р”РѕР±Р°РІР»СЏРµС‚ Р·Р°РіРѕР»РѕРІРѕРє `Proxy-Authorization: Basic base64(user:pass)`
   - РџСЂРѕР±СЂР°СЃС‹РІР°РµС‚ Р·Р°РїСЂРѕСЃ Рє СЂРµР°Р»СЊРЅРѕРјСѓ РїСЂРѕРєСЃРё

2. **РћР±РЅРѕРІРёР» `services/chrome_launcher.py`:**
   - Р”РѕР±Р°РІРёР» РёРјРїРѕСЂС‚: `from services.local_auth_proxy import LocalAuthProxy`
   - Р”РѕР±Р°РІРёР» С…СЂР°РЅРёР»РёС‰Рµ: `_local_proxies: Dict[str, LocalAuthProxy] = {}`

   **Р›РѕРіРёРєР° Р·Р°РїСѓСЃРєР° (СЃС‚СЂРѕРєР° 207-240):**
   ```python
   if proxy_username and proxy_password:
       # Р—Р°РїСѓСЃРєР°РµРј Р»РѕРєР°Р»СЊРЅС‹Р№ РїСЂРѕРєСЃРё-СЃРµСЂРІРµСЂ
       local_proxy = LocalAuthProxy(
           remote_host=proxy_host,
           remote_port=proxy_port,
           username=proxy_username,
           password=proxy_password,
       )
       local_port = local_proxy.start()  # РџРѕР»СѓС‡Р°РµРј СЃРІРѕР±РѕРґРЅС‹Р№ РїРѕСЂС‚

       # Chrome РїРѕРґРєР»СЋС‡Р°РµС‚СЃСЏ Рє localhost Р‘Р•Р— Р°РІС‚РѕСЂРёР·Р°С†РёРё
       args.append(f"--proxy-server=http://127.0.0.1:{local_port}")
   ```

   **РћСЃС‚Р°РЅРѕРІРєР° (СЃС‚СЂРѕРєР° 170-177):**
   ```python
   local_proxy = cls._local_proxies.pop(account, None)
   if local_proxy:
       local_proxy.stop()
   ```

3. **РЈРґР°Р»РёР» РЅРµСЂР°Р±РѕС‚Р°СЋС‰РµРµ СЂР°СЃС€РёСЂРµРЅРёРµ ProxyAuth:**
   - РЈР±СЂР°Р» `_create_proxy_extension`
   - РЈР±СЂР°Р» `_cleanup_proxy_extensions`
   - РЈР±СЂР°Р» `--load-extension` Рё `--disable-extensions-except`

### РљР°Рє СЌС‚Рѕ СЂР°Р±РѕС‚Р°РµС‚:

```
Chrome в†’ http://127.0.0.1:12345 (Р»РѕРєР°Р»СЊРЅС‹Р№ РїСЂРѕРєСЃРё, Р‘Р•Р— Р°РІС‚РѕСЂРёР·Р°С†РёРё)
         в†“
LocalAuthProxy в†’ РґРѕР±Р°РІР»СЏРµС‚ Proxy-Authorization
         в†“
http://user:pass@real-proxy:8000 (СЂРµР°Р»СЊРЅС‹Р№ РїСЂРѕРєСЃРё)
         в†“
РРЅС‚РµСЂРЅРµС‚
```

**Chrome РЅРµ РІРёРґРёС‚ Р°РІС‚РѕСЂРёР·Р°С†РёСЋ** в†’ РѕРєРЅРѕ Р»РѕРіРёРЅР°/РїР°СЂРѕР»СЏ РќР• РїРѕСЏРІР»СЏРµС‚СЃСЏ!

### РџРµСЂРµР·Р°РїСѓСЃРє backend
- РћСЃС‚Р°РЅРѕРІР»РµРЅС‹ СЃС‚Р°СЂС‹Рµ РїСЂРѕС†РµСЃСЃС‹
- Р—Р°РїСѓС‰РµРЅ РЅРѕРІС‹Р№ backend СЃ LocalAuthProxy (PID 88048)

### Р РµР·СѓР»СЊС‚Р°С‚
РўРµРїРµСЂСЊ Р·Р°РїСѓСЃРє Р±СЂР°СѓР·РµСЂР° СЂР°Р±РѕС‚Р°РµС‚ Р‘Р•Р— РѕРєРЅР° Р°РІС‚РѕСЂРёР·Р°С†РёРё:
- вњ… Р‘СЂР°СѓР·РµСЂ Р·Р°РїСѓСЃРєР°РµС‚СЃСЏ С‡РµСЂРµР· `subprocess.Popen`
- вњ… РџСЂРѕРєСЃРё РїР°СЂСЃРёС‚СЃСЏ С‡РµСЂРµР· `proxy_to_playwright` (РµРґРёРЅР°СЏ Р»РѕРіРёРєР° СЃ РјСѓР»СЊС‚РёРїР°СЂСЃРµСЂРѕРј)
- вњ… РђРІС‚РѕСЂРёР·Р°С†РёСЏ РЅР° РїСЂРѕРєСЃРё С‡РµСЂРµР· **LocalAuthProxy** (РєР°Рє РІ СЂР°Р±РѕС‡РµРј РїР°СЂСЃРµСЂРµ)
- вњ… РћРєРЅРѕ "Р’РІРµРґРёС‚Рµ Р»РѕРіРёРЅ/РїР°СЂРѕР»СЊ" РќР• РџРћРЇР’Р›РЇР•РўРЎРЇ
- вњ… РЎС‚СЂР°РЅРёС†С‹ Р·Р°РіСЂСѓР¶Р°СЋС‚СЃСЏ РЅРѕСЂРјР°Р»СЊРЅРѕ
- вњ… Р’СЃРµ Р°СЂРіСѓРјРµРЅС‚С‹ Chrome РєР°Рє РІ СЂР°Р±РѕС‡РµРј РїР°СЂСЃРµСЂРµ

**Р¦РµРїРѕС‡РєР°**: UI в†’ backend в†’ ChromeLauncher в†’ LocalAuthProxy в†’ Chrome в†’ СЂРµР°Р»СЊРЅС‹Р№ РїСЂРѕРєСЃРё СЃ Р°РІС‚РѕСЂРёР·Р°С†РёРµР№

**Р¤Р°Р№Р»С‹**:
- `services/local_auth_proxy.py` (СЃРєРѕРїРёСЂРѕРІР°РЅ РёР· keyset)
- `services/chrome_launcher.py:207-240` (Р·Р°РїСѓСЃРє LocalAuthProxy)
- `services/chrome_launcher.py:170-177` (РѕСЃС‚Р°РЅРѕРІРєР° LocalAuthProxy)  

---

## РћР±РЅРѕРІР»РµРЅРёРµ 2025вЂ‘11вЂ‘14: Р·Р°РїСѓСЃРє Р°РєРєР°СѓРЅС‚РѕРІ С‡РµСЂРµР· Playwright Рё fingerprint

### 1. РџРѕРїС‹С‚РєР° РїРµСЂРµРІРµСЃС‚Рё Р·Р°РїСѓСЃРє РђРєРєР°СѓРЅС‚РѕРІ РЅР° Playwright (РћРўРљРђРў)

- РџСЂРѕР±РѕРІР°Р» РІР°СЂРёР°РЅС‚, РіРґРµ `POST /api/accounts/{id}/launch` РІС‹Р·С‹РІР°Р» `services.browser_factory.for_account(...)` (Playwright persistent context СЃ proxy+fingerprint, РєР°Рє РІ РїР°СЂСЃРµСЂРµ).
- Р’ `services/browser_factory.for_account(...)` РїРѕРґРєР»СЋС‡Р°Р» fingerprint-РїСЂРµСЃРµС‚С‹ РёР· `Account.notes` Рё `LocalAuthProxy` РґР»СЏ HTTPвЂ‘РїСЂРѕРєСЃРё СЃ Р»РѕРіРёРЅРѕРј/РїР°СЂРѕР»РµРј, С‡С‚РѕР±С‹ Р°РІС‚РѕСЂРёР·Р°С†РёСЏ С€Р»Р° С‡РµСЂРµР· Р»РѕРєР°Р»СЊРЅС‹Р№ РїСЂРѕРєСЃРё, Р° Playwright РІРёРґРµР» С‚РѕР»СЊРєРѕ `http://127.0.0.1:<РїРѕСЂС‚>`.
- РќР° РїСЂР°РєС‚РёРєРµ РїСЂРё РІС‹Р·РѕРІРµ РёР· backend (FastAPI) СЌС‚Рѕ РґР°Р»Рѕ РЅРµСЃС‚Р°Р±РёР»СЊРЅРѕРµ РїРѕРІРµРґРµРЅРёРµ:
  - РѕС€РёР±РєР° РІРёРґР° *вЂњFailed to launch browser: It looks like you are using Playwright Sync API inside the asyncio loop. Please use the Async API insteadвЂќ* РїСЂРё Р·Р°РїСѓСЃРєРµ РёР· РІРєР»Р°РґРєРё В«РђРєРєР°СѓРЅС‚С‹В»;
  - РёРЅРѕРіРґР° СЃР°Р№С‚С‹ (РІ С‚РѕРј С‡РёСЃР»Рµ `https://ya.ru/`) РѕС‚РґР°РІР°Р»Рё `ERR_CONNECTION_ABORTED`, С…РѕС‚СЏ РїР°СЂСЃРµСЂ СЃ С‚РµРјРё Р¶Рµ РїСЂРѕРєСЃРё СЂР°Р±РѕС‚Р°Р».
- Р’ РёС‚РѕРіРµ СЌС‚РѕС‚ РІР°СЂРёР°РЅС‚ **РґР»СЏ РєРЅРѕРїРєРё Play РІ РђРєРєР°СѓРЅС‚Р°С… РѕС‚РєР°С‚РёР»**: РѕСЃС‚Р°РІРёР» Playwright+LocalAuthProxy РІРЅСѓС‚СЂРё РїР°СЂСЃРµСЂР°/СЃР»СѓР¶РµР±РЅС‹С… РјРѕРґСѓР»РµР№, Р° СЂСѓС‡РЅРѕР№ Р·Р°РїСѓСЃРє Р°РєРєР°СѓРЅС‚РѕРІ РІРµСЂРЅСѓР» РЅР° РїСЂСЏРјРѕР№ ChromeLauncher.

### 2. РўРµРєСѓС‰РµРµ СЃРѕСЃС‚РѕСЏРЅРёРµ: Р·Р°РїСѓСЃРє РђРєРєР°СѓРЅС‚РѕРІ С‡РµСЂРµР· ChromeLauncher (СЃ proxy+fingerprint РєР°Рє РІ AiChrome)

- Р’ `KeySet-MVP/backend/routers/accounts.py` СЌРЅРґРїРѕРёРЅС‚ `POST /api/accounts/{id}/launch`:
  - С‡РёС‚Р°РµС‚ `Account` РёР· Р‘Р” С‡РµСЂРµР· `services.accounts.get_account`;
  - РїРѕ `Account.notes.fingerprint` РІС‹Р·С‹РІР°РµС‚ `_extract_fingerprint` Рё `_resolve_fingerprint` РёР· `services.browser_factory`, С‡С‚РѕР±С‹ РїРѕР»СѓС‡РёС‚СЊ `(user_agent, locale, timezone_id)` **РїРѕ С‚РµРј Р¶Рµ РїСЂРµСЃРµС‚Р°Рј**, С‡С‚Рѕ Рё РІ TurboParser (`russia_standard`, `kazakhstan_standard`, `no_spoofing`);
  - РІС‹Р±РёСЂР°РµС‚ CDPвЂ‘РїРѕСЂС‚ С‡РµСЂРµР· `_pick_port` (РµСЃР»Рё РЅР°РґРѕ);
  - РїР°СЂСЃРёС‚ СЃС‚СЂРѕРєСѓ РїСЂРѕРєСЃРё (СЃ СѓС‡С‘С‚РѕРј `proxy_override`) С‡РµСЂРµР· `utils.proxy.proxy_to_playwright`, С‡С‚РѕР±С‹ РїРѕР»СѓС‡РёС‚СЊ `server/username/password`;
  - РІС‹Р·С‹РІР°РµС‚ `ChromeLauncher.launch(account=..., profile_path=..., cdp_port=..., proxy_server=..., proxy_username=..., proxy_password=..., start_url=..., user_agent=..., locale=..., timezone_id=...)`.
- Р’ `KeySet-MVP/services/chrome_launcher.py`:
  - `launch(...)` РїСЂРёРЅРёРјР°РµС‚ РґРѕРїРѕР»РЅРёС‚РµР»СЊРЅС‹Рµ РїР°СЂР°РјРµС‚СЂС‹ `user_agent`, `locale`, `timezone_id`, `force_webrtc_proxy`;
  - РЅР° РёС… РѕСЃРЅРѕРІРµ С„РѕСЂРјРёСЂСѓСЋС‚СЃСЏ Р°СЂРіСѓРјРµРЅС‚С‹ Chrome:
    - `--lang=<locale>` (РЅР°РїСЂРёРјРµСЂ, `ru-RU`);
    - `--user-agent=<user_agent>` (РµСЃР»Рё Р·Р°РґР°РЅ);
    - РїРµСЂРµРјРµРЅРЅР°СЏ РѕРєСЂСѓР¶РµРЅРёСЏ `TZ=timezone_id` (РґР»СЏ РєРѕСЂСЂРµРєС‚РЅРѕРіРѕ РІСЂРµРјРµРЅРё РІ JS Рё CDPвЂ‘РѕРІРµСЂСЂР°Р№РґР°С…);
  - РґРѕР±Р°РІР»РµРЅС‹ `_build_accept_language(...)` Рё `_apply_profile_preferences(...)` РїРѕ РѕР±СЂР°Р·С†Сѓ AiChrome:
    - Accept-Language Р·Р°РїРёСЃС‹РІР°РµС‚СЃСЏ РІ `Default/Preferences` (`intl.accept_languages`);
    - WebRTC РїСЂРёРЅСѓРґРёС‚РµР»СЊРЅРѕ РїРµСЂРµРІРѕРґРёС‚СЃСЏ РІ `disable_non_proxied_udp`, РѕС‚РєР»СЋС‡Р°СЏ СѓС‚РµС‡РєРё IP РїРѕ UDP;
    - РІС‹РєР»СЋС‡РµРЅС‹ РІСЃС‚СЂРѕРµРЅРЅС‹Р№ РјРµРЅРµРґР¶РµСЂ РїР°СЂРѕР»РµР№ Рё РІСЃРїР»С‹РІР°СЋС‰РёРµ Р·Р°РїСЂРѕСЃС‹ РіРµРѕР»РѕРєР°С†РёРё.
  - РІРјРµСЃС‚Рѕ СЃС‚Р°СЂРѕРіРѕ ProxyAuthвЂ‘СЂР°СЃС€РёСЂРµРЅРёСЏ РґР»СЏ HTTP(S)вЂ‘РїСЂРѕРєСЃРё СЃ Р»РѕРіРёРЅРѕРј/РїР°СЂРѕР»РµРј РёСЃРїРѕР»СЊР·СѓРµС‚СЃСЏ `LocalAuthProxy`:
    - СЂРµР°Р»СЊРЅС‹Р№ РїСЂРѕРєСЃРё (`scheme://host:port`, `username`, `password`) РїРµСЂРµРґР°С‘С‚СЃСЏ РІ `LocalAuthProxy`, РєРѕС‚РѕСЂС‹Р№ РїРѕРґРЅРёРјР°РµС‚ Р»РѕРєР°Р»СЊРЅС‹Р№ HTTPвЂ‘РїСЂРѕРєСЃРё `http://127.0.0.1:<РїРѕСЂС‚>` Рё СЃР°Рј РґРѕР±Р°РІР»СЏРµС‚ `Proxy-Authorization` РїСЂРё `CONNECT`/HTTPвЂ‘Р·Р°РїСЂРѕСЃР°С…;
    - РІ Chrome РїСЂРѕРєРёРґС‹РІР°РµС‚СЃСЏ `--proxy-server=http://127.0.0.1:<РїРѕСЂС‚>`, Р° `HTTP_PROXY/HTTPS_PROXY` СѓРєР°Р·С‹РІР°СЋС‚ РЅР° СЌС‚РѕС‚ Р»РѕРєР°Р»СЊРЅС‹Р№ РїСЂРѕРєСЃРё;
    - Chrome Р±РѕР»СЊС€Рµ РЅРµ РІРёРґРёС‚ Р»РѕРіРёРЅ/РїР°СЂРѕР»СЊ РїСЂРѕРєСЃРё Рё РЅРµ РїРѕРєР°Р·С‹РІР°РµС‚ РѕРєРЅРѕ Р°РІС‚РѕСЂРёР·Р°С†РёРё.
  - `ChromeLauncher._processes` С…СЂР°РЅРёС‚ РєСЂРѕРјРµ `proc` РµС‰С‘ Рё `local_proxy`; РїСЂРё Р·Р°РІРµСЂС€РµРЅРёРё РїСЂРѕС†РµСЃСЃР° (С‡РµСЂРµР· `_terminate_existing` РёР»Рё С„РѕРЅРѕРІРѕРіРѕ watcherвЂ‘РїРѕС‚РѕРєР°) РІС‹Р·С‹РІР°РµС‚СЃСЏ `local_proxy.stop()`, С‡С‚РѕР±С‹ Р°РєРєСѓСЂР°С‚РЅРѕ РѕСЃС‚Р°РЅРѕРІРёС‚СЊ Р»РѕРєР°Р»СЊРЅС‹Р№ РїСЂРѕРєСЃРё.

**РС‚РѕРі РґР»СЏ РєРЅРѕРїРєРё Play РІ В«РђРєРєР°СѓРЅС‚Р°С…В»:**
- РёСЃРїРѕР»СЊР·СѓРµС‚СЃСЏ С‚РѕС‚ Р¶Рµ РїСЂРѕС„РёР»СЊ, С‡С‚Рѕ РІС‹Р±СЂР°РЅ РІ РїСЂР°РІРѕР№ РїР°РЅРµР»Рё;
- РїСЂРёРјРµРЅСЏСЋС‚СЃСЏ С‚Рµ Р¶Рµ fingerprintвЂ‘РїСЂРµСЃРµС‚С‹ (UA/СЏР·С‹Рє/С‚Р°Р№РјР·РѕРЅР°), С‡С‚Рѕ Рё РІ СЂР°Р±РѕС‡РµРј РїР°СЂСЃРµСЂРµ/Р°РЅС‚РёРґРµС‚РµРєС‚Рµ;
- HTTPвЂ‘РїСЂРѕРєСЃРё СЃ Р°РІС‚РѕСЂРёР·Р°С†РёРµР№ РёРґСѓС‚ С‡РµСЂРµР· `LocalAuthProxy` (Р°РЅР°Р»РѕРі pproxyвЂ‘wrapper РёР· AiChrome), РїРѕСЌС‚РѕРјСѓ РѕРєРЅРѕ Р»РѕРіРёРЅР°/РїР°СЂРѕР»СЏ РЅРµ РїРѕСЏРІР»СЏРµС‚СЃСЏ, Р° СЃР°Р№С‚С‹ РіСЂСѓР·СЏС‚СЃСЏ СЃ РЅСѓР¶РЅС‹Рј IP Рё Р·Р°РіРѕР»РѕРІРєР°РјРё.

### РћР±РЅРѕРІР»РµРЅРёРµ 2025вЂ‘11вЂ‘14 (СЃРёРЅС…СЂРѕРЅРёР·Р°С†РёСЏ СЃ legacy keyset-desktop)

- РџРѕ С‚СЂРµР±РѕРІР°РЅРёСЋ Р·Р°РєР°Р·С‡РёРєР° РІРµСЂРЅСѓР» РѕСЂРёРіРёРЅР°Р»СЊРЅСѓСЋ СЂРµР°Р»РёР·Р°С†РёСЋ `ChromeLauncher` РёР· `keyset-desktop.zip`: Р°РІС‚РѕСЂРёР·Р°С†РёСЏ РЅР° РїСЂРѕРєСЃРё СЃРЅРѕРІР° РІС‹РїРѕР»РЅСЏРµС‚СЃСЏ С‡РµСЂРµР· РІСЂРµРјРµРЅРЅРѕРµ Manifest v3 СЂР°СЃС€РёСЂРµРЅРёРµ (`services/chrome_launcher.py`), LocalAuthProxy РІС‹РєР»СЋС‡РµРЅ.
- Р’ `backend/routers/accounts.py` СѓР±СЂР°РЅС‹ РЅРµРёСЃРїРѕР»СЊР·СѓРµРјС‹Рµ РїР°СЂР°РјРµС‚СЂС‹ fingerprint вЂ” `ChromeLauncher.launch(...)` С‚РµРїРµСЂСЊ РІС‹Р·С‹РІР°РµС‚СЃСЏ СЃС‚СЂРѕРіРѕ СЃ С‚РµРјРё Р°СЂРіСѓРјРµРЅС‚Р°РјРё, С‡С‚Рѕ Рё РІ СЂР°Р±РѕС‡РµРј keyset-desktop.
- РџСЂРѕРІРµСЂРєР°: РїРѕРґРЅСЏР» backend РєРѕРјР°РЅРґРѕР№ `python -m uvicorn backend.main:app --host 127.0.0.1 --port 8765`, РІС‹Р·РІР°Р» `POST /api/accounts/2/launch` вЂ” РїРѕР»СѓС‡РёР» `{"status":"ok","account_id":2,"cdp_port":57814}`, Р±СЂР°СѓР·РµСЂ Р·Р°РїСѓСЃРєР°РµС‚СЃСЏ РїРѕ СЃС‚Р°СЂРѕР№ СЃС…РµРјРµ.

### 2. РњРµР»РєРёРµ РёСЃРїСЂР°РІР»РµРЅРёСЏ

- Р’ `backend/routers/accounts.py` РґРѕР±Р°РІР»РµРЅ СЏРІРЅС‹Р№ РёРјРїРѕСЂС‚ `ChromeLauncher` РґР»СЏ РјР°СЂС€СЂСѓС‚Р° Р·Р°РіСЂСѓР·РєРё cookies (`/api/accounts/{id}/cookies`), РєРѕС‚РѕСЂС‹Р№ РёСЃРїРѕР»СЊР·СѓРµС‚ `ChromeLauncher._normalise_profile_path` РґР»СЏ СЃРѕС…СЂР°РЅРµРЅРёСЏ `storage_state.json`/`cookies.json` СЂСЏРґРѕРј СЃ РїСЂРѕС„РёР»РµРј Р°РєРєР°СѓРЅС‚Р°.
