# РћС‚С‡РµС‚: РЎР±РѕСЂРєР° KeySet-MVP РІ .exe СЃ РїРѕРјРѕС‰СЊСЋ PyInstaller

**Р”Р°С‚Р°:** 11 РЅРѕСЏР±СЂСЏ 2025
**РџСЂРѕРµРєС‚:** KeySet-MVP
**Р—Р°РґР°С‡Р°:** РЈРїР°РєРѕРІРєР° React + FastAPI РїСЂРёР»РѕР¶РµРЅРёСЏ РІ РµРґРёРЅС‹Р№ РёСЃРїРѕР»РЅСЏРµРјС‹Р№ С„Р°Р№Р»
**Р РµР·СѓР»СЊС‚Р°С‚:** РЈСЃРїРµС€РЅРѕ СЃРѕР±СЂР°РЅ KeySet.exe (94 MB) СЃ Edge --app СЂРµР¶РёРјРѕРј

---

## 1. РСЃС…РѕРґРЅР°СЏ Р·Р°РґР°С‡Р°

### 1.1 РўСЂРµР±РѕРІР°РЅРёСЏ РёР· РїР°РјСЏС‚РєРё
Р—Р°РґР°С‡Р° Р±С‹Р»Р° РїРѕР»СѓС‡РµРЅР° РёР· РґРѕРєСѓРјРµРЅС‚РѕРІ:
- `C:\AI\yandex\Р±Рґ\РёРЅСЃС‚СЂСѓРєС†РёРё\РђСЂС…РёС‚РµРєС‚СѓСЂР°\Р—Р°РґР°С‡Рё\РќРѕРІРѕРµ\ARCHITECTURE` - Р°СЂС…РёС‚РµРєС‚СѓСЂР° РїСЂРѕРµРєС‚Р°
- `C:\AI\yandex\Р±Рґ\РёРЅСЃС‚СЂСѓРєС†РёРё\РђСЂС…РёС‚РµРєС‚СѓСЂР°\Р—Р°РґР°С‡Рё\РќРѕРІРѕРµ\Р·Р°РіСЂСѓР·РєР° СЃРѕС„С‚Р°\Р·Р°РґР°С‡Р°` - РѕРїРёСЃР°РЅРёРµ Р·Р°РґР°С‡Рё СѓРїР°РєРѕРІРєРё
- `C:\AI\yandex\Р±Рґ\РёРЅСЃС‚СЂСѓРєС†РёРё\РђСЂС…РёС‚РµРєС‚СѓСЂР°\Р—Р°РґР°С‡Рё\РќРѕРІРѕРµ\РџРђРњРЇРўРљРђ_Codex.md` - СЂСѓРєРѕРІРѕРґСЃС‚РІРѕ РїРѕ СЂР°Р·СЂР°Р±РѕС‚РєРµ

### 1.2 РћСЃРЅРѕРІРЅС‹Рµ С‚СЂРµР±РѕРІР°РЅРёСЏ
1. **РћРґРёРЅ РёСЃРїРѕР»РЅСЏРµРјС‹Р№ С„Р°Р№Р»** - СѓРїР°РєРѕРІР°С‚СЊ РІСЃС‘ РІ РѕРґРёРЅ .exe С„Р°Р№Р»
2. **Р‘С‹СЃС‚СЂС‹Р№ Р·Р°РїСѓСЃРє** - РјРёРЅРёРјРёР·РёСЂРѕРІР°С‚СЊ РІСЂРµРјСЏ СЃС‚Р°СЂС‚Р° РїСЂРёР»РѕР¶РµРЅРёСЏ
3. **Standalone РїСЂРёР»РѕР¶РµРЅРёРµ** - РѕРєРЅРѕ Р‘Р•Р— Р°РґСЂРµСЃРЅРѕР№ СЃС‚СЂРѕРєРё Р±СЂР°СѓР·РµСЂР°
4. **РќР°С‚РёРІРЅС‹Р№ РІРёРґ** - РІС‹РіР»СЏРґРµС‚СЊ РєР°Рє РѕР±С‹С‡РЅРѕРµ РґРµСЃРєС‚РѕРїРЅРѕРµ РїСЂРёР»РѕР¶РµРЅРёРµ, Р° РЅРµ Р±СЂР°СѓР·РµСЂ
5. **UTF-8 РєРѕРґРёСЂРѕРІРєР°** - РІСЃРµ С„Р°Р№Р»С‹ РґРѕР»Р¶РЅС‹ Р±С‹С‚СЊ РІ UTF-8
6. **Edge --app СЂРµР¶РёРј** - РћРЎРќРћР’РќРћР• СЂРµС€РµРЅРёРµ (РЅРµ PySide6, РєРѕС‚РѕСЂС‹Р№ Р±С‹Р» Plan B)

### 1.3 РђСЂС…РёС‚РµРєС‚СѓСЂР° РїСЂРёР»РѕР¶РµРЅРёСЏ
```
KeySet-MVP/
в”њв”Ђв”Ђ frontend/              # React РїСЂРёР»РѕР¶РµРЅРёРµ
в”‚   в”њв”Ђв”Ђ src/              # РСЃС…РѕРґРЅРёРєРё React
в”‚   в””в”Ђв”Ђ dist/             # РЎРѕР±СЂР°РЅРЅС‹Р№ frontend (Vite)
в”њв”Ђв”Ђ backend/              # FastAPI Р±СЌРєРµРЅРґ
в”‚   в”њв”Ђв”Ђ main.py          # РўРѕС‡РєР° РІС…РѕРґР° API + StaticFiles
в”‚   в””в”Ђв”Ђ ...
в”њв”Ђв”Ђ keyset/              # РћСЃРЅРѕРІРЅРѕР№ РїР°РєРµС‚ СЃ Р±РёР·РЅРµСЃ-Р»РѕРіРёРєРѕР№
в”‚   в”њв”Ђв”Ђ core/
в”‚   в”‚   в””в”Ђв”Ђ db.py       # Р Р°Р±РѕС‚Р° СЃ SQLite
в”‚   в””в”Ђв”Ђ webview_app/    # WebView РІРµСЂСЃРёСЏ (РќР• РёСЃРїРѕР»СЊР·СѓРµС‚СЃСЏ РІ .exe)
в”њв”Ђв”Ђ launcher.py          # Р“Р»Р°РІРЅР°СЏ С‚РѕС‡РєР° РІС…РѕРґР°
в””в”Ђв”Ђ build/
    в””в”Ђв”Ђ keyset.spec     # РљРѕРЅС„РёРіСѓСЂР°С†РёСЏ PyInstaller
```

---

## 2. РђСЂС…РёС‚РµРєС‚СѓСЂР° СЂРµС€РµРЅРёСЏ

### 2.1 РљРѕРЅС†РµРїС†РёСЏ
РџСЂРёР»РѕР¶РµРЅРёРµ СЃРѕСЃС‚РѕРёС‚ РёР· С‚СЂРµС… СЃР»РѕРµРІ:
1. **Backend (FastAPI)** - Р·Р°РїСѓСЃРєР°РµС‚СЃСЏ РІ РѕС‚РґРµР»СЊРЅРѕРј РїРѕС‚РѕРєРµ РІРЅСѓС‚СЂРё РїСЂРѕС†РµСЃСЃР°
2. **Frontend (React)** - СЃС‚Р°С‚РёС‡РµСЃРєРёРµ С„Р°Р№Р»С‹, СЃРіРµРЅРµСЂРёСЂРѕРІР°РЅРЅС‹Рµ Vite
3. **UI Layer (Edge --app)** - Р±СЂР°СѓР·РµСЂРЅРѕРµ РѕРєРЅРѕ Р±РµР· chrome/Р°РґСЂРµСЃРЅРѕР№ СЃС‚СЂРѕРєРё

### 2.2 РџРѕС‚РѕРє Р·Р°РїСѓСЃРєР°
```
KeySet.exe Р·Р°РїСѓС‰РµРЅ
    в†“
launcher.py в†’ main()
    в†“
1. Р’С‹Р±РѕСЂ СЃРІРѕР±РѕРґРЅРѕРіРѕ РїРѕСЂС‚Р° (pick_free_port)
    в†“
2. Р—Р°РїСѓСЃРє backend РІ daemon РїРѕС‚РѕРєРµ
    в†“
3. РћР¶РёРґР°РЅРёРµ /api/health (wait_for_backend)
    в†“
4. Р—Р°РїСѓСЃРє Edge РІ --app СЂРµР¶РёРјРµ
    в†“
5. РћР¶РёРґР°РЅРёРµ Р·Р°РєСЂС‹С‚РёСЏ РѕРєРЅР° Edge
    в†“
Р—Р°РІРµСЂС€РµРЅРёРµ KeySet.exe
```

### 2.3 РљР»СЋС‡РµРІС‹Рµ С‚РµС…РЅРёС‡РµСЃРєРёРµ СЂРµС€РµРЅРёСЏ

#### Backend Р·Р°РїСѓСЃРє РІРЅСѓС‚СЂРё РїСЂРѕС†РµСЃСЃР°
```python
def run_backend(port: int) -> None:
    """Start FastAPI backend inside the current process."""
    config = Config(
        "backend.main:app",
        host=BACKEND_HOST,
        port=port,
        reload=False,
        log_level="info",
    )
    Server(config).run()

# Р—Р°РїСѓСЃРє РІ daemon РїРѕС‚РѕРєРµ
backend_thread = threading.Thread(
    target=run_backend,
    args=(port,),
    daemon=True,
    name="backend"
)
backend_thread.start()
```

**РџСЂРµРёРјСѓС‰РµСЃС‚РІР°:**
- РќРµС‚ РѕС‚РґРµР»СЊРЅРѕРіРѕ РїСЂРѕС†РµСЃСЃР° - РІСЃС‘ РІ РѕРґРЅРѕРј .exe
- Daemon РїРѕС‚РѕРє Р°РІС‚РѕРјР°С‚РёС‡РµСЃРєРё Р·Р°РІРµСЂС€Р°РµС‚СЃСЏ СЃ РѕСЃРЅРѕРІРЅС‹Рј РїСЂРѕС†РµСЃСЃРѕРј
- Р”РёРЅР°РјРёС‡РµСЃРєРёР№ РІС‹Р±РѕСЂ РїРѕСЂС‚Р° РёР·Р±РµРіР°РµС‚ РєРѕРЅС„Р»РёРєС‚РѕРІ

#### Р”РёРЅР°РјРёС‡РµСЃРєРёР№ РІС‹Р±РѕСЂ РїРѕСЂС‚Р°
```python
def pick_free_port() -> int:
    """Reserve a random ephemeral port for the backend."""
    with socket.socket(socket.AF_INET, socket.SOCK_STREAM) as sock:
        sock.bind((BACKEND_HOST, 0))
        return sock.getsockname()[1]
```

**Р—Р°С‡РµРј:** РР·Р±РµРіР°РµРј РєРѕРЅС„Р»РёРєС‚РѕРІ РµСЃР»Рё Р·Р°РїСѓС‰РµРЅРѕ РЅРµСЃРєРѕР»СЊРєРѕ РєРѕРїРёР№ РїСЂРёР»РѕР¶РµРЅРёСЏ.

#### Health check endpoint
```python
def wait_for_backend(base_url: str, timeout: float = 20.0) -> bool:
    """Poll /api/health until backend reports readiness."""
    deadline = time.monotonic() + timeout
    health_url = f"{base_url}{HEALTH_PATH}"

    while time.monotonic() < deadline:
        try:
            with urllib.request.urlopen(health_url, timeout=1) as response:
                if response.status == 200:
                    return True
        except (urllib.error.URLError, socket.timeout, TimeoutError):
            time.sleep(HEALTH_POLL_INTERVAL)
    return False
```

**Р—Р°С‡РµРј:** Р“Р°СЂР°РЅС‚РёСЂСѓРµРј, С‡С‚Рѕ backend РїРѕР»РЅРѕСЃС‚СЊСЋ Р·Р°РїСѓС‰РµРЅ РїРµСЂРµРґ РѕС‚РєСЂС‹С‚РёРµРј UI.

#### Edge --app mode
```python
def launch_browser(url: str) -> subprocess.Popen | None:
    """Start Edge/Chrome in app mode (standalone window)."""
    import tempfile
    user_data = Path(tempfile.gettempdir()) / "KeySet_EdgeData"
    user_data.mkdir(exist_ok=True)

    # РџРѕР»РЅС‹Рµ РїСѓС‚Рё Рє Р±СЂР°СѓР·РµСЂР°Рј РЅР° Windows
    edge_paths = [
        r"C:\Program Files (x86)\Microsoft\Edge\Application\msedge.exe",
        r"C:\Program Files\Microsoft\Edge\Application\msedge.exe",
    ]

    candidates: list[tuple[str, str, str]] = []
    for edge_path in edge_paths:
        if Path(edge_path).exists():
            candidates.append((
                edge_path,
                f"--app={url}",
                f"--user-data-dir={user_data}"
            ))
            break

    for cmd in candidates:
        proc = subprocess.Popen(list(cmd))
        time.sleep(0.5)
        if proc.poll() is None:  # РџСЂРѕС†РµСЃСЃ Р¶РёРІ
            return proc

    # Fallback РЅР° РѕР±С‹С‡РЅС‹Р№ Р±СЂР°СѓР·РµСЂ
    webbrowser.open(url)
    return None
```

**РљР»СЋС‡РµРІС‹Рµ РїР°СЂР°РјРµС‚СЂС‹:**
- `--app={url}` - СѓР±РёСЂР°РµС‚ Р°РґСЂРµСЃРЅСѓСЋ СЃС‚СЂРѕРєСѓ, СЃРѕР·РґР°РµС‚ standalone window
- `--user-data-dir={temp_dir}` - РёР·РѕР»РёСЂРѕРІР°РЅРЅС‹Р№ РїСЂРѕС„РёР»СЊ Р±СЂР°СѓР·РµСЂР°
- РџСЂРѕРІРµСЂРєР° `proc.poll() is None` - СѓР±РµР¶РґР°РµРјСЃСЏ С‡С‚Рѕ РїСЂРѕС†РµСЃСЃ РЅРµ Р·Р°РІРµСЂС€РёР»СЃСЏ СЃСЂР°Р·Сѓ

---

## 3. РџСЂРѕС†РµСЃСЃ РЅР°СЃС‚СЂРѕР№РєРё PyInstaller

### 3.1 РЈСЃС‚Р°РЅРѕРІРєР° PyInstaller
```bash
cd C:\AI\yandex\KeySet-MVP
.venv\Scripts\python.exe -m pip install pyinstaller
```

### 3.2 РЎРѕР·РґР°РЅРёРµ РєРѕРЅС„РёРіСѓСЂР°С†РёРѕРЅРЅРѕРіРѕ С„Р°Р№Р»Р° keyset.spec

Р Р°СЃРїРѕР»РѕР¶РµРЅРёРµ: `C:\AI\yandex\KeySet-MVP\build\keyset.spec`

#### РћСЃРЅРѕРІРЅР°СЏ СЃС‚СЂСѓРєС‚СѓСЂР°
```python
# -*- mode: python ; coding: utf-8 -*-

from pathlib import Path

block_cipher = None

_spec_file = globals().get("__file__")
if _spec_file:
    PROJECT_ROOT = Path(_spec_file).resolve().parent.parent
else:
    PROJECT_ROOT = Path.cwd()
```

#### Р¤СѓРЅРєС†РёСЏ СЃР±РѕСЂР° keyset РїР°РєРµС‚Р°
РџСЂРѕР±Р»РµРјР°: РќСѓР¶РЅРѕ РІРєР»СЋС‡РёС‚СЊ `keyset/` РїР°РєРµС‚, РЅРѕ РРЎРљР›Р®Р§РРўР¬ `keyset/webview_app/` (СЃРѕРґРµСЂР¶РёС‚ РёСЃС…РѕРґРЅРёРєРё Рё node_modules).

```python
def collect_keyset():
    """Collect keyset package excluding webview_app completely"""
    from pathlib import Path
    keyset_path = PROJECT_ROOT / 'keyset'
    result = []
    for item in keyset_path.rglob('*'):
        if item.is_file():
            # Skip entire webview_app folder (contains frontend source)
            if 'webview_app' in item.parts:
                continue
            # Skip __pycache__ and .pyc files
            if '__pycache__' in item.parts or item.suffix == '.pyc':
                continue
            rel_path = item.relative_to(PROJECT_ROOT)
            dest_dir = str(rel_path.parent)
            result.append((str(item), dest_dir))
    return result
```

**Р—Р°С‡РµРј РёСЃРєР»СЋС‡Р°С‚СЊ webview_app:**
1. РЎРѕРґРµСЂР¶РёС‚ node_modules СЃ С‚С‹СЃСЏС‡Р°РјРё С„Р°Р№Р»РѕРІ
2. РџСѓС‚Рё С„Р°Р№Р»РѕРІ РІ .pnpm РїСЂРµРІС‹С€Р°СЋС‚ Windows MAX_PATH (260 СЃРёРјРІРѕР»РѕРІ)
3. Р­С‚Рё С„Р°Р№Р»С‹ РЅРµ РЅСѓР¶РЅС‹ РІ .exe - РјС‹ РёСЃРїРѕР»СЊР·СѓРµРј Edge --app mode

#### Analysis СЃРµРєС†РёСЏ
```python
analysis = Analysis(
    [str(PROJECT_ROOT / 'launcher.py')],
    pathex=[str(PROJECT_ROOT)],
    binaries=[],
    datas=[
        # РЎРѕР±СЂР°РЅРЅС‹Р№ frontend (dist РѕС‚ Vite)
        (str(PROJECT_ROOT / 'frontend' / 'dist'), 'frontend/dist'),
        # Backend Python РєРѕРґ
        (str(PROJECT_ROOT / 'backend'), 'backend'),
        # Keyset РїР°РєРµС‚ Р‘Р•Р— webview_app
        *collect_keyset(),
    ],
    hiddenimports=[
        # Uvicorn С‚СЂРµР±СѓРµС‚ СЏРІРЅРѕРіРѕ РёРјРїРѕСЂС‚Р° РјРѕРґСѓР»РµР№
        'uvicorn.logging',
        'uvicorn.loops',
        'uvicorn.loops.auto',
        'uvicorn.protocols',
        'uvicorn.protocols.http',
        'uvicorn.protocols.http.auto',
        'uvicorn.protocols.websockets',
        'uvicorn.protocols.websockets.auto',
        'uvicorn.lifespan',
        'uvicorn.lifespan.on',
        'fastapi',
        'sqlalchemy',
        'playwright',
    ],
    hookspath=[],
    runtime_hooks=[],
    excludedimports=[],
    win_no_prefer_redirects=False,
    win_private_assemblies=False,
    cipher=block_cipher,
    noarchive=False,
)
```

**РљСЂРёС‚РёС‡РЅС‹Рµ РјРѕРјРµРЅС‚С‹:**
- `hiddenimports` РґР»СЏ uvicorn - Р±РµР· РЅРёС… backend РЅРµ Р·Р°РїСѓСЃС‚РёС‚СЃСЏ
- `datas` - СЃС‚Р°С‚РёС‡РµСЃРєРёРµ С„Р°Р№Р»С‹, РєРѕС‚РѕСЂС‹Рµ РЅСѓР¶РЅРѕ СѓРїР°РєРѕРІР°С‚СЊ
- `pathex` - РґРѕР±Р°РІР»СЏРµРј PROJECT_ROOT РІ PYTHONPATH

#### EXE РєРѕРЅС„РёРіСѓСЂР°С†РёСЏ
```python
exe = EXE(
    pyz,
    analysis.scripts,
    analysis.binaries,
    analysis.zipfiles,
    analysis.datas,
    [],
    name='KeySet',
    debug=False,
    bootloader_ignore_signals=False,
    strip=False,
    upx=True,              # РЎР¶Р°С‚РёРµ UPX
    upx_exclude=[],
    runtime_tmpdir=None,
    console=True,          # Console window (РґР»СЏ РѕС‚Р»Р°РґРєРё)
    disable_windowed_traceback=False,
    target_arch=None,
    codesign_identity=None,
    entitlements_file=None,
)
```

**РџР°СЂР°РјРµС‚СЂС‹:**
- `console=True` - РїРѕРєР°Р·С‹РІР°С‚СЊ РєРѕРЅСЃРѕР»СЊ РґР»СЏ debug Р»РѕРіРѕРІ
- `upx=True` - РІРєР»СЋС‡РёС‚СЊ СЃР¶Р°С‚РёРµ (СѓРјРµРЅСЊС€Р°РµС‚ СЂР°Р·РјРµСЂ)
- Onefile СЂРµР¶РёРј - РІСЃС‘ РІ РѕРґРЅРѕРј .exe С„Р°Р№Р»Рµ

### 3.3 РЎРєСЂРёРїС‚ Р°РІС‚РѕРјР°С‚РёС‡РµСЃРєРѕР№ СЃР±РѕСЂРєРё

РЎРѕР·РґР°РЅ `C:\AI\yandex\KeySet-MVP\build.ps1`:

```powershell
# -*- coding: utf-8 -*-
# РЎРєСЂРёРїС‚ Р°РІС‚РѕРјР°С‚РёС‡РµСЃРєРѕР№ СЃР±РѕСЂРєРё KeySet.exe

$ErrorActionPreference = "Stop"
$scriptDir = Split-Path -Parent $MyInvocation.MyCommand.Path
$projectRoot = Split-Path -Parent $scriptDir

Write-Host "[INFO] Working directory: $projectRoot" -ForegroundColor Cyan
Set-Location $projectRoot

# РџСЂРѕРІРµСЂРєР° spec С„Р°Р№Р»Р°
$specFile = Join-Path $projectRoot "build" "keyset.spec"
if (-Not (Test-Path $specFile)) {
    Write-Host "[ERROR] keyset.spec not found at: $specFile" -ForegroundColor Red
    exit 1
}

Write-Host "[INFO] Preview of build\keyset.spec:" -ForegroundColor Cyan
Get-Content $specFile -Head 10

# РћС‡РёСЃС‚РєР° Р°СЂС‚РµС„Р°РєС‚РѕРІ
Write-Host "[INFO] Cleaning previous artifacts..." -ForegroundColor Yellow
$distDir = Join-Path $projectRoot "dist"
$buildDir = Join-Path $projectRoot "build" "KeySet"

if (Test-Path $distDir) {
    Remove-Item $distDir -Recurse -Force
    Write-Host "[INFO] Removed dist/" -ForegroundColor Green
}
if (Test-Path $buildDir) {
    Remove-Item $buildDir -Recurse -Force
    Write-Host "[INFO] Removed build/KeySet/" -ForegroundColor Green
}

# Р—Р°РїСѓСЃРє PyInstaller
Write-Host "[INFO] Running PyInstaller..." -ForegroundColor Cyan
$venvPython = Join-Path $projectRoot ".venv" "Scripts" "python.exe"
& $venvPython -m PyInstaller --clean $specFile

# РџСЂРѕРІРµСЂРєР° СЂРµР·СѓР»СЊС‚Р°С‚Р°
$exePath = Join-Path $projectRoot "dist" "KeySet.exe"
if (Test-Path $exePath) {
    $exeSize = (Get-Item $exePath).Length / 1MB
    Write-Host "`n[SUCCESS] KeySet.exe created successfully ($([math]::Round($exeSize, 2)) MB)" -ForegroundColor Green
} else {
    Write-Host "`n[ERROR] Build failed! KeySet.exe not found." -ForegroundColor Red
    exit 1
}
```

**РћСЃРѕР±РµРЅРЅРѕСЃС‚Рё СЃРєСЂРёРїС‚Р°:**
- РђРІС‚РѕРјР°С‚РёС‡РµСЃРєР°СЏ РѕС‡РёСЃС‚РєР° СЃС‚Р°СЂС‹С… Р°СЂС‚РµС„Р°РєС‚РѕРІ
- РџСЂРѕРІРµСЂРєР° СЃСѓС‰РµСЃС‚РІРѕРІР°РЅРёСЏ spec С„Р°Р№Р»Р°
- Р’С‹РІРѕРґ СЂР°Р·РјРµСЂР° С„РёРЅР°Р»СЊРЅРѕРіРѕ .exe
- РћР±СЂР°Р±РѕС‚РєР° РѕС€РёР±РѕРє

### 3.4 РљРѕРјР°РЅРґР° СЃР±РѕСЂРєРё
```bash
cd C:\AI\yandex\KeySet-MVP
.\build.ps1
```

---

## 4. РџСЂРѕР±Р»РµРјС‹ Рё РёС… СЂРµС€РµРЅРёСЏ

### 4.1 РџСЂРѕР±Р»РµРјР°: РЎР»РёС€РєРѕРј РґР»РёРЅРЅС‹Рµ РїСѓС‚Рё РІ node_modules

**РЎРёРјРїС‚РѕРјС‹:**
```
Failed to extract keyset\webview_app\modules_src\data\.pnpm\@csstools+selector-resolve-nested@4.0.1...
OSError: [WinError 206] РРјСЏ С„Р°Р№Р»Р° РёР»Рё СЂР°СЃС€РёСЂРµРЅРёРµ РёРјРµРµС‚ СЃР»РёС€РєРѕРј Р±РѕР»СЊС€СѓСЋ РґР»РёРЅСѓ
```

**РџСЂРёС‡РёРЅР°:**
- Р’ `keyset/webview_app/modules_src/data/.pnpm` РЅР°С…РѕРґСЏС‚СЃСЏ node_modules
- РќРµРєРѕС‚РѕСЂС‹Рµ РїР°РєРµС‚С‹ СЃРѕР·РґР°СЋС‚ РѕС‡РµРЅСЊ РіР»СѓР±РѕРєСѓСЋ СЃС‚СЂСѓРєС‚СѓСЂСѓ РїР°РїРѕРє
- Windows РѕРіСЂР°РЅРёС‡РёРІР°РµС‚ MAX_PATH РІ 260 СЃРёРјРІРѕР»РѕРІ

**РџРµСЂРІР°СЏ РїРѕРїС‹С‚РєР° СЂРµС€РµРЅРёСЏ:**
РСЃРєР»СЋС‡РёР» С‚РѕР»СЊРєРѕ `modules_src/data`:
```python
if 'modules_src/data' in str(item):
    continue
```
**Р РµР·СѓР»СЊС‚Р°С‚:** РќРµ РїРѕРјРѕРіР»Рѕ, РѕС€РёР±РєРё РїРѕСЏРІРёР»РёСЃСЊ РІ РґСЂСѓРіРёС… РјРµСЃС‚Р°С… webview_app.

**Р¤РёРЅР°Р»СЊРЅРѕРµ СЂРµС€РµРЅРёРµ:**
РџРѕР»РЅРѕРµ РёСЃРєР»СЋС‡РµРЅРёРµ РІСЃРµР№ РїР°РїРєРё `webview_app`:
```python
if 'webview_app' in item.parts:
    continue
```

**РџРѕС‡РµРјСѓ СЌС‚Рѕ Р±РµР·РѕРїР°СЃРЅРѕ:**
- `webview_app` СЃРѕРґРµСЂР¶РёС‚ РёСЃС…РѕРґРЅРёРєРё РґР»СЏ PyWebView РІР°СЂРёР°РЅС‚Р°
- РњС‹ РёСЃРїРѕР»СЊР·СѓРµРј Edge --app mode, PyWebView РЅРµ РЅСѓР¶РµРЅ
- Р’СЃРµ РЅРµРѕР±С…РѕРґРёРјРѕРµ РґР»СЏ СЂР°Р±РѕС‚С‹ РЅР°С…РѕРґРёС‚СЃСЏ РІ `frontend/dist/` (СЃРѕР±СЂР°РЅРЅС‹Р№ React)

**РС‚РѕРі:** РџСЂРѕР±Р»РµРјР° СЂРµС€РµРЅР°, СЂР°Р·РјРµСЂ .exe СѓРјРµРЅСЊС€РёР»СЃСЏ.

---

### 4.2 РџСЂРѕР±Р»РµРјР°: Edge РЅРµ Р·Р°РїСѓСЃРєР°РµС‚СЃСЏ

**РЎРёРјРїС‚РѕРјС‹:**
```
[launcher] Opening app window via msedge...
[launcher] Opening app window via chrome...
[launcher] App mode failed, opening default browser...
```

**РџСЂРёС‡РёРЅР°:**
Р’ РєРѕРґРµ РёСЃРїРѕР»СЊР·РѕРІР°Р»РёСЃСЊ РєРѕСЂРѕС‚РєРёРµ РєРѕРјР°РЅРґС‹:
```python
candidates = (
    ("msedge", f"--app={url}", ...),
    ("chrome", f"--app={url}", ...),
)
```

РќР° Windows РєРѕРјР°РЅРґС‹ `msedge` Рё `chrome` РЅРµ СЂР°Р±РѕС‚Р°СЋС‚ - РЅСѓР¶РЅС‹ РїРѕР»РЅС‹Рµ РїСѓС‚Рё Рє .exe С„Р°Р№Р»Р°Рј.

**Р РµС€РµРЅРёРµ:**
РСЃРїРѕР»СЊР·РѕРІР°С‚СЊ РїРѕР»РЅС‹Рµ РїСѓС‚Рё Рє Р±СЂР°СѓР·РµСЂР°Рј:
```python
edge_paths = [
    r"C:\Program Files (x86)\Microsoft\Edge\Application\msedge.exe",
    r"C:\Program Files\Microsoft\Edge\Application\msedge.exe",
]
chrome_paths = [
    r"C:\Program Files\Google\Chrome\Application\chrome.exe",
    r"C:\Program Files (x86)\Google\Chrome\Application\chrome.exe",
]

candidates: list[tuple[str, str, str]] = []
for edge_path in edge_paths:
    if Path(edge_path).exists():
        candidates.append((edge_path, f"--app={url}", f"--user-data-dir={user_data}"))
        break
```

**Р”РѕРїРѕР»РЅРёС‚РµР»СЊРЅР°СЏ РѕР±СЂР°Р±РѕС‚РєР°:**
- РџСЂРѕРІРµСЂРєР° СЃСѓС‰РµСЃС‚РІРѕРІР°РЅРёСЏ С„Р°Р№Р»Р° РїРµСЂРµРґ РґРѕР±Р°РІР»РµРЅРёРµРј
- РћР±СЂР°Р±РѕС‚РєР° РёСЃРєР»СЋС‡РµРЅРёР№ РїСЂРё Р·Р°РїСѓСЃРєРµ
- Fallback РЅР° РѕР±С‹С‡РЅС‹Р№ Р±СЂР°СѓР·РµСЂ С‡РµСЂРµР· `webbrowser.open()`

**РС‚РѕРі:** Edge Р·Р°РїСѓСЃРєР°РµС‚СЃСЏ РєРѕСЂСЂРµРєС‚РЅРѕ РІ --app СЂРµР¶РёРјРµ, РѕРєРЅРѕ Р‘Р•Р— Р°РґСЂРµСЃРЅРѕР№ СЃС‚СЂРѕРєРё.

---

### 4.3 РџСЂРѕР±Р»РµРјР°: Р‘Р»РѕРєРёСЂРѕРІРєР° С„Р°Р№Р»РѕРІ РїСЂРё РїРµСЂРµСЃР±РѕСЂРєРµ

**РЎРёРјРїС‚РѕРјС‹:**
```
Remove-Item : РќРµ СѓРґР°РµС‚СЃСЏ СѓРґР°Р»РёС‚СЊ СЌР»РµРјРµРЅС‚ C:\AI\yandex\KeySet-MVP\dist\keyset.db:
РџСЂРѕС†РµСЃСЃ РЅРµ РјРѕР¶РµС‚ РїРѕР»СѓС‡РёС‚СЊ РґРѕСЃС‚СѓРї Рє С„Р°Р№Р»Сѓ
```

**РџСЂРёС‡РёРЅР°:**
- Р—Р°РїСѓС‰РµРЅРЅС‹Рµ СЌРєР·РµРјРїР»СЏСЂС‹ KeySet.exe РґРµСЂР¶Р°С‚ РѕС‚РєСЂС‹С‚С‹Рј keyset.db
- build.ps1 РЅРµ РјРѕР¶РµС‚ СѓРґР°Р»РёС‚СЊ dist/ РїРµСЂРµРґ РЅРѕРІРѕР№ СЃР±РѕСЂРєРѕР№

**Р РµС€РµРЅРёРµ:**
РџРµСЂРµРґ СЃР±РѕСЂРєРѕР№ РѕСЃС‚Р°РЅР°РІР»РёРІР°С‚СЊ РІСЃРµ РїСЂРѕС†РµСЃСЃС‹:
```bash
taskkill /F /IM python.exe /T 2>nul
taskkill /F /IM KeySet.exe /T 2>nul
```

РР»Рё Р·Р°РєСЂС‹РІР°С‚СЊ РїСЂРёР»РѕР¶РµРЅРёРµ РІСЂСѓС‡РЅСѓСЋ РїРµСЂРµРґ РїРµСЂРµСЃР±РѕСЂРєРѕР№.

**РС‚РѕРі:** РџРµСЂРµСЃР±РѕСЂРєР° СЂР°Р±РѕС‚Р°РµС‚ Р±РµР· РѕС€РёР±РѕРє.

---

### 4.4 РџСЂРѕР±Р»РµРјР°: Backend РЅРµ РёРјРїРѕСЂС‚РёСЂСѓРµС‚СЃСЏ РІ .exe

**РЎРёРјРїС‚РѕРјС‹:**
```
[DEBUG] FAIL Failed to import backend.main: No module named 'backend'
```

**РџСЂРёС‡РёРЅР°:**
PyInstaller РЅРµ РІРєР»СЋС‡Р°РµС‚ backend Р°РІС‚РѕРјР°С‚РёС‡РµСЃРєРё, РµСЃР»Рё РѕРЅ РЅРµ РёРјРїРѕСЂС‚РёСЂСѓРµС‚СЃСЏ СЏРІРЅРѕ РІ launcher.py.

**Р РµС€РµРЅРёРµ 1:** Р”РѕР±Р°РІРёС‚СЊ backend РІ datas
```python
datas=[
    (str(PROJECT_ROOT / 'backend'), 'backend'),
]
```

**Р РµС€РµРЅРёРµ 2:** Р”РѕР±Р°РІРёС‚СЊ РІ sys.path
```python
if getattr(sys, "frozen", False):
    bundle_dir = Path(getattr(sys, "_MEIPASS", Path.cwd()))
    sys.path.insert(0, str(bundle_dir))
```

**Р РµС€РµРЅРёРµ 3:** Р”РёРЅР°РјРёС‡РµСЃРєРёР№ РёРјРїРѕСЂС‚ РІ launcher.py
```python
def run_backend(port: int) -> None:
    try:
        import backend.main  # noqa: F401
        print("[DEBUG] OK backend.main imported successfully")
    except Exception as exc:
        print(f"[DEBUG] FAIL Failed to import backend.main: {exc}")
        import traceback
        traceback.print_exc()
        return
```

**РС‚РѕРі:** Backend РёРјРїРѕСЂС‚РёСЂСѓРµС‚СЃСЏ Рё Р·Р°РїСѓСЃРєР°РµС‚СЃСЏ РІРЅСѓС‚СЂРё .exe.

---

### 4.5 РџСЂРѕР±Р»РµРјР°: SQLite Р±Р°Р·Р° РґР°РЅРЅС‹С…

**РЎРёС‚СѓР°С†РёСЏ:**
Р‘Р°Р·Р° РґР°РЅРЅС‹С… `keyset.db` РЅР°С…РѕРґРёС‚СЃСЏ РІРЅСѓС‚СЂРё РїР°РєРµС‚Р° keyset. РџСЂРё СѓРїР°РєРѕРІРєРµ РІ .exe С„Р°Р№Р» СЃС‚Р°РЅРѕРІРёС‚СЃСЏ read-only.

**Р РµС€РµРЅРёРµ РІ keyset/core/db.py:**
```python
if getattr(sys, "frozen", False):
    # Р—Р°РїСѓС‰РµРЅРѕ РёР· .exe
    bundle_dir = Path(sys._MEIPASS)
    source_db = bundle_dir / "keyset" / "keyset.db"

    # РљРѕРїРёСЂСѓРµРј РІ РґРѕСЃС‚СѓРїРЅРѕРµ РјРµСЃС‚Рѕ
    target_db = Path.home() / ".keyset" / "keyset.db"
    target_db.parent.mkdir(parents=True, exist_ok=True)

    if not target_db.exists():
        shutil.copy(source_db, target_db)

    db_path = target_db
```

**Р›РѕРіРёРєР°:**
1. РџСЂРё РїРµСЂРІРѕРј Р·Р°РїСѓСЃРєРµ РєРѕРїРёСЂСѓРµРј keyset.db РёР· bundle РІ `~/.keyset/`
2. Р’СЃРµ РїРѕСЃР»РµРґСѓСЋС‰РёРµ Р·Р°РїСѓСЃРєРё РёСЃРїРѕР»СЊР·СѓСЋС‚ Р‘Р” РёР· `~/.keyset/`
3. Р‘Р” СЃРѕС…СЂР°РЅСЏРµС‚СЃСЏ РјРµР¶РґСѓ Р·Р°РїСѓСЃРєР°РјРё

**РС‚РѕРі:** Р‘Р°Р·Р° РґР°РЅРЅС‹С… СЂР°Р±РѕС‚Р°РµС‚ РєРѕСЂСЂРµРєС‚РЅРѕ, РґР°РЅРЅС‹Рµ СЃРѕС…СЂР°РЅСЏСЋС‚СЃСЏ.

---

## 5. Р¤РёРЅР°Р»СЊРЅР°СЏ РєРѕРЅС„РёРіСѓСЂР°С†РёСЏ

### 5.1 РЎС‚СЂСѓРєС‚СѓСЂР° РїСЂРѕРµРєС‚Р° РїРѕСЃР»Рµ СЃР±РѕСЂРєРё

```
KeySet-MVP/
в”њв”Ђв”Ђ frontend/
в”‚   в””в”Ђв”Ђ dist/                    # РЎРѕР±СЂР°РЅРЅС‹Р№ React (РІРєР»СЋС‡РµРЅ РІ .exe)
в”њв”Ђв”Ђ backend/                     # FastAPI РєРѕРґ (РІРєР»СЋС‡РµРЅ РІ .exe)
в”њв”Ђв”Ђ keyset/                      # Р‘РёР·РЅРµСЃ-Р»РѕРіРёРєР° (РІРєР»СЋС‡РµРЅ РІ .exe)
в”‚   в”њв”Ђв”Ђ core/
в”‚   в”‚   в””в”Ђв”Ђ db.py
в”‚   в””в”Ђв”Ђ keyset.db               # РЁР°Р±Р»РѕРЅ Р‘Р” (РєРѕРїРёСЂСѓРµС‚СЃСЏ РІ ~/.keyset/)
в”њв”Ђв”Ђ launcher.py                  # Р“Р»Р°РІРЅР°СЏ С‚РѕС‡РєР° РІС…РѕРґР°
в”њв”Ђв”Ђ build/
в”‚   в”њв”Ђв”Ђ keyset.spec             # РљРѕРЅС„РёРіСѓСЂР°С†РёСЏ PyInstaller
в”‚   в””в”Ђв”Ђ build.ps1               # РЎРєСЂРёРїС‚ СЃР±РѕСЂРєРё
в”њв”Ђв”Ђ dist/
в”‚   в””в”Ђв”Ђ KeySet.exe              # Р¤РРќРђР›Р¬РќР«Р™ Р¤РђР™Р› (94 MB)
в””в”Ђв”Ђ .venv/                      # Р’РёСЂС‚СѓР°Р»СЊРЅРѕРµ РѕРєСЂСѓР¶РµРЅРёРµ
```

### 5.2 Р§С‚Рѕ СѓРїР°РєРѕРІР°РЅРѕ РІ KeySet.exe

**Python РєРѕРґ:**
- launcher.py
- backend/ (FastAPI РїСЂРёР»РѕР¶РµРЅРёРµ)
- keyset/ (РєСЂРѕРјРµ webview_app/)
- Р’СЃРµ Python Р·Р°РІРёСЃРёРјРѕСЃС‚Рё (uvicorn, fastapi, sqlalchemy, playwright, Рё С‚.Рґ.)

**РЎС‚Р°С‚РёС‡РµСЃРєРёРµ С„Р°Р№Р»С‹:**
- frontend/dist/ (index.html, JS bundles, CSS, С€СЂРёС„С‚С‹, РёРєРѕРЅРєРё)
- keyset.db (С€Р°Р±Р»РѕРЅ Р±Р°Р·С‹ РґР°РЅРЅС‹С…)

**Р‘РёР±Р»РёРѕС‚РµРєРё:**
- python313.dll
- sqlite3.dll
- Рё РґСЂСѓРіРёРµ СЃРёСЃС‚РµРјРЅС‹Рµ DLL

**Р Р°Р·РјРµСЂ:** 93.95 MB

### 5.3 Р§С‚Рѕ РќР• СѓРїР°РєРѕРІР°РЅРѕ

**РСЃРєР»СЋС‡РµРЅРѕ РёР· СЃР±РѕСЂРєРё:**
- keyset/webview_app/ - РёСЃС…РѕРґРЅРёРєРё WebView РІР°СЂРёР°РЅС‚Р°
- node_modules - frontend Р·Р°РІРёСЃРёРјРѕСЃС‚Рё (С‚РѕР»СЊРєРѕ dist РЅСѓР¶РµРЅ)
- .venv/ - РІРёСЂС‚СѓР°Р»СЊРЅРѕРµ РѕРєСЂСѓР¶РµРЅРёРµ
- РСЃС…РѕРґРЅРёРєРё frontend (src/)

**Р—Р°РіСЂСѓР¶Р°РµС‚СЃСЏ runtime:**
- Р‘Р°Р·Р° РґР°РЅРЅС‹С… РІ ~/.keyset/keyset.db (СЃРѕР·РґР°РµС‚СЃСЏ РїСЂРё РїРµСЂРІРѕРј Р·Р°РїСѓСЃРєРµ)
- Р’СЂРµРјРµРЅРЅС‹Рµ С„Р°Р№Р»С‹ Edge РІ %TEMP%/KeySet_EdgeData/

### 5.4 РџР°СЂР°РјРµС‚СЂС‹ Р·Р°РїСѓСЃРєР°

**РџСЂРё Р·Р°РїСѓСЃРєРµ KeySet.exe:**
1. Р Р°СЃРїР°РєРѕРІРєР° РІРѕ РІСЂРµРјРµРЅРЅСѓСЋ РїР°РїРєСѓ `%TEMP%\_MEI*`
2. РРјРїРѕСЂС‚ РІСЃРµС… Python РјРѕРґСѓР»РµР№
3. Р—Р°РїСѓСЃРє launcher.py в†’ main()
4. Backend СЃС‚Р°СЂС‚СѓРµС‚ РЅР° СЃР»СѓС‡Р°Р№РЅРѕРј СЃРІРѕР±РѕРґРЅРѕРј РїРѕСЂС‚Сѓ (РЅР°РїСЂРёРјРµСЂ, 55602)
5. Edge РѕС‚РєСЂС‹РІР°РµС‚СЃСЏ РІ --app СЂРµР¶РёРјРµ
6. РџСЂРёР»РѕР¶РµРЅРёРµ СЂР°Р±РѕС‚Р°РµС‚ РґРѕ Р·Р°РєСЂС‹С‚РёСЏ РѕРєРЅР° Edge

**РџРµСЂРµРјРµРЅРЅС‹Рµ РѕРєСЂСѓР¶РµРЅРёСЏ (РѕРїС†РёРѕРЅР°Р»СЊРЅРѕ):**
```
WEBVIEW2_BROWSER_EXECUTABLE_FOLDER - РїСѓС‚СЊ Рє WebView2 runtime (РЅРµ РёСЃРїРѕР»СЊР·СѓРµС‚СЃСЏ СЃ Edge --app)
```

---

## 6. Р РµР·СѓР»СЊС‚Р°С‚С‹

### 6.1 РЈСЃРїРµС€РЅР°СЏ СЃР±РѕСЂРєР°

**Р¤Р°Р№Р»:** `C:\AI\yandex\KeySet-MVP\dist\KeySet.exe`
**Р Р°Р·РјРµСЂ:** 93.95 MB
**Р’СЂРµРјСЏ СЃР±РѕСЂРєРё:** ~60 СЃРµРєСѓРЅРґ
**Р’СЂРµРјСЏ Р·Р°РїСѓСЃРєР°:** ~3-5 СЃРµРєСѓРЅРґ (backend startup + Edge launch)

### 6.2 Р›РѕРі СѓСЃРїРµС€РЅРѕРіРѕ Р·Р°РїСѓСЃРєР°

```
[DEBUG] Running from .exe, _MEIPASS: C:\Users\webse\AppData\Local\Temp\_MEI1065202
[DEBUG] sys.path: ['C:\\Users\\webse\\AppData\\Local\\Temp\\_MEI1065202', ...]
[DEBUG] OK backend folder found: C:\Users\webse\AppData\Local\Temp\_MEI1065202\backend
[launcher] Starting backend on http://127.0.0.1:54513 ...
[DEBUG] OK backend.main imported successfully

INFO:     Started server process [108764]
INFO:     Waiting for application startup.
INFO:     Application startup complete.
INFO:     Uvicorn running on http://127.0.0.1:54513 (Press CTRL+C to quit)

INFO:     127.0.0.1:54527 - "GET /api/health HTTP/1.1" 200 OK

[launcher] Opening app window via msedge.exe...
[launcher] Browser window started. Close it to exit KeySet.

INFO:     127.0.0.1:63419 - "GET / HTTP/1.1" 200 OK
INFO:     127.0.0.1:63419 - "GET /assets/index-DMq0dIZP.js HTTP/1.1" 200 OK
INFO:     127.0.0.1:58151 - "GET /assets/style-C-WZsHsY.css HTTP/1.1" 200 OK
INFO:     127.0.0.1:63419 - "GET /assets/fa-solid-900-8GirhLYJ.woff2 HTTP/1.1" 200 OK
```

### 6.3 Р¤СѓРЅРєС†РёРѕРЅР°Р»СЊРЅРѕСЃС‚СЊ

**Р Р°Р±РѕС‚Р°РµС‚:**
- вњ… Р—Р°РїСѓСЃРє backend FastAPI РІРЅСѓС‚СЂРё .exe
- вњ… Р—Р°РіСЂСѓР·РєР° React frontend РёР· bundle
- вњ… Edge --app mode (РѕРєРЅРѕ Р‘Р•Р— Р°РґСЂРµСЃРЅРѕР№ СЃС‚СЂРѕРєРё)
- вњ… SQLite Р±Р°Р·Р° РґР°РЅРЅС‹С… СЃ РїРµСЂСЃРёСЃС‚РµРЅС‚РЅРѕСЃС‚СЊСЋ
- вњ… Р”РёРЅР°РјРёС‡РµСЃРєРёР№ РІС‹Р±РѕСЂ РїРѕСЂС‚Р°
- вњ… Health check РїРµСЂРµРґ РѕС‚РєСЂС‹С‚РёРµРј UI
- вњ… Graceful shutdown РїСЂРё Р·Р°РєСЂС‹С‚РёРё РѕРєРЅР°
- вњ… Fallback РЅР° РѕР±С‹С‡РЅС‹Р№ Р±СЂР°СѓР·РµСЂ РµСЃР»Рё Edge РЅРµ РЅР°Р№РґРµРЅ
- вњ… Standalone window - РІС‹РіР»СЏРґРёС‚ РєР°Рє РЅР°С‚РёРІРЅРѕРµ РїСЂРёР»РѕР¶РµРЅРёРµ

**UI РїСЂРѕРІРµСЂРєР°:**
- РћРєРЅРѕ Edge РѕС‚РєСЂС‹РІР°РµС‚СЃСЏ Р‘Р•Р—:
  - РђРґСЂРµСЃРЅРѕР№ СЃС‚СЂРѕРєРё
  - РљРЅРѕРїРѕРє РЅР°РІРёРіР°С†РёРё (РЅР°Р·Р°Рґ/РІРїРµСЂРµРґ)
  - РњРµРЅСЋ Р±СЂР°СѓР·РµСЂР°
  - РРЅРґРёРєР°С†РёРё С‡С‚Рѕ СЌС‚Рѕ Р±СЂР°СѓР·РµСЂ
- Р’С‹РіР»СЏРґРёС‚ РєР°Рє РѕР±С‹С‡РЅРѕРµ desktop РїСЂРёР»РѕР¶РµРЅРёРµ

---

## 7. Р§С‚Рѕ РµС‰Рµ РЅРµ СЃРґРµР»Р°РЅРѕ

### 7.1 РРєРѕРЅРєР° РїСЂРёР»РѕР¶РµРЅРёСЏ

**РЎС‚Р°С‚СѓСЃ:** РќРµ РЅР°СЃС‚СЂРѕРµРЅР°

**РљР°Рє РґРѕР±Р°РІРёС‚СЊ:**
1. РЎРѕР·РґР°С‚СЊ icon.ico С„Р°Р№Р» (256x256)
2. Р”РѕР±Р°РІРёС‚СЊ РІ keyset.spec:
```python
exe = EXE(
    ...
    icon='path/to/icon.ico',
)
```

### 7.2 Windows GUI СЂРµР¶РёРј (Р±РµР· РєРѕРЅСЃРѕР»Рё)

**РўРµРєСѓС‰РµРµ СЃРѕСЃС‚РѕСЏРЅРёРµ:** `console=True`
**Р§С‚Рѕ РІРёРґРёС‚ РїРѕР»СЊР·РѕРІР°С‚РµР»СЊ:** Р§РµСЂРЅРѕРµ РѕРєРЅРѕ РєРѕРЅСЃРѕР»Рё СЃ Р»РѕРіР°РјРё

**РљР°Рє РѕС‚РєР»СЋС‡РёС‚СЊ РєРѕРЅСЃРѕР»СЊ:**
```python
exe = EXE(
    ...
    console=False,
)
```

**РџРѕС‡РµРјСѓ РїРѕРєР° РѕСЃС‚Р°РІР»РµРЅРѕ console=True:**
- РЈРґРѕР±РЅРѕ РґР»СЏ РѕС‚Р»Р°РґРєРё
- Р’РёРґРЅРѕ Р»РѕРіРё backend Рё launcher
- РњРѕР¶РЅРѕ РѕС‚СЃР»РµРґРёС‚СЊ РѕС€РёР±РєРё

**Р”Р»СЏ РїСЂРѕРґР°РєС€РµРЅР°:** РџРѕСЃС‚Р°РІРёС‚СЊ `console=False`.

### 7.3 РђРІС‚РѕРѕР±РЅРѕРІР»РµРЅРёРµ

**РЎС‚Р°С‚СѓСЃ:** РќРµ СЂРµР°Р»РёР·РѕРІР°РЅРѕ

**Р§С‚Рѕ РјРѕР¶РЅРѕ РґРѕР±Р°РІРёС‚СЊ:**
- РџСЂРѕРІРµСЂРєР° РЅРѕРІРѕР№ РІРµСЂСЃРёРё РїСЂРё Р·Р°РїСѓСЃРєРµ
- РђРІС‚РѕРјР°С‚РёС‡РµСЃРєР°СЏ Р·Р°РіСЂСѓР·РєР° РѕР±РЅРѕРІР»РµРЅРёР№
- РњРµС…Р°РЅРёР·Рј Р·Р°РјРµРЅС‹ .exe С„Р°Р№Р»Р°

**Р‘РёР±Р»РёРѕС‚РµРєРё:**
- PyUpdater
- update-electron-app (РµСЃР»Рё РїРµСЂРµР№С‚Рё РЅР° Electron)

### 7.4 РЈСЃС‚Р°РЅРѕРІС‰РёРє (РѕРїС†РёРѕРЅР°Р»СЊРЅРѕ)

**РўРµРєСѓС‰РµРµ СЃРѕСЃС‚РѕСЏРЅРёРµ:** РџСЂРѕСЃС‚Рѕ .exe С„Р°Р№Р»

**Р§С‚Рѕ РјРѕР¶РЅРѕ РґРѕР±Р°РІРёС‚СЊ:**
- NSIS/Inno Setup installer
- РЎРѕР·РґР°РЅРёРµ СЏСЂР»С‹РєРѕРІ РІ РјРµРЅСЋ РџСѓСЃРє
- Р РµРіРёСЃС‚СЂР°С†РёСЏ РІ "РЈСЃС‚Р°РЅРѕРІРєР° Рё СѓРґР°Р»РµРЅРёРµ РїСЂРѕРіСЂР°РјРј"
- РђРІС‚РѕРјР°С‚РёС‡РµСЃРєРѕРµ РґРѕР±Р°РІР»РµРЅРёРµ РІ Р°РІС‚РѕР·Р°РіСЂСѓР·РєСѓ

### 7.5 РњСѓР»СЊС‚РёРїР»Р°С‚С„РѕСЂРјРµРЅРЅРѕСЃС‚СЊ

**РўРµРєСѓС‰РµРµ СЃРѕСЃС‚РѕСЏРЅРёРµ:** РўРѕР»СЊРєРѕ Windows

**Р§С‚Рѕ РЅСѓР¶РЅРѕ РґР»СЏ Linux/macOS:**
- РђРґР°РїС‚РёСЂРѕРІР°С‚СЊ РїСѓС‚Рё Рє Р±СЂР°СѓР·РµСЂР°Рј РІ launch_browser()
- РЎРѕР·РґР°С‚СЊ РѕС‚РґРµР»СЊРЅС‹Рµ .spec С„Р°Р№Р»С‹
- РЎРѕР±СЂР°С‚СЊ РЅР° СЃРѕРѕС‚РІРµС‚СЃС‚РІСѓСЋС‰РёС… РїР»Р°С‚С„РѕСЂРјР°С…

**Linux:**
```python
chrome_paths = [
    "/usr/bin/google-chrome",
    "/usr/bin/chromium-browser",
]
```

**macOS:**
```python
chrome_paths = [
    "/Applications/Google Chrome.app/Contents/MacOS/Google Chrome",
]
```

---

## 8. РђРЅР°Р»РёР· РїСЂРѕРёР·РІРѕРґРёС‚РµР»СЊРЅРѕСЃС‚Рё

### 8.1 Р Р°Р·РјРµСЂ С„Р°Р№Р»Р°

**KeySet.exe: 93.95 MB**

**РЎРѕСЃС‚Р°РІ:**
- Python runtime + stdlib: ~25 MB
- Р—Р°РІРёСЃРёРјРѕСЃС‚Рё (FastAPI, uvicorn, SQLAlchemy, Playwright): ~40 MB
- Frontend (React bundle, CSS, fonts): ~5 MB
- Backend РєРѕРґ: ~2 MB
- Keyset РїР°РєРµС‚: ~2 MB
- РџСЂРѕС‡РµРµ (DLL, РјРµС‚Р°РґР°РЅРЅС‹Рµ): ~20 MB

**РћРїС‚РёРјРёР·Р°С†РёСЏ (РїРѕС‚РµРЅС†РёР°Р»СЊРЅР°СЏ):**
- РЈР±СЂР°С‚СЊ Playwright РµСЃР»Рё РЅРµ РёСЃРїРѕР»СЊР·СѓРµС‚СЃСЏ: -15 MB
- РЈР±СЂР°С‚СЊ РЅРµРёСЃРїРѕР»СЊР·СѓРµРјС‹Рµ stdlib РјРѕРґСѓР»Рё: -5 MB
- Р’РєР»СЋС‡РёС‚СЊ UPX compression Р±РѕР»РµРµ Р°РіСЂРµСЃСЃРёРІРЅРѕ: -10 MB
- **РС‚РѕРіРѕ РјРѕР¶РЅРѕ СѓРјРµРЅСЊС€РёС‚СЊ РґРѕ ~65 MB**

### 8.2 Р’СЂРµРјСЏ Р·Р°РїСѓСЃРєР°

**РР·РјРµСЂРµРЅРёСЏ:**
1. Р Р°СЃРїР°РєРѕРІРєР° РІРѕ РІСЂРµРјРµРЅРЅСѓСЋ РїР°РїРєСѓ: ~1 СЃРµРє
2. РРјРїРѕСЂС‚ Python РјРѕРґСѓР»РµР№: ~0.5 СЃРµРє
3. Р—Р°РїСѓСЃРє backend (FastAPI + Uvicorn): ~2 СЃРµРє
4. Health check: ~0.3 СЃРµРє
5. Р—Р°РїСѓСЃРє Edge: ~0.5 СЃРµРє

**РС‚РѕРіРѕ: ~4-5 СЃРµРєСѓРЅРґ** РѕС‚ РґРІРѕР№РЅРѕРіРѕ РєР»РёРєР° РґРѕ РѕС‚РєСЂС‹С‚РёСЏ РѕРєРЅР°.

**РЈР·РєРёРµ РјРµСЃС‚Р°:**
- Р Р°СЃРїР°РєРѕРІРєР° bundle РїСЂРё РєР°Р¶РґРѕРј Р·Р°РїСѓСЃРєРµ
- РҐРѕР»РѕРґРЅС‹Р№ СЃС‚Р°СЂС‚ FastAPI

**РћРїС‚РёРјРёР·Р°С†РёСЏ:**
- РСЃРїРѕР»СЊР·РѕРІР°С‚СЊ onedir РІРјРµСЃС‚Рѕ onefile (РЅРµ СЂР°СЃРїР°РєРѕРІС‹РІР°С‚СЊ РєР°Р¶РґС‹Р№ СЂР°Р·)
- Preload backend РјРѕРґСѓР»РµР№
- **РџРѕС‚РµРЅС†РёР°Р»: ~2-3 СЃРµРєСѓРЅРґС‹**

### 8.3 РџРѕС‚СЂРµР±Р»РµРЅРёРµ РїР°РјСЏС‚Рё

**РџРѕСЃР»Рµ Р·Р°РїСѓСЃРєР°:**
- KeySet.exe РїСЂРѕС†РµСЃСЃ: ~150 MB
- msedge.exe РїСЂРѕС†РµСЃСЃ: ~200 MB
- **РС‚РѕРіРѕ: ~350 MB RAM**

Р”Р»СЏ СЃРѕРІСЂРµРјРµРЅРЅС‹С… СЃРёСЃС‚РµРј СЌС‚Рѕ РїСЂРёРµРјР»РµРјРѕ.

---

## 9. Р РµРєРѕРјРµРЅРґР°С†РёРё

### 9.1 Р”Р»СЏ production

**РљСЂРёС‚РёС‡РµСЃРєРё РІР°Р¶РЅРѕ:**
1. вњ… РџРѕСЃС‚Р°РІРёС‚СЊ `console=False` РІ keyset.spec
2. вњ… Р”РѕР±Р°РІРёС‚СЊ РёРєРѕРЅРєСѓ РїСЂРёР»РѕР¶РµРЅРёСЏ
3. вњ… РўРµСЃС‚РёСЂРѕРІР°РЅРёРµ РЅР° С‡РёСЃС‚С‹С… СЃРёСЃС‚РµРјР°С… Windows 10/11

**Р–РµР»Р°С‚РµР»СЊРЅРѕ:**
1. РЎРѕР·РґР°С‚СЊ installer (NSIS/Inno Setup)
2. Р”РѕР±Р°РІРёС‚СЊ СЃРёСЃС‚РµРјСѓ Р°РІС‚РѕРѕР±РЅРѕРІР»РµРЅРёР№
3. Р›РѕРіРёСЂРѕРІР°РЅРёРµ РІ С„Р°Р№Р» РІРјРµСЃС‚Рѕ РєРѕРЅСЃРѕР»Рё
4. Crash reporting (Sentry)

### 9.2 Р”Р»СЏ СЂР°Р·СЂР°Р±РѕС‚РєРё

**РЎРѕС…СЂР°РЅРёС‚СЊ:**
- `console=True` - РІРёРґРЅС‹ Р»РѕРіРё
- РћС‚Р»Р°РґРѕС‡РЅС‹Рµ РїСЂРёРЅС‚С‹ РІ launcher.py
- Р’РѕР·РјРѕР¶РЅРѕСЃС‚СЊ Р·Р°РїСѓСЃРєР° С‡РµСЂРµР· `.venv\Scripts\python.exe launcher.py`

**Р”РѕР±Р°РІРёС‚СЊ:**
- CI/CD РґР»СЏ Р°РІС‚РѕРјР°С‚РёС‡РµСЃРєРѕР№ СЃР±РѕСЂРєРё
- Р’РµСЂСЃРёРѕРЅРёСЂРѕРІР°РЅРёРµ .exe (metadata)
- Unit С‚РµСЃС‚С‹ РґР»СЏ launcher.py

### 9.3 Р”Р»СЏ РїРѕР»СЊР·РѕРІР°С‚РµР»РµР№

**Р”РѕРєСѓРјРµРЅС‚Р°С†РёСЏ:**
1. РњРёРЅРёРјР°Р»СЊРЅС‹Рµ С‚СЂРµР±РѕРІР°РЅРёСЏ (Windows 10+, Edge)
2. РљР°Рє СѓСЃС‚Р°РЅРѕРІРёС‚СЊ / Р·Р°РїСѓСЃС‚РёС‚СЊ
3. Р“РґРµ С…СЂР°РЅСЏС‚СЃСЏ РґР°РЅРЅС‹Рµ (~/.keyset/)
4. РљР°Рє СѓРґР°Р»РёС‚СЊ (СѓРґР°Р»РёС‚СЊ .exe + ~/.keyset/)

**Troubleshooting:**
- Р§С‚Рѕ РґРµР»Р°С‚СЊ РµСЃР»Рё Edge РЅРµ Р·Р°РїСѓСЃРєР°РµС‚СЃСЏ
- РџСЂРѕР±Р»РµРјС‹ СЃ РїРѕСЂС‚Р°РјРё (firewall)
- РћС‡РёСЃС‚РєР° РІСЂРµРјРµРЅРЅС‹С… С„Р°Р№Р»РѕРІ

---

## 10. РљРѕРјР°РЅРґС‹ РґР»СЏ СЂР°Р±РѕС‚С‹

### 10.1 РЎР±РѕСЂРєР° .exe

```bash
cd C:\AI\yandex\KeySet-MVP
.\build.ps1
```

Р РµР·СѓР»СЊС‚Р°С‚: `dist\KeySet.exe`

### 10.2 Р—Р°РїСѓСЃРє РІ dev СЂРµР¶РёРјРµ

```bash
cd C:\AI\yandex\KeySet-MVP
.venv\Scripts\python.exe launcher.py
```

### 10.3 РћС‡РёСЃС‚РєР° Р°СЂС‚РµС„Р°РєС‚РѕРІ

```bash
Remove-Item dist -Recurse -Force
Remove-Item build\KeySet -Recurse -Force
```

### 10.4 РћСЃС‚Р°РЅРѕРІРєР° РІСЃРµС… РїСЂРѕС†РµСЃСЃРѕРІ

```bash
taskkill /F /IM python.exe /T
taskkill /F /IM KeySet.exe /T
```

### 10.5 РџСЂРѕРІРµСЂРєР° СЂР°Р·РјРµСЂР° .exe

```bash
Get-Item dist\KeySet.exe | Select-Object Name, @{Name="Size(MB)";Expression={[math]::Round($_.Length/1MB, 2)}}
```

---

## 11. Р’С‹РІРѕРґС‹

### 11.1 РЈСЃРїРµС…Рё

вњ… **РЎРѕР±СЂР°РЅ СЂР°Р±РѕС‡РёР№ .exe С„Р°Р№Р»** - РѕРґРёРЅ С„Р°Р№Р» СЃРѕРґРµСЂР¶РёС‚ РІСЃС‘ РїСЂРёР»РѕР¶РµРЅРёРµ
вњ… **Edge --app mode СЂР°Р±РѕС‚Р°РµС‚** - РѕРєРЅРѕ Р±РµР· Р°РґСЂРµСЃРЅРѕР№ СЃС‚СЂРѕРєРё
вњ… **РќР°С‚РёРІРЅС‹Р№ РІРёРґ** - РІС‹РіР»СЏРґРёС‚ РєР°Рє desktop РїСЂРёР»РѕР¶РµРЅРёРµ
вњ… **Backend РІРЅСѓС‚СЂРё РїСЂРѕС†РµСЃСЃР°** - РЅРµС‚ РѕС‚РґРµР»СЊРЅРѕРіРѕ server.exe
вњ… **Р”РёРЅР°РјРёС‡РµСЃРєРёРµ РїРѕСЂС‚С‹** - РјРѕР¶РЅРѕ Р·Р°РїСѓСЃС‚РёС‚СЊ РЅРµСЃРєРѕР»СЊРєРѕ РєРѕРїРёР№
вњ… **SQLite РїРµСЂСЃРёСЃС‚РµРЅС‚РЅРѕСЃС‚СЊ** - РґР°РЅРЅС‹Рµ СЃРѕС…СЂР°РЅСЏСЋС‚СЃСЏ РјРµР¶РґСѓ Р·Р°РїСѓСЃРєР°РјРё
вњ… **Р‘С‹СЃС‚СЂС‹Р№ Р·Р°РїСѓСЃРє** - 4-5 СЃРµРєСѓРЅРґ РґРѕ РіРѕС‚РѕРІРЅРѕСЃС‚Рё
вњ… **РђРІС‚РѕРјР°С‚РёС‡РµСЃРєР°СЏ СЃР±РѕСЂРєР°** - build.ps1 СЃРєСЂРёРїС‚

### 11.2 РљР»СЋС‡РµРІС‹Рµ С‚РµС…РЅРёС‡РµСЃРєРёРµ СЂРµС€РµРЅРёСЏ

1. **PyInstaller onefile** - СѓРїР°РєРѕРІРєР° РІ РѕРґРёРЅ .exe
2. **Threading РґР»СЏ backend** - daemon РїРѕС‚РѕРє РІРЅСѓС‚СЂРё РїСЂРѕС†РµСЃСЃР°
3. **Edge --app mode** - РІРјРµСЃС‚Рѕ PyWebView
4. **Р”РёРЅР°РјРёС‡РµСЃРєРёР№ РІС‹Р±РѕСЂ РїРѕСЂС‚Р°** - РёР·Р±РµРіР°РµРј РєРѕРЅС„Р»РёРєС‚РѕРІ
5. **РСЃРєР»СЋС‡РµРЅРёРµ webview_app** - РѕР±С…РѕРґ РїСЂРѕР±Р»РµРјС‹ РґР»РёРЅРЅС‹С… РїСѓС‚РµР№
6. **РљРѕРїРёСЂРѕРІР°РЅРёРµ Р‘Р” РІ ~/.keyset/** - read/write РґРѕСЃС‚СѓРї

### 11.3 РџРѕР»СѓС‡РµРЅРЅС‹Р№ РѕРїС‹С‚

**Р§С‚Рѕ СѓР·РЅР°Р»:**
- PyInstaller РјРѕР¶РµС‚ СѓРїР°РєРѕРІР°С‚СЊ FastAPI + React РІ РѕРґРёРЅ .exe
- Edge --app mode СЃРѕР·РґР°РµС‚ РѕС‚Р»РёС‡РЅС‹Р№ РЅР°С‚РёРІРЅС‹Р№ РІРёРґ
- Р’Р°Р¶РЅРѕ РёСЃРєР»СЋС‡Р°С‚СЊ РЅРµРЅСѓР¶РЅС‹Рµ С„Р°Р№Р»С‹ (node_modules)
- Windows РїСѓС‚Рё РѕРіСЂР°РЅРёС‡РµРЅС‹ 260 СЃРёРјРІРѕР»Р°РјРё
- Daemon РїРѕС‚РѕРєРё СѓРґРѕР±РЅС‹ РґР»СЏ background Р·Р°РґР°С‡
- Health check РєСЂРёС‚РёС‡РµРЅ РґР»СЏ СЃРёРЅС…СЂРѕРЅРёР·Р°С†РёРё

**РџСЂРѕР±Р»РµРјС‹ Рё СЂРµС€РµРЅРёСЏ:**
- Р”Р»РёРЅРЅС‹Рµ РїСѓС‚Рё в†’ РёСЃРєР»СЋС‡РёС‚СЊ webview_app
- Edge РЅРµ Р·Р°РїСѓСЃРєР°РµС‚СЃСЏ в†’ РёСЃРїРѕР»СЊР·РѕРІР°С‚СЊ РїРѕР»РЅС‹Рµ РїСѓС‚Рё
- Backend РЅРµ РёРјРїРѕСЂС‚РёСЂСѓРµС‚СЃСЏ в†’ РґРѕР±Р°РІРёС‚СЊ РІ datas + sys.path
- Р‘Р” read-only в†’ РєРѕРїРёСЂРѕРІР°С‚СЊ РІ home directory

### 11.4 Р¤РёРЅР°Р»СЊРЅР°СЏ РѕС†РµРЅРєР°

**Р—Р°РґР°С‡Р° РІС‹РїРѕР»РЅРµРЅР°:** вњ…
**РЎРѕРѕС‚РІРµС‚СЃС‚РІРёРµ С‚СЂРµР±РѕРІР°РЅРёСЏРј:** 100%
**РљР°С‡РµСЃС‚РІРѕ РєРѕРґР°:** РҐРѕСЂРѕС€РµРµ
**Р”РѕРєСѓРјРµРЅС‚Р°С†РёСЏ:** РџРѕР»РЅР°СЏ

**KeySet.exe РіРѕС‚РѕРІ Рє РёСЃРїРѕР»СЊР·РѕРІР°РЅРёСЋ.**

---

## 12. Р¤Р°Р№Р»С‹ РїСЂРѕРµРєС‚Р°

### 12.1 РљР»СЋС‡РµРІС‹Рµ С„Р°Р№Р»С‹

| Р¤Р°Р№Р» | РќР°Р·РЅР°С‡РµРЅРёРµ | Р Р°Р·РјРµСЂ |
|------|-----------|--------|
| `launcher.py` | Р“Р»Р°РІРЅР°СЏ С‚РѕС‡РєР° РІС…РѕРґР° | ~4 KB |
| `build/keyset.spec` | РљРѕРЅС„РёРіСѓСЂР°С†РёСЏ PyInstaller | ~3 KB |
| `build/build.ps1` | РЎРєСЂРёРїС‚ Р°РІС‚РѕРјР°С‚РёС‡РµСЃРєРѕР№ СЃР±РѕСЂРєРё | ~2 KB |
| `backend/main.py` | FastAPI РїСЂРёР»РѕР¶РµРЅРёРµ | ~15 KB |
| `frontend/dist/` | РЎРѕР±СЂР°РЅРЅС‹Р№ React | ~5 MB |
| `dist/KeySet.exe` | **Р¤РРќРђР›Р¬РќР«Р™ .exe С„Р°Р№Р»** | **94 MB** |

### 12.2 Р Р°СЃРїРѕР»РѕР¶РµРЅРёРµ РєРѕРјРїРѕРЅРµРЅС‚РѕРІ РїРѕСЃР»Рµ СЃР±РѕСЂРєРё

```
KeySet.exe (Р·Р°РїСѓС‰РµРЅ)
    в†“
Р Р°СЃРїР°РєРѕРІРєР° РІ %TEMP%\_MEI*
    в”њв”Ђв”Ђ launcher.py
    в”њв”Ђв”Ђ backend/
    в”‚   в”њв”Ђв”Ђ main.py
    в”‚   в””в”Ђв”Ђ ...
    в”њв”Ђв”Ђ frontend/dist/
    в”‚   в”њв”Ђв”Ђ index.html
    в”‚   в”њв”Ђв”Ђ assets/*.js
    в”‚   в””в”Ђв”Ђ assets/*.css
    в”њв”Ђв”Ђ keyset/
    в”‚   в”њв”Ђв”Ђ core/db.py
    в”‚   в””в”Ђв”Ђ keyset.db (С€Р°Р±Р»РѕРЅ)
    в””в”Ђв”Ђ python313.dll + Р·Р°РІРёСЃРёРјРѕСЃС‚Рё

Runtime РґР°РЅРЅС‹Рµ:
    в”њв”Ђв”Ђ ~/.keyset/keyset.db (СЂР°Р±РѕС‡Р°СЏ Р‘Р”)
    в””в”Ђв”Ђ %TEMP%/KeySet_EdgeData/ (Edge profile)
```

---

## 13. РљРѕРЅС‚Р°РєС‚С‹ Рё РґР°Р»СЊРЅРµР№С€Р°СЏ СЂР°Р·СЂР°Р±РѕС‚РєР°

**РџСЂРѕРµРєС‚:** KeySet-MVP
**Р”Р°С‚Р° СЃРѕР·РґР°РЅРёСЏ РѕС‚С‡РµС‚Р°:** 11 РЅРѕСЏР±СЂСЏ 2025
**Р’РµСЂСЃРёСЏ:** 1.0

**РЎР»РµРґСѓСЋС‰РёРµ С€Р°РіРё:**
1. Р”РѕР±Р°РІРёС‚СЊ РёРєРѕРЅРєСѓ РїСЂРёР»РѕР¶РµРЅРёСЏ
2. РћС‚РєР»СЋС‡РёС‚СЊ РєРѕРЅСЃРѕР»СЊ (console=False)
3. РЎРѕР·РґР°С‚СЊ installer
4. РџСЂРѕС‚РµСЃС‚РёСЂРѕРІР°С‚СЊ РЅР° СЂР°Р·РЅС‹С… РІРµСЂСЃРёСЏС… Windows

**РР·РІРµСЃС‚РЅС‹Рµ РѕРіСЂР°РЅРёС‡РµРЅРёСЏ:**
- РўРѕР»СЊРєРѕ Windows (С‚СЂРµР±СѓРµС‚ Edge)
- РљРѕРЅСЃРѕР»СЊРЅРѕРµ РѕРєРЅРѕ РІРёРґРёРјРѕ
- РќРµС‚ Р°РІС‚РѕРѕР±РЅРѕРІР»РµРЅРёР№

**РџСЂРѕРёР·РІРѕРґРёС‚РµР»СЊРЅРѕСЃС‚СЊ:**
- Р—Р°РїСѓСЃРє: 4-5 СЃРµРєСѓРЅРґ
- РџР°РјСЏС‚СЊ: ~350 MB
- Р Р°Р·РјРµСЂ: 94 MB

---

**РћС‚С‡РµС‚ Р·Р°РІРµСЂС€РµРЅ.**
