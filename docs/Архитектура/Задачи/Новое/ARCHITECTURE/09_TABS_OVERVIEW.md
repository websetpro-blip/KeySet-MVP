# 09. РћР±Р·РѕСЂ РІРєР»Р°РґРѕРє KeySet-MVP

> **Р”РѕРєСѓРјРµРЅС‚Р°С†РёСЏ UI РјРѕРґСѓР»РµР№: РђРєРєР°СѓРЅС‚С‹, Р”Р°РЅРЅС‹Рµ, РњР°СЃРєРё, РђРЅР°Р»РёС‚РёРєР°**

## рџ“‹ РЎРѕРґРµСЂР¶Р°РЅРёРµ

- [Р¦РµР»СЊ](#С†РµР»СЊ)
- [Р”Р»СЏ РєРѕРіРѕ](#РґР»СЏ-РєРѕРіРѕ)
- [РЎРІСЏР·Р°РЅРЅС‹Рµ РґРѕРєСѓРјРµРЅС‚С‹](#СЃРІСЏР·Р°РЅРЅС‹Рµ-РґРѕРєСѓРјРµРЅС‚С‹)
- [РђСЂС…РёС‚РµРєС‚СѓСЂР° РІРєР»Р°РґРѕРє](#Р°СЂС…РёС‚РµРєС‚СѓСЂР°-РІРєР»Р°РґРѕРє)
- [Р”РёР°РіСЂР°РјРјР° РЅР°РІРёРіР°С†РёРё](#РґРёР°РіСЂР°РјРјР°-РЅР°РІРёРіР°С†РёРё)
- [РњРѕРґСѓР»Рё Рё С„СѓРЅРєС†РёРѕРЅР°Р»](#РјРѕРґСѓР»Рё-Рё-С„СѓРЅРєС†РёРѕРЅР°Р»)
- [РЎРЅРёРїРїРµС‚С‹ РєРѕРґР°](#СЃРЅРёРїРїРµС‚С‹-РєРѕРґР°)
- [РўРёРїРѕРІС‹Рµ РѕС€РёР±РєРё](#С‚РёРїРѕРІС‹Рµ-РѕС€РёР±РєРё)
- [Р‘С‹СЃС‚СЂС‹Р№ СЃС‚Р°СЂС‚](#Р±С‹СЃС‚СЂС‹Р№-СЃС‚Р°СЂС‚)
- [TL;DR](#tldr)
- [Р§РµРє-Р»РёСЃС‚ РїСЂРёРјРµРЅРµРЅРёСЏ](#С‡РµРє-Р»РёСЃС‚-РїСЂРёРјРµРЅРµРЅРёСЏ)

---

## Р¦РµР»СЊ

Р”РѕРєСѓРјРµРЅС‚Р°С†РёСЏ UI РјРѕРґСѓР»РµР№ KeySet-MVP: РѕР±Р·РѕСЂ С„СѓРЅРєС†РёРѕРЅР°Р»Р° РєР°Р¶РґРѕР№ РІРєР»Р°РґРєРё, РІР·Р°РёРјРѕРґРµР№СЃС‚РІРёРµ РјРµР¶РґСѓ РјРѕРґСѓР»СЏРјРё, РєРѕРјРїРѕРЅРµРЅС‚С‹ Рё РёС… РЅР°Р·РЅР°С‡РµРЅРёРµ.

## Р”Р»СЏ РєРѕРіРѕ

- Frontend СЂР°Р·СЂР°Р±РѕС‚С‡РёРєРё РґР»СЏ РїРѕРЅРёРјР°РЅРёСЏ СЃС‚СЂСѓРєС‚СѓСЂС‹ UI
- Product managers РґР»СЏ feature mapping
- QA РґР»СЏ С‚РµСЃС‚РёСЂРѕРІР°РЅРёСЏ С„СѓРЅРєС†РёРѕРЅР°Р»Р°
- UX РґРёР·Р°Р№РЅРµСЂС‹ РґР»СЏ СѓР»СѓС‡С€РµРЅРёСЏ РёРЅС‚РµСЂС„РµР№СЃР°

## РЎРІСЏР·Р°РЅРЅС‹Рµ РґРѕРєСѓРјРµРЅС‚С‹

- [08_FRONTEND_STRUCTURE.md](./08_FRONTEND_STRUCTURE.md) вЂ” Р°СЂС…РёС‚РµРєС‚СѓСЂР° frontend
- [10_API_INTEGRATION.md](./10_API_INTEGRATION.md) вЂ” API СЌРЅРґРїРѕРёРЅС‚С‹
- [11_DATA_FLOW.md](./11_DATA_FLOW.md) вЂ” РїРѕС‚РѕРєРё РґР°РЅРЅС‹С…

---

## РђСЂС…РёС‚РµРєС‚СѓСЂР° РІРєР»Р°РґРѕРє

```mermaid
graph TD
    A[Main Navigation] --> B1[рџ“Љ Accounts Tab]
    A --> B2[рџ“‹ Data Tab]
    A --> B3[рџ”¤ Masks Tab]
    A --> B4[рџ“€ Analytics Tab]
    
    B1 -->|CRUD| C1[Accounts Management]
    B1 -->|Auth| C2[Auto-login]
    B1 -->|Profiles| C3[Chrome Profiles]
    
    B2 -->|View| D1[Phrases Table]
    B2 -->|Filter| D2[Groups Filter]
    B2 -->|Export| D3[CSV/Excel Export]
    
    B3 -->|Generate| E1[Keywords Generator]
    B3 -->|Templates| E2[Mask Templates]
    B3 -->|Preview| E3[Results Preview]
    
    B4 -->|Stats| F1[Parsing Statistics]
    B4 -->|Charts| F2[Data Visualization]
    B4 -->|Reports| F3[Export Reports]
```

---

## Р”РёР°РіСЂР°РјРјР° РЅР°РІРёРіР°С†РёРё

```mermaid
stateDiagram-v2
    [*] --> Accounts
    Accounts --> Data: РџРѕСЃР»Рµ РЅР°СЃС‚СЂРѕР№РєРё Р°РєРєР°СѓРЅС‚РѕРІ
    Data --> Masks: Р”Р»СЏ РіРµРЅРµСЂР°С†РёРё С„СЂР°Р·
    Masks --> Data: РЎРіРµРЅРµСЂРёСЂРѕРІР°РЅРЅС‹Рµ С„СЂР°Р·С‹
    Data --> Analytics: РџСЂРѕСЃРјРѕС‚СЂ СЃС‚Р°С‚РёСЃС‚РёРєРё
    Analytics --> Data: Р’РѕР·РІСЂР°С‚ Рє РґР°РЅРЅС‹Рј
    
    Accounts --> Accounts: CRUD РѕРїРµСЂР°С†РёРё
    Data --> Data: Р¤РёР»СЊС‚СЂР°С†РёСЏ, СЌРєСЃРїРѕСЂС‚
    Masks --> Masks: РќР°СЃС‚СЂРѕР№РєР° С€Р°Р±Р»РѕРЅРѕРІ
    Analytics --> Analytics: Р’С‹Р±РѕСЂ РїРµСЂРёРѕРґР°
```

---

## РњРѕРґСѓР»Рё Рё С„СѓРЅРєС†РёРѕРЅР°Р»

### 1. рџ“Љ Accounts Tab (РђРєРєР°СѓРЅС‚С‹)

**РќР°Р·РЅР°С‡РµРЅРёРµ:** РЈРїСЂР°РІР»РµРЅРёРµ Yandex Р°РєРєР°СѓРЅС‚Р°РјРё РґР»СЏ РїР°СЂСЃРёРЅРіР°

**Р¤СѓРЅРєС†РёРѕРЅР°Р»:**
- Р”РѕР±Р°РІР»РµРЅРёРµ/СѓРґР°Р»РµРЅРёРµ Р°РєРєР°СѓРЅС‚РѕРІ
- РђРІС‚Рѕ-Р»РѕРіРёРЅ С‡РµСЂРµР· Chrome profiles
- РќР°СЃС‚СЂРѕР№РєР° РїСЂРѕРєСЃРё РґР»СЏ Р°РєРєР°СѓРЅС‚РѕРІ
- РЎС‚Р°С‚СѓСЃС‹: ok/cooldown/captcha/banned
- РўРµСЃС‚РёСЂРѕРІР°РЅРёРµ РїРѕРґРєР»СЋС‡РµРЅРёСЏ

### 2. рџ“‹ Data Tab (Р”Р°РЅРЅС‹Рµ)

**РќР°Р·РЅР°С‡РµРЅРёРµ:** РџСЂРѕСЃРјРѕС‚СЂ Рё СѓРїСЂР°РІР»РµРЅРёРµ СЃРїР°СЂСЃРµРЅРЅС‹РјРё С„СЂР°Р·Р°РјРё

**Р¤СѓРЅРєС†РёРѕРЅР°Р»:**
- РўР°Р±Р»РёС†Р° РІСЃРµС… С„СЂР°Р· СЃ РїРѕРєР°Р·Р°С‚РµР»СЏРјРё
- Р“СЂСѓРїРїРёСЂРѕРІРєР° РїРѕ РєР°С‚РµРіРѕСЂРёСЏРј
- Р¤РёР»СЊС‚СЂР°С†РёСЏ РїРѕ СЂРµРіРёРѕРЅСѓ, РґР°С‚Рµ, РіСЂСѓРїРїРµ
- Р­РєСЃРїРѕСЂС‚ РІ CSV/Excel
- РњР°СЃСЃРѕРІРѕРµ СѓРґР°Р»РµРЅРёРµ

### 3. рџ”¤ Masks Tab (РњР°СЃРєРё)

**РќР°Р·РЅР°С‡РµРЅРёРµ:** Р“РµРЅРµСЂР°С†РёСЏ РєР»СЋС‡РµРІС‹С… СЃР»РѕРІ РїРѕ С€Р°Р±Р»РѕРЅР°Рј

**Р¤СѓРЅРєС†РёРѕРЅР°Р»:**
- РЎРѕР·РґР°РЅРёРµ РјР°СЃРѕРє (С€Р°Р±Р»РѕРЅРѕРІ)
- РџРѕРґСЃС‚Р°РЅРѕРІРєР° РїРµСЂРµРјРµРЅРЅС‹С…
- Р“РµРЅРµСЂР°С†РёСЏ РєРѕРјР±РёРЅР°С†РёР№
- Preview СЂРµР·СѓР»СЊС‚Р°С‚РѕРІ
- Р­РєСЃРїРѕСЂС‚ СЃРїРёСЃРєР° С„СЂР°Р·

### 4. рџ“€ Analytics Tab (РђРЅР°Р»РёС‚РёРєР°)

**РќР°Р·РЅР°С‡РµРЅРёРµ:** РЎС‚Р°С‚РёСЃС‚РёРєР° Рё РІРёР·СѓР°Р»РёР·Р°С†РёСЏ РґР°РЅРЅС‹С…

**Р¤СѓРЅРєС†РёРѕРЅР°Р»:**
- Р“СЂР°С„РёРєРё РїР°СЂСЃРёРЅРіР° РїРѕ РІСЂРµРјРµРЅРё
- РўРѕРї С„СЂР°Р· РїРѕ РїРѕРєР°Р·Р°Рј
- РЎС‚Р°С‚РёСЃС‚РёРєР° РїРѕ СЂРµРіРёРѕРЅР°Рј
- РџСЂРѕРёР·РІРѕРґРёС‚РµР»СЊРЅРѕСЃС‚СЊ Р°РєРєР°СѓРЅС‚РѕРІ
- Р­РєСЃРїРѕСЂС‚ РѕС‚С‡РµС‚РѕРІ

---

## РЎРЅРёРїРїРµС‚С‹ РєРѕРґР°

### Accounts Module

```typescript
// С„Р°Р№Р»: frontend/src/modules/accounts/index.tsx:26-41
const loadAccounts = useCallback(async () => {
  setIsLoading(true);
  setError(null);
  try {
    const data = await fetchAccounts();
    setAccounts(data);
  } catch (loadError) {
    setAccounts([]);
    setError(
      (loadError as Error).message ||
        "РќРµ СѓРґР°Р»РѕСЃСЊ Р·Р°РіСЂСѓР·РёС‚СЊ Р°РєРєР°СѓРЅС‚С‹. РџСЂРѕРІРµСЂСЊС‚Рµ backend."
    );
  } finally {
    setIsLoading(false);
  }
}, []);
```

### Data Module

```typescript
// С„Р°Р№Р»: frontend/src/modules/data/App.tsx:63-84
const { 
  selectedPhraseIds, 
  phrases,
  groups,
  clearFilters,
  deletePhrases, 
  selectAll, 
  deselectAll,
  invertSelection,
  undo,
  redo,
  canUndo,
  canRedo,
  addLog,
  movePhrasesToGroup,
  copyPhrasesToGroup,
  updateGroupParent,
  loadInitialData,
  isDataLoaded,
  isDataLoading,
  dataError,
} = useStore();
```

### Masks Module (РіРµРЅРµСЂР°С‚РѕСЂ)

```typescript
// С„Р°Р№Р»: frontend/src/modules/masks/lib/stream-generator.ts:25-50 (СѓРїСЂРѕС‰РµРЅРѕ)
export async function* generateStream(
  template: string,
  options: GeneratorOptions
): AsyncGenerator<GeneratedPhrase> {
  const lines = template.split('\\n').filter(l => l.trim());
  let counter = 0;
  
  for (const line of lines) {
    // РћР±СЂР°Р±РѕС‚РєР° С€Р°Р±Р»РѕРЅР° СЃ РїРѕРґСЃС‚Р°РЅРѕРІРєР°РјРё
    const processed = processTemplate(line, options);
    
    for (const variant of processed) {
      yield {
        id: `${Date.now()}-${counter++}`,
        text: variant,
        source: 'mask-generator'
      };
      
      // РџР°СѓР·Р° РґР»СЏ РёР·Р±РµР¶Р°РЅРёСЏ Р±Р»РѕРєРёСЂРѕРІРєРё UI
      if (counter % 100 === 0) {
        await new Promise(r => setTimeout(r, 0));
      }
    }
  }
}
```

### Analytics Module

```typescript
// С„Р°Р№Р»: frontend/src/modules/analytics/App.tsx (РєРѕРЅС†РµРїС‚ вЂ” РјРѕРґСѓР»СЊ РЅР°С…РѕРґРёС‚СЃСЏ РІ СЂР°Р·СЂР°Р±РѕС‚РєРµ)
// РџСЂРёРјРµСЂ СЃС‚СЂСѓРєС‚СѓСЂС‹:
export default function AnalyticsModule() {
  const [stats, setStats] = useState<ParsingStats | null>(null);
  
  useEffect(() => {
    fetchParsingStatistics().then(setStats);
  }, []);
  
  return (
    <div>
      <h1>РЎС‚Р°С‚РёСЃС‚РёРєР° РїР°СЂСЃРёРЅРіР°</h1>
      {stats && <StatsChart data={stats} />}
    </div>
  );
}
```

---

## РўРёРїРѕРІС‹Рµ РѕС€РёР±РєРё / РљР°Рє С‡РёРЅРёС‚СЊ

### вќЊ РћС€РёР±РєР°: "Table not rendering data"

**РџСЂРёС‡РёРЅР°:** Zustand store РЅРµ Р·Р°РіСЂСѓР¶РµРЅ РёР»Рё РґР°РЅРЅС‹Рµ РµС‰С‘ РЅРµ РіРѕС‚РѕРІС‹.

**РљР°Рє С‡РёРЅРёС‚СЊ:**
1. РЈР±РµРґРёС‚РµСЃСЊ, С‡С‚Рѕ `loadInitialData()` РІС‹Р·С‹РІР°РµС‚СЃСЏ РІ `useEffect` РїСЂРё РјРѕРЅС‚РёСЂРѕРІР°РЅРёРё Data РјРѕРґСѓР»СЏ.
2. РџРѕРєР°Р·С‹РІР°Р№С‚Рµ `Loader2` (СЃРј. `App.tsx`) РїРѕРєР° `isDataLoading === true`.
3. Р›РѕРіРёСЂСѓР№С‚Рµ `dataError` Рё РѕС‚РѕР±СЂР°Р¶Р°Р№С‚Рµ РµРіРѕ РІ `StatusBar`.

### вќЊ РћС€РёР±РєР°: "Filter not working"

**РџСЂРёС‡РёРЅР°:** State РЅРµ РѕР±РЅРѕРІР»СЏРµС‚СЃСЏ РёР»Рё С„РёР»СЊС‚СЂ РїСЂРёРјРµРЅСЏРµС‚СЃСЏ Рє РЅРµРІРµСЂРЅРѕРјСѓ РїРѕР»СЋ.

**РљР°Рє С‡РёРЅРёС‚СЊ:**
1. РџСЂРѕРІРµСЂСЊС‚Рµ СЃРµР»РµРєС‚РѕСЂС‹ РІ `useStore` вЂ” С„РёР»СЊС‚СЂС‹ РґРѕР»Р¶РЅС‹ РѕР±РЅРѕРІР»СЏС‚СЊ `filters` РІРЅСѓС‚СЂРё Zustand.
2. РСЃРїРѕР»СЊР·СѓР№С‚Рµ `useMemo` Рё С„СѓРЅРєС†РёРё `filterAccounts`/`applyFilters` РґР»СЏ С‡РёСЃС‚С‹С… РІС‹С‡РёСЃР»РµРЅРёР№.
3. Р”РѕР±Р°РІСЊС‚Рµ debounce (РЅР°РїСЂРёРјРµСЂ, `useDebounce`) РґР»СЏ С‚РµРєСЃС‚РѕРІС‹С… РёРЅРїСѓС‚РѕРІ, С‡С‚РѕР±С‹ РїСЂРµРґРѕС‚РІСЂР°С‚РёС‚СЊ Р»РёС€РЅРёРµ СЂРµСЂРµРЅРґРµСЂС‹.

### вќЊ РћС€РёР±РєР°: "Export produces empty file"

**РџСЂРёС‡РёРЅР°:** Р­РєСЃРїРѕСЂС‚ Р·Р°РїСѓСЃРєР°РµС‚СЃСЏ РґРѕ Р·Р°РіСЂСѓР·РєРё РґР°РЅРЅС‹С… РёР»Рё РЅРµ РІС‹Р±СЂР°РЅС‹ СЃС‚СЂРѕРєРё.

**РљР°Рє С‡РёРЅРёС‚СЊ:**
1. РџРµСЂРµРґ СЌРєСЃРїРѕСЂС‚РѕРј РїСЂРѕРІРµСЂСЏР№С‚Рµ `phrases.length` Рё РІС‹РІРѕРґРёС‚Рµ РїСЂРµРґСѓРїСЂРµР¶РґРµРЅРёРµ С‡РµСЂРµР· `addLog('warning', ...)`.
2. Р”Р»СЏ РјР°СЃСЃРѕРІРѕРіРѕ СЌРєСЃРїРѕСЂС‚Р° РёСЃРїРѕР»СЊР·СѓР№С‚Рµ `MassBulkPanel` вЂ” РѕРЅ РїСЂРѕРІРµСЂСЏРµС‚ РІС‹РґРµР»РµРЅРЅС‹Рµ СЃС‚СЂРѕРєРё.
3. РЈР±РµРґРёС‚РµСЃСЊ, С‡С‚Рѕ `exportToCSV` РїРѕР»СѓС‡Р°РµС‚ С‡РёСЃС‚С‹Р№ РјР°СЃСЃРёРІ РѕР±СЉРµРєС‚РѕРІ (Р±РµР· `Set`/`Map`).

---

## Р‘С‹СЃС‚СЂС‹Р№ СЃС‚Р°СЂС‚

### 1. РќР°РІРёРіР°С†РёСЏ РјРµР¶РґСѓ РІРєР»Р°РґРєР°РјРё

```typescript
import { useNavigate } from 'react-router-dom';

const navigate = useNavigate();

// РџРµСЂРµС…РѕРґ РЅР° РІРєР»Р°РґРєСѓ Data
navigate('/data');
```

### 2. Р—Р°РіСЂСѓР·РєР° РґР°РЅРЅС‹С… РјРѕРґСѓР»СЏ

```typescript
import { useDataStore } from '@/stores/dataStore';

const { phrases, fetchPhrases } = useDataStore();

useEffect(() => {
  fetchPhrases();
}, []);
```

### 3. Р­РєСЃРїРѕСЂС‚ РґР°РЅРЅС‹С…

```typescript
import { exportToCSV } from '@/lib/export';

const handleExport = () => {
  exportToCSV(phrases, 'phrases.csv');
};
```

---

## TL;DR

- **Accounts** вЂ” СѓРїСЂР°РІР»РµРЅРёРµ Yandex Р°РєРєР°СѓРЅС‚Р°РјРё
- **Data** вЂ” РїСЂРѕСЃРјРѕС‚СЂ Рё С„РёР»СЊС‚СЂР°С†РёСЏ С„СЂР°Р·
- **Masks** вЂ” РіРµРЅРµСЂР°С†РёСЏ РєР»СЋС‡РµРІС‹С… СЃР»РѕРІ
- **Analytics** вЂ” СЃС‚Р°С‚РёСЃС‚РёРєР° Рё РѕС‚С‡РµС‚С‹
- **React Router** вЂ” РЅР°РІРёРіР°С†РёСЏ РјРµР¶РґСѓ РјРѕРґСѓР»СЏРјРё
- **Zustand** вЂ” state РґР»СЏ РєР°Р¶РґРѕРіРѕ РјРѕРґСѓР»СЏ

---

## Р§РµРє-Р»РёСЃС‚ РїСЂРёРјРµРЅРµРЅРёСЏ

- [ ] Р’СЃРµ 4 РјРѕРґСѓР»СЏ РґРѕСЃС‚СѓРїРЅС‹ РІ РЅР°РІРёРіР°С†РёРё
- [ ] Accounts: CRUD РѕРїРµСЂР°С†РёРё СЂР°Р±РѕС‚Р°СЋС‚
- [ ] Accounts: Auto-login РЅР°СЃС‚СЂРѕРµРЅ
- [ ] Data: РўР°Р±Р»РёС†Р° РѕС‚РѕР±СЂР°Р¶Р°РµС‚ С„СЂР°Р·С‹
- [ ] Data: Р¤РёР»СЊС‚СЂС‹ РїСЂРёРјРµРЅСЏСЋС‚СЃСЏ
- [ ] Data: Р­РєСЃРїРѕСЂС‚ РІ CSV/Excel СЂР°Р±РѕС‚Р°РµС‚
- [ ] Masks: Р“РµРЅРµСЂР°С†РёСЏ РїРѕ С€Р°Р±Р»РѕРЅР°Рј
- [ ] Masks: Preview РїРѕРєР°Р·С‹РІР°РµС‚ СЂРµР·СѓР»СЊС‚Р°С‚
- [ ] Analytics: Р“СЂР°С„РёРєРё РѕС‚РѕР±СЂР°Р¶Р°СЋС‚СЃСЏ
- [ ] Analytics: Р­РєСЃРїРѕСЂС‚ РѕС‚С‡РµС‚РѕРІ СЂР°Р±РѕС‚Р°РµС‚

---

**РџРѕСЃР»РµРґРЅРµРµ РѕР±РЅРѕРІР»РµРЅРёРµ:** 2024-11-10

**РЎР»РµРґСѓСЋС‰РёР№ С€Р°Рі:** [10_API_INTEGRATION.md](./10_API_INTEGRATION.md) вЂ” API РёРЅС‚РµРіСЂР°С†РёСЏ
