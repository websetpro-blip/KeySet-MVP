## 05. Р¦РµРїРѕС‡РєР° В«Р”Р°РЅРЅС‹Рµ в†’ Р“РµРѕ в†’ Р§Р°СЃС‚РѕС‚РєР°В»

> РџР°РјСЏС‚РєР° РґР»СЏ РІСЃРµС…, РєС‚Рѕ Р±СѓРґРµС‚ РїРѕРґРєР»СЋС‡Р°С‚СЊ РѕСЃС‚Р°Р»СЊРЅС‹Рµ РјРѕРґСѓР»Рё: Р·РґРµСЃСЊ СЃРѕР±СЂР°РЅ РїРѕР»РЅС‹Р№ С†РёРєР» РІРѕСЃСЃС‚Р°РЅРѕРІР»РµРЅРёСЏ РІРєР»Р°РґРєРё В«Р”Р°РЅРЅС‹РµВ» РІ KeySet-MVP (РЅРѕСЏР±СЂСЊ 2025). РЎР»РµРґСѓРµРј СЂРѕРІРЅРѕ СЌС‚РёРј С€Р°РіР°Рј РґР»СЏ РґСЂСѓРіРёС… СЂР°Р·РґРµР»РѕРІ вЂ” С‚РѕР»СЊРєРѕ РїРµСЂРµРЅРѕСЃ Рё РёРЅС‚РµРіСЂР°С†РёСЏ РіРѕС‚РѕРІС‹С… СЃРµСЂРІРёСЃРѕРІ, РЅРёРєР°РєРёС… РїРµСЂРµРїРёСЃС‹РІР°РЅРёРёМ†.

### 1. РСЃС…РѕРґРЅРѕРµ СЃРѕСЃС‚РѕСЏРЅРёРµ (РґРѕ 09.11.2025)
- React-РІРєР»Р°РґРєР° СѓР¶Рµ РїРѕСЂС‚РёСЂРѕРІР°РЅР° РёР· В«Р“РћРўРћР’Р«РҐ РњРћР”РЈР›Р•Р™В», РЅРѕ:
  - `/api/data/phrases` РѕС‚РґР°РІР°Р» `[]` РёР»Рё РїР°РґР°Р» 404, РїРѕС‚РѕРјСѓ С‡С‚Рѕ Р±СЌРєРµРЅРґ РЅРµ РёРјРµР» РјР°СЂС€СЂСѓС‚РѕРІ, РІРѕР·РІСЂР°С‰Р°СЋС‰РёС… С‚Рµ Р¶Рµ РїРѕР»СЏ, С‡С‚Рѕ Р¶РґС‘С‚ UI.
  - `frequency.py` РЅРµ РІРѕР·РІСЂР°С‰Р°Р» `id`, `freq_exact`, `freq_quotes` Рё РЅРµ СѓРјРµР» СѓРґР°Р»СЏС‚СЊ/СЌРєСЃРїРѕСЂС‚РёСЂРѕРІР°С‚СЊ СЃС‚СЂРѕРєРё.
  - `freq_results` РІ SQLite РЅРµ СЃРѕРґРµСЂР¶Р°Р»Р° РєРѕР»РѕРЅРѕРє `freq_quotes`, `freq_exact`, `group` вЂ” СЃС‚Р°СЂС‹Рµ Р±Р°Р·С‹ Р»РѕРјР°Р»Рё РґР°Р¶Рµ SELECT.
  - Zustand-СЃС‚РѕСЂ Рё РјРѕРґР°Р»РєРё РѕРїРёСЂР°Р»РёСЃСЊ РЅР° localStorage: СЂРµРіРёРґСЂР°С‚Р°С†РёСЏ РєРёРґР°Р»Р° `addLog()` РїСЂСЏРјРѕ РІРѕ РІСЂРµРјСЏ `set()`, РїРѕСЌС‚РѕРјСѓ React РІС‹РґР°РІР°Р» `Minified error #185`.
  - WordstatModal СЂРµРЅРґРµСЂРёР»СЃСЏ РІСЃРµРіРґР° Рё СЃСЂР°Р·Сѓ РґС‘СЂРіР°Р» `loadInitialData()` в†’ Р±РµСЃРєРѕРЅРµС‡РЅС‹Р№ С†РёРєР» `setState`.

**РС‚РѕРі:** РІРєР»Р°РґРєР° В«Р”Р°РЅРЅС‹РµВ» РїР°РґР°Р»Р° СЃСЂР°Р·Сѓ РїРѕСЃР»Рµ РѕС‚РєСЂС‹С‚РёСЏ, С†РµРїРѕС‡РєР° РіРµРѕ/С‡Р°СЃС‚РѕС‚РєРё Р±С‹Р»Р° РѕР±СЂСѓР±Р»РµРЅР° РЅР° СѓСЂРѕРІРЅРµ API.

### 2. Backend: РІС‹СЂР°РІРЅРёРІР°РЅРёРµ СЃ legacy-СЃРµСЂРІРёСЃР°РјРё
1. **`keyset/core/db.py`** вЂ” РїСЂРё СЃС‚Р°СЂС‚Рµ РґРѕРєРёРґС‹РІР°РµРј РЅРµРґРѕСЃС‚Р°СЋС‰РёРµ РєРѕР»РѕРЅРєРё РІ `freq_results`, С‡С‚РѕР±С‹ СЃС‚Р°СЂС‹Рµ SQLite-С„Р°Р№Р»С‹ РЅРµ СЂРѕРЅСЏР»Рё ORM.
2. **`keyset/services/frequency.py`**:
   - `list_results()` С‚РµРїРµСЂСЊ РІРѕР·РІСЂР°С‰Р°РµС‚ `id`, `mask`, `freq_total`, `freq_quotes`, `freq_exact`, `updated_at`, `group`.
   - Р”РѕР±Р°РІР»РµРЅС‹ `delete_results(ids)`, `clear_results()`, `export_results()` вЂ” РІСЃС‘ С‡РµСЂРµР· СЃСѓС‰РµСЃС‚РІСѓСЋС‰РёРµ SQL-helpers, Р±РµР· РїРµСЂРµРїРёСЃС‹РІР°РЅРёСЏ Р»РѕРіРёРєРё.
3. **`backend/routers/data.py`**:
   - `GET /api/data/phrases` в†’ Р°РґР°РїС‚РµСЂ РЅР°Рґ `frequency.list_results`, РїРѕРґРґРµСЂР¶РёРІР°РµС‚ `limit/offset/search/status/q/cursor/sort` Рё РІРѕР·РІСЂР°С‰Р°РµС‚ `{ items, nextCursor }`.
   - `POST /api/data/{enqueue|delete|clear|group}` в†’ С‚РѕРЅРєРёРµ РїСЂРѕРєР»Р°РґРєРё Рє `frequency_service`.
   - `GET /api/data/export` в†’ СЃС‚СЂРёРј CSV (8 РєРѕР»РѕРЅРѕРє + ISO `updatedAt`), С‡С‚РѕР±С‹ С„СЂРѕРЅС‚ РЅРµ РіРµРЅРµСЂРёСЂРѕРІР°Р» С„Р°Р№Р» СЃР°Рј.

### 3. Frontend: Р±РµР·РѕРїР°СЃРЅС‹Р№ СЃС‚РѕСЂ Рё РєР»РёРµРЅС‚
1. **API-РєР»РёРµРЅС‚ (`frontend/src/modules/data/api/data.ts`)**
   - DTO СЂР°СЃС€РёСЂРµРЅС‹ РїРѕР»СЏРјРё `wsQuotes/wsExact/freq*`, Р·Р°РїСЂРѕСЃС‹ СѓРјРµСЋС‚ `cursor`, `sort`, `q`.
   - `fetchPhrases` РїР°СЂСЃРёС‚ СЃС‚СЂСѓРєС‚СѓСЂСѓ `{ items, nextCursor }`.
2. **РЎС‚РѕСЂ (`frontend/src/modules/data/store/useStore.ts`)**
   - Р”РѕР±Р°РІР»РµРЅ `phrasesCursor`, РјР°РїРїРµСЂС‹ `pickNumber` РґР»СЏ `ws/qws/bws`.
   - `loadInitialData()` Р¶РґС‘С‚ `items`, СЃР±СЂР°СЃС‹РІР°РµС‚ selected/pinned sets Рё СЃРѕС…СЂР°РЅСЏРµС‚ `phrasesCursor`.
   - Р РµРіРёРґСЂР°С‚Р°С†РёСЏ: `addLog` РІС‹Р·С‹РІР°РµС‚СЃСЏ С‡РµСЂРµР· `setTimeout(..., 0)` вЂ” РЅРµС‚ СЂРµРєСѓСЂСЃРёРІРЅС‹С… setState.
3. **UI/РјРѕРґР°Р»РєРё**
   - WordstatModal Рё РѕСЃС‚Р°Р»СЊРЅС‹Рµ РѕРєРЅР° СЂРµРЅРґРµСЂСЏС‚СЃСЏ РїРѕ СѓСЃР»РѕРІРёСЋ `isOpen`, РёСЃРїРѕР»СЊР·СѓСЋС‚ В«safeВ» РјР°СЃСЃРёРІС‹/Set (guard РѕС‚ Р±РёС‚С‹С… localStorage).
   - ErrorBoundary РѕС‚РїСЂР°РІР»СЏРµС‚ РїР°РґРµРЅРёСЏ РІ `POST /api/debug/react-error`, С‡С‚РѕР±С‹ РЅРѕРІС‹Рµ РїСЂРѕР±Р»РµРјС‹ РІРёРґРЅРѕ Р±С‹Р»Рѕ РІ `backend/react_errors.log`.

### 4. Р”РёР°РіРЅРѕСЃС‚РёРєР° Рё С‚РµСЃС‚С‹
1. `npm run build` (Vite) + `python -m py_compile launcher.py` вЂ” РїСЂРѕРІРµСЂРєР° СЃРёРЅС‚Р°РєСЃРёСЃР°.
2. `python launcher.py` в†’ СЂСѓС‡РЅРѕР№ Р·Р°С…РѕРґ РЅР° РІРєР»Р°РґРєСѓ В«Р”Р°РЅРЅС‹РµВ», РїСЂРѕРІРµСЂРєР°:
   - С‚Р°Р±Р»РёС†Р° РїРѕРєР°Р·С‹РІР°РµС‚ СЃС‚СЂРѕРєРё РёР· SQLite (`ws/qws/bws` СЃРѕРІРїР°РґР°СЋС‚),
   - Р¶СѓСЂРЅР°Р» Р°РєС‚РёРІРЅРѕСЃС‚Рё РѕР¶РёРІР°РµС‚,
   - React #185 РЅРµ РїРѕСЏРІР»СЏРµС‚СЃСЏ (react_errors.log РїСѓСЃС‚РѕР№ РїРѕСЃР»Рµ Р·Р°РїСѓСЃРєР°).
3. РЎРєСЂРёРЅ 10.11.2025 09:48, СЃРѕС…СЂР°РЅС‘РЅРЅС‹Р№ Р·Р°РєР°Р·С‡РёРєРѕРј, С„РёРєСЃРёСЂСѓРµС‚ СѓСЃРїРµС€РЅС‹Р№ Р·Р°РїСѓСЃРє.

### 5. Р§С‚Рѕ РґРµР»Р°С‚СЊ РїСЂРё РїРѕРґРєР»СЋС‡РµРЅРёРё РґСЂСѓРіРёС… РјРѕРґСѓР»РµР№
1. **РќРµ РїРёСЃР°С‚СЊ Р»РѕРіРёРєСѓ Р·Р°РЅРѕРІРѕ.** РўРѕР»СЊРєРѕ РѕР±РѕСЂР°С‡РёРІР°РµРј С„СѓРЅРєС†РёРё РёР· `keyset/services/*` Рё `keyset/core/db.py`.
2. **Р’СЃРµРіРґР° РґРµСЂР¶Р°С‚СЊ API Рё С„СЂРѕРЅС‚ СЃРёРЅС…СЂРѕРЅРЅС‹РјРё:** РµСЃР»Рё Р±СЌРєРµРЅРґ РІРѕР·РІСЂР°С‰Р°РµС‚ `{ items, nextCursor }`, СЃС‚РѕСЂ РѕР±СЏР·Р°РЅ СЂР°Р±РѕС‚Р°С‚СЊ СЃ СЌС‚РѕР№ СЃС‚СЂСѓРєС‚СѓСЂРѕР№.
3. **РџРµСЂРµРґ РїСѓС€РµРј:** `npm run build`, `python launcher.py`, РѕР±РЅРѕРІР»РµРЅРёРµ `Р“РћРўРћР’Р«Р•_РњРћР”РЈР›Р_РїР»Р°РЅ.md`.
4. **Р”РѕРєСѓРјРµРЅС‚РёСЂРѕРІР°С‚СЊ** Р»СЋР±С‹Рµ РёР·РјРµРЅРµРЅРёСЏ РІ `ARCHITECTURE/*.md`, С‡С‚РѕР±С‹ СЃР»РµРґСѓСЋС‰РёР№ РјРѕРґСѓР»СЊ РЅРµ РїРѕРІС‚РѕСЂСЏР» С‚Рµ Р¶Рµ СЂР°Р·РѕР±СЂР°РЅРЅС‹Рµ РіСЂР°Р±Р»Рё.

РўРµРїРµСЂСЊ РІРєР»Р°РґРєР° В«Р”Р°РЅРЅС‹РµВ» СЃР»СѓР¶РёС‚ СЌС‚Р°Р»РѕРЅРѕРј РїРµСЂРµРЅРѕСЃР°: backend в†’ Р°РґР°РїС‚РµСЂС‹ в†’ СЃС‚РѕСЂ в†’ UI в†’ РїСЂРѕРІРµСЂРєР°. РџРѕ СЌС‚РѕР№ СЃС…РµРјРµ РїРѕРґРєР»СЋС‡Р°РµРј РњР°СЃРєРё, РђРєРєР°СѓРЅС‚С‹ Рё РѕСЃС‚Р°Р»СЊРЅС‹Рµ РјРѕРґСѓР»Рё.
