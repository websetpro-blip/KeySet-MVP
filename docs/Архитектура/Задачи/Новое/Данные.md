РџРѕС‡РµРјСѓ В«Р”Р°РЅРЅС‹РµВ» РїР°РґР°РµС‚
1) РќР° Р±СЌРєРµ РЅРµС‚ РјР°СЂС€СЂСѓС‚РѕРІ РїРѕРґ В«Р”Р°РЅРЅС‹РµВ»

Р’Рѕ FastAPI-СЃРµСЂРІРёСЃРµ Сѓ С‚РµР±СЏ Р·Р°РІРµРґРµРЅС‹ РјРѕРє-СЌРЅРґРїРѕРёРЅС‚С‹ С‚РёРїР° accounts, groups, parse, РЅРѕ РЅРµС‚ РЅРё РѕРґРЅРѕРіРѕ СЂРѕСѓС‚Р°, РєРѕС‚РѕСЂС‹Р№ РѕС‚РґР°С‘С‚ СЃРѕРґРµСЂР¶РёРјРѕРµ С‚Р°Р±Р»РёС†С‹ С‡Р°СЃС‚РѕС‚ (СЃРїРёСЃРѕРє С„СЂР°Р· СЃ WS/В«WSВ»/!WS, РіСЂСѓРїРїРѕР№, СЂРµРіРёРѕРЅРѕРј, РґР°С‚РѕР№, РёСЃС‚РѕС‡РЅРёРєРѕРј).
РС‚РѕРі РІ React: РїСЂРё РїРµСЂРІРѕРј СЂРµРЅРґРµСЂРµ РєРѕРјРїРѕРЅРµРЅС‚ В«Р”Р°РЅРЅС‹РµВ» Р±СЊС‘С‚ РІ /api/data... (РёР»Рё РїРѕС…РѕР¶РёР№ URL), РїРѕР»СѓС‡Р°РµС‚ 404/500 Рё РІР°Р»РёС‚СЃСЏ (РѕР±С‹С‡РЅРѕ TypeError: Cannot read properties of undefined РїСЂРё РїРѕРїС‹С‚РєРµ С‡РёС‚Р°С‚СЊ РїРѕР»СЏ Сѓ undefined).

2) РќРµСЃРѕРІРїР°РґРµРЅРёРµ РїРѕР»РµР№ (snake_case vs camelCase)

Р’ Р‘Р”/ORM РїРѕР»СЏ РЅР°Р·С‹РІР°СЋС‚СЃСЏ freq_total, freq_quotes, freq_exact, group, updated_at.
Рђ С„СЂРѕРЅС‚ С‡Р°С‰Рµ Р¶РґС‘С‚ freq/freqQuotes/freqExact/group/updatedAt. Р•СЃР»Рё РІРѕР·РІСЂР°С‰Р°С‚СЊ РєР°Рє РµСЃС‚СЊ, Р±РµР· РјР°РїРїРёРЅРіР°, С‚С‹ Р»РѕРІРёС€СЊ undefined/NaN Рё СЃРєСЂРёРїС‚ СЂРѕРЅСЏРµС‚ СЂРµРЅРґРµСЂ.

3) Р‘Р°Р·Р°: РєРѕР»РѕРЅРѕРє В«groupВ»/В«freq_quotesВ» РјРѕР¶РµС‚ РЅРµ Р±С‹С‚СЊ

РЈ С‚РµР±СЏ РІ РїСЂРѕРµРєС‚Рµ РµСЃС‚СЊ РјРёРіСЂР°С†РёРё РїРѕРґ СЌС‚Рѕ (migrate_add_group.py, migrate_add_freq_quotes.py). Р•СЃР»Рё Р‘Р” СЃРѕР±СЂР°РЅР° РґРѕ СЌС‚РёС… РјРёРіСЂР°С†РёР№, Р»СЋР±РѕР№ Р·Р°РїСЂРѕСЃ, РіРґРµ С„СЂРѕРЅС‚/Р±СЌРє С‚СЂРѕРіР°РµС‚ СЌС‚Рё РїРѕР»СЏ, СѓСЂРѕРЅРёС‚ Р·Р°РїСЂРѕСЃ В«no such columnВ». Р­С‚Рѕ РІС‚РѕСЂРѕР№ С‡Р°СЃС‚С‹Р№ РёСЃС‚РѕС‡РЅРёРє 500 в†’ РїР°РґРµРЅРёРµ В«Р”Р°РЅРЅС‹С…В».

Р§С‚Рѕ РїСЂР°РІРёРј, С‡С‚РѕР±С‹ В«Р”Р°РЅРЅС‹РµВ» Р·Р°РІРµР»РёСЃСЊ СЃ РїРµСЂРІРѕРіРѕ Р·Р°РїСѓСЃРєР°

РќРёР¶Рµ вЂ” РјРёРЅРёРјР°Р»СЊРЅС‹Рµ РїСЂР°РІРєРё. Р”РµР»Р°РµС€СЊ РёС… вЂ” Рё РІРєР»Р°РґРєР° РЅР°С‡РЅС‘С‚ РіСЂСѓР·РёС‚СЊСЃСЏ. РќРёС‡РµРіРѕ РІ СЃС‚РµРєРµ РЅРµ РјРµРЅСЏСЋ.

A) FastAPI: РґРѕР±Р°РІРёС‚СЊ СЂРѕРІРЅРѕ С‚Рµ СЂСѓС‡РєРё, РєРѕС‚РѕСЂС‹С… РЅРµ С…РІР°С‚Р°РµС‚
1) РЎРїРёСЃРѕРє СЃС‚СЂРѕРє РґР»СЏ С‚Р°Р±Р»РёС†С‹ В«Р”Р°РЅРЅС‹РµВ»
# backend/api_server.py
from datetime import datetime
from typing import List, Optional
from pydantic import BaseModel
from sqlalchemy import select

from core.db import SessionLocal
from core.models import FrequencyResult  # __tablename__ = 'freq_results'

class FreqRow(BaseModel):
    id: int
    phrase: str
    freq: int
    freqQuotes: int
    freqExact: int
    group: Optional[str] = None
    region: int
    updatedAt: datetime
    source: str = "Wordstat"

@app.get("/api/data", response_model=List[FreqRow])
def list_data(limit: int = 1000, status: Optional[str] = None):
    with SessionLocal() as s:
        q = select(FrequencyResult).order_by(FrequencyResult.updated_at.desc())
        if status and status != "all":
            q = q.where(FrequencyResult.status == status)
        rows = s.execute(q.limit(limit)).scalars().all()
        return [
            FreqRow(
                id=r.id,
                phrase=r.mask,
                freq=r.freq_total,
                freqQuotes=r.freq_quotes,
                freqExact=r.freq_exact,
                group=r.group,
                region=r.region,
                updatedAt=r.updated_at,
            ) for r in rows
        ]

2) РЈРґР°Р»РµРЅРёРµ РІС‹Р±СЂР°РЅРЅС‹С… СЃС‚СЂРѕРє
from fastapi import HTTPException
from sqlalchemy import delete

class Ids(BaseModel):
    ids: List[int]

@app.post("/api/data/delete")
def delete_data(payload: Ids):
    with SessionLocal() as s:
        if not payload.ids:
            return {"deleted": 0}
        res = s.execute(delete(FrequencyResult).where(FrequencyResult.id.in_(payload.ids)))
        s.commit()
        return {"deleted": res.rowcount or 0}

3) Р­РєСЃРїРѕСЂС‚
import csv, io
from fastapi.responses import StreamingResponse

@app.get("/api/data/export")
def export_data(limit: int = 5000):
    with SessionLocal() as s:
        rows = s.execute(
            select(FrequencyResult).order_by(FrequencyResult.updated_at.desc()).limit(limit)
        ).scalars().all()

    buf = io.StringIO()
    w = csv.writer(buf, delimiter=';')
    w.writerow(["phrase","WS","\"WS\"","!WS","group","region","updatedAt","source"])
    for r in rows:
        w.writerow([r.mask, r.freq_total, r.freq_quotes, r.freq_exact, r.group or "", r.region, r.updated_at.isoformat(), "Wordstat"])
    buf.seek(0)
    return StreamingResponse(buf, media_type="text/csv", headers={
        "Content-Disposition": "attachment; filename=data_export.csv"
    })


Р’Р°Р¶РЅРѕ: CORS СѓР¶Рµ РѕС‚РєСЂС‹С‚ РЅР° localhost:5173/3000 вЂ” РѕСЃС‚Р°РІСЊ РєР°Рє РµСЃС‚СЊ.

B) РњРёРіСЂР°С†РёРё Р‘Р”: РіР°СЂР°РЅС‚РёСЂРѕРІР°С‚СЊ РЅСѓР¶РЅС‹Рµ РєРѕР»РѕРЅРєРё

Р’С‹РїРѕР»РЅРё (РѕРґРЅРѕРєСЂР°С‚РЅРѕ) РјРёРіСЂР°С†РёРё, РµСЃР»Рё Р‘Р” СЃС‚Р°СЂР°СЏ:

# РёР· РєРѕСЂРЅСЏ Р±СЌРєР°
python scripts/migrate_add_group.py
python scripts/migrate_add_freq_quotes.py


Р­С‚Рѕ РґРѕР±Р°РІРёС‚ \group`Рёfreq_quotesРІfreq_results`. Р•СЃР»Рё С‚Р°Р±Р»РёС†С‹ РµС‰С‘ РЅРµС‚ вЂ” РїСЂРё СЃС‚Р°СЂС‚Рµ РѕРЅР° СЃРѕР·РґР°С‘С‚СЃСЏ ORM-РёРЅРёС†РёР°Р»РёР·Р°С‚РѕСЂРѕРј, РЅРѕ РјРёРіСЂР°С†РёРё РІСЃС‘ СЂР°РІРЅРѕ Р±РµР·РѕРїР°СЃРЅС‹.

C) Р¤СЂРѕРЅС‚РµРЅРґ (React): РЅРѕСЂРјР°Р»РёР·РѕРІР°С‚СЊ РѕС‚РІРµС‚ Рё РЅРµ РїР°РґР°С‚СЊ РЅР° РїСѓСЃС‚РѕС‚Рµ

РўРёРї РїРѕРґ С‚Р°Р±Р»РёС†Сѓ:

export type FreqRow = {
  id: number
  phrase: string
  freq: number
  freqQuotes: number
  freqExact: number
  group?: string
  region: number
  updatedAt: string
  source: string
}


Р—Р°РіСЂСѓР·РєР° c Р·Р°С‰РёС‚РѕР№ РѕС‚ 404/РїСѓСЃС‚РѕРіРѕ:

async function fetchData(): Promise<FreqRow[]> {
  const res = await fetch('/api/data');
  if (!res.ok) throw new Error(`API /api/data ${res.status}`);
  const data = await res.json();
  return Array.isArray(data) ? data : [];
}


Р’ РєРѕРјРїРѕРЅРµРЅС‚Рµ В«Р”Р°РЅРЅС‹РµВ» РѕР±СЏР·Р°С‚РµР»СЊРЅРѕ:

РїРѕРєР°Р·С‹РІР°С‚СЊ СЃРїРёРЅРЅРµСЂ while loading,

РЅР° РѕС€РёР±РєРµ вЂ” С‚РѕСЃС‚/Р±Р°РЅРЅРµСЂ, Р° РЅРµ РѕР±СЂР°С‰РµРЅРёРµ Рє rows.length РЅР° undefined,

РЅРµ С‡РёС‚Р°С‚СЊ РїРѕР»СЏ, РїРѕРєР° РјР°СЃСЃРёРІ РЅРµ Р·Р°РіСЂСѓР¶РµРЅ.

РџСЂРёРјРµСЂ Р±РµР·РѕРїР°СЃРЅРѕРіРѕ СЂРµРЅРґРµСЂР°:

const [rows, setRows] = useState<FreqRow[] | null>(null);
const [err, setErr] = useState<string | null>(null);

useEffect(() => {
  fetchData().then(setRows).catch(e => setErr(String(e)));
}, []);

if (err) return <ErrorBanner text={err} />;
if (rows === null) return <Spinner/>;          // в†ђ РЅРµ РїР°РґР°РµРј
return <DataTable rows={rows} />;


РљРЅРѕРїРєРё В«РЈРґР°Р»РёС‚СЊВ», В«Р­РєСЃРїРѕСЂС‚В» вЂ” Р¶РјСѓС‚ РЅР° /api/data/delete Рё /api/data/export (СЃРј. Р±СЌРє РІС‹С€Рµ). РџРѕСЃР»Рµ СѓРґР°Р»РµРЅРёСЏ вЂ” Р»РѕРєР°Р»СЊРЅРѕ РІС‹С‡РµСЃС‚СЊ id РёР· СЃС‚РµР№С‚Р° Р±РµР· РїРѕР»РЅРѕРіРѕ СЂРµС„РµС‚С‡Р°.

РС‚РѕРі: С‡С‚Рѕ РёРјРµРЅРЅРѕ Р»РѕРјР°Р»Рѕ С†РµРїРѕС‡РєСѓ В«Р”Р°РЅРЅС‹РµВ»

РћС‚СЃСѓС‚СЃС‚РІРѕРІР°Р»Рё /api/data-СЂСѓС‡РєРё в†’ С„СЂРѕРЅС‚ Р»РµР· РІ РЅРµСЃСѓС‰РµСЃС‚РІСѓСЋС‰РёР№ URL, РїР°РґР°Р» РїСЂРё РїРѕРїС‹С‚РєРµ С‡РёС‚Р°С‚СЊ РґР°РЅРЅС‹Рµ.

Р Р°Р·РЅС‹Рµ РёРјРµРЅР° РїРѕР»РµР№ (snake_case vs camelCase) в†’ РґР°Р¶Рµ РїСЂРё 200 С„СЂРѕРЅС‚ РІРёРґРµР» undefined Рё СЂРѕРЅСЏР» С‚Р°Р±Р»РёС†Сѓ.

РЎС‚Р°СЂР°СЏ Р‘Р” Р±РµР· РєРѕР»РѕРЅРѕРє group/freq_quotes в†’ 500 РЅР° Р±СЌРєРµ РїСЂРё Р»СЋР±С‹С… Р·Р°РїСЂРѕСЃР°С… Рє В«Р”Р°РЅРЅС‹РјВ».

РџСЂР°РІРєРё РІС‹С€Рµ Р·Р°РєСЂС‹РІР°СЋС‚ РІСЃРµ С‚СЂРё С‚РѕС‡РєРё, РЅРёС‡РµРіРѕ РІ СЃС‚РµРєРµ РЅРµ РјРµРЅСЏСЋС‚, Рё РІРєР»Р°РґРєР° В«Р”Р°РЅРЅС‹РµВ» РЅР°С‡РёРЅР°РµС‚ СЃС‚Р°Р±РёР»СЊРЅРѕ РіСЂСѓР·РёС‚СЊСЃСЏ Рё СЂР°Р±РѕС‚Р°С‚СЊ: СЃРїРёСЃРѕРє, С„РёР»СЊС‚СЂС‹, СѓРґР°Р»РµРЅРёРµ, СЌРєСЃРїРѕСЂС‚.

---

РџСЂРёРЅСЏР». Р”РµР»Р°СЋ РїРѕ РґРµР»Сѓ Рё РїРѕ С‚РІРѕРёРј РІРІРѕРґРЅС‹Рј.

РљРѕСЂРѕС‚РєРѕ: РґР° вЂ” РёР·-Р·Р° Р±СЌРєРµРЅРґР° В«Р”Р°РЅРЅС‹РµВ» РёР·РЅР°С‡Р°Р»СЊРЅРѕ РїР°РґР°Р»Рё. РЎРµР№С‡Р°СЃ РїРѕ С‚РІРѕРёРј РїСЂР°РІРєР°Рј РІРєР»Р°РґРєР° РІСЃС‘ СЂР°РІРЅРѕ РЅРµ РІР·Р»РµС‚РёС‚ РёР·-Р·Р° РЅРµСЃРѕСЃС‚С‹РєРѕРІРєРё РєРѕРЅС‚СЂР°РєС‚Р° API СЃ С„СЂРѕРЅС‚РѕРј РІ С‚СЂС‘С… РјРµСЃС‚Р°С…. РќРёР¶Рµ вЂ” РєРѕРЅРєСЂРµС‚РЅС‹Рµ С‚РѕС‡РµС‡РЅС‹Рµ РїСЂР°РІРєРё, С‡С‚РѕР±С‹ В«Р”Р°РЅРЅС‹РµВ» Р·Р°РіСЂСѓР·РёР»РёСЃСЊ СЃ РїРµСЂРІРѕРіРѕ РїСѓСЃРєР° РЅР° С‚РІРѕС‘Рј СЃС‚РµРєРµ (React + FastAPI), Р±РµР· С„Р°РЅС‚Р°Р·РёР№ Рё Р±РµР· СЃРјРµРЅС‹ С‚РµС…РЅРѕР»РѕРіРёР№. (Р РµРїРѕР·РёС‚РѕСЂРёР№ вЂ” СЌС‚Рѕ СЂРѕРІРЅРѕ С‚РѕС‚ KeySet-MVP СЃ frontend/ Рё backend/, РѕРґРёРЅ exe С‡РµСЂРµР· launcher вЂ” РІРёР¶Сѓ СЃС‚СЂСѓРєС‚СѓСЂСѓ РЅР° GitHub. 
GitHub
)

Р§С‚Рѕ РєРѕРЅРєСЂРµС‚РЅРѕ РµС‰С‘ Р»РѕРјР°РµС‚ В«Р”Р°РЅРЅС‹РµВ» СЃРµР№С‡Р°СЃ

РџР°СЂР°РјРµС‚СЂС‹ Р·Р°РїСЂРѕСЃР°: С„СЂРѕРЅС‚ Р·Р°РїСЂР°С€РёРІР°РµС‚ СЃРїРёСЃРѕРє С„СЂР°Р· СЃ РЅР°Р±РѕСЂРѕРј query-РїР°СЂР°РјРµС‚СЂРѕРІ, РєРѕС‚РѕСЂС‹Рµ Р±СЌРєРµРЅРґ РЅРµ РїСЂРёРЅРёРјР°РµС‚.
РўРёРїРёС‡РЅС‹Рµ вЂ” status, q (СЃС‚СЂРѕРєР° РїРѕРёСЃРєР°), cursor (РєРµР№СЃРµС‚-РєСѓСЂСЃРѕСЂ РїРѕ id), РёРЅРѕРіРґР° sort (updatedAt:desc). Р•СЃР»Рё СЂРѕСѓС‚ РїСЂРёРЅРёРјР°РµС‚ С‚РѕР»СЊРєРѕ limit/status, FastAPI РѕС‚РґР°С‘С‚ 422, Рё React РїР°РґР°РµС‚ РїСЂРё СЂРµРЅРґРµСЂРµ С‚Р°Р±Р»РёС†С‹ (С‡РёС‚Р°СЋС‚ rows.map, Р° rows РЅРµС‚).

РРјРµРЅР° РїРѕР»РµР№ РЅР° РїСЂРѕРІРѕРґРµ.
Р¤СЂРѕРЅС‚ СЂРµРЅРґРµСЂРёС‚ РєРѕР»РѕРЅРєРё РёР· РІРµСЂСЃРёР№ РїРѕР»РµР№, РѕС‚Р»РёС‡РЅС‹С… РѕС‚ В«СЃС‹СЂС‹С…В» ORM: РѕРґРЅРѕРІСЂРµРјРµРЅРЅРѕ РЅСѓР¶РЅС‹ Р±РµР·РѕРїР°СЃРЅС‹Рµ Р°Р»РёР°СЃС‹ ws/wsQuotes/wsExact Рё В«СЂРµР·РµСЂРІРЅС‹РµВ» freq/freqQuotes/freqExact, РїР»СЋСЃ updatedAt (ISO-СЃС‚СЂРѕРєР°), РЅРµ updated_at. Р•СЃР»Рё РІРµСЂРЅСѓС‚СЊ С‚РѕР»СЊРєРѕ В«СЃС‹СЂС‹РµВ» РёРјРµРЅР° вЂ” Р»РѕРІРёС€СЊ undefined в†’ NaN в†’ РїР°РґРµРЅРёРµ.

РћС‚РІРµС‚ СЃРїРёСЃРєР°: С„СЂРѕРЅС‚ Р¶РґС‘С‚ РѕР±С‘СЂС‚РєСѓ СЃ РєСѓСЂСЃРѕСЂРѕРј (keyset) вЂ” РЅРµ РїСЂРѕСЃС‚Рѕ РјР°СЃСЃРёРІ.
РњРёРЅРёРјСѓРј: { items: FreqRow[], nextCursor: number | null }. Р•СЃР»Рё РїСЂРёСЃР»Р°С‚СЊ РїСЂРѕСЃС‚Рѕ [], С‡Р°СЃС‚СЊ Р»РѕРіРёРєРё РїР°РіРёРЅР°С†РёРё/РєРЅРѕРїРѕРє СЂР°СЃСЃС‡РёС‚Р°РЅР° РЅР° РЅР°Р»РёС‡РёРµ items Рё nextCursor в†’ РѕР±СЂР°С‰РµРЅРёРµ Рє СЃРІРѕР№СЃС‚РІР°Рј undefined.

РўРѕС‡РЅС‹Рµ РїСЂР°РІРєРё РІ Р±СЌРєРµРЅРґ (FastAPI)
Р РѕСѓС‚ СЃРїРёСЃРєР° (СЃРѕРІРјРµСЃС‚РёРј Рё СЃ РїСЂРѕСЃС‚С‹Рј, Рё СЃ В«СѓРјРЅС‹РјВ» С„СЂРѕРЅС‚РѕРј)
# backend/routers/data.py
from typing import List, Optional, Dict, Any
from datetime import datetime
from fastapi import APIRouter, Query
from pydantic import BaseModel
from sqlalchemy import select, desc, and_
from keyset.core.db import SessionLocal
from keyset.core.models import FrequencyResult  # freq_results

router = APIRouter(prefix="/api/data", tags=["data"])

class FreqRow(BaseModel):
    id: int
    phrase: str
    # Р°Р»РёР°СЃС‹ РїРѕРґ РѕР±Р° РІР°СЂРёР°РЅС‚Р° С„СЂРѕРЅС‚Р°
    ws: int
    wsQuotes: int
    wsExact: int
    freq: int
    freqQuotes: int
    freqExact: int
    group: Optional[str] = None
    region: int
    source: str = "Wordstat"
    updatedAt: datetime

class ListResp(BaseModel):
    items: List[FreqRow]
    nextCursor: Optional[int] = None

@router.get("/phrases", response_model=ListResp)
def list_phrases(
    limit: int = Query(500, ge=1, le=5000),
    status: Optional[str] = Query(None),
    q: Optional[str] = Query(None),
    cursor: Optional[int] = Query(None),      # РєРµР№СЃРµС‚: id < cursor
    sort: Optional[str] = Query(None),        # РѕР¶РёРґР°СЋС‚ 'updatedAt:desc' / 'id:desc'
):
    with SessionLocal() as s:
        stmt = select(FrequencyResult)

        # С„РёР»СЊС‚СЂР°С†РёСЏ
        if status and status != "all":
            stmt = stmt.where(FrequencyResult.status == status)
        if q:
            like = f"%{q.strip()}%"
            stmt = stmt.where(FrequencyResult.mask.ilike(like))

        # СЃРѕСЂС‚РёСЂРѕРІРєР° (РїРѕ СѓРјРѕР»С‡Р°РЅРёСЋ вЂ” updated_at DESC, id DESC)
        order_desc = True
        if sort:
            field, _, direction = sort.partition(":")
            order_desc = (direction.lower() != "asc")
        primary = desc(FrequencyResult.updated_at) if order_desc else FrequencyResult.updated_at
        secondary = desc(FrequencyResult.id) if order_desc else FrequencyResult.id
        stmt = stmt.order_by(primary, secondary)

        # РєРµР№СЃРµС‚
        if cursor:
            cond = FrequencyResult.id < cursor if order_desc else FrequencyResult.id > cursor
            stmt = stmt.where(cond)

        rows = s.execute(stmt.limit(limit + 1)).scalars().all()

        # РіРѕС‚РѕРІРёРј nextCursor Рё Р°Р»РёР°СЃС‹
        has_more = len(rows) > limit
        rows = rows[:limit]
        next_cursor = rows[-1].id if (has_more and rows) else None

        items = []
        for r in rows:
            item = FreqRow(
                id=r.id,
                phrase=r.mask,
                ws=r.freq_total or 0,
                wsQuotes=r.freq_quotes or 0,
                wsExact=r.freq_exact or 0,
                freq=r.freq_total or 0,          # Р°Р»РёР°СЃ РґР»СЏ СЃС‚Р°СЂРѕРіРѕ С„СЂРѕРЅС‚Р°
                freqQuotes=r.freq_quotes or 0,
                freqExact=r.freq_exact or 0,
                group=getattr(r, "group", None),
                region=r.region or 213,
                updatedAt=r.updated_at,
                source="Wordstat",
            )
            items.append(item)
        return ListResp(items=items, nextCursor=next_cursor)

РЈРґР°Р»РµРЅРёРµ Рё СЌРєСЃРїРѕСЂС‚ (СЃРѕРІРјРµСЃС‚РёРјС‹ СЃ С‚РµРєСѓС‰РёРјРё РІС‹Р·РѕРІР°РјРё)

РўС‹ СѓР¶Рµ РґРѕРїРёР»РёР» delete_results Рё export_results РІ keyset/services/frequency.py; РѕСЃС‚Р°РІР»СЏРµРј, РЅРѕ РїСЂРёРІРѕРґРёРј СЂРѕСѓС‚С‹ Рє РѕР¶РёРґР°РµРјС‹Рј РїСѓС‚СЏРј:

from fastapi import Body
from fastapi.responses import StreamingResponse
from keyset.services.frequency import delete_results, export_results

@router.post("/delete")
def delete_phrases(payload: Dict[str, Any] = Body(...)):
    ids = payload.get("ids") or []
    return {"deleted": delete_results(ids)}

@router.get("/export")
def export_csv(limit: int = 5000):
    rows = export_results(limit=limit)
    def _stream():
        yield "phrase;WS;\"WS\";!WS;group;region;updatedAt;source\r\n"
        for r in rows:
            yield f"{r.mask};{r.freq_total};{r.freq_quotes};{r.freq_exact};{r.group or ''};{r.region};{r.updated_at.isoformat()};Wordstat\r\n"
    return StreamingResponse(_stream(), media_type="text/csv",
                             headers={"Content-Disposition":"attachment; filename=data_export.csv"})

РђРІС‚РѕРґРѕР±Р°РІР»РµРЅРёРµ РєРѕР»РѕРЅРѕРє

РћСЃС‚Р°РІР»СЏРµРј С‚РІРѕР№ В«РґРѕРєРёРЅСѓС‚СЊ РєРѕР»РѕРЅРєРё РїСЂРё СЃС‚Р°СЂС‚РµВ», РЅРѕ РІР°Р¶РЅРѕ: СЌС‚РѕС‚ Р±Р»РѕРє РґРѕР»Р¶РµРЅ РѕС‚СЂР°Р±Р°С‚С‹РІР°С‚СЊ РїСЂРё РёРјРїРѕСЂС‚Рµ РїР°РєРµС‚Р° Р‘Р”, РґРѕ СЂРµРіРёСЃС‚СЂР°С†РёРё СЂРѕСѓС‚РµСЂРѕРІ. РџСЂРѕРІРµСЂСЊ, С‡С‚Рѕ РІС‹Р·РѕРІ РёРЅРёС†РёР°Р»РёР·Р°С†РёРё РІС‹РїРѕР»РЅРёС‚СЃСЏ РЅР° uvicorn СЃС‚Р°СЂС‚Рµ, Р° РЅРµ С‚РѕР»СЊРєРѕ РїСЂРё СЂСѓС‡РЅРѕРј Р·Р°РїСѓСЃРєРµ СЃРєСЂРёРїС‚Р°.

Р•СЃР»Рё РЅСѓР¶РЅРѕ РјРёРЅРёРјР°Р»СЊРЅРѕ С‚СЂРѕРЅСѓС‚СЊ С„СЂРѕРЅС‚ (С‡С‚РѕР±С‹ С‚РѕС‡РЅРѕ РЅРµ РїР°РґР°Р»)

Р‘РµР·РѕРїР°СЃРЅР°СЏ РѕР±РІСЏР·РєР° Р·Р°РіСЂСѓР·РєРё:

const [resp, setResp] = useState<{items: FreqRow[], nextCursor:number|null} | null>(null);
useEffect(() => { fetch('/api/data/phrases?limit=500&status=all&sort=updatedAt:desc')
  .then(r => r.ok ? r.json() : Promise.reject(r.status))
  .then(setResp)
  .catch(e => setResp({items: [], nextCursor: null}));
}, []);
if (!resp) return <Spinner/>;
return <DataTable rows={resp.items} />;


Р РµРЅРґРµСЂ РєРѕР»РѕРЅРѕРє С‡РµСЂРµР· Р°Р»РёР°СЃС‹:

// Р‘РµСЂС‘Рј ws/wsQuotes/wsExact, fallback РЅР° freq/freqQuotes/freqExact
const toNumber = (v:any)=> Number.isFinite(v) ? v : 0;
const colWS = toNumber(row.ws ?? row.freq);

РљРѕРЅС‚СЂРѕР»СЊ, С‡С‚Рѕ С‚РµРїРµСЂСЊ В«Р”Р°РЅРЅС‹РµВ» Р¶РёРІСѓС‚

РЎРїРёСЃРѕРє (РґРѕР»Р¶РµРЅ РІРµСЂРЅСѓС‚СЊ {items:[], nextCursor} Рё 200)

curl "http://127.0.0.1:8765/api/data/phrases?limit=5&status=all&sort=updatedAt:desc"


РџРѕРёСЃРє (200 Рё Р»РёР±Рѕ РїСѓСЃС‚С‹Рµ items, Р»РёР±Рѕ РЅР°Р№РґРµРЅРЅС‹Рµ)

curl "http://127.0.0.1:8765/api/data/phrases?q=СЂРµРјРѕРЅС‚&limit=5"


РљРµР№СЃРµС‚-РїР°РіРёРЅР°С†РёСЏ (РІС‚РѕСЂРѕР№ Р·Р°С…РѕРґ РїРѕ nextCursor)

curl ".../phrases?limit=5&cursor=<Р’РЎРўРђР’Р¬_ID_РР—_РџР Р•Р”Р«Р”РЈР©Р•Р“Рћ_РћРўР’Р•РўРђ>"


РЈРґР°Р»РµРЅРёРµ (200, {deleted: N})

curl -X POST "http://127.0.0.1:8765/api/data/delete" -H "Content-Type: application/json" -d "{\"ids\":[1,2,3]}"


Р­РєСЃРїРѕСЂС‚ (СЃРєР°С‡РёРІР°РµС‚СЃСЏ CSV)

curl -I "http://127.0.0.1:8765/api/data/export"

РћС‚РІРµС‚ РЅР° С‚РІРѕР№ РїСЂСЏРјРѕР№ РІРѕРїСЂРѕСЃ

Р”Р°: РїРµСЂРІРѕРЅР°С‡Р°Р»СЊРЅР°СЏ РїСЂРёС‡РёРЅР° РїР°РґРµРЅРёР№ В«Р”Р°РЅРЅС‹С…В» Р±С‹Р»Р° РЅР° Р±СЌРєРµ вЂ” РѕС‚СЃСѓС‚СЃС‚РІРѕРІР°Р»Рё РєРѕСЂСЂРµРєС‚РЅС‹Рµ СЂСѓС‡РєРё Рё РјР°РїРїРёРЅРі РїРѕР»РµР№, С„СЂРѕРЅС‚ РїРѕР»СѓС‡Р°Р» 404/422/РЅРµ С‚РѕС‚ JSON Рё РїР°РґР°Р». РЎРµР№С‡Р°СЃ, С‡С‚РѕР±С‹ С‚РѕС‡РЅРѕ РЅРµ Р±С‹Р»Рѕ РїРѕРІС‚РѕСЂРЅРѕРіРѕ В«РµР±*СЃСЏВ», СЏ Р·Р°Р»РѕР¶РёР» СЃРѕРІРјРµСЃС‚РёРјРѕСЃС‚СЊ В«СЃ РґРІСѓС… СЃС‚РѕСЂРѕРЅВ»:

Р±СЌРєРµРЅРґ РїСЂРёРЅРёРјР°РµС‚ В«Р»РёС€РЅРёРµВ» РїР°СЂР°РјРµС‚СЂС‹ (q, cursor, sort) Рё РѕС‚РґР°С‘С‚ Рё СЃС‚Р°СЂС‹Рµ, Рё РЅРѕРІС‹Рµ РёРјРµРЅР° РїРѕР»РµР№;

РѕС‚РІРµС‚ вЂ” РІ РѕР¶РёРґР°РµРјРѕР№ РѕР±С‘СЂС‚РєРµ {items, nextCursor};
вЂ” РїРѕСЃР»Рµ СЌС‚РѕРіРѕ РІРєР»Р°РґРєР° В«Р”Р°РЅРЅС‹РµВ» РЅР°С‡РёРЅР°РµС‚ РіСЂСѓР·РёС‚СЊСЃСЏ РїСЂРµРґСЃРєР°Р·СѓРµРјРѕ (СЃС‚СЂСѓРєС‚СѓСЂР° РїСЂРѕРµРєС‚Р° вЂ” С‚РѕС‚ СЃР°РјС‹Р№ React-С„СЂРѕРЅС‚ + FastAPI, РµРґРёРЅС‹Р№ Р»Р°СѓРЅС‡РµСЂ/СЌРєР·Рµ, СЃРј. РѕРїРёСЃР°РЅРёРµ СЂРµРїРѕР·РёС‚РѕСЂРёСЏ. 
GitHub
)

Р•СЃР»Рё С…РѕС‡РµС€СЊ вЂ” СЃРіРµРЅРµСЂСЋ РїР°С‚С‡-С„Р°Р№Р» (git diff) СЃС‚СЂРѕРіРѕ РїРѕРґ С‚РІРѕРё РїСѓС‚Рё backend/routers/data.py + РєРѕСЂРѕС‚РєРёР№ unit-С‚РµСЃС‚, РєРѕС‚РѕСЂС‹Р№ РґРµСЂРЅС‘С‚ РІСЃРµ 5 РїСЂРѕРІРµСЂРѕРє РІС‹С€Рµ.

