# Обзор каталога `бд/инструкции/Архитектура/Задачи/Новое`

Файлы в этой папке задают правила работы над KeySet-MVP и фиксируют ошибки предыдущих подходов. Ниже — краткий конспект, чтобы перед любой правкой быстро вспомнить контекст и требования.

## 1. Что лежит в каталоге
- `Схема перехода софта.md` — длинное исследование гибрида «тонкий клиент + удалённый UI». Объясняет, зачем держать React-интерфейс на VPS, а локально оставлять только окно, бэкенд и тяжёлые зависимости (Playwright, БД и т.п.). Содержит аналоги (Figma/Slack/Discord), риски, стек и инфраструктурные шаги.
- `Схема перехода софта 1.md` — сокращённый пошаговый план для локального MVP на 8–12 часов: монорепа `KeySet-MVP`, копирование готовых модулей, FastAPI + PyWebView лаунчер, PyInstaller-упаковка.
- `ПАМЯТКА_Codex.md` — чеклист для Codex: всегда читать «Схемы», переносить HTML/CSS/JS 1:1, соблюдать UTF-8, после каждой задачи обновлять `бд/…/ГОТОВЫЕ_МОДУЛИ_план.md`.
- `Исправление` — отчёт об ошибках (делал UI с нуля, выбросил готовые стили/скрипты, недотянул зависимости). В конце есть конкретный план рефакторинга по модулям и требование сделать документ «Что перенесено».
- `Архитектура.txt` — техническая документация парсера: слои системы, Playwright/CDP пайплайн, модели БД (`Account`, `Proxy`, `Task`, `FrequencyResult`), рабочие процессы и риски. Нужна для понимания требований к LocalAgent.
- `скрины/` — эталонные изображения UI (используем для визуальной сверки).

## 2. Ключевые требования из документов
### 2.1 Памятка Codex
- Любой файл читаем и пишем строго в UTF-8 (`Get/Set-Content -Encoding utf8`).
- Перед началом работы перечитываем обе «Схемы» и памятку, сверяемся с требованиями.
- Не изобретаем UI — берём исходники из `C:\AI\yandex\ГОТОВЫЕ МОДУЛИ\<модуль>\`.
- После правок прогоняем `npm run build`, `python launcher.py`, сравниваем UI со скринами и обновляем `ГОТОВЫЕ_МОДУЛИ_план.md`.

### 2.2 Схемы перехода
- Вариант архитектуры: локальный лаунчер (PyWebView + FastAPI) открывает React UI, который физически находится на VPS и разблокируется по подписке. Локально остаются тяжёлые зависимости и Playwright.
- Для текущего этапа достаточно локального MVP (`KeySet-MVP`): React-вкладки + FastAPI мок эндпоинты + PyInstaller.

### 2.3 Исправление (что нужно переделать)
1. **Аккаунты**: разобрать `ГОТОВЫЕ МОДУЛИ/аккаунты/keyset-v2-fixed/index.html` на React-компоненты, скопировать `styles.css`, перенести логику из `script.js`/`enhanced-search.js` в TypeScript (`utils.ts`, `store.ts` и т.д.), убрать FontAwesome CDN.
2. **Маски**: установить все либы из оригинального `package.json` (jszip, fast-xml-parser, т.п.), проверить работу генераторов.
3. **Данные**: вернуть типизацию (убрать `@ts-nocheck`), подключить все стили из `styles/`, починить импорты.
4. **Аналитика**: убедиться, что Supabase переменные читаются из `.env`, а Tailwind-конфиг совпадает.
5. **Документация**: подготовить отчёт «Что перенесено» + добавить скрины «до/после» в `ГОТОВЫЕ_МОДУЛИ_план.md`.

### 2.4 Архитектура парсера
- UI (Tabs) → Worker слой (QThread MultiParsingWorker) → парсер (`turbo_parser_improved.py`) → Playwright/Chromium.
- Аккаунты хранят path к профилю Chrome, куки, proxy, статистику банов и связаны с задачами.
- `Task` описывает запуск парсинга (seed файл, регион, headless, статус, пути логов).
- `FrequencyResult` хранит частотности (WS, "WS", !WS) и состояние обработки.
- Эти сущности нужно учитывать при проектировании API LocalAgent и базы.

## 3. Текущий статус KeySet-MVP (07.11.2025)
- Монорепа создана (`frontend` + `backend` + `launcher.py`), маршруты `/accounts|/masks|/data|/analytics` работают.
- Аккаунты подключены через встраивание `legacy/index.html` и `script.js` (временно без разбивки на React).
- Маски, Данные, Аналитика скопированы, но требуют сверки зависимостей и окружения.
- FastAPI (`backend/main.py`) отдаёт `frontend/dist` и пару моков (`/api/health`, `/api/accounts`).
- PyWebView лаунчер стартует uvicorn и открывает UI.

## 4. Ближайшие действия (по приоритету)
1. **Аккаунты**: начать выносить структуру в React. Минимум — создать `modules/accounts/components` и перенести Toolbar + таблицу, запитать их от TS-версии `script.js`. На этом же шаге подготовить typed store вместо DOM‑манипуляций.
2. **Маски**: сверить `package.json` из `ГОТОВЫЕ МОДУЛИ/Маски` с текущим `frontend`, добавить недостающие зависимости и проверить `npm run build`.
3. **Данные**: убрать остатки `@ts-nocheck`, прогнать ESLint/tsc, поправить импорты и убедиться, что все стили попали.
4. **Аналитика**: вынести Supabase ключи в `.env`, Настроить `import.meta.env`, актуализировать README по переменным окружения.
5. **Документация**: расширить `бд/.../ГОТОВЫЕ_МОДУЛИ_план.md` таблицей «Что перенесено» (модуль, из каких файлов, статус, доказательства). Добавить ссылки на скриншоты из `скрины/`.

Этот файл держим в актуальном состоянии: обновляем после каждого прохода по каталогу «Новое» или появления новых инструкций.
