# 11. –ü–æ—Ç–æ–∫–∏ –¥–∞–Ω–Ω—ã—Ö KeySet-MVP

> **–î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è –∂–∏–∑–Ω–µ–Ω–Ω–æ–≥–æ —Ü–∏–∫–ª–∞ –¥–∞–Ω–Ω—ã—Ö: UI ‚Üí API ‚Üí Parser ‚Üí DB ‚Üí UI**

## üìã –°–æ–¥–µ—Ä–∂–∞–Ω–∏–µ

- [–¶–µ–ª—å](#—Ü–µ–ª—å)
- [–î–ª—è –∫–æ–≥–æ](#–¥–ª—è-–∫–æ–≥–æ)
- [–°–≤—è–∑–∞–Ω–Ω—ã–µ –¥–æ–∫—É–º–µ–Ω—Ç—ã](#—Å–≤—è–∑–∞–Ω–Ω—ã–µ-–¥–æ–∫—É–º–µ–Ω—Ç—ã)
- [–û–±—â–∞—è —Å—Ö–µ–º–∞ –ø–æ—Ç–æ–∫–∞ –¥–∞–Ω–Ω—ã—Ö](#–æ–±—â–∞—è-—Å—Ö–µ–º–∞-–ø–æ—Ç–æ–∫–∞-–¥–∞–Ω–Ω—ã—Ö)
- [–î–∏–∞–≥—Ä–∞–º–º–∞ –ø–æ—Å–ª–µ–¥–æ–≤–∞—Ç–µ–ª—å–Ω–æ—Å—Ç–∏](#–¥–∏–∞–≥—Ä–∞–º–º–∞-–ø–æ—Å–ª–µ–¥–æ–≤–∞—Ç–µ–ª—å–Ω–æ—Å—Ç–∏)
- [–û—Å–Ω–æ–≤–Ω—ã–µ —Å—Ü–µ–Ω–∞—Ä–∏–∏](#–æ—Å–Ω–æ–≤–Ω—ã–µ-—Å—Ü–µ–Ω–∞—Ä–∏–∏)
- [–°–Ω–∏–ø–ø–µ—Ç—ã –∫–æ–¥–∞](#—Å–Ω–∏–ø–ø–µ—Ç—ã-–∫–æ–¥–∞)
- [–¢–∏–ø–æ–≤—ã–µ –æ—à–∏–±–∫–∏](#—Ç–∏–ø–æ–≤—ã–µ-–æ—à–∏–±–∫–∏)
- [–ë—ã—Å—Ç—Ä—ã–π —Å—Ç–∞—Ä—Ç](#–±—ã—Å—Ç—Ä—ã–π-—Å—Ç–∞—Ä—Ç)
- [TL;DR](#tldr)
- [–ß–µ–∫-–ª–∏—Å—Ç –ø—Ä–∏–º–µ–Ω–µ–Ω–∏—è](#—á–µ–∫-–ª–∏—Å—Ç-–ø—Ä–∏–º–µ–Ω–µ–Ω–∏—è)

---

## –¶–µ–ª—å

–î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è –ø–æ—Ç–æ–∫–æ–≤ –¥–∞–Ω–Ω—ã—Ö KeySet-MVP: –æ—Ç –≤–≤–æ–¥–∞ —Ñ—Ä–∞–∑ –≤ UI –¥–æ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤ –≤ –ë–î –∏ –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏—è –≤ –∞–Ω–∞–ª–∏—Ç–∏–∫–µ.

## –î–ª—è –∫–æ–≥–æ

- Tech Lead –¥–ª—è –æ—Ü–µ–Ω–∫–∏ end-to-end –ø–æ—Ç–æ–∫–∞
- Backend –∏ frontend —Ä–∞–∑—Ä–∞–±–æ—Ç—á–∏–∫–∏
- QA –¥–ª—è —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è —Å–∫–≤–æ–∑–Ω—ã—Ö —Å—Ü–µ–Ω–∞—Ä–∏–µ–≤
- Data analysts –¥–ª—è –ø–æ–Ω–∏–º–∞–Ω–∏—è –∏—Å—Ç–æ—á–Ω–∏–∫–æ–≤ –¥–∞–Ω–Ω—ã—Ö

## –°–≤—è–∑–∞–Ω–Ω—ã–µ –¥–æ–∫—É–º–µ–Ω—Ç—ã

- [06_PARSING.md](./06_PARSING.md) ‚Äî –ø–∞—Ä—Å–∏–Ω–≥ —Å–∏—Å—Ç–µ–º–∞
- [10_API_INTEGRATION.md](./10_API_INTEGRATION.md) ‚Äî API –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è
- [01_DATABASE.md](./01_DATABASE.md) ‚Äî —Å—Ç—Ä—É–∫—Ç—É—Ä–∞ –ë–î
- [09_TABS_OVERVIEW.md](./09_TABS_OVERVIEW.md) ‚Äî UI –º–æ–¥—É–ª–∏

---

## –û–±—â–∞—è —Å—Ö–µ–º–∞ –ø–æ—Ç–æ–∫–∞ –¥–∞–Ω–Ω—ã—Ö

```mermaid
graph TD
    A[Frontend UI] -->|GraphQL/REST| B[API Layer]
    B -->|Commands| C[Task Queue]
    C -->|Tasks| D[Parsing Workers]
    D -->|CDP Requests| E[Yandex Wordstat]
    E -->|Responses| D
    D -->|Results| F[Database]
    F -->|Queries| G[Analytics Engine]
    G -->|Data| A
    F -->|Exports| H[CSV/XLSX]
```

---

## –î–∏–∞–≥—Ä–∞–º–º–∞ –ø–æ—Å–ª–µ–¥–æ–≤–∞—Ç–µ–ª—å–Ω–æ—Å—Ç–∏

```mermaid
sequenceDiagram
    participant UI as Frontend UI
    participant API as API Server
    participant Worker as Parsing Worker
    participant DB as Database
    participant WS as WebSocket
    participant YA as Yandex API
    
    UI->>API: POST /api/wordstat/start (phrases, region_id)
    API->>Worker: enqueue task
    Worker->>YA: fetch frequency
    YA-->>Worker: frequency JSON
    Worker->>DB: save freq_results
    Worker->>WS: send progress update
    WS-->>UI: real-time updates
    UI->>API: GET /api/data/phrases
    API->>DB: query results
    DB-->>API: rows
    API-->>UI: table data
```

---

## –û—Å–Ω–æ–≤–Ω—ã–µ —Å—Ü–µ–Ω–∞—Ä–∏–∏

### 1. –ó–∞–ø—É—Å–∫ –ø–∞—Ä—Å–∏–Ω–≥–∞
- –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –≤–≤–æ–¥–∏—Ç —Å–ø–∏—Å–æ–∫ —Ñ—Ä–∞–∑
- –í—ã–±–∏—Ä–∞–µ—Ç —Ä–µ–≥–∏–æ–Ω –∏ –∞–∫–∫–∞—É–Ω—Ç—ã
- UI –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç –∑–∞–ø—Ä–æ—Å `/api/wordstat/start`
- API —Å–æ–∑–¥–∞—ë—Ç –∑–∞–¥–∞—á—É –≤ –æ—á–µ—Ä–µ–¥–∏
- Worker —Ä–∞—Å–ø—Ä–µ–¥–µ–ª—è–µ—Ç —Ñ—Ä–∞–∑—ã –ø–æ –∞–∫–∫–∞—É–Ω—Ç–∞–º

### 2. –û–±—Ä–∞–±–æ—Ç–∫–∞ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤
- Worker –ø–æ–ª—É—á–∞–µ—Ç –æ—Ç–≤–µ—Ç—ã –æ—Ç Yandex API
- –ü–∞—Ä—Å–∏—Ç JSON –∏ —Å–æ—Ö—Ä–∞–Ω—è–µ—Ç –¥–∞–Ω–Ω—ã–µ –≤ —Ç–∞–±–ª–∏—Ü—É `freq_results`
- –û—Ç–ø—Ä–∞–≤–ª—è–µ—Ç –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è —á–µ—Ä–µ–∑ WebSocket
- API –ø—Ä–µ–¥–æ—Å—Ç–∞–≤–ª—è–µ—Ç —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã —á–µ—Ä–µ–∑ `/api/data/phrases`

### 3. –ê–Ω–∞–ª–∏—Ç–∏–∫–∞
- Analytics Tab –∑–∞–ø—Ä–∞—à–∏–≤–∞–µ—Ç –∞–≥—Ä–µ–≥–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ
- –ò—Å–ø–æ–ª—å–∑—É–µ—Ç –ø–æ–∫–∞–∑–∞—Ç–µ–ª–∏ –¥–ª—è –≥—Ä–∞—Ñ–∏–∫–æ–≤ –∏ –æ—Ç—á—ë—Ç–æ–≤

---

## –°–Ω–∏–ø–ø–µ—Ç—ã –∫–æ–¥–∞

### –ü–æ—Å—Ç–∞–Ω–æ–≤–∫–∞ –∑–∞–¥–∞—á–∏ –ø–∞—Ä—Å–∏–Ω–≥–∞

```python
# —Ñ–∞–π–ª: keyset/services/multiparser_manager.py:TBD-TBD
```

### –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤ –≤ –ë–î

```python
# —Ñ–∞–π–ª: backend/db.py:TBD-TBD
```

### WebSocket –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ

```python
# —Ñ–∞–π–ª: backend/main.py:TBD-TBD
```

### Frontend –∑–∞–ø—Ä–æ—Å –¥–∞–Ω–Ω—ã—Ö

```typescript
// —Ñ–∞–π–ª: frontend/src/modules/data/api/data.ts:TBD-TBD
```

---

## –¢–∏–ø–æ–≤—ã–µ –æ—à–∏–±–∫–∏

### ‚ùå –û—à–∏–±–∫–∞: "Data not syncing between tabs"

**–ü—Ä–∏—á–∏–Ω–∞:** –ù–µ—Ç –ø–æ–¥–ø–∏—Å–∫–∏ –Ω–∞ WebSocket –∏–ª–∏ state –Ω–µ –æ–±–Ω–æ–≤–ª—è–µ—Ç—Å—è.

**–†–µ—à–µ–Ω–∏–µ:**
- –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–µ –∫ WS
- –û–±–Ω–æ–≤–ª—è—Ç—å Zustand store –ø—Ä–∏ –ø–æ–ª—É—á–µ–Ω–∏–∏ —Å–æ–æ–±—â–µ–Ω–∏–π
- –î–æ–±–∞–≤–∏—Ç—å fallback –Ω–∞ polling

### ‚ùå –û—à–∏–±–∫–∞: "Stale data in analytics"

**–ü—Ä–∏—á–∏–Ω–∞:** –ö—ç—à–∏—Ä–æ–≤–∞–Ω–∏–µ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤ –±–µ–∑ –∏–Ω–≤–∞–ª–∏–¥–∏—Ä–æ–≤–∞–Ω–∏—è.

**–†–µ—à–µ–Ω–∏–µ:**
- –î–æ–±–∞–≤–∏—Ç—å —Ñ–ª–∞–≥ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è
- –û—á–∏—Å—Ç–∏—Ç—å –∫—ç—à –ø—Ä–∏ –Ω–æ–≤—ã—Ö –¥–∞–Ω–Ω—ã—Ö
- –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å timestamp –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è

### ‚ùå –û—à–∏–±–∫–∞: "Missing region_id in results"

**–ü—Ä–∏—á–∏–Ω–∞:** region_id –Ω–µ –ø–µ—Ä–µ–¥–∞–Ω –¥–æ –ø–∞—Ä—Å–∏–Ω–≥–∞.

**–†–µ—à–µ–Ω–∏–µ:**
- –ü—Ä–æ–≤–µ—Ä–∏—Ç—å payload –∑–∞–¥–∞—á–∏
- –£–±–µ–¥–∏—Ç—å—Å—è —á—Ç–æ UI –ø–µ—Ä–µ–¥–∞–µ—Ç –≤—ã–±—Ä–∞–Ω–Ω—ã–π —Ä–µ–≥–∏–æ–Ω
- –õ–æ–≥–∏—Ä–æ–≤–∞—Ç—å region_id –≤ worker

---

## –ë—ã—Å—Ç—Ä—ã–π —Å—Ç–∞—Ä—Ç

### 1. –¢—Ä–∞—Å—Å–∏—Ä–æ–≤–∫–∞ –ø–æ—Ç–æ–∫–∞ –¥–∞–Ω–Ω—ã—Ö

```mermaid
graph LR
    UI[UI] --> API[API]
    API --> Worker[Worker]
    Worker --> DB[DB]
    DB --> UI
```

### 2. –ü—Ä–æ–≤–µ—Ä–∫–∞ –¥–∞–Ω–Ω—ã—Ö –≤ –ë–î

```sql
SELECT phrase, shows, region_id
FROM freq_results
ORDER BY created_at DESC
LIMIT 20;
```

### 3. –ü–æ–¥–ø–∏—Å–∫–∞ –Ω–∞ WebSocket

```typescript
const ws = new WebSocket('ws://localhost:8000/ws');

ws.onmessage = (event) => {
  const data = JSON.parse(event.data);
  updateDataStore(data);
};
```

---

## TL;DR

- **UI ‚Üí API ‚Üí Worker ‚Üí DB ‚Üí UI** ‚Äî –æ—Å–Ω–æ–≤–Ω–æ–π —Ü–∏–∫–ª –¥–∞–Ω–Ω—ã—Ö
- **WebSocket** ‚Äî real-time –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è —Å—Ç–∞—Ç—É—Å–æ–≤
- **freq_results** ‚Äî –æ—Å–Ω–æ–≤–Ω–∞—è —Ç–∞–±–ª–∏—Ü–∞ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤
- **region_id** ‚Äî –æ–±—è–∑–∞—Ç–µ–ª—å–Ω—ã–π –ø–∞—Ä–∞–º–µ—Ç—Ä –¥–ª—è –≤—Å–µ—Ö –∑–∞–ø–∏—Å–µ–π
- **Zustand** ‚Äî —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—è –¥–∞–Ω–Ω—ã—Ö –º–µ–∂–¥—É –≤–∫–ª–∞–¥–∫–∞–º–∏

---

## –ß–µ–∫-–ª–∏—Å—Ç –ø—Ä–∏–º–µ–Ω–µ–Ω–∏—è

- [ ] UI –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç –¥–∞–Ω–Ω—ã–µ –Ω–∞ API
- [ ] API –≤–∞–ª–∏–¥–∏—Ä—É–µ—Ç payload –∑–∞–¥–∞—á–∏
- [ ] Worker —Å–æ—Ö—Ä–∞–Ω—è–µ—Ç —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã –≤ –ë–î
- [ ] WebSocket –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è –¥–æ—Ö–æ–¥—è—Ç –¥–æ UI
- [ ] Analytics –ø–æ–ª—É—á–∞–µ—Ç –∞–∫—Ç—É–∞–ª—å–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ
- [ ] region_id –ø—Ä–∏—Å—É—Ç—Å—Ç–≤—É–µ—Ç –≤ –∫–∞–∂–¥–æ–π –∑–∞–ø–∏—Å–∏
- [ ] –û—à–∏–±–∫–∏ –ª–æ–≥–∏—Ä—É—é—Ç—Å—è –Ω–∞ –≤—Å–µ—Ö —ç—Ç–∞–ø–∞—Ö
- [ ] –¢–µ—Å—Ç—ã –ø–æ–∫—Ä—ã–≤–∞—é—Ç –≤–µ—Å—å –ø–æ—Ç–æ–∫ –¥–∞–Ω–Ω—ã—Ö
- [ ] –≠–∫—Å–ø–æ—Ä—Ç–∏—Ä—É–µ—Ç –¥–∞–Ω–Ω—ã–µ –≤ CSV/XLSX
- [ ] –ú–µ—Ç—Ä–∏–∫–∏ –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏ —Å–æ–±–∏—Ä–∞—é—Ç—Å—è

---

**–ü–æ—Å–ª–µ–¥–Ω–µ–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ:** 2024-11-10

**–°–ª–µ–¥—É—é—â–∏–π —à–∞–≥:** [12_PRODUCTION_WINDOWS_BUILD.md](./12_PRODUCTION_WINDOWS_BUILD.md) ‚Äî Production —Å–±–æ—Ä–∫–∞ Windows
