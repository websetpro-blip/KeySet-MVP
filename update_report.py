# -*- coding: utf-8 -*-
"""Append encoding fix report to the main report file."""

report_file = r"C:\AI\yandex\–±–¥\–∏–Ω—Å—Ç—Ä—É–∫—Ü–∏–∏\–ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞\–ó–∞–¥–∞—á–∏\–û—Ç—á–µ—Ç\–ß–¢–û –£–ñ–ï –°–î–ï–õ–ê–õ.md"

new_section = """

## 12.11.2025 ‚Äî –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –∫—Ä–∞–∫–æ–∑—è–±—Ä (UTF-8 encoding) –≤ API responses

- üîç –í—ã—è–≤–ª–µ–Ω–∞ –ø—Ä–æ–±–ª–µ–º–∞: `/api/accounts` –≤–æ–∑–≤—Ä–∞—â–∞–ª –∫—Ä–∞–∫–æ–∑—è–±—Ä—ã –≤–º–µ—Å—Ç–æ —Ä—É—Å—Å–∫–æ–≥–æ —Ç–µ–∫—Å—Ç–∞ (¬´–ê–≤—Ç–æ—Ä–∏–∑–æ–≤–∞–Ω¬ª –æ—Ç–æ–±—Ä–∞–∂–∞–ª—Å—è –∫–∞–∫ ¬´√ê√ê¬≤√ë√ê¬æ√ë√ê¬∏√ê¬∑√ê¬æ√ê¬≤√ê¬∞√ê¬Ω¬ª).
- üìç –ö–æ—Ä–µ–Ω—å –ø—Ä–æ–±–ª–µ–º—ã: –í —Ñ–∞–π–ª–µ `backend/routers/accounts.py` —Å—Ç—Ä–æ–∫–æ–≤—ã–µ –ª–∏—Ç–µ—Ä–∞–ª—ã —Å —Ä—É—Å—Å–∫–∏–º —Ç–µ–∫—Å—Ç–æ–º (lines 75-84 –≤ —Ñ—É–Ω–∫—Ü–∏–∏ `_map_status`) –±—ã–ª–∏ –Ω–µ–ø—Ä–∞–≤–∏–ª—å–Ω–æ –∑–∞–∫–æ–¥–∏—Ä–æ–≤–∞–Ω—ã.
- ‚úèÔ∏è –†–µ—à–µ–Ω–∏–µ:
  1. –°–æ–∑–¥–∞–Ω —Å–∫—Ä–∏–ø—Ç `fix_encoding.py` –¥–ª—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–π –ø–µ—Ä–µ–∫–æ–¥–∏—Ä–æ–≤–∫–∏ —Ñ–∞–π–ª–∞.
  2. –°–∫—Ä–∏–ø—Ç —á–∏—Ç–∞–µ—Ç —Ñ–∞–π–ª –∫–∞–∫ UTF-8 bytes –∏ –ø—Ä–∞–≤–∏–ª—å–Ω–æ —Å–æ—Ö—Ä–∞–Ω—è–µ—Ç –æ–±—Ä–∞—Ç–Ω–æ —Å –∫–æ—Ä—Ä–µ–∫—Ç–Ω—ã–º–∏ —Ä—É—Å—Å–∫–∏–º–∏ —Å—Ç—Ä–æ–∫–∞–º–∏.
  3. –ò—Å–ø—Ä–∞–≤–ª–µ–Ω—ã –≤—Å–µ —Å—Ç–∞—Ç—É—Å—ã: ¬´–ê–≤—Ç–æ—Ä–∏–∑–æ–≤–∞–Ω¬ª, ¬´–í —Ä–∞–±–æ—Ç–µ¬ª, ¬´–¢—Ä–µ–±—É–µ—Ç—Å—è –∫–∞–ø—á–∞¬ª, ¬´–ó–∞–±–ª–æ–∫–∏—Ä–æ–≤–∞–Ω¬ª, ¬´–û—à–∏–±–∫–∞¬ª, ¬´–ù–µ–∏–∑–≤–µ—Å—Ç–Ω–æ¬ª.
- ‚úÖ –†–µ–∑—É–ª—å—Ç–∞—Ç:
  - API response `/api/accounts` —Ç–µ–ø–µ—Ä—å –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç –∫–æ—Ä—Ä–µ–∫—Ç–Ω—ã–π UTF-8: `authStatus: '–ê–≤—Ç–æ—Ä–∏–∑–æ–≤–∞–Ω'`.
  - –ë–∞–π—Ç—ã UTF-8: `b'\\xd0\\x90\\xd0\\xb2\\xd1\\x82\\xd0\\xbe\\xd1\\x80\\xd0\\xb8\\xd0\\xb7\\xd0\\xbe\\xd0\\xb2\\xd0\\xb0\\xd0\\xbd'`.
  - –ë—Ä–∞—É–∑–µ—Ä –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ –æ—Ç–æ–±—Ä–∞–∂–∞–µ—Ç —Ä—É—Å—Å–∫–∏–π —Ç–µ–∫—Å—Ç –≤ UI.
  - –ö–æ–Ω—Å–æ–ª—å Windows –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç mojibake –∏–∑-–∑–∞ cp1251, –Ω–æ —ç—Ç–æ –Ω–µ –≤–ª–∏—è–µ—Ç –Ω–∞ —Ä–∞–±–æ—Ç—É –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è.

**–§–∞–π–ª—ã –∏–∑–º–µ–Ω–µ–Ω—ã:**
- `backend/routers/accounts.py` (lines 75-84): –∏—Å–ø—Ä–∞–≤–ª–µ–Ω—ã —Å—Ç—Ä–æ–∫–æ–≤—ã–µ –ª–∏—Ç–µ—Ä–∞–ª—ã —Å —Ä—É—Å—Å–∫–∏–º —Ç–µ–∫—Å—Ç–æ–º
- `fix_encoding.py`: —Å–æ–∑–¥–∞–Ω –≤—Ä–µ–º–µ–Ω–Ω—ã–π —Å–∫—Ä–∏–ø—Ç –¥–ª—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–π –ø–µ—Ä–µ–∫–æ–¥–∏—Ä–æ–≤–∫–∏

**–¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ:**
```python
resp = requests.get('http://127.0.0.1:57143/api/accounts')
data[0]['authStatus']  # Returns correct UTF-8: '–ê–≤—Ç–æ—Ä–∏–∑–æ–≤–∞–Ω'
```
"""

try:
    with open(report_file, 'r', encoding='utf-8') as f:
        content = f.read()

    with open(report_file, 'w', encoding='utf-8') as f:
        f.write(content + new_section)

    print("OK: Report updated")
except Exception as e:
    print(f"Error: {e}")
